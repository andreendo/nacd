
> wp-calypso@0.17.0 pretest /benchmarks/nacd/Automattic_wp-calypso
> npm run -s install-if-deps-outdated


> wp-calypso@0.17.0 test /benchmarks/nacd/Automattic_wp-calypso
> run-s -s test-client test-packages test-server

FAIL client/post-editor/media-modal/test/markup.js
  ● markup › #get() › should return an empty string if not passed any arguments

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › #get() › should return an empty string if not passed any arguments

    TypeError: Cannot read property 'get' of undefined

      30 | 	describe( '#get()', () => {
      31 | 		test( 'should return an empty string if not passed any arguments', () => {
    > 32 | 			const value = markup.get( site );
         | 			                     ^
      33 | 
      34 | 			expect( value ).to.equal( '' );
      35 | 		} );

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:32:25)

  ● markup › #get() › should defer to a specific mime type handler if one exists

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › #get() › should defer to a specific mime type handler if one exists

    TypeError: Cannot read property 'mimeTypes' of undefined

      36 | 
      37 | 		test( 'should defer to a specific mime type handler if one exists', () => {
    > 38 | 			sandbox.stub( markup.mimeTypes, 'image' );
         | 			                     ^
      39 | 			markup.get( site, { mime_type: 'image/png' } );
      40 | 
      41 | 			expect( markup.mimeTypes.image ).to.have.been.called;

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:38:25)

  ● markup › #get() › should return a link for a mime type prefix without a specific handler

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › #get() › should return a link for a mime type prefix without a specific handler

    Trying to stub property 'link' of undefined

      43 | 
      44 | 		test( 'should return a link for a mime type prefix without a specific handler', () => {
    > 45 | 			sandbox.stub( markup, 'link' );
         | 			        ^
      46 | 			markup.get( site, { mime_type: 'application/pdf' } );
      47 | 
      48 | 			expect( markup.link ).to.have.been.called;

      at throwOnFalsyObject (node_modules/sinon/lib/sinon/throw-on-falsy-object.js:7:15)
      at stub (node_modules/sinon/lib/sinon/stub.js:32:24)
      at Sandbox.stub (node_modules/sinon/lib/sinon/sandbox.js:318:33)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:45:12)

  ● markup › #link() › should return a link for a mime type prefix without a specific handler

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › #link() › should return a link for a mime type prefix without a specific handler

    TypeError: Cannot read property 'link' of undefined

      52 | 	describe( '#link()', () => {
      53 | 		test( 'should return a link for a mime type prefix without a specific handler', () => {
    > 54 | 			const value = markup.link( {
         | 			                     ^
      55 | 				URL: 'http://example.com/wp-content/uploads/document.pdf',
      56 | 				title: 'document',
      57 | 			} );

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:54:25)

  ● markup › #caption() › should accept a media object, returning a caption element

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › #caption() › should accept a media object, returning a caption element

    TypeError: Cannot read property 'caption' of undefined

      65 | 	describe( '#caption()', () => {
      66 | 		test( 'should accept a media object, returning a caption element', () => {
    > 67 | 			const value = markup.caption( site, {
         | 			                     ^
      68 | 				ID: 1,
      69 | 				URL: 'https://s1.wp.com/wp-content/themes/a8c/automattic-2011/images/automattic-logo.png',
      70 | 				alt: 'Automattic',

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:67:25)

  ● markup › #caption() › should accept a non-captioned image, returning null

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › #caption() › should accept a non-captioned image, returning null

    TypeError: Cannot read property 'caption' of undefined

      81 | 
      82 | 		test( 'should accept a non-captioned image, returning null', () => {
    > 83 | 			const value = markup.caption( site, {
         | 			                     ^
      84 | 				ID: 1,
      85 | 				URL: 'https://s1.wp.com/wp-content/themes/a8c/automattic-2011/images/automattic-logo.png',
      86 | 				alt: 'Automattic',

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:83:25)

  ● markup › #caption() › should accept a captioned string, returning a React element

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › #caption() › should accept a captioned string, returning a React element

    TypeError: Cannot read property 'caption' of undefined

      93 | 
      94 | 		test( 'should accept a captioned string, returning a React element', () => {
    > 95 | 			const value = markup.caption(
         | 			                     ^
      96 | 				site,
      97 | 				'[caption id="attachment_1627" align="aligncenter" width="660"]<img class="size-full wp-image-1627" src="https://andrewmduthietest.files.wordpress.com/2015/01/img_0372.jpg" alt="Example" width="660" height="660" /> Ceramic[/caption]'
      98 | 			);

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:95:25)

  ● markup › .mimeTypes › #image() › should not set width auto if media width cannot be determined

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should not set width auto if media width cannot be determined

    TypeError: Cannot read property 'mimeTypes' of undefined

      108 | 		describe( '#image()', () => {
      109 | 			test( 'should not set width auto if media width cannot be determined', () => {
    > 110 | 				const value = markup.mimeTypes.image( site, {
          | 				                     ^
      111 | 					ID: 'media-4',
      112 | 					URL: 'http%3A//example.com/ddd1d6b0-f31b-4937-ae9e-97f1d660cf71',
      113 | 					thumbnails: {},

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:110:26)

  ● markup › .mimeTypes › #image() › should return an img element for an image

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should return an img element for an image

    TypeError: Cannot read property 'mimeTypes' of undefined

      120 | 
      121 | 			test( 'should return an img element for an image', () => {
    > 122 | 				const value = markup.mimeTypes.image( site, {
          | 				                     ^
      123 | 					ID: 1,
      124 | 					URL: 'https://s1.wp.com/wp-content/themes/a8c/automattic-2011/images/automattic-logo.png',
      125 | 					alt: 'Automattic',

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:122:26)

  ● markup › .mimeTypes › #image() › should respect the max width for a site size

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should respect the max width for a site size

    TypeError: Cannot read property 'mimeTypes' of undefined

      141 | 				};
      142 | 
    > 143 | 				const value = markup.mimeTypes.image(
          | 				                     ^
      144 | 					siteWithLargeSize,
      145 | 					{
      146 | 						ID: 1,

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:143:26)

  ● markup › .mimeTypes › #image() › should respect the max height for a site size

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should respect the max height for a site size

    TypeError: Cannot read property 'mimeTypes' of undefined

      166 | 				};
      167 | 
    > 168 | 				const value = markup.mimeTypes.image(
          | 				                     ^
      169 | 					siteWithLargeSize,
      170 | 					{
      171 | 						ID: 1,

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:168:26)

  ● markup › .mimeTypes › #image() › should include a resize parameter if forceResize option passed

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should include a resize parameter if forceResize option passed

    TypeError: Cannot read property 'mimeTypes' of undefined

      184 | 
      185 | 			test( 'should include a resize parameter if forceResize option passed', () => {
    > 186 | 				const value = markup.mimeTypes.image(
          | 				                     ^
      187 | 					site,
      188 | 					{
      189 | 						ID: 1,

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:186:26)

  ● markup › .mimeTypes › #image() › should avoid XSS because React

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should avoid XSS because React

    TypeError: Cannot read property 'mimeTypes' of undefined

      203 | 
      204 | 			test( 'should avoid XSS because React', () => {
    > 205 | 				const value = markup.mimeTypes.image( site, {
          | 				                     ^
      206 | 					ID: 1,
      207 | 					URL: '""><SCRIPT>alert("XSS")</SCRIPT>"',
      208 | 					thumbnails: {},

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:205:26)

  ● markup › .mimeTypes › #image() › should attempt to find the site's thumbnail width if a size is specified

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should attempt to find the site's thumbnail width if a size is specified

    TypeError: Cannot read property 'mimeTypes' of undefined

      223 | 				};
      224 | 
    > 225 | 				value = markup.mimeTypes.image(
          | 				               ^
      226 | 					siteWithWidth,
      227 | 					{
      228 | 						ID: 1,

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:225:20)

  ● markup › .mimeTypes › #image() › should attempt to find the media's own thumbnail width if a size is specified

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should attempt to find the media's own thumbnail width if a size is specified

    TypeError: Cannot read property 'mimeTypes' of undefined

      245 | 				const jetpackSite = { jetpack: true };
      246 | 
    > 247 | 				value = markup.mimeTypes.image(
          | 				               ^
      248 | 					jetpackSite,
      249 | 					{
      250 | 						ID: 1,

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:247:20)

  ● markup › .mimeTypes › #image() › should wrap a captioned image in a caption shortcode

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should wrap a captioned image in a caption shortcode

    TypeError: Cannot read property 'mimeTypes' of undefined

      265 | 
      266 | 			test( 'should wrap a captioned image in a caption shortcode', () => {
    > 267 | 				const value = markup.mimeTypes.image( site, {
          | 				                     ^
      268 | 					ID: 1,
      269 | 					URL: 'https://s1.wp.com/wp-content/themes/a8c/automattic-2011/images/automattic-logo.png',
      270 | 					alt: 'Automattic',

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:267:26)

  ● markup › .mimeTypes › #image() › should calculate the height when specifying a size

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should calculate the height when specifying a size

    TypeError: Cannot read property 'mimeTypes' of undefined

      280 | 
      281 | 			test( 'should calculate the height when specifying a size', () => {
    > 282 | 				const value = markup.mimeTypes.image(
          | 				                     ^
      283 | 					site,
      284 | 					{
      285 | 						ID: 1,

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:282:26)

  ● markup › .mimeTypes › #image() › should include a data-istransient="istransient" attribute when media.transient is truthy

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should include a data-istransient="istransient" attribute when media.transient is truthy

    TypeError: Cannot read property 'mimeTypes' of undefined

      300 | 
      301 | 			test( 'should include a data-istransient="istransient" attribute when media.transient is truthy', () => {
    > 302 | 				const value = markup.mimeTypes.image( site, {
          | 				                     ^
      303 | 					ID: 1,
      304 | 					URL: 'https://s1.wp.com/wp-content/themes/a8c/automattic-2011/images/automattic-logo.png',
      305 | 					alt: 'Automattic',

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:302:26)

  ● markup › .mimeTypes › #image() › should not include a data-istransient attribute when media.transient is falsy

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should not include a data-istransient attribute when media.transient is falsy

    TypeError: Cannot read property 'mimeTypes' of undefined

      316 | 
      317 | 			test( 'should not include a data-istransient attribute when media.transient is falsy', () => {
    > 318 | 				const value = markup.mimeTypes.image( site, {
          | 				                     ^
      319 | 					ID: 1,
      320 | 					URL: 'https://s1.wp.com/wp-content/themes/a8c/automattic-2011/images/automattic-logo.png',
      321 | 					alt: 'Automattic',

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:318:26)

  ● markup › .mimeTypes › #audio() › should return an `audio` shortcode for an audio item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #audio() › should return an `audio` shortcode for an audio item

    TypeError: Cannot read property 'mimeTypes' of undefined

      334 | 		describe( '#audio()', () => {
      335 | 			test( 'should return an `audio` shortcode for an audio item', () => {
    > 336 | 				const value = markup.mimeTypes.audio( site, {
          | 				                     ^
      337 | 					URL: 'http://example.com/wp-content/uploads/2015/06/loop.mp3',
      338 | 				} );
      339 | 

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:336:26)

  ● markup › .mimeTypes › #video() › should return a `wpvideo` shortcode for a VideoPress video

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #video() › should return a `wpvideo` shortcode for a VideoPress video

    TypeError: Cannot read property 'mimeTypes' of undefined

      346 | 		describe( '#video()', () => {
      347 | 			test( 'should return a `wpvideo` shortcode for a VideoPress video', () => {
    > 348 | 				const value = markup.mimeTypes.video( site, {
          | 				                     ^
      349 | 					videopress_guid: '11acMj3O',
      350 | 				} );
      351 | 

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:348:26)

  ● markup › .mimeTypes › #video() › should return a `video` shortcode for a video

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #video() › should return a `video` shortcode for a video

    TypeError: Cannot read property 'mimeTypes' of undefined

      354 | 
      355 | 			test( 'should return a `video` shortcode for a video', () => {
    > 356 | 				const value = markup.mimeTypes.video( site, {
          | 				                     ^
      357 | 					URL: 'http://example.com/wp-content/uploads/2015/06/loop.mp4',
      358 | 					height: 454,
      359 | 					width: 1436,

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:356:26)

FAIL client/blocks/post-status/test/index.jsx
  ● Console

    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.

  ● PostStatus › no post › should be empty

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › no post › should be empty

    TypeError: Cannot read property 'contextTypes' of undefined

      18 | 		test( 'should be empty', () => {
      19 | 			const PostStatusComponent = <PostStatus translate={ identity } />;
    > 20 | 			const wrapper = shallow( PostStatusComponent );
         | 			                ^
      21 | 
      22 | 			expect( wrapper ).to.be.empty;
      23 | 		} );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:20:20)

  ● PostStatus › post › sticky › should render the primary components

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › sticky › should render the primary components

    TypeError: Cannot read property 'contextTypes' of undefined

      28 | 			test( 'should render the primary components', () => {
      29 | 				const PostStatusComponent = <PostStatus post={ { sticky: true } } translate={ identity } />;
    > 30 | 				const wrapper = shallow( PostStatusComponent );
         | 				                ^
      31 | 
      32 | 				expect( wrapper ).to.have.descendants( 'span' );
      33 | 				expect( wrapper ).to.have.className( 'is-sticky' );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:30:21)

  ● PostStatus › post › not sticky › pending › should render the primary components

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › not sticky › pending › should render the primary components

    TypeError: Cannot read property 'contextTypes' of undefined

      46 | 						<PostStatus post={ { sticky: false, status: 'pending' } } translate={ identity } />
      47 | 					);
    > 48 | 					const wrapper = shallow( PostStatusComponent );
         | 					                ^
      49 | 
      50 | 					expect( wrapper ).to.have.descendants( 'span' );
      51 | 					expect( wrapper ).to.have.className( 'is-pending' );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:48:22)

  ● PostStatus › post › not sticky › future › showAll › should render the primary components

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › not sticky › future › showAll › should render the primary components

    TypeError: Cannot read property 'contextTypes' of undefined

      68 | 							/>
      69 | 						);
    > 70 | 						const wrapper = shallow( PostStatusComponent );
         | 						                ^
      71 | 
      72 | 						expect( wrapper ).to.have.descendants( 'span' );
      73 | 						expect( wrapper ).to.have.className( 'is-scheduled' );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:70:23)

  ● PostStatus › post › not sticky › future › not showAll › should be empty

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › not sticky › future › not showAll › should be empty

    TypeError: Cannot read property 'contextTypes' of undefined

      85 | 							<PostStatus post={ { sticky: false, status: 'future' } } translate={ identity } />
      86 | 						);
    > 87 | 						const wrapper = shallow( PostStatusComponent );
         | 						                ^
      88 | 
      89 | 						expect( wrapper ).to.be.empty;
      90 | 					} );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:87:23)

  ● PostStatus › post › not sticky › trash › showAll › should render the primary components

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › not sticky › trash › showAll › should render the primary components

    TypeError: Cannot read property 'contextTypes' of undefined

      102 | 							/>
      103 | 						);
    > 104 | 						const wrapper = shallow( PostStatusComponent );
          | 						                ^
      105 | 
      106 | 						expect( wrapper ).to.have.descendants( 'span' );
      107 | 						expect( wrapper ).to.have.className( 'is-trash' );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:104:23)

  ● PostStatus › post › not sticky › trash › not showAll › should be empty

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › not sticky › trash › not showAll › should be empty

    TypeError: Cannot read property 'contextTypes' of undefined

      119 | 							<PostStatus post={ { sticky: false, status: 'trash' } } translate={ identity } />
      120 | 						);
    > 121 | 						const wrapper = shallow( PostStatusComponent );
          | 						                ^
      122 | 
      123 | 						expect( wrapper ).to.be.empty;
      124 | 					} );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:121:23)

  ● PostStatus › post › not sticky › draft › showAll › should render the primary components

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › not sticky › draft › showAll › should render the primary components

    TypeError: Cannot read property 'contextTypes' of undefined

      136 | 							/>
      137 | 						);
    > 138 | 						const wrapper = shallow( PostStatusComponent );
          | 						                ^
      139 | 
      140 | 						expect( wrapper ).to.have.descendants( 'span' );
      141 | 						expect( wrapper ).to.have.className( 'is-draft' );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:138:23)

  ● PostStatus › post › not sticky › draft › not showAll › should be empty

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › not sticky › draft › not showAll › should be empty

    TypeError: Cannot read property 'contextTypes' of undefined

      153 | 							<PostStatus post={ { sticky: false, status: 'draft' } } translate={ identity } />
      154 | 						);
    > 155 | 						const wrapper = shallow( PostStatusComponent );
          | 						                ^
      156 | 
      157 | 						expect( wrapper ).to.be.empty;
      158 | 					} );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:155:23)

  ● PostStatus › post › not sticky › publish › showAll › should render the primary components

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › not sticky › publish › showAll › should render the primary components

    TypeError: Cannot read property 'contextTypes' of undefined

      170 | 							/>
      171 | 						);
    > 172 | 						const wrapper = shallow( PostStatusComponent );
          | 						                ^
      173 | 
      174 | 						expect( wrapper ).to.have.descendants( 'span' );
      175 | 						expect( wrapper ).to.have.className( 'is-published' );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:172:23)

  ● PostStatus › post › not sticky › publish › not showAll › should be empty

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › not sticky › publish › not showAll › should be empty

    TypeError: Cannot read property 'contextTypes' of undefined

      187 | 							<PostStatus post={ { sticky: false, status: 'publish' } } translate={ identity } />
      188 | 						);
    > 189 | 						const wrapper = shallow( PostStatusComponent );
          | 						                ^
      190 | 
      191 | 						expect( wrapper ).to.be.empty;
      192 | 					} );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:189:23)

  ● PostStatus › post › not sticky › unhandled status › should be empty

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › not sticky › unhandled status › should be empty

    TypeError: Cannot read property 'contextTypes' of undefined

      199 | 						<PostStatus post={ { sticky: false, status: 'wow' } } translate={ identity } />
      200 | 					);
    > 201 | 					const wrapper = shallow( PostStatusComponent );
          | 					                ^
      202 | 
      203 | 					expect( wrapper ).to.be.empty;
      204 | 				} );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:201:22)

FAIL client/lib/media/test/list-store.js
  ● MediaListStore › #get() › should return a single value

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #get() › should return a single value

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #get() › should return a single value

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      85 | 					siteId: DUMMY_SITE_ID,
      86 | 					data: DUMMY_MEDIA_RESPONSE,
    > 87 | 					query: MediaListStore.getNextPageQuery(
         | 					                      ^
      88 | 						action && action.siteId ? action.siteId : DUMMY_SITE_ID
      89 | 					),
      90 | 				},

      at dispatchReceiveMediaItems (client/lib/media/test/list-store.js:87:28)
      at Object.<anonymous> (client/lib/media/test/list-store.js:124:4)

  ● MediaListStore › #get() › should return undefined for an item that does not exist

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #get() › should return undefined for an item that does not exist

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #get() › should return undefined for an item that does not exist

    TypeError: Cannot read property 'get' of undefined

      128 | 
      129 | 		test( 'should return undefined for an item that does not exist', () => {
    > 130 | 			expect( MediaListStore.get( DUMMY_SITE_ID, DUMMY_MEDIA_ID + 1 ) ).to.be.undefined;
          | 			                       ^
      131 | 		} );
      132 | 	} );
      133 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:130:27)

  ● MediaListStore › #getAll() › should return all received media

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #getAll() › should return all received media

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #getAll() › should return all received media

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      85 | 					siteId: DUMMY_SITE_ID,
      86 | 					data: DUMMY_MEDIA_RESPONSE,
    > 87 | 					query: MediaListStore.getNextPageQuery(
         | 					                      ^
      88 | 						action && action.siteId ? action.siteId : DUMMY_SITE_ID
      89 | 					),
      90 | 				},

      at dispatchReceiveMediaItems (client/lib/media/test/list-store.js:87:28)
      at Object.<anonymous> (client/lib/media/test/list-store.js:136:4)

  ● MediaListStore › #getAll() › should sort media by date, with newest first

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #getAll() › should sort media by date, with newest first

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #getAll() › should sort media by date, with newest first

    TypeError: Cannot read property 'get' of undefined

      145 | 			];
      146 | 
    > 147 | 			MediaStore.get.restore();
          | 			           ^
      148 | 			sandbox.stub( MediaStore, 'get' ).callsFake( function( siteId, postId ) {
      149 | 				return find( media, { ID: postId } );
      150 | 			} );

      at Object.<anonymous> (client/lib/media/test/list-store.js:147:15)

  ● MediaListStore › #getAll() › should secondary sort media by ID, with larger first

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #getAll() › should secondary sort media by ID, with larger first

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #getAll() › should secondary sort media by ID, with larger first

    TypeError: Cannot read property 'get' of undefined

      161 | 			];
      162 | 
    > 163 | 			MediaStore.get.restore();
          | 			           ^
      164 | 			sandbox.stub( MediaStore, 'get' ).callsFake( function( siteId, postId ) {
      165 | 				return find( media, { ID: postId } );
      166 | 			} );

      at Object.<anonymous> (client/lib/media/test/list-store.js:163:15)

  ● MediaListStore › #getAll() › should not sort media if the source is marked as not having a date

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #getAll() › should not sort media if the source is marked as not having a date

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #getAll() › should not sort media if the source is marked as not having a date

    TypeError: Cannot read property 'get' of undefined

      178 | 			const query = { number: 2, source: 'pexels' };
      179 | 
    > 180 | 			MediaStore.get.restore();
          | 			           ^
      181 | 			dispatchSetQuery( { query } );
      182 | 
      183 | 			sandbox.stub( MediaStore, 'get' ).callsFake( function( siteId, postId ) {

      at Object.<anonymous> (client/lib/media/test/list-store.js:180:15)

  ● MediaListStore › #getAll() › should return undefined for a fetching site

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #getAll() › should return undefined for a fetching site

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #getAll() › should return undefined for a fetching site

    TypeError: handler is not a function

      67 | 
      68 | 	function dispatchFetchMedia( action ) {
    > 69 | 		handler( {
         | 		^
      70 | 			action: assign(
      71 | 				{
      72 | 					type: 'FETCH_MEDIA_ITEMS',

      at dispatchFetchMedia (client/lib/media/test/list-store.js:69:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:193:4)

  ● MediaListStore › #getAll() › should return an empty array for a site with no media

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #getAll() › should return an empty array for a site with no media

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #getAll() › should return an empty array for a site with no media

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      85 | 					siteId: DUMMY_SITE_ID,
      86 | 					data: DUMMY_MEDIA_RESPONSE,
    > 87 | 					query: MediaListStore.getNextPageQuery(
         | 					                      ^
      88 | 						action && action.siteId ? action.siteId : DUMMY_SITE_ID
      89 | 					),
      90 | 				},

      at dispatchReceiveMediaItems (client/lib/media/test/list-store.js:87:28)
      at Object.<anonymous> (client/lib/media/test/list-store.js:199:4)

  ● MediaListStore › #getNextPageQuery() › should include default parameters if no query provided

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #getNextPageQuery() › should include default parameters if no query provided

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #getNextPageQuery() › should include default parameters if no query provided

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      205 | 	describe( '#getNextPageQuery()', () => {
      206 | 		test( 'should include default parameters if no query provided', () => {
    > 207 | 			expect( MediaListStore.getNextPageQuery( DUMMY_SITE_ID ) ).to.eql(
          | 			                       ^
      208 | 				MediaListStore.DEFAULT_QUERY
      209 | 			);
      210 | 		} );

      at Object.<anonymous> (client/lib/media/test/list-store.js:207:27)

  ● MediaListStore › #getNextPageQuery() › should include page_handle if the previous response included next_page meta

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #getNextPageQuery() › should include page_handle if the previous response included next_page meta

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #getNextPageQuery() › should include page_handle if the previous response included next_page meta

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      85 | 					siteId: DUMMY_SITE_ID,
      86 | 					data: DUMMY_MEDIA_RESPONSE,
    > 87 | 					query: MediaListStore.getNextPageQuery(
         | 					                      ^
      88 | 						action && action.siteId ? action.siteId : DUMMY_SITE_ID
      89 | 					),
      90 | 				},

      at dispatchReceiveMediaItems (client/lib/media/test/list-store.js:87:28)
      at Object.<anonymous> (client/lib/media/test/list-store.js:213:4)

  ● MediaListStore › #getNextPageQuery() › should preserve the query from the previous request

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #getNextPageQuery() › should preserve the query from the previous request

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #getNextPageQuery() › should preserve the query from the previous request

    TypeError: handler is not a function

      55 | 
      56 | 	function dispatchSetQuery( action ) {
    > 57 | 		handler( {
         | 		^
      58 | 			action: assign(
      59 | 				{
      60 | 					type: 'SET_MEDIA_QUERY',

      at dispatchSetQuery (client/lib/media/test/list-store.js:57:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:223:4)

  ● MediaListStore › #getNextPageQuery() › should reset the page handle when the query changes

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #getNextPageQuery() › should reset the page handle when the query changes

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #getNextPageQuery() › should reset the page handle when the query changes

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      85 | 					siteId: DUMMY_SITE_ID,
      86 | 					data: DUMMY_MEDIA_RESPONSE,
    > 87 | 					query: MediaListStore.getNextPageQuery(
         | 					                      ^
      88 | 						action && action.siteId ? action.siteId : DUMMY_SITE_ID
      89 | 					),
      90 | 				},

      at dispatchReceiveMediaItems (client/lib/media/test/list-store.js:87:28)
      at Object.<anonymous> (client/lib/media/test/list-store.js:240:4)

  ● MediaListStore › #hasNextPage() › should return true if the previous response included next_page meta

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #hasNextPage() › should return true if the previous response included next_page meta

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #hasNextPage() › should return true if the previous response included next_page meta

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      85 | 					siteId: DUMMY_SITE_ID,
      86 | 					data: DUMMY_MEDIA_RESPONSE,
    > 87 | 					query: MediaListStore.getNextPageQuery(
         | 					                      ^
      88 | 						action && action.siteId ? action.siteId : DUMMY_SITE_ID
      89 | 					),
      90 | 				},

      at dispatchReceiveMediaItems (client/lib/media/test/list-store.js:87:28)
      at Object.<anonymous> (client/lib/media/test/list-store.js:254:4)

  ● MediaListStore › #hasNextPage() › should return true if the site is unknown

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #hasNextPage() › should return true if the site is unknown

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #hasNextPage() › should return true if the site is unknown

    TypeError: Cannot read property 'hasNextPage' of undefined

      258 | 
      259 | 		test( 'should return true if the site is unknown', () => {
    > 260 | 			expect( MediaListStore.hasNextPage( DUMMY_SITE_ID ) ).to.be.ok;
          | 			                       ^
      261 | 		} );
      262 | 
      263 | 		test( 'should return false if the previous response did not include next_page meta', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:260:27)

  ● MediaListStore › #hasNextPage() › should return false if the previous response did not include next_page meta

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #hasNextPage() › should return false if the previous response did not include next_page meta

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #hasNextPage() › should return false if the previous response did not include next_page meta

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      85 | 					siteId: DUMMY_SITE_ID,
      86 | 					data: DUMMY_MEDIA_RESPONSE,
    > 87 | 					query: MediaListStore.getNextPageQuery(
         | 					                      ^
      88 | 						action && action.siteId ? action.siteId : DUMMY_SITE_ID
      89 | 					),
      90 | 				},

      at dispatchReceiveMediaItems (client/lib/media/test/list-store.js:87:28)
      at Object.<anonymous> (client/lib/media/test/list-store.js:264:4)

  ● MediaListStore › #isFetchingNextPage() › should return false no request has been made

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isFetchingNextPage() › should return false no request has been made

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isFetchingNextPage() › should return false no request has been made

    TypeError: Cannot read property 'isFetchingNextPage' of undefined

      270 | 	describe( '#isFetchingNextPage()', () => {
      271 | 		test( 'should return false no request has been made', () => {
    > 272 | 			expect( MediaListStore.isFetchingNextPage( DUMMY_SITE_ID ) ).to.not.be.ok;
          | 			                       ^
      273 | 		} );
      274 | 
      275 | 		test( 'should return true if site media is being fetched', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:272:27)

  ● MediaListStore › #isFetchingNextPage() › should return true if site media is being fetched

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isFetchingNextPage() › should return true if site media is being fetched

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isFetchingNextPage() › should return true if site media is being fetched

    TypeError: handler is not a function

      67 | 
      68 | 	function dispatchFetchMedia( action ) {
    > 69 | 		handler( {
         | 		^
      70 | 			action: assign(
      71 | 				{
      72 | 					type: 'FETCH_MEDIA_ITEMS',

      at dispatchFetchMedia (client/lib/media/test/list-store.js:69:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:276:4)

  ● MediaListStore › #isFetchingNextPage() › should return false if site media was received

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isFetchingNextPage() › should return false if site media was received

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isFetchingNextPage() › should return false if site media was received

    TypeError: handler is not a function

      67 | 
      68 | 	function dispatchFetchMedia( action ) {
    > 69 | 		handler( {
         | 		^
      70 | 			action: assign(
      71 | 				{
      72 | 					type: 'FETCH_MEDIA_ITEMS',

      at dispatchFetchMedia (client/lib/media/test/list-store.js:69:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:282:4)

  ● MediaListStore › #isFetchingNextPage() › should return false when the query was changed

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isFetchingNextPage() › should return false when the query was changed

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isFetchingNextPage() › should return false when the query was changed

    TypeError: handler is not a function

      67 | 
      68 | 	function dispatchFetchMedia( action ) {
    > 69 | 		handler( {
         | 		^
      70 | 			action: assign(
      71 | 				{
      72 | 					type: 'FETCH_MEDIA_ITEMS',

      at dispatchFetchMedia (client/lib/media/test/list-store.js:69:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:289:4)

  ● MediaListStore › #isItemMatchingQuery › should return true if no query exists for site

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isItemMatchingQuery › should return true if no query exists for site

    TypeError: Cannot read property 'isItemMatchingQuery' of undefined

      298 | 
      299 | 		beforeAll( function() {
    > 300 | 			isItemMatchingQuery = MediaListStore.isItemMatchingQuery;
          | 			                                     ^
      301 | 		} );
      302 | 
      303 | 		test( 'should return true if no query exists for site', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:300:41)

  ● MediaListStore › #isItemMatchingQuery › should return true if no query exists for site

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isItemMatchingQuery › should return true if no query exists for site

    TypeError: isItemMatchingQuery is not a function

      302 | 
      303 | 		test( 'should return true if no query exists for site', () => {
    > 304 | 			const matches = isItemMatchingQuery( DUMMY_SITE_ID, DUMMY_MEDIA_OBJECT );
          | 			                ^
      305 | 
      306 | 			expect( matches ).to.be.true;
      307 | 		} );

      at Object.<anonymous> (client/lib/media/test/list-store.js:304:20)

  ● MediaListStore › #isItemMatchingQuery › should return false if a search query is specified, but the item doesn't match

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isItemMatchingQuery › should return false if a search query is specified, but the item doesn't match

    TypeError: Cannot read property 'isItemMatchingQuery' of undefined

      298 | 
      299 | 		beforeAll( function() {
    > 300 | 			isItemMatchingQuery = MediaListStore.isItemMatchingQuery;
          | 			                                     ^
      301 | 		} );
      302 | 
      303 | 		test( 'should return true if no query exists for site', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:300:41)

  ● MediaListStore › #isItemMatchingQuery › should return false if a search query is specified, but the item doesn't match

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isItemMatchingQuery › should return false if a search query is specified, but the item doesn't match

    TypeError: handler is not a function

      55 | 
      56 | 	function dispatchSetQuery( action ) {
    > 57 | 		handler( {
         | 		^
      58 | 			action: assign(
      59 | 				{
      60 | 					type: 'SET_MEDIA_QUERY',

      at dispatchSetQuery (client/lib/media/test/list-store.js:57:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:310:4)

  ● MediaListStore › #isItemMatchingQuery › should return true if a search query is specified, and the item matches

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isItemMatchingQuery › should return true if a search query is specified, and the item matches

    TypeError: Cannot read property 'isItemMatchingQuery' of undefined

      298 | 
      299 | 		beforeAll( function() {
    > 300 | 			isItemMatchingQuery = MediaListStore.isItemMatchingQuery;
          | 			                                     ^
      301 | 		} );
      302 | 
      303 | 		test( 'should return true if no query exists for site', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:300:41)

  ● MediaListStore › #isItemMatchingQuery › should return true if a search query is specified, and the item matches

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isItemMatchingQuery › should return true if a search query is specified, and the item matches

    TypeError: handler is not a function

      55 | 
      56 | 	function dispatchSetQuery( action ) {
    > 57 | 		handler( {
         | 		^
      58 | 			action: assign(
      59 | 				{
      60 | 					type: 'SET_MEDIA_QUERY',

      at dispatchSetQuery (client/lib/media/test/list-store.js:57:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:318:4)

  ● MediaListStore › #isItemMatchingQuery › should return true if a search query is specified, and the item matches case insensitive

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isItemMatchingQuery › should return true if a search query is specified, and the item matches case insensitive

    TypeError: Cannot read property 'isItemMatchingQuery' of undefined

      298 | 
      299 | 		beforeAll( function() {
    > 300 | 			isItemMatchingQuery = MediaListStore.isItemMatchingQuery;
          | 			                                     ^
      301 | 		} );
      302 | 
      303 | 		test( 'should return true if no query exists for site', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:300:41)

  ● MediaListStore › #isItemMatchingQuery › should return true if a search query is specified, and the item matches case insensitive

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isItemMatchingQuery › should return true if a search query is specified, and the item matches case insensitive

    TypeError: handler is not a function

      55 | 
      56 | 	function dispatchSetQuery( action ) {
    > 57 | 		handler( {
         | 		^
      58 | 			action: assign(
      59 | 				{
      60 | 					type: 'SET_MEDIA_QUERY',

      at dispatchSetQuery (client/lib/media/test/list-store.js:57:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:326:4)

  ● MediaListStore › #isItemMatchingQuery › should return false if a search query and mime_type are specified, and the item matches on title, but not mime_type

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isItemMatchingQuery › should return false if a search query and mime_type are specified, and the item matches on title, but not mime_type

    TypeError: Cannot read property 'isItemMatchingQuery' of undefined

      298 | 
      299 | 		beforeAll( function() {
    > 300 | 			isItemMatchingQuery = MediaListStore.isItemMatchingQuery;
          | 			                                     ^
      301 | 		} );
      302 | 
      303 | 		test( 'should return true if no query exists for site', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:300:41)

  ● MediaListStore › #isItemMatchingQuery › should return false if a search query and mime_type are specified, and the item matches on title, but not mime_type

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isItemMatchingQuery › should return false if a search query and mime_type are specified, and the item matches on title, but not mime_type

    TypeError: handler is not a function

      55 | 
      56 | 	function dispatchSetQuery( action ) {
    > 57 | 		handler( {
         | 		^
      58 | 			action: assign(
      59 | 				{
      60 | 					type: 'SET_MEDIA_QUERY',

      at dispatchSetQuery (client/lib/media/test/list-store.js:57:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:334:4)

  ● MediaListStore › #isItemMatchingQuery › should return false if a mime_type is specified, but the item doesn't match

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isItemMatchingQuery › should return false if a mime_type is specified, but the item doesn't match

    TypeError: Cannot read property 'isItemMatchingQuery' of undefined

      298 | 
      299 | 		beforeAll( function() {
    > 300 | 			isItemMatchingQuery = MediaListStore.isItemMatchingQuery;
          | 			                                     ^
      301 | 		} );
      302 | 
      303 | 		test( 'should return true if no query exists for site', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:300:41)

  ● MediaListStore › #isItemMatchingQuery › should return false if a mime_type is specified, but the item doesn't match

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isItemMatchingQuery › should return false if a mime_type is specified, but the item doesn't match

    TypeError: handler is not a function

      55 | 
      56 | 	function dispatchSetQuery( action ) {
    > 57 | 		handler( {
         | 		^
      58 | 			action: assign(
      59 | 				{
      60 | 					type: 'SET_MEDIA_QUERY',

      at dispatchSetQuery (client/lib/media/test/list-store.js:57:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:342:4)

  ● MediaListStore › #isItemMatchingQuery › should return true if a mime_type is specified, and the item matches

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isItemMatchingQuery › should return true if a mime_type is specified, and the item matches

    TypeError: Cannot read property 'isItemMatchingQuery' of undefined

      298 | 
      299 | 		beforeAll( function() {
    > 300 | 			isItemMatchingQuery = MediaListStore.isItemMatchingQuery;
          | 			                                     ^
      301 | 		} );
      302 | 
      303 | 		test( 'should return true if no query exists for site', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:300:41)

  ● MediaListStore › #isItemMatchingQuery › should return true if a mime_type is specified, and the item matches

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isItemMatchingQuery › should return true if a mime_type is specified, and the item matches

    TypeError: handler is not a function

      55 | 
      56 | 	function dispatchSetQuery( action ) {
    > 57 | 		handler( {
         | 		^
      58 | 			action: assign(
      59 | 				{
      60 | 					type: 'SET_MEDIA_QUERY',

      at dispatchSetQuery (client/lib/media/test/list-store.js:57:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:350:4)

  ● MediaListStore › #isItemMatchingQuery › should return true if item matches an external source but doesnt match title

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isItemMatchingQuery › should return true if item matches an external source but doesnt match title

    TypeError: Cannot read property 'isItemMatchingQuery' of undefined

      298 | 
      299 | 		beforeAll( function() {
    > 300 | 			isItemMatchingQuery = MediaListStore.isItemMatchingQuery;
          | 			                                     ^
      301 | 		} );
      302 | 
      303 | 		test( 'should return true if no query exists for site', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:300:41)

  ● MediaListStore › #isItemMatchingQuery › should return true if item matches an external source but doesnt match title

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isItemMatchingQuery › should return true if item matches an external source but doesnt match title

    TypeError: handler is not a function

      55 | 
      56 | 	function dispatchSetQuery( action ) {
    > 57 | 		handler( {
         | 		^
      58 | 			action: assign(
      59 | 				{
      60 | 					type: 'SET_MEDIA_QUERY',

      at dispatchSetQuery (client/lib/media/test/list-store.js:57:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:358:4)

  ● MediaListStore › .dispatchToken › should expose its dispatcher ID

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › .dispatchToken › should expose its dispatcher ID

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › .dispatchToken › should expose its dispatcher ID

    TypeError: Cannot read property 'dispatchToken' of undefined

      366 | 	describe( '.dispatchToken', () => {
      367 | 		test( 'should expose its dispatcher ID', () => {
    > 368 | 			expect( MediaListStore.dispatchToken ).to.be.a( 'string' );
          | 			                       ^
      369 | 		} );
      370 | 
      371 | 		test( 'should destroy existing media when a query changes', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:368:27)

  ● MediaListStore › .dispatchToken › should destroy existing media when a query changes

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › .dispatchToken › should destroy existing media when a query changes

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › .dispatchToken › should destroy existing media when a query changes

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      85 | 					siteId: DUMMY_SITE_ID,
      86 | 					data: DUMMY_MEDIA_RESPONSE,
    > 87 | 					query: MediaListStore.getNextPageQuery(
         | 					                      ^
      88 | 						action && action.siteId ? action.siteId : DUMMY_SITE_ID
      89 | 					),
      90 | 				},

      at dispatchReceiveMediaItems (client/lib/media/test/list-store.js:87:28)
      at Object.<anonymous> (client/lib/media/test/list-store.js:372:4)

  ● MediaListStore › .dispatchToken › should not destroy existing media if query change relates to pagination

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › .dispatchToken › should not destroy existing media if query change relates to pagination

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › .dispatchToken › should not destroy existing media if query change relates to pagination

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      85 | 					siteId: DUMMY_SITE_ID,
      86 | 					data: DUMMY_MEDIA_RESPONSE,
    > 87 | 					query: MediaListStore.getNextPageQuery(
         | 					                      ^
      88 | 						action && action.siteId ? action.siteId : DUMMY_SITE_ID
      89 | 					),
      90 | 				},

      at dispatchReceiveMediaItems (client/lib/media/test/list-store.js:87:28)
      at Object.<anonymous> (client/lib/media/test/list-store.js:379:4)

  ● MediaListStore › .dispatchToken › should emit a change event when receiving updates

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › .dispatchToken › should emit a change event when receiving updates

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › .dispatchToken › should emit a change event when receiving updates

    TypeError: Cannot read property 'once' of undefined

      384 | 
      385 | 		test( 'should emit a change event when receiving updates', done => {
    > 386 | 			MediaListStore.once( 'change', done );
          | 			               ^
      387 | 
      388 | 			dispatchReceiveMediaItems();
      389 | 		} );

      at Object.<anonymous> (client/lib/media/test/list-store.js:386:19)

  ● MediaListStore › .dispatchToken › should ignore received items where the query does not match

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › .dispatchToken › should ignore received items where the query does not match

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › .dispatchToken › should ignore received items where the query does not match

    TypeError: handler is not a function

      67 | 
      68 | 	function dispatchFetchMedia( action ) {
    > 69 | 		handler( {
         | 		^
      70 | 			action: assign(
      71 | 				{
      72 | 					type: 'FETCH_MEDIA_ITEMS',

      at dispatchFetchMedia (client/lib/media/test/list-store.js:69:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:392:4)

  ● MediaListStore › .dispatchToken › should remove an item when REMOVE_MEDIA_ITEM is dispatched

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › .dispatchToken › should remove an item when REMOVE_MEDIA_ITEM is dispatched

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › .dispatchToken › should remove an item when REMOVE_MEDIA_ITEM is dispatched

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      85 | 					siteId: DUMMY_SITE_ID,
      86 | 					data: DUMMY_MEDIA_RESPONSE,
    > 87 | 					query: MediaListStore.getNextPageQuery(
         | 					                      ^
      88 | 						action && action.siteId ? action.siteId : DUMMY_SITE_ID
      89 | 					),
      90 | 				},

      at dispatchReceiveMediaItems (client/lib/media/test/list-store.js:87:28)
      at Object.<anonymous> (client/lib/media/test/list-store.js:400:4)

  ● MediaListStore › .dispatchToken › should re-add an item when REMOVE_MEDIA_ITEM errors and includes data

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › .dispatchToken › should re-add an item when REMOVE_MEDIA_ITEM errors and includes data

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › .dispatchToken › should re-add an item when REMOVE_MEDIA_ITEM errors and includes data

    TypeError: Cannot read property 'ensureActiveQueryForSiteId' of undefined

      405 | 
      406 | 		test( 'should re-add an item when REMOVE_MEDIA_ITEM errors and includes data', () => {
    > 407 | 			MediaListStore.ensureActiveQueryForSiteId( DUMMY_SITE_ID );
          | 			               ^
      408 | 			dispatchRemoveMediaItem( { error: true } );
      409 | 
      410 | 			expect( MediaListStore.getAllIds( DUMMY_SITE_ID ) ).to.not.be.empty;

      at Object.<anonymous> (client/lib/media/test/list-store.js:407:19)

  ● MediaListStore › .dispatchToken › should replace an item when RECEIVE_MEDIA_ITEM includes ID

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › .dispatchToken › should replace an item when RECEIVE_MEDIA_ITEM includes ID

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › .dispatchToken › should replace an item when RECEIVE_MEDIA_ITEM includes ID

    TypeError: Cannot read property 'get' of undefined

      414 | 			const newItem = assign( {}, DUMMY_MEDIA_OBJECT, { ID: DUMMY_MEDIA_ID + 1 } );
      415 | 
    > 416 | 			MediaStore.get.restore();
          | 			           ^
      417 | 			sandbox.stub( MediaStore, 'get' ).callsFake( function( siteId, postId ) {
      418 | 				if ( siteId !== DUMMY_SITE_ID ) {
      419 | 					return;

      at Object.<anonymous> (client/lib/media/test/list-store.js:416:15)

FAIL client/lib/media/test/actions.js
  ● MediaActions › #setQuery() › should dispatch the SET_MEDIA_QUERY action

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #setQuery() › should dispatch the SET_MEDIA_QUERY action

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #setQuery() › should dispatch the SET_MEDIA_QUERY action

    TypeError: Cannot read property 'setQuery' of undefined

      89 | 	describe( '#setQuery()', () => {
      90 | 		test( 'should dispatch the SET_MEDIA_QUERY action', () => {
    > 91 | 			MediaActions.setQuery( DUMMY_SITE_ID, DUMMY_QUERY );
         | 			             ^
      92 | 
      93 | 			expect( Dispatcher.handleViewAction ).to.have.been.calledWithMatch( {
      94 | 				type: 'SET_MEDIA_QUERY',

      at Object.<anonymous> (client/lib/media/test/actions.js:91:17)

  ● MediaActions › #fetch() › should call to the WordPress.com REST API

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #fetch() › should call to the WordPress.com REST API

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #fetch() › should call to the WordPress.com REST API

    TypeError: Cannot read property 'fetch' of undefined

      109 | 				} );
      110 | 
    > 111 | 				MediaActions.fetch( DUMMY_SITE_ID, DUMMY_ITEM.ID );
          | 				             ^
      112 | 
      113 | 				expect( Dispatcher.handleViewAction ).to.have.been.calledOnce;
      114 | 				expect( stubs.mediaGet ).to.have.been.calledOn( [ DUMMY_SITE_ID, DUMMY_ITEM.ID ].join() );

      at client/lib/media/test/actions.js:111:18
      at Object.<anonymous> (client/lib/media/test/actions.js:103:11)

  ● MediaActions › #fetch() › should not allow simultaneous request for the same item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #fetch() › should not allow simultaneous request for the same item

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #fetch() › should not allow simultaneous request for the same item

    TypeError: Cannot read property 'fetch' of undefined

      127 | 
      128 | 		test( 'should not allow simultaneous request for the same item', () => {
    > 129 | 			MediaActions.fetch( DUMMY_SITE_ID, DUMMY_ITEM.ID );
          | 			             ^
      130 | 			MediaActions.fetch( DUMMY_SITE_ID, DUMMY_ITEM.ID );
      131 | 
      132 | 			expect( stubs.mediaGet ).to.have.been.calledOnce;

      at Object.<anonymous> (client/lib/media/test/actions.js:129:17)

  ● MediaActions › #fetch() › should allow simultaneous request for different items

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #fetch() › should allow simultaneous request for different items

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #fetch() › should allow simultaneous request for different items

    TypeError: Cannot read property 'fetch' of undefined

      134 | 
      135 | 		test( 'should allow simultaneous request for different items', () => {
    > 136 | 			MediaActions.fetch( DUMMY_SITE_ID, DUMMY_ITEM.ID );
          | 			             ^
      137 | 			MediaActions.fetch( DUMMY_SITE_ID, DUMMY_ITEM.ID + 1 );
      138 | 
      139 | 			expect( stubs.mediaGet ).to.have.been.calledTwice;

      at Object.<anonymous> (client/lib/media/test/actions.js:136:17)

  ● MediaActions › #fetchNextPage() › should call to the internal WordPress.com REST API

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #fetchNextPage() › should call to the internal WordPress.com REST API

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #fetchNextPage() › should call to the internal WordPress.com REST API

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      144 | 		test( 'should call to the internal WordPress.com REST API', () => {
      145 | 			return new Promise( done => {
    > 146 | 				const query = MediaListStore.getNextPageQuery( DUMMY_SITE_ID );
          | 				                             ^
      147 | 
      148 | 				MediaActions.fetchNextPage( DUMMY_SITE_ID );
      149 | 

      at client/lib/media/test/actions.js:146:34
      at Object.<anonymous> (client/lib/media/test/actions.js:145:11)

  ● MediaActions › #fetchNextPage() › should call to the external WordPress.com REST API

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #fetchNextPage() › should call to the external WordPress.com REST API

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #fetchNextPage() › should call to the external WordPress.com REST API

    TypeError: Cannot read property '_activeQueries' of undefined

      165 | 		test( 'should call to the external WordPress.com REST API', () => {
      166 | 			return new Promise( done => {
    > 167 | 				MediaListStore._activeQueries[ DUMMY_SITE_ID ] = { query: { source: 'external' } };
          | 				               ^
      168 | 
      169 | 				const query = MediaListStore.getNextPageQuery( DUMMY_SITE_ID );
      170 | 

      at client/lib/media/test/actions.js:167:20
      at Object.<anonymous> (client/lib/media/test/actions.js:166:11)

  ● MediaActions › #add() › should accept a single upload

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #add() › should accept a single upload

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #add() › should accept a single upload

    TypeError: Cannot read property 'add' of undefined

      190 | 	describe( '#add()', () => {
      191 | 		test( 'should accept a single upload', () => {
    > 192 | 			return MediaActions.add( site, DUMMY_UPLOAD ).then( () => {
          | 			                    ^
      193 | 				expect( Dispatcher.handleViewAction ).to.have.been.calledOnce;
      194 | 				expect( Dispatcher.handleViewAction ).to.have.been.calledWithMatch( {
      195 | 					type: 'CREATE_MEDIA_ITEM',

      at Object.<anonymous> (client/lib/media/test/actions.js:192:24)

  ● MediaActions › #add() › should accept an array of uploads

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #add() › should accept an array of uploads

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #add() › should accept an array of uploads

    TypeError: Cannot read property 'add' of undefined

      199 | 
      200 | 		test( 'should accept an array of uploads', () => {
    > 201 | 			return MediaActions.add( site, [ DUMMY_UPLOAD, DUMMY_UPLOAD ] ).then( () => {
          | 			                    ^
      202 | 				expect( Dispatcher.handleViewAction ).to.have.been.calledTwice;
      203 | 				expect( Dispatcher.handleViewAction ).to.have.always.been.calledWithMatch( {
      204 | 					type: 'CREATE_MEDIA_ITEM',

      at Object.<anonymous> (client/lib/media/test/actions.js:201:24)

  ● MediaActions › #add() › should accept a file URL

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #add() › should accept a file URL

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #add() › should accept a file URL

    TypeError: Cannot read property 'add' of undefined

      208 | 
      209 | 		test( 'should accept a file URL', () => {
    > 210 | 			return MediaActions.add( site, DUMMY_URL ).then( () => {
          | 			                    ^
      211 | 				expect( stubs.mediaAddUrls ).to.have.been.calledWithMatch( {}, DUMMY_URL );
      212 | 			} );
      213 | 		} );

      at Object.<anonymous> (client/lib/media/test/actions.js:210:24)

  ● MediaActions › #add() › should accept a FileList of uploads

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #add() › should accept a FileList of uploads

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #add() › should accept a FileList of uploads

    TypeError: window.FileList is not a constructor

      215 | 		test( 'should accept a FileList of uploads', () => {
      216 | 			const uploads = [ DUMMY_UPLOAD, DUMMY_UPLOAD ];
    > 217 | 			uploads.__proto__ = new window.FileList(); // eslint-disable-line no-proto
          | 			                    ^
      218 | 			return MediaActions.add( site, uploads ).then( () => {
      219 | 				expect( Dispatcher.handleViewAction ).to.have.been.calledTwice;
      220 | 				expect( Dispatcher.handleViewAction ).to.have.always.been.calledWithMatch( {

      at Object.<anonymous> (client/lib/media/test/actions.js:217:24)

  ● MediaActions › #add() › should accept a Blob object wrapper and pass it as "file" parameter

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #add() › should accept a Blob object wrapper and pass it as "file" parameter

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #add() › should accept a Blob object wrapper and pass it as "file" parameter

    TypeError: Cannot read property 'add' of undefined

      225 | 
      226 | 		test( 'should accept a Blob object wrapper and pass it as "file" parameter', () => {
    > 227 | 			return MediaActions.add( site, DUMMY_BLOB_UPLOAD ).then( () => {
          | 			                    ^
      228 | 				expect( stubs.mediaAdd ).to.have.been.calledWithMatch( {}, { file: DUMMY_BLOB_UPLOAD } );
      229 | 				expect( Dispatcher.handleServerAction ).to.have.been.calledWithMatch( {
      230 | 					type: 'RECEIVE_MEDIA_ITEM',

      at Object.<anonymous> (client/lib/media/test/actions.js:227:24)

  ● MediaActions › #add() › should call to the WordPress.com REST API

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #add() › should call to the WordPress.com REST API

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #add() › should call to the WordPress.com REST API

    TypeError: Cannot read property 'add' of undefined

      237 | 
      238 | 		test( 'should call to the WordPress.com REST API', () => {
    > 239 | 			return MediaActions.add( site, DUMMY_UPLOAD ).then( () => {
          | 			                    ^
      240 | 				expect( stubs.mediaAdd ).to.have.been.calledWithMatch( {}, DUMMY_UPLOAD );
      241 | 				expect( Dispatcher.handleServerAction ).to.have.been.calledWithMatch( {
      242 | 					type: 'RECEIVE_MEDIA_ITEM',

      at Object.<anonymous> (client/lib/media/test/actions.js:239:24)

  ● MediaActions › #add() › should immediately receive a transient object

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #add() › should immediately receive a transient object

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #add() › should immediately receive a transient object

    TypeError: Cannot read property 'add' of undefined

      249 | 
      250 | 		test( 'should immediately receive a transient object', () => {
    > 251 | 			return MediaActions.add( site, DUMMY_UPLOAD ).then( () => {
          | 			                    ^
      252 | 				expect( Dispatcher.handleViewAction ).to.have.been.calledWithMatch( {
      253 | 					type: 'CREATE_MEDIA_ITEM',
      254 | 					data: {

      at Object.<anonymous> (client/lib/media/test/actions.js:251:24)

  ● MediaActions › #add() › should attach file upload to a post if one is being edited

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #add() › should attach file upload to a post if one is being edited

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #add() › should attach file upload to a post if one is being edited

    TypeError: Cannot read property 'add' of undefined

      264 | 			mockReduxPostId = 200;
      265 | 
    > 266 | 			return MediaActions.add( site, DUMMY_UPLOAD ).then( () => {
          | 			                    ^
      267 | 				expect( stubs.mediaAdd ).to.have.been.calledWithMatch(
      268 | 					{},
      269 | 					{

      at Object.<anonymous> (client/lib/media/test/actions.js:266:24)

  ● MediaActions › #add() › should attach URL upload to a post if one is being edited

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #add() › should attach URL upload to a post if one is being edited

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #add() › should attach URL upload to a post if one is being edited

    TypeError: Cannot read property 'add' of undefined

      278 | 			mockReduxPostId = 200;
      279 | 
    > 280 | 			return MediaActions.add( site, DUMMY_URL ).then( () => {
          | 			                    ^
      281 | 				expect( stubs.mediaAddUrls ).to.have.been.calledWithMatch(
      282 | 					{},
      283 | 					{

      at Object.<anonymous> (client/lib/media/test/actions.js:280:24)

  ● MediaActions › #add() › should upload in series

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #add() › should upload in series

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #add() › should upload in series

    TypeError: Cannot read property 'add' of undefined

      296 | 			sandbox.stub( Dispatcher, 'handleServerAction' ).throws();
      297 | 
    > 298 | 			return MediaActions.add( site, [ DUMMY_UPLOAD, DUMMY_UPLOAD ] )
          | 			                    ^
      299 | 				.then( () => {
      300 | 					expect( Dispatcher.handleServerAction ).to.have.thrown;
      301 | 				} )

      at Object.<anonymous> (client/lib/media/test/actions.js:298:24)

  ● MediaActions › #addExternal() › should accept an upload

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #addExternal() › should accept an upload

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #addExternal() › should accept an upload

    TypeError: Cannot read property 'addExternal' of undefined

      308 | 	describe( '#addExternal()', () => {
      309 | 		test( 'should accept an upload', () => {
    > 310 | 			return MediaActions.addExternal( site, [ DUMMY_UPLOAD ], 'external' ).then( () => {
          | 			                    ^
      311 | 				expect( stubs.mediaAddExternal ).to.have.been.calledWithMatch( 'external', [
      312 | 					DUMMY_UPLOAD.guid,
      313 | 				] );

      at Object.<anonymous> (client/lib/media/test/actions.js:310:24)

  ● MediaActions › #edit() › should immediately edit the existing item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #edit() › should immediately edit the existing item

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #edit() › should immediately edit the existing item

    TypeError: Cannot read property 'edit' of undefined

      326 | 
      327 | 		test( 'should immediately edit the existing item', () => {
    > 328 | 			MediaActions.edit( DUMMY_SITE_ID, item );
          | 			             ^
      329 | 
      330 | 			expect( Dispatcher.handleViewAction ).to.have.been.calledWithMatch( {
      331 | 				type: 'RECEIVE_MEDIA_ITEM',

      at Object.<anonymous> (client/lib/media/test/actions.js:328:17)

  ● MediaActions › #update() › should accept a single item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #update() › should accept a single item

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #update() › should accept a single item

    TypeError: Cannot read property 'update' of undefined

      340 | 
      341 | 		test( 'should accept a single item', () => {
    > 342 | 			MediaActions.update( DUMMY_SITE_ID, item );
          | 			             ^
      343 | 			expect( stubs.mediaUpdate ).to.have.been.calledOnce;
      344 | 		} );
      345 | 

      at Object.<anonymous> (client/lib/media/test/actions.js:342:17)

  ● MediaActions › #update() › should accept an array of items

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #update() › should accept an array of items

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #update() › should accept an array of items

    TypeError: Cannot read property 'update' of undefined

      345 | 
      346 | 		test( 'should accept an array of items', () => {
    > 347 | 			MediaActions.update( DUMMY_SITE_ID, [ item, item ] );
          | 			             ^
      348 | 			expect( stubs.mediaUpdate ).to.have.been.calledTwice;
      349 | 		} );
      350 | 

      at Object.<anonymous> (client/lib/media/test/actions.js:347:17)

  ● MediaActions › #update() › should immediately update the existing item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #update() › should immediately update the existing item

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #update() › should immediately update the existing item

    TypeError: Cannot read property 'update' of undefined

      350 | 
      351 | 		test( 'should immediately update the existing item', () => {
    > 352 | 			MediaActions.update( DUMMY_SITE_ID, item );
          | 			             ^
      353 | 
      354 | 			expect( stubs.mediaUpdate ).to.have.been.calledWithMatch( item );
      355 | 			expect( Dispatcher.handleViewAction ).to.have.been.calledWithMatch( {

      at Object.<anonymous> (client/lib/media/test/actions.js:352:17)

  ● MediaActions › #update() › should call to the WordPress.com REST API

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #update() › should call to the WordPress.com REST API

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #update() › should call to the WordPress.com REST API

    TypeError: Cannot read property 'update' of undefined

      362 | 		test( 'should call to the WordPress.com REST API', () => {
      363 | 			return new Promise( done => {
    > 364 | 				MediaActions.update( DUMMY_SITE_ID, item );
          | 				             ^
      365 | 
      366 | 				expect( stubs.mediaUpdate ).to.have.been.calledWithMatch( item );
      367 | 

      at client/lib/media/test/actions.js:364:18
      at Object.<anonymous> (client/lib/media/test/actions.js:363:11)

  ● MediaActions › #delete() › should accept a single item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #delete() › should accept a single item

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #delete() › should accept a single item

    TypeError: Cannot read property 'delete' of undefined

      384 | 
      385 | 		test( 'should accept a single item', () => {
    > 386 | 			MediaActions.delete( DUMMY_SITE_ID, item );
          | 			             ^
      387 | 			expect( stubs.mediaDelete ).to.have.been.calledOnce;
      388 | 		} );
      389 | 

      at Object.<anonymous> (client/lib/media/test/actions.js:386:17)

  ● MediaActions › #delete() › should accept an array of items

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #delete() › should accept an array of items

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #delete() › should accept an array of items

    TypeError: Cannot read property 'delete' of undefined

      389 | 
      390 | 		test( 'should accept an array of items', () => {
    > 391 | 			MediaActions.delete( DUMMY_SITE_ID, [ item, item ] );
          | 			             ^
      392 | 			expect( stubs.mediaDelete ).to.have.been.calledTwice;
      393 | 		} );
      394 | 

      at Object.<anonymous> (client/lib/media/test/actions.js:391:17)

  ● MediaActions › #delete() › should call to the WordPress.com REST API

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #delete() › should call to the WordPress.com REST API

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #delete() › should call to the WordPress.com REST API

    TypeError: Cannot read property 'delete' of undefined

      395 | 		test( 'should call to the WordPress.com REST API', () => {
      396 | 			return new Promise( done => {
    > 397 | 				MediaActions.delete( DUMMY_SITE_ID, item );
          | 				             ^
      398 | 
      399 | 				expect( stubs.mediaDelete ).to.have.been.calledOn( [ DUMMY_SITE_ID, item.ID ].join() );
      400 | 				process.nextTick( function() {

      at client/lib/media/test/actions.js:397:18
      at Object.<anonymous> (client/lib/media/test/actions.js:396:11)

  ● MediaActions › #delete() › should immediately remove the item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #delete() › should immediately remove the item

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #delete() › should immediately remove the item

    TypeError: Cannot read property 'delete' of undefined

      412 | 
      413 | 		test( 'should immediately remove the item', () => {
    > 414 | 			MediaActions.delete( DUMMY_SITE_ID, item );
          | 			             ^
      415 | 
      416 | 			expect( Dispatcher.handleViewAction ).to.have.been.calledWithMatch( {
      417 | 				type: 'REMOVE_MEDIA_ITEM',

      at Object.<anonymous> (client/lib/media/test/actions.js:414:17)

  ● MediaActions › #clearValidationErrors() › should dispatch the `CLEAR_MEDIA_VALIDATION_ERRORS` action with the specified siteId

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #clearValidationErrors() › should dispatch the `CLEAR_MEDIA_VALIDATION_ERRORS` action with the specified siteId

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #clearValidationErrors() › should dispatch the `CLEAR_MEDIA_VALIDATION_ERRORS` action with the specified siteId

    TypeError: Cannot read property 'clearValidationErrors' of undefined

      424 | 	describe( '#clearValidationErrors()', () => {
      425 | 		test( 'should dispatch the `CLEAR_MEDIA_VALIDATION_ERRORS` action with the specified siteId', () => {
    > 426 | 			MediaActions.clearValidationErrors( DUMMY_SITE_ID );
          | 			             ^
      427 | 
      428 | 			expect( Dispatcher.handleViewAction ).to.have.been.calledWithMatch( {
      429 | 				type: 'CLEAR_MEDIA_VALIDATION_ERRORS',

      at Object.<anonymous> (client/lib/media/test/actions.js:426:17)

  ● MediaActions › #clearValidationErrors() › should dispatch the `CLEAR_MEDIA_VALIDATION_ERRORS` action with the specified siteId and itemId

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #clearValidationErrors() › should dispatch the `CLEAR_MEDIA_VALIDATION_ERRORS` action with the specified siteId and itemId

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #clearValidationErrors() › should dispatch the `CLEAR_MEDIA_VALIDATION_ERRORS` action with the specified siteId and itemId

    TypeError: Cannot read property 'clearValidationErrors' of undefined

      434 | 
      435 | 		test( 'should dispatch the `CLEAR_MEDIA_VALIDATION_ERRORS` action with the specified siteId and itemId', () => {
    > 436 | 			MediaActions.clearValidationErrors( DUMMY_SITE_ID, DUMMY_ITEM.ID );
          | 			             ^
      437 | 
      438 | 			expect( Dispatcher.handleViewAction ).to.have.been.calledWithMatch( {
      439 | 				type: 'CLEAR_MEDIA_VALIDATION_ERRORS',

      at Object.<anonymous> (client/lib/media/test/actions.js:436:17)

  ● MediaActions › #sourceChanged() › should dispatch the `CHANGE_MEDIA_SOURCE` action with the specified siteId

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #sourceChanged() › should dispatch the `CHANGE_MEDIA_SOURCE` action with the specified siteId

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #sourceChanged() › should dispatch the `CHANGE_MEDIA_SOURCE` action with the specified siteId

    TypeError: Cannot read property 'sourceChanged' of undefined

      446 | 	describe( '#sourceChanged()', () => {
      447 | 		test( 'should dispatch the `CHANGE_MEDIA_SOURCE` action with the specified siteId', () => {
    > 448 | 			MediaActions.sourceChanged( DUMMY_SITE_ID );
          | 			             ^
      449 | 
      450 | 			expect( Dispatcher.handleViewAction ).to.have.been.calledWithMatch( {
      451 | 				type: 'CHANGE_MEDIA_SOURCE',

      at Object.<anonymous> (client/lib/media/test/actions.js:448:17)

FAIL client/components/accordion/test/index.jsx
  ● Console

    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.

  ● Accordion › should render as expected with a title but no content when initially closed

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:16:15)

  ● Accordion › should render as expected with a title but no content when initially closed

    TypeError: Cannot read property 'contextTypes' of undefined

      19 | 
      20 | 	test( 'should render as expected with a title but no content when initially closed', () => {
    > 21 | 		const wrapper = shallow( <Accordion title="Section">Content</Accordion> );
         | 		                ^
      22 | 
      23 | 		expect( wrapper.hasClass( 'accordion' ) ).toBe( true );
      24 | 		expect( wrapper.state( 'isExpanded' ) ).toBe( false );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:21:19)

  ● Accordion › should accept an icon prop to be rendered

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:16:15)

  ● Accordion › should accept an icon prop to be rendered

    TypeError: Cannot read property 'contextTypes' of undefined

      34 | 
      35 | 	test( 'should accept an icon prop to be rendered', () => {
    > 36 | 		const wrapper = shallow(
         | 		                ^
      37 | 			<Accordion title="Section" icon={ <Gridicon icon="time" /> }>
      38 | 				Content
      39 | 			</Accordion>

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:36:19)

  ● Accordion › should accept a subtitle prop to be rendered aside the title

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:16:15)

  ● Accordion › should accept a subtitle prop to be rendered aside the title

    TypeError: Cannot read property 'contextTypes' of undefined

      45 | 
      46 | 	test( 'should accept a subtitle prop to be rendered aside the title', () => {
    > 47 | 		const wrapper = shallow(
         | 		                ^
      48 | 			<Accordion title="Section" subtitle="Subtitle">
      49 | 				Content
      50 | 			</Accordion>

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:47:19)

  ● Accordion › should accept a status prop to be rendered in the toggle

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:16:15)

  ● Accordion › should accept a status prop to be rendered in the toggle

    TypeError: Cannot read property 'contextTypes' of undefined

      63 | 			onClick() {},
      64 | 		};
    > 65 | 		const wrapper = shallow(
         | 		                ^
      66 | 			<Accordion title="Section" status={ status }>
      67 | 				Content
      68 | 			</Accordion>

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:65:19)

  ● Accordion › events › should toggle when clicked

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:16:15)

  ● Accordion › events › should toggle when clicked

    TypeError: Cannot read property 'contextTypes' of undefined

      79 | 
      80 | 		test( 'should toggle when clicked', () => {
    > 81 | 			const wrapper = shallow( <Accordion title="Section">Content</Accordion> );
         | 			                ^
      82 | 
      83 | 			simulateClick( wrapper );
      84 | 

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:81:20)

  ● Accordion › events › should accept an onToggle function handler to be invoked when toggled

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:16:15)

  ● Accordion › events › should accept an onToggle function handler to be invoked when toggled

    TypeError: Cannot read property 'contextTypes' of undefined

      90 | 		test( 'should accept an onToggle function handler to be invoked when toggled', () => {
      91 | 			const toggleSpy = jest.fn();
    > 92 | 			const wrapper = shallow(
         | 			                ^
      93 | 				<Accordion title="Section" onToggle={ toggleSpy }>
      94 | 					Content
      95 | 				</Accordion>

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:92:20)

  ● Accordion › events › should always use the initialExpanded prop, if specified

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:16:15)

  ● Accordion › events › should always use the initialExpanded prop, if specified

    TypeError: Cannot read property 'contextTypes' of undefined

      105 | 		test( 'should always use the initialExpanded prop, if specified', () => {
      106 | 			const toggleSpy = jest.fn();
    > 107 | 			const wrapper = shallow(
          | 			                ^
      108 | 				<Accordion initialExpanded={ true } title="Section" onToggle={ toggleSpy }>
      109 | 					Content
      110 | 				</Accordion>

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:107:20)

  ● Accordion › events › should render content when initially open

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:16:15)

  ● Accordion › events › should render content when initially open

    TypeError: Cannot read property 'contextTypes' of undefined

      119 | 
      120 | 		test( 'should render content when initially open', () => {
    > 121 | 			const wrapper = shallow(
          | 			                ^
      122 | 				<Accordion initialExpanded={ true } title="Section">
      123 | 					Content
      124 | 				</Accordion>

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:121:20)

  ● Accordion › events › should render content when forced

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:16:15)

  ● Accordion › events › should render content when forced

    TypeError: Cannot read property 'contextTypes' of undefined

      130 | 
      131 | 		test( 'should render content when forced', () => {
    > 132 | 			const wrapper = shallow( <Accordion title="Section">Content</Accordion> );
          | 			                ^
      133 | 			expect( wrapper.state( 'isExpanded' ) ).toBe( false );
      134 | 			expect( wrapper.state( 'hasExpanded' ) ).toBe( false );
      135 | 			expect( wrapper.find( '.accordion__content' ) ).toHaveLength( 0 );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:132:20)

FAIL client/lib/media/test/validation-store.js
  ● MediaValidationStore › #validateItem() › should have no effect for a valid file

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #validateItem() › should have no effect for a valid file

    TypeError: Cannot read property 'validateItem' of undefined

       97 | 
       98 | 		beforeAll( function() {
    >  99 | 			validateItem = MediaValidationStore.validateItem;
          | 			                                    ^
      100 | 		} );
      101 | 
      102 | 		test( 'should have no effect for a valid file', () => {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:99:40)

  ● MediaValidationStore › #validateItem() › should have no effect for a valid file

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #validateItem() › should have no effect for a valid file

    TypeError: validateItem is not a function

      101 | 
      102 | 		test( 'should have no effect for a valid file', () => {
    > 103 | 			validateItem( site, Object.assign( {}, DUMMY_MEDIA_OBJECT, { extension: 'gif' } ) );
          | 			^
      104 | 
      105 | 			expect( MediaValidationStore._errors ).to.eql( {} );
      106 | 		} );

      at Object.<anonymous> (client/lib/media/test/validation-store.js:103:4)

  ● MediaValidationStore › #validateItem() › should set an error array for an invalid file

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #validateItem() › should set an error array for an invalid file

    TypeError: Cannot read property 'validateItem' of undefined

       97 | 
       98 | 		beforeAll( function() {
    >  99 | 			validateItem = MediaValidationStore.validateItem;
          | 			                                    ^
      100 | 		} );
      101 | 
      102 | 		test( 'should have no effect for a valid file', () => {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:99:40)

  ● MediaValidationStore › #validateItem() › should set an error array for an invalid file

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #validateItem() › should set an error array for an invalid file

    TypeError: validateItem is not a function

      107 | 
      108 | 		test( 'should set an error array for an invalid file', () => {
    > 109 | 			validateItem( site, DUMMY_MEDIA_OBJECT );
          | 			^
      110 | 
      111 | 			expect( MediaValidationStore._errors ).to.eql( {
      112 | 				[ DUMMY_SITE_ID ]: {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:109:4)

  ● MediaValidationStore › #validateItem() › should set an error array for a file exceeding acceptable size

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #validateItem() › should set an error array for a file exceeding acceptable size

    TypeError: Cannot read property 'validateItem' of undefined

       97 | 
       98 | 		beforeAll( function() {
    >  99 | 			validateItem = MediaValidationStore.validateItem;
          | 			                                    ^
      100 | 		} );
      101 | 
      102 | 		test( 'should have no effect for a valid file', () => {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:99:40)

  ● MediaValidationStore › #validateItem() › should set an error array for a file exceeding acceptable size

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #validateItem() › should set an error array for a file exceeding acceptable size

    TypeError: validateItem is not a function

      117 | 
      118 | 		test( 'should set an error array for a file exceeding acceptable size', () => {
    > 119 | 			validateItem(
          | 			^
      120 | 				site,
      121 | 				Object.assign( {}, DUMMY_MEDIA_OBJECT, { size: 2048, extension: 'gif' } )
      122 | 			);

      at Object.<anonymous> (client/lib/media/test/validation-store.js:119:4)

  ● MediaValidationStore › #validateItem() › should accumulate multiple validation errors

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #validateItem() › should accumulate multiple validation errors

    TypeError: Cannot read property 'validateItem' of undefined

       97 | 
       98 | 		beforeAll( function() {
    >  99 | 			validateItem = MediaValidationStore.validateItem;
          | 			                                    ^
      100 | 		} );
      101 | 
      102 | 		test( 'should have no effect for a valid file', () => {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:99:40)

  ● MediaValidationStore › #validateItem() › should accumulate multiple validation errors

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #validateItem() › should accumulate multiple validation errors

    TypeError: validateItem is not a function

      130 | 
      131 | 		test( 'should accumulate multiple validation errors', () => {
    > 132 | 			validateItem( site, Object.assign( {}, DUMMY_MEDIA_OBJECT, { size: 2048 } ) );
          | 			^
      133 | 
      134 | 			expect( MediaValidationStore._errors ).to.eql( {
      135 | 				[ DUMMY_SITE_ID ]: {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:132:4)

  ● MediaValidationStore › #clearValidationErrors() › should remove validation errors for a single item on a given site

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #clearValidationErrors() › should remove validation errors for a single item on a given site

    TypeError: Cannot read property 'clearValidationErrors' of undefined

      147 | 
      148 | 		beforeAll( function() {
    > 149 | 			clearValidationErrors = MediaValidationStore.clearValidationErrors;
          | 			                                             ^
      150 | 		} );
      151 | 
      152 | 		test( 'should remove validation errors for a single item on a given site', () => {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:149:49)

  ● MediaValidationStore › #clearValidationErrors() › should remove validation errors for a single item on a given site

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #clearValidationErrors() › should remove validation errors for a single item on a given site

    TypeError: handler is not a function

      56 | 
      57 | 	function dispatchCreateMediaItem( action ) {
    > 58 | 		handler( {
         | 		^
      59 | 			action: assign(
      60 | 				{
      61 | 					type: 'CREATE_MEDIA_ITEM',

      at dispatchCreateMediaItem (client/lib/media/test/validation-store.js:58:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:153:4)

  ● MediaValidationStore › #clearValidationErrors() › should remove all validation errors on a site if no item is specified

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #clearValidationErrors() › should remove all validation errors on a site if no item is specified

    TypeError: Cannot read property 'clearValidationErrors' of undefined

      147 | 
      148 | 		beforeAll( function() {
    > 149 | 			clearValidationErrors = MediaValidationStore.clearValidationErrors;
          | 			                                             ^
      150 | 		} );
      151 | 
      152 | 		test( 'should remove validation errors for a single item on a given site', () => {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:149:49)

  ● MediaValidationStore › #clearValidationErrors() › should remove all validation errors on a site if no item is specified

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #clearValidationErrors() › should remove all validation errors on a site if no item is specified

    TypeError: handler is not a function

      56 | 
      57 | 	function dispatchCreateMediaItem( action ) {
    > 58 | 		handler( {
         | 		^
      59 | 			action: assign(
      60 | 				{
      61 | 					type: 'CREATE_MEDIA_ITEM',

      at dispatchCreateMediaItem (client/lib/media/test/validation-store.js:58:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:163:4)

  ● MediaValidationStore › #clearValidationErrorsByType › should remove errors for all items containing that error type on a given site

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #clearValidationErrorsByType › should remove errors for all items containing that error type on a given site

    TypeError: Cannot read property 'clearValidationErrorsByType' of undefined

      173 | 
      174 | 		beforeAll( function() {
    > 175 | 			clearValidationErrorsByType = MediaValidationStore.clearValidationErrorsByType;
          | 			                                                   ^
      176 | 		} );
      177 | 
      178 | 		test( 'should remove errors for all items containing that error type on a given site', () => {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:175:55)

  ● MediaValidationStore › #clearValidationErrorsByType › should remove errors for all items containing that error type on a given site

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #clearValidationErrorsByType › should remove errors for all items containing that error type on a given site

    TypeError: handler is not a function

      56 | 
      57 | 	function dispatchCreateMediaItem( action ) {
    > 58 | 		handler( {
         | 		^
      59 | 			action: assign(
      60 | 				{
      61 | 					type: 'CREATE_MEDIA_ITEM',

      at dispatchCreateMediaItem (client/lib/media/test/validation-store.js:58:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:179:4)

  ● MediaValidationStore › #getAllErrors() › should return an empty object when no errors exist

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #getAllErrors() › should return an empty object when no errors exist

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #getAllErrors() › should return an empty object when no errors exist

    TypeError: Cannot read property 'getAllErrors' of undefined

      196 | 	describe( '#getAllErrors()', () => {
      197 | 		test( 'should return an empty object when no errors exist', () => {
    > 198 | 			const errors = MediaValidationStore.getAllErrors( DUMMY_SITE_ID );
          | 			                                    ^
      199 | 
      200 | 			expect( errors ).to.eql( {} );
      201 | 		} );

      at Object.<anonymous> (client/lib/media/test/validation-store.js:198:40)

  ● MediaValidationStore › #getAllErrors() › should return an object of errors

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #getAllErrors() › should return an object of errors

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #getAllErrors() › should return an object of errors

    TypeError: handler is not a function

      56 | 
      57 | 	function dispatchCreateMediaItem( action ) {
    > 58 | 		handler( {
         | 		^
      59 | 			action: assign(
      60 | 				{
      61 | 					type: 'CREATE_MEDIA_ITEM',

      at dispatchCreateMediaItem (client/lib/media/test/validation-store.js:58:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:204:4)

  ● MediaValidationStore › #getErrors() › should return an empty array when no errors exist

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #getErrors() › should return an empty array when no errors exist

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #getErrors() › should return an empty array when no errors exist

    TypeError: Cannot read property 'getErrors' of undefined

      213 | 	describe( '#getErrors()', () => {
      214 | 		test( 'should return an empty array when no errors exist', () => {
    > 215 | 			const errors = MediaValidationStore.getErrors( DUMMY_SITE_ID, DUMMY_MEDIA_OBJECT.ID );
          | 			                                    ^
      216 | 
      217 | 			expect( errors ).to.be.an.instanceof( Array );
      218 | 			expect( errors ).to.be.empty;

      at Object.<anonymous> (client/lib/media/test/validation-store.js:215:40)

  ● MediaValidationStore › #getErrors() › should return an array of errors

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #getErrors() › should return an array of errors

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #getErrors() › should return an array of errors

    TypeError: handler is not a function

      56 | 
      57 | 	function dispatchCreateMediaItem( action ) {
    > 58 | 		handler( {
         | 		^
      59 | 			action: assign(
      60 | 				{
      61 | 					type: 'CREATE_MEDIA_ITEM',

      at dispatchCreateMediaItem (client/lib/media/test/validation-store.js:58:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:222:4)

  ● MediaValidationStore › .dispatchToken › should expose its dispatcher ID

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should expose its dispatcher ID

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should expose its dispatcher ID

    TypeError: Cannot read property 'dispatchToken' of undefined

      229 | 	describe( '.dispatchToken', () => {
      230 | 		test( 'should expose its dispatcher ID', () => {
    > 231 | 			expect( MediaValidationStore.dispatchToken ).to.not.be.undefined;
          | 			                             ^
      232 | 		} );
      233 | 
      234 | 		test( 'should emit a change event when receiving an item with an error', done => {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:231:33)

  ● MediaValidationStore › .dispatchToken › should emit a change event when receiving an item with an error

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should emit a change event when receiving an item with an error

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should emit a change event when receiving an item with an error

    TypeError: Cannot read property 'once' of undefined

      233 | 
      234 | 		test( 'should emit a change event when receiving an item with an error', done => {
    > 235 | 			MediaValidationStore.once( 'change', done );
          | 			                     ^
      236 | 
      237 | 			dispatchCreateMediaItem();
      238 | 		} );

      at Object.<anonymous> (client/lib/media/test/validation-store.js:235:25)

  ● MediaValidationStore › .dispatchToken › should emit a change event when clearing validation errors

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should emit a change event when clearing validation errors

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should emit a change event when clearing validation errors

    TypeError: Cannot read property 'once' of undefined

      239 | 
      240 | 		test( 'should emit a change event when clearing validation errors', done => {
    > 241 | 			MediaValidationStore.once( 'change', done );
          | 			                     ^
      242 | 
      243 | 			dispatchClearMediaValidationErrors();
      244 | 		} );

      at Object.<anonymous> (client/lib/media/test/validation-store.js:241:25)

  ● MediaValidationStore › .dispatchToken › should detect a 404 error from received item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should detect a 404 error from received item

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should detect a 404 error from received item

    TypeError: handler is not a function

      70 | 
      71 | 	function dispatchReceiveMediaItem( action ) {
    > 72 | 		handler( {
         | 		^
      73 | 			action: assign(
      74 | 				{
      75 | 					type: 'RECEIVE_MEDIA_ITEM',

      at dispatchReceiveMediaItem (client/lib/media/test/validation-store.js:72:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:247:4)

  ● MediaValidationStore › .dispatchToken › should detect a not enough space error from received item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should detect a not enough space error from received item

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should detect a not enough space error from received item

    TypeError: handler is not a function

      70 | 
      71 | 	function dispatchReceiveMediaItem( action ) {
    > 72 | 		handler( {
         | 		^
      73 | 			action: assign(
      74 | 				{
      75 | 					type: 'RECEIVE_MEDIA_ITEM',

      at dispatchReceiveMediaItem (client/lib/media/test/validation-store.js:72:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:265:4)

  ● MediaValidationStore › .dispatchToken › should detect an exceeds plan storage limit error from received item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should detect an exceeds plan storage limit error from received item

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should detect an exceeds plan storage limit error from received item

    TypeError: handler is not a function

      70 | 
      71 | 	function dispatchReceiveMediaItem( action ) {
    > 72 | 		handler( {
         | 		^
      73 | 			action: assign(
      74 | 				{
      75 | 					type: 'RECEIVE_MEDIA_ITEM',

      at dispatchReceiveMediaItem (client/lib/media/test/validation-store.js:72:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:283:4)

  ● MediaValidationStore › .dispatchToken › should detect general server error from received item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should detect general server error from received item

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should detect general server error from received item

    TypeError: handler is not a function

      70 | 
      71 | 	function dispatchReceiveMediaItem( action ) {
    > 72 | 		handler( {
         | 		^
      73 | 			action: assign(
      74 | 				{
      75 | 					type: 'RECEIVE_MEDIA_ITEM',

      at dispatchReceiveMediaItem (client/lib/media/test/validation-store.js:72:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:301:4)

  ● MediaValidationStore › .dispatchToken › should set errors into the action object explicitly

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should set errors into the action object explicitly

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should set errors into the action object explicitly

    TypeError: handler is not a function

      315 | 			};
      316 | 
    > 317 | 			handler( { action } );
          | 			^
      318 | 
      319 | 			expect( action.error ).to.eql( {
      320 | 				[ DUMMY_MEDIA_OBJECT.ID ]: [ MediaValidationErrors.FILE_TYPE_UNSUPPORTED ],

      at Object.<anonymous> (client/lib/media/test/validation-store.js:317:4)

  ● MediaValidationStore › .dispatchToken › should preserve existing errors when detecting a new one

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should preserve existing errors when detecting a new one

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should preserve existing errors when detecting a new one

    TypeError: handler is not a function

      331 | 			};
      332 | 
    > 333 | 			handler( {
          | 			^
      334 | 				action: {
      335 | 					type: 'CREATE_MEDIA_ITEM',
      336 | 					siteId: DUMMY_SITE_ID,

      at Object.<anonymous> (client/lib/media/test/validation-store.js:333:4)

  ● MediaValidationStore › .dispatchToken › should detect an external media error and set error on item ERROR_GLOBAL_ITEM_ID

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should detect an external media error and set error on item ERROR_GLOBAL_ITEM_ID

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should detect an external media error and set error on item ERROR_GLOBAL_ITEM_ID

    TypeError: handler is not a function

      43 | 
      44 | 	function dispatchError( error ) {
    > 45 | 		handler( {
         | 		^
      46 | 			action: {
      47 | 				type: 'RECEIVE_MEDIA_ITEM',
      48 | 				siteId: DUMMY_SITE_ID,

      at dispatchError (client/lib/media/test/validation-store.js:45:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:351:4)

  ● MediaValidationStore › .dispatchToken › should detect an expired auth token and set error on item ERROR_GLOBAL_ITEM_ID

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should detect an expired auth token and set error on item ERROR_GLOBAL_ITEM_ID

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should detect an expired auth token and set error on item ERROR_GLOBAL_ITEM_ID

    TypeError: handler is not a function

      43 | 
      44 | 	function dispatchError( error ) {
    > 45 | 		handler( {
         | 		^
      46 | 			action: {
      47 | 				type: 'RECEIVE_MEDIA_ITEM',
      48 | 				siteId: DUMMY_SITE_ID,

      at dispatchError (client/lib/media/test/validation-store.js:45:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:359:4)

  ● MediaValidationStore › .dispatchToken › should require an action ID for all errors other than external media

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should require an action ID for all errors other than external media

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should require an action ID for all errors other than external media

    TypeError: handler is not a function

      43 | 
      44 | 	function dispatchError( error ) {
    > 45 | 		handler( {
         | 		^
      46 | 			action: {
      47 | 				type: 'RECEIVE_MEDIA_ITEM',
      48 | 				siteId: DUMMY_SITE_ID,

      at dispatchError (client/lib/media/test/validation-store.js:45:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:367:4)

  ● MediaValidationStore › .dispatchToken › should remove all validation errors when changing the data source

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should remove all validation errors when changing the data source

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should remove all validation errors when changing the data source

    TypeError: handler is not a function

      43 | 
      44 | 	function dispatchError( error ) {
    > 45 | 		handler( {
         | 		^
      46 | 			action: {
      47 | 				type: 'RECEIVE_MEDIA_ITEM',
      48 | 				siteId: DUMMY_SITE_ID,

      at dispatchError (client/lib/media/test/validation-store.js:45:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:375:4)

FAIL client/blocks/edit-gravatar/test/index.jsx
  ● Console

    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.

  ● EditGravatar › component rendering › displays a Gravatar

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/edit-gravatar/index.jsx:17:1)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:40:18)

  ● EditGravatar › component rendering › displays a Gravatar

    TypeError: Cannot read property 'contextTypes' of undefined

      48 | 	describe( 'component rendering', () => {
      49 | 		test( 'displays a Gravatar', () => {
    > 50 | 			const wrapper = shallow( <EditGravatar translate={ noop } user={ user } /> );
         | 			                ^
      51 | 			expect( wrapper.find( Gravatar ).length ).to.equal( 1 );
      52 | 		} );
      53 | 

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:50:20)

  ● EditGravatar › component rendering › contains a file picker that accepts images

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/edit-gravatar/index.jsx:17:1)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:40:18)

  ● EditGravatar › component rendering › contains a file picker that accepts images

    TypeError: Cannot read property 'contextTypes' of undefined

      53 | 
      54 | 		test( 'contains a file picker that accepts images', () => {
    > 55 | 			const wrapper = shallow( <EditGravatar translate={ noop } user={ user } /> );
         | 			                ^
      56 | 			const filePicker = wrapper.find( FilePicker );
      57 | 			expect( filePicker.length ).to.equal( 1 );
      58 | 			expect( filePicker.prop( 'accept' ) ).to.equal( 'image/*' );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:55:20)

  ● EditGravatar › component rendering › does not display the image editor by default

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/edit-gravatar/index.jsx:17:1)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:40:18)

  ● EditGravatar › component rendering › does not display the image editor by default

    TypeError: Cannot read property 'contextTypes' of undefined

      60 | 
      61 | 		test( 'does not display the image editor by default', () => {
    > 62 | 			const wrapper = shallow( <EditGravatar translate={ noop } user={ user } /> );
         | 			                ^
      63 | 			expect( wrapper.find( ImageEditor ).length ).to.equal( 0 );
      64 | 		} );
      65 | 

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:62:20)

  ● EditGravatar › component rendering › drag and drop › does not contain a drop zone for unverified users

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/edit-gravatar/index.jsx:17:1)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:40:18)

  ● EditGravatar › component rendering › drag and drop › does not contain a drop zone for unverified users

    TypeError: Cannot read property 'contextTypes' of undefined

      66 | 		describe( 'drag and drop', () => {
      67 | 			test( 'does not contain a drop zone for unverified users', () => {
    > 68 | 				const wrapper = shallow(
         | 				                ^
      69 | 					<EditGravatar
      70 | 						translate={ noop }
      71 | 						user={ {

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:68:21)

  ● EditGravatar › component rendering › drag and drop › contains a drop zone for verified users

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/edit-gravatar/index.jsx:17:1)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:40:18)

  ● EditGravatar › component rendering › drag and drop › contains a drop zone for verified users

    TypeError: Cannot read property 'contextTypes' of undefined

      78 | 
      79 | 			test( 'contains a drop zone for verified users', () => {
    > 80 | 				const wrapper = shallow(
         | 				                ^
      81 | 					<EditGravatar
      82 | 						translate={ noop }
      83 | 						user={ {

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:80:21)

  ● EditGravatar › getting a file from user › accepted file type › displays the image editor with square allowed aspect ratio

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/edit-gravatar/index.jsx:17:1)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:40:18)

  ● EditGravatar › getting a file from user › accepted file type › displays the image editor with square allowed aspect ratio

    TypeError: Cannot read property 'contextTypes' of undefined

      94 | 		describe( 'accepted file type', () => {
      95 | 			test( 'displays the image editor with square allowed aspect ratio', () => {
    > 96 | 				const wrapper = shallow(
         | 				                ^
      97 | 					<EditGravatar translate={ noop } user={ user } recordReceiveImageEvent={ noop } />
      98 | 				);
      99 | 				const files = [

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:96:21)

  ● EditGravatar › getting a file from user › bad file type › does not display editor, and calls error action creator

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/edit-gravatar/index.jsx:17:1)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:40:18)

  ● EditGravatar › getting a file from user › bad file type › does not display editor, and calls error action creator

    TypeError: Cannot read property 'contextTypes' of undefined

      116 | 			test( 'does not display editor, and calls error action creator', () => {
      117 | 				const receiveGravatarImageFailedSpy = sandbox.spy();
    > 118 | 				const wrapper = shallow(
          | 				                ^
      119 | 					<EditGravatar
      120 | 						receiveGravatarImageFailed={ receiveGravatarImageFailedSpy }
      121 | 						translate={ noop }

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:118:21)

  ● EditGravatar › after editing image › given no error, hides image editor and calls upload gravatar action creator

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/edit-gravatar/index.jsx:17:1)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:40:18)

  ● EditGravatar › after editing image › given no error, hides image editor and calls upload gravatar action creator

    TypeError: Cannot read property 'contextTypes' of undefined

      151 | 			const receiveGravatarImageFailedSpy = sandbox.spy();
      152 | 			const uploadGravatarSpy = sandbox.spy();
    > 153 | 			const wrapper = shallow(
          | 			                ^
      154 | 				<EditGravatar
      155 | 					receiveGravatarImageFailed={ receiveGravatarImageFailedSpy }
      156 | 					resetAllImageEditorState={ noop }

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:153:20)

  ● EditGravatar › after editing image › given an error, hides image editor and calls error notice action creator

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/edit-gravatar/index.jsx:17:1)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:40:18)

  ● EditGravatar › after editing image › given an error, hides image editor and calls error notice action creator

    TypeError: Cannot read property 'contextTypes' of undefined

      174 | 			const receiveGravatarImageFailedSpy = sandbox.spy();
      175 | 			const uploadGravatarSpy = sandbox.spy();
    > 176 | 			const wrapper = shallow(
          | 			                ^
      177 | 				<EditGravatar
      178 | 					receiveGravatarImageFailed={ receiveGravatarImageFailedSpy }
      179 | 					resetAllImageEditorState={ noop }

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:176:20)

  ● EditGravatar › unverified user › shows email verification dialog when clicked

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/edit-gravatar/index.jsx:17:1)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:40:18)

  ● EditGravatar › unverified user › shows email verification dialog when clicked

    TypeError: Cannot read property 'contextTypes' of undefined

      196 | 	describe( 'unverified user', () => {
      197 | 		test( 'shows email verification dialog when clicked', () => {
    > 198 | 			const wrapper = shallow(
          | 			                ^
      199 | 				<EditGravatar translate={ noop } user={ user } recordClickButtonEvent={ noop } />
      200 | 			);
      201 | 			// Enzyme requires simulate() to be called directly on the element with the click handler

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:198:20)

FAIL client/lib/media/test/store.js
  ● MediaStore › #get() › should return a single value

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › #get() › should return a single value

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › #get() › should return a single value

    TypeError: handler is not a function

      43 | 
      44 | 	function dispatchReceiveMediaItems() {
    > 45 | 		handler( {
         | 		^
      46 | 			action: {
      47 | 				type: 'RECEIVE_MEDIA_ITEMS',
      48 | 				siteId: DUMMY_SITE_ID,

      at dispatchReceiveMediaItems (client/lib/media/test/store.js:45:3)
      at Object.<anonymous> (client/lib/media/test/store.js:78:4)

  ● MediaStore › #get() › should return undefined for an item that does not exist

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › #get() › should return undefined for an item that does not exist

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › #get() › should return undefined for an item that does not exist

    TypeError: Cannot read property 'get' of undefined

      82 | 
      83 | 		test( 'should return undefined for an item that does not exist', () => {
    > 84 | 			expect( MediaStore.get( DUMMY_SITE_ID, DUMMY_MEDIA_ID + 1 ) ).to.be.undefined;
         | 			                   ^
      85 | 		} );
      86 | 
      87 | 		test( 'should resolve a pointer to another image item', () => {

      at Object.<anonymous> (client/lib/media/test/store.js:84:23)

  ● MediaStore › #get() › should resolve a pointer to another image item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › #get() › should resolve a pointer to another image item

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › #get() › should resolve a pointer to another image item

    TypeError: Cannot set property '_media' of undefined

      86 | 
      87 | 		test( 'should resolve a pointer to another image item', () => {
    > 88 | 			MediaStore._media = {
         | 			^
      89 | 				[ DUMMY_SITE_ID ]: {
      90 | 					[ DUMMY_MEDIA_ID ]: DUMMY_MEDIA_OBJECT,
      91 | 				},

      at Object.<anonymous> (client/lib/media/test/store.js:88:4)

  ● MediaStore › #getAll() › should return all received media

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › #getAll() › should return all received media

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › #getAll() › should return all received media

    TypeError: handler is not a function

      43 | 
      44 | 	function dispatchReceiveMediaItems() {
    > 45 | 		handler( {
         | 		^
      46 | 			action: {
      47 | 				type: 'RECEIVE_MEDIA_ITEMS',
      48 | 				siteId: DUMMY_SITE_ID,

      at dispatchReceiveMediaItems (client/lib/media/test/store.js:45:3)
      at Object.<anonymous> (client/lib/media/test/store.js:105:4)

  ● MediaStore › #getAll() › should return undefined for an unknown site

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › #getAll() › should return undefined for an unknown site

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › #getAll() › should return undefined for an unknown site

    TypeError: Cannot read property 'getAll' of undefined

      109 | 
      110 | 		test( 'should return undefined for an unknown site', () => {
    > 111 | 			expect( MediaStore.getAll( DUMMY_SITE_ID ) ).to.be.undefined;
          | 			                   ^
      112 | 		} );
      113 | 	} );
      114 | 

      at Object.<anonymous> (client/lib/media/test/store.js:111:23)

  ● MediaStore › .dispatchToken › should expose its dispatcher ID

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › .dispatchToken › should expose its dispatcher ID

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › .dispatchToken › should expose its dispatcher ID

    TypeError: Cannot read property 'dispatchToken' of undefined

      115 | 	describe( '.dispatchToken', () => {
      116 | 		test( 'should expose its dispatcher ID', () => {
    > 117 | 			expect( MediaStore.dispatchToken ).to.be.a( 'string' );
          | 			                   ^
      118 | 		} );
      119 | 
      120 | 		test( 'should emit a change event when receiving updates', done => {

      at Object.<anonymous> (client/lib/media/test/store.js:117:23)

  ● MediaStore › .dispatchToken › should emit a change event when receiving updates

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › .dispatchToken › should emit a change event when receiving updates

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › .dispatchToken › should emit a change event when receiving updates

    TypeError: Cannot read property 'once' of undefined

      119 | 
      120 | 		test( 'should emit a change event when receiving updates', done => {
    > 121 | 			MediaStore.once( 'change', done );
          | 			           ^
      122 | 
      123 | 			dispatchReceiveMediaItems();
      124 | 		} );

      at Object.<anonymous> (client/lib/media/test/store.js:121:15)

  ● MediaStore › .dispatchToken › should blank an item when REMOVE_MEDIA_ITEM is dispatched

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › .dispatchToken › should blank an item when REMOVE_MEDIA_ITEM is dispatched

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › .dispatchToken › should blank an item when REMOVE_MEDIA_ITEM is dispatched

    TypeError: handler is not a function

      43 | 
      44 | 	function dispatchReceiveMediaItems() {
    > 45 | 		handler( {
         | 		^
      46 | 			action: {
      47 | 				type: 'RECEIVE_MEDIA_ITEMS',
      48 | 				siteId: DUMMY_SITE_ID,

      at dispatchReceiveMediaItems (client/lib/media/test/store.js:45:3)
      at Object.<anonymous> (client/lib/media/test/store.js:127:4)

  ● MediaStore › .dispatchToken › should re-add an item when REMOVE_MEDIA_ITEM errors and includes data

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › .dispatchToken › should re-add an item when REMOVE_MEDIA_ITEM errors and includes data

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › .dispatchToken › should re-add an item when REMOVE_MEDIA_ITEM errors and includes data

    TypeError: handler is not a function

      64 | 
      65 | 	function dispatchRemoveMediaItem( error ) {
    > 66 | 		handler( {
         | 		^
      67 | 			action: {
      68 | 				error: error,
      69 | 				type: 'REMOVE_MEDIA_ITEM',

      at dispatchRemoveMediaItem (client/lib/media/test/store.js:66:3)
      at Object.<anonymous> (client/lib/media/test/store.js:137:4)

  ● MediaStore › .dispatchToken › should replace an item when RECEIVE_MEDIA_ITEM includes ID

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › .dispatchToken › should replace an item when RECEIVE_MEDIA_ITEM includes ID

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › .dispatchToken › should replace an item when RECEIVE_MEDIA_ITEM includes ID

    TypeError: handler is not a function

      53 | 
      54 | 	function dispatchReceiveMediaItem( id, data ) {
    > 55 | 		handler( {
         | 		^
      56 | 			action: {
      57 | 				type: 'RECEIVE_MEDIA_ITEM',
      58 | 				siteId: DUMMY_SITE_ID,

      at dispatchReceiveMediaItem (client/lib/media/test/store.js:55:3)
      at Object.<anonymous> (client/lib/media/test/store.js:148:4)

  ● MediaStore › .dispatchToken › should create an item stub when FETCH_MEDIA_ITEM called

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › .dispatchToken › should create an item stub when FETCH_MEDIA_ITEM called

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › .dispatchToken › should create an item stub when FETCH_MEDIA_ITEM called

    TypeError: handler is not a function

      154 | 
      155 | 		test( 'should create an item stub when FETCH_MEDIA_ITEM called', () => {
    > 156 | 			handler( {
          | 			^
      157 | 				action: {
      158 | 					type: 'FETCH_MEDIA_ITEM',
      159 | 					siteId: DUMMY_SITE_ID,

      at Object.<anonymous> (client/lib/media/test/store.js:156:4)

  ● MediaStore › .dispatchToken › should clear all pointers when CHANGE_MEDIA_SOURCE called

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › .dispatchToken › should clear all pointers when CHANGE_MEDIA_SOURCE called

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › .dispatchToken › should clear all pointers when CHANGE_MEDIA_SOURCE called

    TypeError: Cannot set property '_pointers' of undefined

      168 | 
      169 | 		test( 'should clear all pointers when CHANGE_MEDIA_SOURCE called', () => {
    > 170 | 			MediaStore._pointers = {
          | 			^
      171 | 				[ DUMMY_SITE_ID ]: {
      172 | 					[ DUMMY_MEDIA_ID + 1 ]: DUMMY_MEDIA_ID,
      173 | 				},

      at Object.<anonymous> (client/lib/media/test/store.js:170:4)

FAIL client/lib/resize-image-url/test/index.js
  ● resizeImageUrl() › should return non-string URLs unmodified

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › should return non-string URLs unmodified

    TypeError: resizeImageUrl is not a function

      14 | 
      15 | 	test( 'should return non-string URLs unmodified', () => {
    > 16 | 		expect( resizeImageUrl() ).to.be.undefined;
         | 		        ^
      17 | 		expect( resizeImageUrl( null ) ).to.be.null;
      18 | 		expect( resizeImageUrl( 1 ) ).to.equal( 1 );
      19 | 	} );

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:16:11)

  ● resizeImageUrl() › should strip original query params (WP.com)

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › should strip original query params (WP.com)

    TypeError: resizeImageUrl is not a function

      20 | 
      21 | 	test( 'should strip original query params (WP.com)', () => {
    > 22 | 		const resizedUrl = resizeImageUrl( imageUrl );
         | 		                   ^
      23 | 		expect( resizedUrl ).to.equal(
      24 | 			'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg'
      25 | 		);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:22:22)

  ● resizeImageUrl() › should strip original query params (Photon)

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › should strip original query params (Photon)

    TypeError: resizeImageUrl is not a function

      28 | 	test( 'should strip original query params (Photon)', () => {
      29 | 		const original = 'https://i0.wp.com/example.com/foo.png?fit=meh';
    > 30 | 		const resizedUrl = resizeImageUrl( original );
         | 		                   ^
      31 | 		expect( resizedUrl ).to.equal( 'https://i0.wp.com/example.com/foo.png' );
      32 | 	} );
      33 | 

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:30:22)

  ● resizeImageUrl() › should not attempt to resize non-HTTP protocols

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › should not attempt to resize non-HTTP protocols

    TypeError: resizeImageUrl is not a function

      35 | 		const blobImageUrl =
      36 | 			'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';
    > 37 | 		const resizedUrl = resizeImageUrl( blobImageUrl, { resize: '40,40' } );
         | 		                   ^
      38 | 		expect( resizedUrl ).to.equal( blobImageUrl );
      39 | 	} );
      40 | 

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:37:22)

  ● resizeImageUrl() › should allow arguments to be specified as strings

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › should allow arguments to be specified as strings

    TypeError: resizeImageUrl is not a function

      40 | 
      41 | 	test( 'should allow arguments to be specified as strings', () => {
    > 42 | 		const resizedUrl = resizeImageUrl( imageUrl, { w: '40' } );
         | 		                   ^
      43 | 		expect( resizedUrl ).to.equal(
      44 | 			'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?w=40'
      45 | 		);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:42:22)

  ● resizeImageUrl() › should preserve unrelated query arguments

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › should preserve unrelated query arguments

    TypeError: resizeImageUrl is not a function

      49 | 		const gravatarUrl =
      50 | 			'https://gravatar.com/avatar/00000000000000000000000000000000?d=https%3A%2F%2Fexample.com%2Favatar.jpg';
    > 51 | 		const resizedUrl = resizeImageUrl( gravatarUrl, { s: '40' } );
         | 		                   ^
      52 | 		const expectedUrl =
      53 | 			'https://gravatar.com/avatar/00000000000000000000000000000000?d=https%3A%2F%2Fexample.com%2Favatar.jpg&s=40';
      54 | 		expect( resizedUrl ).to.equal( expectedUrl );

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:51:22)

  ● resizeImageUrl() › numeric width › wpcom › should append width as ?w query argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › numeric width › wpcom › should append width as ?w query argument

    TypeError: resizeImageUrl is not a function

      59 | 			test( 'should append width as ?w query argument', () => {
      60 | 				const original = 'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg';
    > 61 | 				const resized = resizeImageUrl( original, 40 );
         | 				                ^
      62 | 				const expected = 'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?w=40';
      63 | 				expect( resized ).to.equal( expected );
      64 | 			} );

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:61:21)

  ● resizeImageUrl() › numeric width › wpcom › should append ?fit query argument if both width and height provided

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › numeric width › wpcom › should append ?fit query argument if both width and height provided

    TypeError: resizeImageUrl is not a function

      66 | 			test( 'should append ?fit query argument if both width and height provided', () => {
      67 | 				const original = 'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg';
    > 68 | 				const resized = resizeImageUrl( original, 40, 20 );
         | 				                ^
      69 | 				const expected =
      70 | 					'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?fit=40%2C20';
      71 | 				expect( resized ).to.equal( expected );

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:68:21)

  ● resizeImageUrl() › numeric width › photon › should append width as ?w query argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › numeric width › photon › should append width as ?w query argument

    TypeError: resizeImageUrl is not a function

      76 | 			test( 'should append width as ?w query argument', () => {
      77 | 				const original = 'https://i0.wp.com/example.com/foo.png';
    > 78 | 				const resized = resizeImageUrl( original, 40 );
         | 				                ^
      79 | 				const expected = 'https://i0.wp.com/example.com/foo.png?w=40';
      80 | 				expect( resized ).to.equal( expected );
      81 | 			} );

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:78:21)

  ● resizeImageUrl() › numeric width › photon › should append ?fit query argument if both width and height provided

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › numeric width › photon › should append ?fit query argument if both width and height provided

    TypeError: resizeImageUrl is not a function

      83 | 			test( 'should append ?fit query argument if both width and height provided', () => {
      84 | 				const original = 'https://i0.wp.com/example.com/foo.png';
    > 85 | 				const resized = resizeImageUrl( original, 40, 20 );
         | 				                ^
      86 | 				const expected = 'https://i0.wp.com/example.com/foo.png?fit=40%2C20';
      87 | 				expect( resized ).to.equal( expected );
      88 | 			} );

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:85:21)

  ● resizeImageUrl() › numeric width › gravatar › should append width as ?s query argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › numeric width › gravatar › should append width as ?s query argument

    TypeError: resizeImageUrl is not a function

      92 | 			test( 'should append width as ?s query argument', () => {
      93 | 				const original = 'https://gravatar.com/avatar/00000000000000000000000000000000';
    > 94 | 				const resized = resizeImageUrl( original, 40 );
         | 				                ^
      95 | 				const expected = 'https://gravatar.com/avatar/00000000000000000000000000000000?s=40';
      96 | 				expect( resized ).to.equal( expected );
      97 | 			} );

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:94:21)

  ● resizeImageUrl() › numeric width › gravatar › should ignore height

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › numeric width › gravatar › should ignore height

    TypeError: resizeImageUrl is not a function

       99 | 			test( 'should ignore height', () => {
      100 | 				const original = 'https://gravatar.com/avatar/00000000000000000000000000000000';
    > 101 | 				const resized = resizeImageUrl( original, 40, 20 );
          | 				                ^
      102 | 				const expected = 'https://gravatar.com/avatar/00000000000000000000000000000000?s=40';
      103 | 				expect( resized ).to.equal( expected );
      104 | 			} );

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:101:21)

  ● resizeImageUrl() › numeric width › external › should return a Photonized (safe) resized image with width

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › numeric width › external › should return a Photonized (safe) resized image with width

    TypeError: resizeImageUrl is not a function

      109 | 				const original = 'https://example.com/foo.png';
      110 | 				const expected = 'https://i0.wp.com/example.com/foo.png?ssl=1&w=40';
    > 111 | 				expect( resizeImageUrl( original, 40 ) ).to.equal( expected );
          | 				        ^
      112 | 				expect( resizeImageUrl( original, { w: 40 } ) ).to.equal( expected );
      113 | 			} );
      114 | 

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:111:13)

  ● resizeImageUrl() › numeric width › external › should return a Photonized (safe) resized image with width and height

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › numeric width › external › should return a Photonized (safe) resized image with width and height

    TypeError: resizeImageUrl is not a function

      115 | 			test( 'should return a Photonized (safe) resized image with width and height', () => {
      116 | 				const original = 'https://example.com/foo.png';
    > 117 | 				const resized = resizeImageUrl( original, 40, 20 );
          | 				                ^
      118 | 				const expected = 'https://i0.wp.com/example.com/foo.png?ssl=1&fit=40%2C20';
      119 | 				expect( resized ).to.equal( expected );
      120 | 			} );

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:117:21)

  ● resizeImageUrl() › numeric width › external › returns null for URLs with query string

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › numeric width › external › returns null for URLs with query string

    TypeError: resizeImageUrl is not a function

      122 | 			test( 'returns null for URLs with query string', () => {
      123 | 				const original = 'https://example.com/foo.png?bar=baz';
    > 124 | 				const resized = resizeImageUrl( original, 40, 20 );
          | 				                ^
      125 | 				expect( resized ).to.be.null;
      126 | 			} );
      127 | 

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:124:21)

  ● resizeImageUrl() › numeric width › external › should treat external wp-content urls as external

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › numeric width › external › should treat external wp-content urls as external

    TypeError: resizeImageUrl is not a function

      128 | 			test( 'should treat external wp-content urls as external', () => {
      129 | 				const original = 'https://blacktacho.com/wp-content/uploads/2018/10/Divo07.jpg';
    > 130 | 				const resized = resizeImageUrl( original, 450 );
          | 				                ^
      131 | 				expect( resized ).to.equal(
      132 | 					'https://i2.wp.com/blacktacho.com/wp-content/uploads/2018/10/Divo07.jpg?ssl=1&w=450'
      133 | 				);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:130:21)

  ● resizeImageUrl() › standard pixel density › should append resize argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › standard pixel density › should append resize argument

    TypeError: resizeImageUrl is not a function

      138 | 	describe( 'standard pixel density', () => {
      139 | 		test( 'should append resize argument', () => {
    > 140 | 			const resizedUrl = resizeImageUrl( imageUrl, { resize: '40,40' } );
          | 			                   ^
      141 | 			expect( resizedUrl ).to.equal(
      142 | 				'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?resize=40%2C40'
      143 | 			);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:140:23)

  ● resizeImageUrl() › standard pixel density › should append fit argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › standard pixel density › should append fit argument

    TypeError: resizeImageUrl is not a function

      145 | 
      146 | 		test( 'should append fit argument', () => {
    > 147 | 			const resizedUrl = resizeImageUrl( imageUrl, { fit: '40,40' } );
          | 			                   ^
      148 | 			expect( resizedUrl ).to.equal(
      149 | 				'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?fit=40%2C40'
      150 | 			);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:147:23)

  ● resizeImageUrl() › standard pixel density › should append w argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › standard pixel density › should append w argument

    TypeError: resizeImageUrl is not a function

      152 | 
      153 | 		test( 'should append w argument', () => {
    > 154 | 			const resizedUrl = resizeImageUrl( imageUrl, { w: 40 } );
          | 			                   ^
      155 | 			expect( resizedUrl ).to.equal(
      156 | 				'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?w=40'
      157 | 			);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:154:23)

  ● resizeImageUrl() › standard pixel density › should append s argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › standard pixel density › should append s argument

    TypeError: resizeImageUrl is not a function

      159 | 
      160 | 		test( 'should append s argument', () => {
    > 161 | 			const resizedUrl = resizeImageUrl( imageUrl, { s: 200 } );
          | 			                   ^
      162 | 			expect( resizedUrl ).to.equal(
      163 | 				'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?s=200'
      164 | 			);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:161:23)

  ● resizeImageUrl() › high pixel density › should append resize argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › high pixel density › should append resize argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › high pixel density › should append resize argument

    TypeError: resizeImageUrl is not a function

      182 | 
      183 | 		test( 'should append resize argument', () => {
    > 184 | 			const resizedUrl = resizeImageUrl( imageUrl, { resize: '40,40' } );
          | 			                   ^
      185 | 			expect( resizedUrl ).to.equal(
      186 | 				'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?resize=80%2C80'
      187 | 			);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:184:23)

  ● resizeImageUrl() › high pixel density › should append fit argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › high pixel density › should append fit argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › high pixel density › should append fit argument

    TypeError: resizeImageUrl is not a function

      189 | 
      190 | 		test( 'should append fit argument', () => {
    > 191 | 			const resizedUrl = resizeImageUrl( imageUrl, { fit: '40,40' } );
          | 			                   ^
      192 | 			expect( resizedUrl ).to.equal(
      193 | 				'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?fit=80%2C80'
      194 | 			);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:191:23)

  ● resizeImageUrl() › high pixel density › should append w argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › high pixel density › should append w argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › high pixel density › should append w argument

    TypeError: resizeImageUrl is not a function

      196 | 
      197 | 		test( 'should append w argument', () => {
    > 198 | 			const resizedUrl = resizeImageUrl( imageUrl, { w: 40 } );
          | 			                   ^
      199 | 			expect( resizedUrl ).to.equal(
      200 | 				'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?w=80'
      201 | 			);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:198:23)

  ● resizeImageUrl() › high pixel density › should append s argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › high pixel density › should append s argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › high pixel density › should append s argument

    TypeError: resizeImageUrl is not a function

      203 | 
      204 | 		test( 'should append s argument', () => {
    > 205 | 			const resizedUrl = resizeImageUrl( imageUrl, { s: 200 } );
          | 			                   ^
      206 | 			expect( resizedUrl ).to.equal(
      207 | 				'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?s=400'
      208 | 			);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:205:23)

FAIL client/components/tinymce/plugins/media/restrict-size/test/index.js
  ● restrictSize › #getMaxWidth() › should return the multiple of the root device ratio if available

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/index.js:5:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:14:24)

  ● restrictSize › #getMaxWidth() › should return the multiple of the root device ratio if available

    TypeError: getMaxWidth is not a function

      33 | 			window.devicePixelRatio = 1.5;
      34 | 
    > 35 | 			expect( getMaxWidth() ).to.equal( 1020 );
         | 			        ^
      36 | 		} );
      37 | 
      38 | 		test( 'should return twice the base if the device resolution matches the retina media query', () => {

      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:35:12)

  ● restrictSize › #getMaxWidth() › should return twice the base if the device resolution matches the retina media query

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/index.js:5:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:14:24)

  ● restrictSize › #getMaxWidth() › should return twice the base if the device resolution matches the retina media query

    TypeError: getMaxWidth is not a function

      40 | 			window.matchMedia = () => ( { matches: true } );
      41 | 
    > 42 | 			expect( getMaxWidth() ).to.equal( 1360 );
         | 			        ^
      43 | 		} );
      44 | 
      45 | 		test( 'should return the base max width if the device is not retina-capable', () => {

      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:42:12)

  ● restrictSize › #getMaxWidth() › should return the base max width if the device is not retina-capable

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/index.js:5:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:14:24)

  ● restrictSize › #getMaxWidth() › should return the base max width if the device is not retina-capable

    TypeError: getMaxWidth is not a function

      45 | 		test( 'should return the base max width if the device is not retina-capable', () => {
      46 | 			window.devicePixelRatio = undefined;
    > 47 | 			expect( getMaxWidth() ).to.equal( 680 );
         | 			        ^
      48 | 		} );
      49 | 	} );
      50 | 

      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:47:12)

  ● restrictSize › #resetImages() › should restore all instances of replaced images

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/index.js:5:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:14:24)

  ● restrictSize › #resetImages() › should restore all instances of replaced images

    TypeError: resetImages is not a function

      51 | 	describe( '#resetImages()', () => {
      52 | 		test( 'should restore all instances of replaced images', () => {
    > 53 | 			const value = resetImages(
         | 			              ^
      54 | 				'<p><img src="https://wordpress.com/2015/11/forest.jpg?w=680" data-wpmedia-src="https://wordpress.com/2015/11/forest.jpg?w=1024" class="alignnone size-large wp-image-5823" alt="forest" width="1024" height="683" data-mce-src="https://wordpress.com/2015/11/forest.jpg?w=680" data-mce-selected="1"></p>'
      55 | 			);
      56 | 			expect( value ).to.equal(

      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:53:18)

  ● restrictSize › #resetImages() › should handle multiple images from content

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/index.js:5:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:14:24)

  ● restrictSize › #resetImages() › should handle multiple images from content

    TypeError: resetImages is not a function

      60 | 
      61 | 		test( 'should handle multiple images from content', () => {
    > 62 | 			const value = resetImages(
         | 			              ^
      63 | 				'<p><img src="https://example.com/bird.jpg?w=680" data-wpmedia-src="https://example.com/bird.jpg"><img src="https://example.com/forest.jpg?w=680" data-wpmedia-src="https://example.com/forest.jpg"></p>'
      64 | 			);
      65 | 			expect( value ).to.equal(

      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:62:18)

  ● restrictSize › #resetImages() › should ignore non-replaced images in handling multiple images

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/index.js:5:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:14:24)

  ● restrictSize › #resetImages() › should ignore non-replaced images in handling multiple images

    TypeError: resetImages is not a function

      69 | 
      70 | 		test( 'should ignore non-replaced images in handling multiple images', () => {
    > 71 | 			const value = resetImages(
         | 			              ^
      72 | 				'<p><img src="https://example.com/bird.jpg?w=300"><img src="https://example.com/forest.jpg?w=680" data-wpmedia-src="https://example.com/forest.jpg"></p>'
      73 | 			);
      74 | 			expect( value ).to.equal(

      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:71:18)

  ● restrictSize › #setImages() › should replace all instances of large images

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/index.js:5:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:14:24)

  ● restrictSize › #setImages() › should replace all instances of large images

    TypeError: setImages is not a function

      80 | 	describe( '#setImages()', () => {
      81 | 		test( 'should replace all instances of large images', () => {
    > 82 | 			const value = setImages(
         | 			              ^
      83 | 				'<p><img src="https://wordpress.com/2015/11/forest.jpg?w=1024" class="alignnone size-large wp-image-5823" alt="forest" width="1024" height="683" data-mce-src="https://wordpress.com/2015/11/forest.jpg?w=680" data-mce-selected="1"></p>'
      84 | 			);
      85 | 			expect( value ).to.equal(

      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:82:18)

  ● restrictSize › #setImages() › should not replace already-replaced instances

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/index.js:5:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:14:24)

  ● restrictSize › #setImages() › should not replace already-replaced instances

    TypeError: setImages is not a function

      89 | 
      90 | 		test( 'should not replace already-replaced instances', () => {
    > 91 | 			const value = setImages(
         | 			              ^
      92 | 				'<p><img class="alignnone size-large wp-image-5823" src="https://wordpress.com/2015/11/forest.jpg?w=680" data-wpmedia-src="https://wordpress.com/2015/11/forest.jpg?w=1024" alt="forest" width="1024" height="683" data-mce-src="https://wordpress.com/2015/11/forest.jpg?w=680" data-mce-selected="1"></p>'
      93 | 			);
      94 | 			expect( value ).to.equal(

      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:91:18)

  ● restrictSize › #setImages() › should replace images with indeterminate widths

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/index.js:5:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:14:24)

  ● restrictSize › #setImages() › should replace images with indeterminate widths

    TypeError: setImages is not a function

       98 | 
       99 | 		test( 'should replace images with indeterminate widths', () => {
    > 100 | 			const value = setImages(
          | 			              ^
      101 | 				'<p><img src="https://wordpress.com/2015/11/forest.jpg" alt="forest" class="alignnone size-thumbnail wp-image-5823" data-mce-selected="1"></p>'
      102 | 			);
      103 | 			expect( value ).to.equal(

      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:100:18)

  ● restrictSize › #setImages() › should not replace external images (those without media ID)

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/index.js:5:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:14:24)

  ● restrictSize › #setImages() › should not replace external images (those without media ID)

    TypeError: setImages is not a function

      110 | 				'<p><img src="https://wordpress.com/2015/11/forest.jpg" alt="forest" class="alignnone size-thumbnail"></p>';
      111 | 
    > 112 | 			const value = setImages( markup );
          | 			              ^
      113 | 			expect( value ).to.equal( markup );
      114 | 		} );
      115 | 	} );

      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:112:18)

FAIL client/lib/safe-image-url/test/index.js
  ● safeImageUrl() › browser › should ignore a blob url for current origin

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should ignore a blob url for current origin

    TypeError: safeImageUrl is not a function

      117 | 		test( 'should ignore a blob url for current origin', () => {
      118 | 			const originalUrl = 'blob:https://wordpress.com/ddd1d6b0-f31b-4937-ae9e-97f1d660cf71';
    > 119 | 			expect( safeImageUrl( originalUrl ) ).toEqual( originalUrl );
          | 			        ^
      120 | 		} );
      121 | 
      122 | 		test( 'should make a blob url for other origin safe', () => {

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:119:12)

  ● safeImageUrl() › browser › should make a blob url for other origin safe

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should make a blob url for other origin safe

    TypeError: safeImageUrl is not a function

      124 | 			const expectedUrl =
      125 | 				'https://i1.wp.com/http//example.com/ddd1d6b0-f31b-4937-ae9e-97f1d660cf71';
    > 126 | 			expect( safeImageUrl( originalUrl ) ).toEqual( expectedUrl );
          | 			        ^
      127 | 		} );
      128 | 
      129 | 		commonTests();

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:126:12)

  ● safeImageUrl() › browser › should ignore a relative url

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should ignore a relative url

    TypeError: safeImageUrl is not a function

      4 | 	function commonTests() {
      5 | 		test( 'should ignore a relative url', () => {
    > 6 | 			expect( safeImageUrl( '/foo' ) ).toEqual( '/foo' );
        | 			        ^
      7 | 		} );
      8 | 
      9 | 		test( 'should ignore a data url', () => {

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:6:12)

  ● safeImageUrl() › browser › should ignore a data url

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should ignore a data url

    TypeError: safeImageUrl is not a function

      10 | 			const dataImageUrl =
      11 | 				'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';
    > 12 | 			expect( safeImageUrl( dataImageUrl ) ).toEqual( dataImageUrl );
         | 			        ^
      13 | 		} );
      14 | 
      15 | 		test( 'should make a non-whitelisted protocol safe', () => {

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:12:12)

  ● safeImageUrl() › browser › should make a non-whitelisted protocol safe

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should make a non-whitelisted protocol safe

    TypeError: safeImageUrl is not a function

      16 | 			[ 'javascript:alert("foo")', 'data:application/json;base64,', 'about:config' ].forEach(
      17 | 				url => {
    > 18 | 					expect( safeImageUrl( url ) ).toMatch( /^https:\/\/i[0-2]\.wp.com\// );
         | 					        ^
      19 | 				}
      20 | 			);
      21 | 		} );

      at forEach (client/lib/safe-image-url/test/index.js:18:14)
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:16:83)

  ● safeImageUrl() › browser › should make a non-wpcom http url safe

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should make a non-wpcom http url safe

    TypeError: safeImageUrl is not a function

      22 | 
      23 | 		test( 'should make a non-wpcom http url safe', () => {
    > 24 | 			expect( safeImageUrl( 'http://example.com/foo' ) ).toEqual(
         | 			        ^
      25 | 				'https://i1.wp.com/example.com/foo'
      26 | 			);
      27 | 		} );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:24:12)

  ● safeImageUrl() › browser › should make a non-wpcom https url safe

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should make a non-wpcom https url safe

    TypeError: safeImageUrl is not a function

      28 | 
      29 | 		test( 'should make a non-wpcom https url safe', () => {
    > 30 | 			expect( safeImageUrl( 'https://example.com/foo' ) ).toEqual(
         | 			        ^
      31 | 				'https://i1.wp.com/example.com/foo?ssl=1'
      32 | 			);
      33 | 		} );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:30:12)

  ● safeImageUrl() › browser › should make wp-com like subdomain url safe

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should make wp-com like subdomain url safe

    TypeError: safeImageUrl is not a function

      34 | 
      35 | 		test( 'should make wp-com like subdomain url safe', () => {
    > 36 | 			expect( safeImageUrl( 'https://wordpress.com.example.com/foo' ) ).toEqual(
         | 			        ^
      37 | 				'https://i0.wp.com/wordpress.com.example.com/foo?ssl=1'
      38 | 			);
      39 | 		} );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:36:12)

  ● safeImageUrl() › browser › should make safe variations of urls testing extremes of safe patterns

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should make safe variations of urls testing extremes of safe patterns

    TypeError: undefined is not a function
        at Array.map (<anonymous>)

      45 | 					'https://wordpresscom/foo',
      46 | 					'https://wordpress.com.example.com/foo',
    > 47 | 				].map( safeImageUrl )
         | 				  ^
      48 | 			).toEqual( [
      49 | 				'https://i0.wp.com/examplewordpress.com/foo?ssl=1',
      50 | 				'https://i0.wp.com/wordpresscom/foo?ssl=1',

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:47:7)

  ● safeImageUrl() › browser › should make a non-wpcom protocol relative url safe

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should make a non-wpcom protocol relative url safe

    TypeError: safeImageUrl is not a function

      54 | 
      55 | 		test( 'should make a non-wpcom protocol relative url safe', () => {
    > 56 | 			expect( safeImageUrl( '//example.com/foo' ) ).toEqual( 'https://i1.wp.com/example.com/foo' );
         | 			        ^
      57 | 		} );
      58 | 
      59 | 		test( 'should promote an http wpcom url to https', () => {

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:56:12)

  ● safeImageUrl() › browser › should promote an http wpcom url to https

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should promote an http wpcom url to https

    TypeError: safeImageUrl is not a function

      58 | 
      59 | 		test( 'should promote an http wpcom url to https', () => {
    > 60 | 			expect( safeImageUrl( 'http://files.wordpress.com/' ) ).toEqual(
         | 			        ^
      61 | 				'https://files.wordpress.com/'
      62 | 			);
      63 | 			expect( safeImageUrl( 'http://wordpress.com/' ) ).toEqual( 'https://wordpress.com/' );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:60:12)

  ● safeImageUrl() › browser › should leave https wpcom url alone

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should leave https wpcom url alone

    TypeError: safeImageUrl is not a function

      65 | 
      66 | 		test( 'should leave https wpcom url alone', () => {
    > 67 | 			expect( safeImageUrl( 'https://files.wordpress.com/' ) ).toEqual(
         | 			        ^
      68 | 				'https://files.wordpress.com/'
      69 | 			);
      70 | 			expect( safeImageUrl( 'https://wordpress.com/' ) ).toEqual( 'https://wordpress.com/' );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:67:12)

  ● safeImageUrl() › browser › should promote an http gravatar url to https

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should promote an http gravatar url to https

    TypeError: safeImageUrl is not a function

      75 | 
      76 | 		test( 'should promote an http gravatar url to https', () => {
    > 77 | 			expect( safeImageUrl( 'http://files.gravatar.com/' ) ).toEqual(
         | 			        ^
      78 | 				'https://files.gravatar.com/'
      79 | 			);
      80 | 			expect( safeImageUrl( 'http://gravatar.com/' ) ).toEqual( 'https://gravatar.com/' );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:77:12)

  ● safeImageUrl() › browser › should leave https gravatar url alone

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should leave https gravatar url alone

    TypeError: safeImageUrl is not a function

      82 | 
      83 | 		test( 'should leave https gravatar url alone', () => {
    > 84 | 			expect( safeImageUrl( 'https://files.gravatar.com/' ) ).toEqual(
         | 			        ^
      85 | 				'https://files.gravatar.com/'
      86 | 			);
      87 | 			expect( safeImageUrl( 'https://gravatar.com/' ) ).toEqual( 'https://gravatar.com/' );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:84:12)

  ● safeImageUrl() › browser › should return null for urls with querystrings

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should return null for urls with querystrings

    TypeError: safeImageUrl is not a function

      89 | 
      90 | 		test( 'should return null for urls with querystrings', () => {
    > 91 | 			expect( safeImageUrl( 'https://example.com/foo?bar' ) ).toBeNull();
         | 			        ^
      92 | 			expect( safeImageUrl( 'https://example.com/foo.jpg?bar' ) ).toBeNull();
      93 | 			expect( safeImageUrl( 'https://example.com/foo.jpeg?bar' ) ).toBeNull();
      94 | 			expect( safeImageUrl( 'https://example.com/foo.gif?bar' ) ).toBeNull();

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:91:12)

  ● safeImageUrl() › browser › should return null for SVG images

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should return null for SVG images

    TypeError: safeImageUrl is not a function

       98 | 
       99 | 		test( 'should return null for SVG images', () => {
    > 100 | 			expect( safeImageUrl( 'https://example.com/foo.svg' ) ).toBeNull();
          | 			        ^
      101 | 			expect( safeImageUrl( 'https://example.com/foo.svg?ssl=1' ) ).toBeNull();
      102 | 		} );
      103 | 	}

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:100:12)

  ● safeImageUrl() › node › should make a blob url safe

    TypeError: safeImageUrl is not a function

      139 | 			const expectedUrl =
      140 | 				'https://i1.wp.com/http//example.com/ddd1d6b0-f31b-4937-ae9e-97f1d660cf71';
    > 141 | 			expect( safeImageUrl( originalUrl ) ).toEqual( expectedUrl );
          | 			        ^
      142 | 		} );
      143 | 
      144 | 		commonTests();

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:141:12)

  ● safeImageUrl() › node › should ignore a relative url

    TypeError: safeImageUrl is not a function

      4 | 	function commonTests() {
      5 | 		test( 'should ignore a relative url', () => {
    > 6 | 			expect( safeImageUrl( '/foo' ) ).toEqual( '/foo' );
        | 			        ^
      7 | 		} );
      8 | 
      9 | 		test( 'should ignore a data url', () => {

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:6:12)

  ● safeImageUrl() › node › should ignore a data url

    TypeError: safeImageUrl is not a function

      10 | 			const dataImageUrl =
      11 | 				'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';
    > 12 | 			expect( safeImageUrl( dataImageUrl ) ).toEqual( dataImageUrl );
         | 			        ^
      13 | 		} );
      14 | 
      15 | 		test( 'should make a non-whitelisted protocol safe', () => {

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:12:12)

  ● safeImageUrl() › node › should make a non-whitelisted protocol safe

    TypeError: safeImageUrl is not a function

      16 | 			[ 'javascript:alert("foo")', 'data:application/json;base64,', 'about:config' ].forEach(
      17 | 				url => {
    > 18 | 					expect( safeImageUrl( url ) ).toMatch( /^https:\/\/i[0-2]\.wp.com\// );
         | 					        ^
      19 | 				}
      20 | 			);
      21 | 		} );

      at forEach (client/lib/safe-image-url/test/index.js:18:14)
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:16:83)

  ● safeImageUrl() › node › should make a non-wpcom http url safe

    TypeError: safeImageUrl is not a function

      22 | 
      23 | 		test( 'should make a non-wpcom http url safe', () => {
    > 24 | 			expect( safeImageUrl( 'http://example.com/foo' ) ).toEqual(
         | 			        ^
      25 | 				'https://i1.wp.com/example.com/foo'
      26 | 			);
      27 | 		} );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:24:12)

  ● safeImageUrl() › node › should make a non-wpcom https url safe

    TypeError: safeImageUrl is not a function

      28 | 
      29 | 		test( 'should make a non-wpcom https url safe', () => {
    > 30 | 			expect( safeImageUrl( 'https://example.com/foo' ) ).toEqual(
         | 			        ^
      31 | 				'https://i1.wp.com/example.com/foo?ssl=1'
      32 | 			);
      33 | 		} );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:30:12)

  ● safeImageUrl() › node › should make wp-com like subdomain url safe

    TypeError: safeImageUrl is not a function

      34 | 
      35 | 		test( 'should make wp-com like subdomain url safe', () => {
    > 36 | 			expect( safeImageUrl( 'https://wordpress.com.example.com/foo' ) ).toEqual(
         | 			        ^
      37 | 				'https://i0.wp.com/wordpress.com.example.com/foo?ssl=1'
      38 | 			);
      39 | 		} );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:36:12)

  ● safeImageUrl() › node › should make safe variations of urls testing extremes of safe patterns

    TypeError: [object Object] is not a function
        at Array.map (<anonymous>)

      45 | 					'https://wordpresscom/foo',
      46 | 					'https://wordpress.com.example.com/foo',
    > 47 | 				].map( safeImageUrl )
         | 				  ^
      48 | 			).toEqual( [
      49 | 				'https://i0.wp.com/examplewordpress.com/foo?ssl=1',
      50 | 				'https://i0.wp.com/wordpresscom/foo?ssl=1',

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:47:7)

  ● safeImageUrl() › node › should make a non-wpcom protocol relative url safe

    TypeError: safeImageUrl is not a function

      54 | 
      55 | 		test( 'should make a non-wpcom protocol relative url safe', () => {
    > 56 | 			expect( safeImageUrl( '//example.com/foo' ) ).toEqual( 'https://i1.wp.com/example.com/foo' );
         | 			        ^
      57 | 		} );
      58 | 
      59 | 		test( 'should promote an http wpcom url to https', () => {

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:56:12)

  ● safeImageUrl() › node › should promote an http wpcom url to https

    TypeError: safeImageUrl is not a function

      58 | 
      59 | 		test( 'should promote an http wpcom url to https', () => {
    > 60 | 			expect( safeImageUrl( 'http://files.wordpress.com/' ) ).toEqual(
         | 			        ^
      61 | 				'https://files.wordpress.com/'
      62 | 			);
      63 | 			expect( safeImageUrl( 'http://wordpress.com/' ) ).toEqual( 'https://wordpress.com/' );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:60:12)

  ● safeImageUrl() › node › should leave https wpcom url alone

    TypeError: safeImageUrl is not a function

      65 | 
      66 | 		test( 'should leave https wpcom url alone', () => {
    > 67 | 			expect( safeImageUrl( 'https://files.wordpress.com/' ) ).toEqual(
         | 			        ^
      68 | 				'https://files.wordpress.com/'
      69 | 			);
      70 | 			expect( safeImageUrl( 'https://wordpress.com/' ) ).toEqual( 'https://wordpress.com/' );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:67:12)

  ● safeImageUrl() › node › should promote an http gravatar url to https

    TypeError: safeImageUrl is not a function

      75 | 
      76 | 		test( 'should promote an http gravatar url to https', () => {
    > 77 | 			expect( safeImageUrl( 'http://files.gravatar.com/' ) ).toEqual(
         | 			        ^
      78 | 				'https://files.gravatar.com/'
      79 | 			);
      80 | 			expect( safeImageUrl( 'http://gravatar.com/' ) ).toEqual( 'https://gravatar.com/' );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:77:12)

  ● safeImageUrl() › node › should leave https gravatar url alone

    TypeError: safeImageUrl is not a function

      82 | 
      83 | 		test( 'should leave https gravatar url alone', () => {
    > 84 | 			expect( safeImageUrl( 'https://files.gravatar.com/' ) ).toEqual(
         | 			        ^
      85 | 				'https://files.gravatar.com/'
      86 | 			);
      87 | 			expect( safeImageUrl( 'https://gravatar.com/' ) ).toEqual( 'https://gravatar.com/' );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:84:12)

  ● safeImageUrl() › node › should return null for urls with querystrings

    TypeError: safeImageUrl is not a function

      89 | 
      90 | 		test( 'should return null for urls with querystrings', () => {
    > 91 | 			expect( safeImageUrl( 'https://example.com/foo?bar' ) ).toBeNull();
         | 			        ^
      92 | 			expect( safeImageUrl( 'https://example.com/foo.jpg?bar' ) ).toBeNull();
      93 | 			expect( safeImageUrl( 'https://example.com/foo.jpeg?bar' ) ).toBeNull();
      94 | 			expect( safeImageUrl( 'https://example.com/foo.gif?bar' ) ).toBeNull();

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:91:12)

  ● safeImageUrl() › node › should return null for SVG images

    TypeError: safeImageUrl is not a function

       98 | 
       99 | 		test( 'should return null for SVG images', () => {
    > 100 | 			expect( safeImageUrl( 'https://example.com/foo.svg' ) ).toBeNull();
          | 			        ^
      101 | 			expect( safeImageUrl( 'https://example.com/foo.svg?ssl=1' ) ).toBeNull();
      102 | 		} );
      103 | 	}

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:100:12)

FAIL client/lib/media/test/library-selected-store.js
  ● MediaLibrarySelectedStore › #get() › should return a single value

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:36:16)

  ● MediaLibrarySelectedStore › #get() › should return a single value

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaLibrarySelectedStore._media = {};
         | 		^
      49 | 	} );
      50 | 
      51 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:48:3)

  ● MediaLibrarySelectedStore › #get() › should return a single value

    TypeError: handler is not a function

      54 | 
      55 | 	function dispatchSetLibrarySelectedItems( action ) {
    > 56 | 		handler( {
         | 		^
      57 | 			action: assign(
      58 | 				{
      59 | 					type: 'SET_MEDIA_LIBRARY_SELECTED_ITEMS',

      at dispatchSetLibrarySelectedItems (client/lib/media/test/library-selected-store.js:56:3)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:92:4)

  ● MediaLibrarySelectedStore › #get() › should return undefined for an item that does not exist

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:36:16)

  ● MediaLibrarySelectedStore › #get() › should return undefined for an item that does not exist

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaLibrarySelectedStore._media = {};
         | 		^
      49 | 	} );
      50 | 
      51 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:48:3)

  ● MediaLibrarySelectedStore › #get() › should return undefined for an item that does not exist

    TypeError: Cannot read property 'get' of undefined

       98 | 
       99 | 		test( 'should return undefined for an item that does not exist', () => {
    > 100 | 			expect( MediaLibrarySelectedStore.get( DUMMY_SITE_ID, DUMMY_TRANSIENT_MEDIA_OBJECT.ID + 1 ) )
          | 			                                  ^
      101 | 				.to.be.undefined;
      102 | 		} );
      103 | 	} );

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:100:38)

  ● MediaLibrarySelectedStore › #getAll() › should return all selected media

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:36:16)

  ● MediaLibrarySelectedStore › #getAll() › should return all selected media

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaLibrarySelectedStore._media = {};
         | 		^
      49 | 	} );
      50 | 
      51 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:48:3)

  ● MediaLibrarySelectedStore › #getAll() › should return all selected media

    TypeError: handler is not a function

      54 | 
      55 | 	function dispatchSetLibrarySelectedItems( action ) {
    > 56 | 		handler( {
         | 		^
      57 | 			action: assign(
      58 | 				{
      59 | 					type: 'SET_MEDIA_LIBRARY_SELECTED_ITEMS',

      at dispatchSetLibrarySelectedItems (client/lib/media/test/library-selected-store.js:56:3)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:107:4)

  ● MediaLibrarySelectedStore › #getAll() › should return an empty array for a site with no selected items

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:36:16)

  ● MediaLibrarySelectedStore › #getAll() › should return an empty array for a site with no selected items

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaLibrarySelectedStore._media = {};
         | 		^
      49 | 	} );
      50 | 
      51 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:48:3)

  ● MediaLibrarySelectedStore › #getAll() › should return an empty array for a site with no selected items

    TypeError: Cannot read property 'getAll' of undefined

      113 | 
      114 | 		test( 'should return an empty array for a site with no selected items', () => {
    > 115 | 			expect( MediaLibrarySelectedStore.getAll( DUMMY_SITE_ID ) ).to.eql( [] );
          | 			                                  ^
      116 | 		} );
      117 | 	} );
      118 | 

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:115:38)

  ● MediaLibrarySelectedStore › .dispatchToken › should expose its dispatcher ID

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:36:16)

  ● MediaLibrarySelectedStore › .dispatchToken › should expose its dispatcher ID

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaLibrarySelectedStore._media = {};
         | 		^
      49 | 	} );
      50 | 
      51 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:48:3)

  ● MediaLibrarySelectedStore › .dispatchToken › should expose its dispatcher ID

    TypeError: Cannot read property 'dispatchToken' of undefined

      119 | 	describe( '.dispatchToken', () => {
      120 | 		test( 'should expose its dispatcher ID', () => {
    > 121 | 			expect( MediaLibrarySelectedStore.dispatchToken ).to.not.be.undefined;
          | 			                                  ^
      122 | 		} );
      123 | 
      124 | 		test( 'should emit a change event when library items have been set', done => {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:121:38)

  ● MediaLibrarySelectedStore › .dispatchToken › should emit a change event when library items have been set

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:36:16)

  ● MediaLibrarySelectedStore › .dispatchToken › should emit a change event when library items have been set

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaLibrarySelectedStore._media = {};
         | 		^
      49 | 	} );
      50 | 
      51 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:48:3)

  ● MediaLibrarySelectedStore › .dispatchToken › should emit a change event when library items have been set

    TypeError: Cannot read property 'once' of undefined

      123 | 
      124 | 		test( 'should emit a change event when library items have been set', done => {
    > 125 | 			MediaLibrarySelectedStore.once( 'change', done );
          | 			                          ^
      126 | 
      127 | 			dispatchSetLibrarySelectedItems();
      128 | 		} );

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:125:30)

  ● MediaLibrarySelectedStore › .dispatchToken › should emit a change event when receiving updates

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:36:16)

  ● MediaLibrarySelectedStore › .dispatchToken › should emit a change event when receiving updates

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaLibrarySelectedStore._media = {};
         | 		^
      49 | 	} );
      50 | 
      51 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:48:3)

  ● MediaLibrarySelectedStore › .dispatchToken › should emit a change event when receiving updates

    TypeError: Cannot read property 'once' of undefined

      129 | 
      130 | 		test( 'should emit a change event when receiving updates', done => {
    > 131 | 			MediaLibrarySelectedStore.once( 'change', done );
          | 			                          ^
      132 | 
      133 | 			dispatchReceiveMediaItem();
      134 | 		} );

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:131:30)

  ● MediaLibrarySelectedStore › .dispatchToken › should replace an item when its ID has changed

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:36:16)

  ● MediaLibrarySelectedStore › .dispatchToken › should replace an item when its ID has changed

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaLibrarySelectedStore._media = {};
         | 		^
      49 | 	} );
      50 | 
      51 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:48:3)

  ● MediaLibrarySelectedStore › .dispatchToken › should replace an item when its ID has changed

    TypeError: handler is not a function

      54 | 
      55 | 	function dispatchSetLibrarySelectedItems( action ) {
    > 56 | 		handler( {
         | 		^
      57 | 			action: assign(
      58 | 				{
      59 | 					type: 'SET_MEDIA_LIBRARY_SELECTED_ITEMS',

      at dispatchSetLibrarySelectedItems (client/lib/media/test/library-selected-store.js:56:3)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:137:4)

  ● MediaLibrarySelectedStore › .dispatchToken › should remove an item when REMOVE_MEDIA_ITEM is dispatched

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:36:16)

  ● MediaLibrarySelectedStore › .dispatchToken › should remove an item when REMOVE_MEDIA_ITEM is dispatched

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaLibrarySelectedStore._media = {};
         | 		^
      49 | 	} );
      50 | 
      51 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:48:3)

  ● MediaLibrarySelectedStore › .dispatchToken › should remove an item when REMOVE_MEDIA_ITEM is dispatched

    TypeError: handler is not a function

      54 | 
      55 | 	function dispatchSetLibrarySelectedItems( action ) {
    > 56 | 		handler( {
         | 		^
      57 | 			action: assign(
      58 | 				{
      59 | 					type: 'SET_MEDIA_LIBRARY_SELECTED_ITEMS',

      at dispatchSetLibrarySelectedItems (client/lib/media/test/library-selected-store.js:56:3)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:144:4)

  ● MediaLibrarySelectedStore › .dispatchToken › should clear selected items when CHANGE_MEDIA_SOURCE is dispatched

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:36:16)

  ● MediaLibrarySelectedStore › .dispatchToken › should clear selected items when CHANGE_MEDIA_SOURCE is dispatched

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaLibrarySelectedStore._media = {};
         | 		^
      49 | 	} );
      50 | 
      51 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:48:3)

  ● MediaLibrarySelectedStore › .dispatchToken › should clear selected items when CHANGE_MEDIA_SOURCE is dispatched

    TypeError: handler is not a function

      54 | 
      55 | 	function dispatchSetLibrarySelectedItems( action ) {
    > 56 | 		handler( {
         | 		^
      57 | 			action: assign(
      58 | 				{
      59 | 					type: 'SET_MEDIA_LIBRARY_SELECTED_ITEMS',

      at dispatchSetLibrarySelectedItems (client/lib/media/test/library-selected-store.js:56:3)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:151:4)

FAIL client/my-sites/people/people-invite-details/test/index.jsx
  ● Console

    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.

  ● PeopleInviteDetails › should trigger deletion upon clicking Revoke Invite (pending invite)

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/state/selectors/get-media-url.js:5:1)
      at Object.<anonymous> (client/state/selectors/get-site-icon-url.js:11:1)
      at Object.<anonymous> (client/blocks/site-icon/index.jsx:20:1)
      at Object.<anonymous> (client/my-sites/sidebar-navigation/index.jsx:13:1)
      at Object.<anonymous> (client/my-sites/people/people-invite-details/index.jsx:15:1)
      at Object.<anonymous> (client/my-sites/people/people-invite-details/test/index.jsx:66:25)

  ● PeopleInviteDetails › should trigger deletion upon clicking Revoke Invite (pending invite)

    TypeError: Cannot read property 'contextTypes' of undefined

      74 | 		const mockDeleteInvite = jest.fn();
      75 | 
    > 76 | 		const inviteDetails = shallow(
         | 		                      ^
      77 | 			<PeopleInviteDetails
      78 | 				site={ siteObject }
      79 | 				requesting={ false }

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/my-sites/people/people-invite-details/test/index.jsx:76:25)

  ● PeopleInviteDetails › should trigger deletion upon clicking Clear Invite (accepted invite)

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/state/selectors/get-media-url.js:5:1)
      at Object.<anonymous> (client/state/selectors/get-site-icon-url.js:11:1)
      at Object.<anonymous> (client/blocks/site-icon/index.jsx:20:1)
      at Object.<anonymous> (client/my-sites/sidebar-navigation/index.jsx:13:1)
      at Object.<anonymous> (client/my-sites/people/people-invite-details/index.jsx:15:1)
      at Object.<anonymous> (client/my-sites/people/people-invite-details/test/index.jsx:66:25)

  ● PeopleInviteDetails › should trigger deletion upon clicking Clear Invite (accepted invite)

    TypeError: Cannot read property 'contextTypes' of undefined

      103 | 		const mockDeleteInvite = jest.fn();
      104 | 
    > 105 | 		const inviteDetails = shallow(
          | 		                      ^
      106 | 			<PeopleInviteDetails
      107 | 				site={ siteObject }
      108 | 				requesting={ false }

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/my-sites/people/people-invite-details/test/index.jsx:105:25)

  ● PeopleInviteDetails › should navigate back (to the invite list) when an invite is deleted

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/state/selectors/get-media-url.js:5:1)
      at Object.<anonymous> (client/state/selectors/get-site-icon-url.js:11:1)
      at Object.<anonymous> (client/blocks/site-icon/index.jsx:20:1)
      at Object.<anonymous> (client/my-sites/sidebar-navigation/index.jsx:13:1)
      at Object.<anonymous> (client/my-sites/people/people-invite-details/index.jsx:15:1)
      at Object.<anonymous> (client/my-sites/people/people-invite-details/test/index.jsx:66:25)

  ● PeopleInviteDetails › should navigate back (to the invite list) when an invite is deleted

    TypeError: Cannot read property 'contextTypes' of undefined

      130 | 
      131 | 	it( 'should navigate back (to the invite list) when an invite is deleted', () => {
    > 132 | 		const inviteDetails = shallow(
          | 		                      ^
      133 | 			<PeopleInviteDetails
      134 | 				site={ siteObject }
      135 | 				requesting={ false }

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/my-sites/people/people-invite-details/test/index.jsx:132:25)

FAIL client/components/accordion/test/status.jsx
  ● Console

    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.
    console.error node_modules/react/cjs/react.development.js:167
      Warning: React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: undefined. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.

  ● AccordionStatus › should render with explicit props

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/test/status.jsx:18:21)

  ● AccordionStatus › should render with explicit props

    TypeError: Cannot read property 'contextTypes' of undefined

      27 | 			position: 'top left',
      28 | 		};
    > 29 | 		const wrapper = shallow( <AccordionStatus { ...status } /> );
         | 		                ^
      30 | 
      31 | 		expect( wrapper.find( 'a' ) )
      32 | 			.to.have.prop( 'href' )

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/status.jsx:29:19)

  ● AccordionStatus › should render with default props

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/test/status.jsx:18:21)

  ● AccordionStatus › should render with default props

    TypeError: Cannot read property 'contextTypes' of undefined

      45 | 
      46 | 	test( 'should render with default props', () => {
    > 47 | 		const wrapper = shallow( <AccordionStatus /> );
         | 		                ^
      48 | 
      49 | 		expect( wrapper.find( 'a' ) ).to.not.have.prop( 'href' );
      50 | 		expect( wrapper.find( 'a' ) ).to.have.className( 'is-info' );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/status.jsx:47:19)

  ● AccordionStatus › should show tooltip on hover

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/test/status.jsx:18:21)

  ● AccordionStatus › should show tooltip on hover

    TypeError: Cannot read property 'contextTypes' of undefined

      56 | 
      57 | 	test( 'should show tooltip on hover', () => {
    > 58 | 		const wrapper = shallow( <AccordionStatus text="Warning!" /> );
         | 		                ^
      59 | 
      60 | 		expect( wrapper.find( Tooltip ) ).to.have.prop( 'isVisible' ).be.false;
      61 | 		expect( wrapper.find( Tooltip ) )

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/status.jsx:58:19)

  ● AccordionStatus › should call onClick callback

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/test/status.jsx:18:21)

  ● AccordionStatus › should call onClick callback

    TypeError: Cannot read property 'contextTypes' of undefined

      74 | 	test( 'should call onClick callback', () => {
      75 | 		const spy = sinon.spy();
    > 76 | 		const wrapper = shallow( <AccordionStatus onClick={ spy } /> );
         | 		                ^
      77 | 
      78 | 		wrapper.find( 'a' ).simulate( 'click' );
      79 | 

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/status.jsx:76:19)

FAIL client/blocks/app-promo/test/index.jsx
  ● AppPromo › readering › should render the primary components

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/app-promo/index.jsx:18:1)
      at Object.<anonymous> (client/blocks/app-promo/test/index.jsx:30:14)

  ● AppPromo › readering › should render the primary components

    TypeError: ShallowWrapper can only wrap valid elements

      35 | 	describe( 'readering', () => {
      36 | 		test( 'should render the primary components', () => {
    > 37 | 			const wrapper = shallow( AppPromoComponent );
         | 			                ^
      38 | 
      39 | 			expect( wrapper ).to.have.descendants( '.app-promo' );
      40 | 			expect( wrapper ).to.have.descendants( '.app-promo__dismiss' );

      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:386:15)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/app-promo/test/index.jsx:37:20)

  ● AppPromo › readering › should render the promo text

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/app-promo/index.jsx:18:1)
      at Object.<anonymous> (client/blocks/app-promo/test/index.jsx:30:14)

  ● AppPromo › readering › should render the promo text

    TypeError: ShallowWrapper can only wrap valid elements

      43 | 
      44 | 		test( 'should render the promo text', () => {
    > 45 | 			const wrapper = shallow( AppPromoComponent );
         | 			                ^
      46 | 
      47 | 			expect( wrapper.text() ).to.contain( appPromoDetails.message );
      48 | 		} );

      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:386:15)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/app-promo/test/index.jsx:45:20)

  ● AppPromo › readering › should render the promo link

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/app-promo/index.jsx:18:1)
      at Object.<anonymous> (client/blocks/app-promo/test/index.jsx:30:14)

  ● AppPromo › readering › should render the promo link

    TypeError: ShallowWrapper can only wrap valid elements

      49 | 
      50 | 		test( 'should render the promo link', () => {
    > 51 | 			const wrapper = shallow( AppPromoComponent );
         | 			                ^
      52 | 
      53 | 			const promoLink = wrapper.find( '.app-promo__link' );
      54 | 			expect( promoLink ).to.have.lengthOf( 1 );

      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:386:15)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/app-promo/test/index.jsx:51:20)

  ● AppPromo › getPromoLink › should render a mobile link when the mobile promo code is passed in

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/app-promo/index.jsx:18:1)
      at Object.<anonymous> (client/blocks/app-promo/test/index.jsx:30:14)

  ● AppPromo › getPromoLink › should render a mobile link when the mobile promo code is passed in

    TypeError: getPromoLink is not a function

      73 | 
      74 | 		test( 'should render a mobile link when the mobile promo code is passed in', () => {
    > 75 | 			expect( getPromoLink( 'reader', mobilePromo ) ).to.include( 'mobile' );
         | 			        ^
      76 | 		} );
      77 | 
      78 | 		test( 'should render a desktop link when the desktop promo code is passed in', () => {

      at Object.<anonymous> (client/blocks/app-promo/test/index.jsx:75:12)

  ● AppPromo › getPromoLink › should render a desktop link when the desktop promo code is passed in

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/app-promo/index.jsx:18:1)
      at Object.<anonymous> (client/blocks/app-promo/test/index.jsx:30:14)

  ● AppPromo › getPromoLink › should render a desktop link when the desktop promo code is passed in

    TypeError: getPromoLink is not a function

      77 | 
      78 | 		test( 'should render a desktop link when the desktop promo code is passed in', () => {
    > 79 | 			expect( getPromoLink( 'reader', desktopPromo ) ).to.include( 'desktop' );
         | 			        ^
      80 | 		} );
      81 | 	} );
      82 | } );

      at Object.<anonymous> (client/blocks/app-promo/test/index.jsx:79:12)

PASS client/state/themes/test/selectors.js
PASS client/components/domains/registrant-extra-info/test/with-contact-details-validation.js
PASS client/state/sites/test/selectors.js
PASS client/extensions/woocommerce/state/ui/shipping/zones/locations/test/selectors.js
PASS client/lib/cart/store/test/index.js
PASS client/my-sites/checkout/cart/test/cart-plan-discount-ad.js
PASS client/extensions/woocommerce/woocommerce-services/state/shipping-label/test/reducer.js
PASS client/extensions/woocommerce/state/ui/shipping/zones/methods/test/reducer.js
PASS client/components/token-field/test/index.jsx
  ● Console

    console.error node_modules/jsdom/lib/jsdom/virtual-console.js:29
      Error: Not implemented: window.scroll
          at module.exports (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/not-implemented.js:9:17)
          at scroll (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/Window.js:594:7)
          at fallbackScrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:44:10)
          at scrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:91:2)
          at SuggestionsList.componentDidUpdate (/benchmarks/nacd/Automattic_wp-calypso/client/components/token-field/suggestions-list.jsx:44:5)
          at commitLifeCycles (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:22117:22)
          at commitLayoutEffects (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:25344:7)
          at HTMLUnknownElement.callCallback (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:336:14)
          at invokeEventListeners (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:193:27)
          at HTMLUnknownElementImpl._dispatch (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9) undefined
    console.error node_modules/jsdom/lib/jsdom/virtual-console.js:29
      Error: Not implemented: window.scroll
          at module.exports (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/not-implemented.js:9:17)
          at scroll (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/Window.js:594:7)
          at fallbackScrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:44:10)
          at scrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:91:2)
          at SuggestionsList.componentDidUpdate (/benchmarks/nacd/Automattic_wp-calypso/client/components/token-field/suggestions-list.jsx:44:5)
          at commitLifeCycles (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:22117:22)
          at commitLayoutEffects (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:25344:7)
          at HTMLUnknownElement.callCallback (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:336:14)
          at invokeEventListeners (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:193:27)
          at HTMLUnknownElementImpl._dispatch (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9) undefined
    console.error node_modules/jsdom/lib/jsdom/virtual-console.js:29
      Error: Not implemented: window.scroll
          at module.exports (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/not-implemented.js:9:17)
          at scroll (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/Window.js:594:7)
          at fallbackScrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:44:10)
          at scrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:91:2)
          at SuggestionsList.componentDidUpdate (/benchmarks/nacd/Automattic_wp-calypso/client/components/token-field/suggestions-list.jsx:44:5)
          at commitLifeCycles (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:22117:22)
          at commitLayoutEffects (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:25344:7)
          at HTMLUnknownElement.callCallback (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:336:14)
          at invokeEventListeners (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:193:27)
          at HTMLUnknownElementImpl._dispatch (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9) undefined
    console.error node_modules/jsdom/lib/jsdom/virtual-console.js:29
      Error: Not implemented: window.scroll
          at module.exports (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/not-implemented.js:9:17)
          at scroll (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/Window.js:594:7)
          at fallbackScrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:44:10)
          at scrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:91:2)
          at SuggestionsList.componentDidUpdate (/benchmarks/nacd/Automattic_wp-calypso/client/components/token-field/suggestions-list.jsx:44:5)
          at commitLifeCycles (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:22117:22)
          at commitLayoutEffects (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:25344:7)
          at HTMLUnknownElement.callCallback (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:336:14)
          at invokeEventListeners (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:193:27)
          at HTMLUnknownElementImpl._dispatch (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9) undefined
    console.error node_modules/jsdom/lib/jsdom/virtual-console.js:29
      Error: Not implemented: window.scroll
          at module.exports (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/not-implemented.js:9:17)
          at scroll (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/Window.js:594:7)
          at fallbackScrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:44:10)
          at scrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:91:2)
          at SuggestionsList.componentDidUpdate (/benchmarks/nacd/Automattic_wp-calypso/client/components/token-field/suggestions-list.jsx:44:5)
          at commitLifeCycles (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:22117:22)
          at commitLayoutEffects (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:25344:7)
          at HTMLUnknownElement.callCallback (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:336:14)
          at invokeEventListeners (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:193:27)
          at HTMLUnknownElementImpl._dispatch (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9) undefined
    console.error node_modules/jsdom/lib/jsdom/virtual-console.js:29
      Error: Not implemented: window.scroll
          at module.exports (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/not-implemented.js:9:17)
          at scroll (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/Window.js:594:7)
          at fallbackScrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:44:10)
          at scrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:91:2)
          at SuggestionsList.componentDidUpdate (/benchmarks/nacd/Automattic_wp-calypso/client/components/token-field/suggestions-list.jsx:44:5)
          at commitLifeCycles (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:22117:22)
          at commitLayoutEffects (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:25344:7)
          at HTMLUnknownElement.callCallback (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:336:14)
          at invokeEventListeners (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:193:27)
          at HTMLUnknownElementImpl._dispatch (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9) undefined
    console.error node_modules/jsdom/lib/jsdom/virtual-console.js:29
      Error: Not implemented: window.scroll
          at module.exports (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/not-implemented.js:9:17)
          at scroll (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/Window.js:594:7)
          at fallbackScrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:44:10)
          at scrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:91:2)
          at SuggestionsList.componentDidUpdate (/benchmarks/nacd/Automattic_wp-calypso/client/components/token-field/suggestions-list.jsx:44:5)
          at commitLifeCycles (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:22117:22)
          at commitLayoutEffects (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:25344:7)
          at HTMLUnknownElement.callCallback (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:336:14)
          at invokeEventListeners (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:193:27)
          at HTMLUnknownElementImpl._dispatch (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9) undefined
    console.error node_modules/jsdom/lib/jsdom/virtual-console.js:29
      Error: Not implemented: window.scroll
          at module.exports (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/not-implemented.js:9:17)
          at scroll (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/Window.js:594:7)
          at fallbackScrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:44:10)
          at scrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:91:2)
          at SuggestionsList.componentDidUpdate (/benchmarks/nacd/Automattic_wp-calypso/client/components/token-field/suggestions-list.jsx:44:5)
          at commitLifeCycles (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:22117:22)
          at commitLayoutEffects (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:25344:7)
          at HTMLUnknownElement.callCallback (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:336:14)
          at invokeEventListeners (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:193:27)
          at HTMLUnknownElementImpl._dispatch (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9) undefined
    console.error node_modules/jsdom/lib/jsdom/virtual-console.js:29
      Error: Not implemented: window.scroll
          at module.exports (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/not-implemented.js:9:17)
          at scroll (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/Window.js:594:7)
          at fallbackScrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:44:10)
          at scrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:91:2)
          at SuggestionsList.componentDidUpdate (/benchmarks/nacd/Automattic_wp-calypso/client/components/token-field/suggestions-list.jsx:44:5)
          at commitLifeCycles (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:22117:22)
          at commitLayoutEffects (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:25344:7)
          at HTMLUnknownElement.callCallback (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:336:14)
          at invokeEventListeners (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:193:27)
          at HTMLUnknownElementImpl._dispatch (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9) undefined
    console.error node_modules/jsdom/lib/jsdom/virtual-console.js:29
      Error: Not implemented: window.scroll
          at module.exports (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/not-implemented.js:9:17)
          at scroll (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/Window.js:594:7)
          at fallbackScrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:44:10)
          at scrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:91:2)
          at SuggestionsList.componentDidUpdate (/benchmarks/nacd/Automattic_wp-calypso/client/components/token-field/suggestions-list.jsx:44:5)
          at commitLifeCycles (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:22117:22)
          at commitLayoutEffects (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:25344:7)
          at HTMLUnknownElement.callCallback (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:336:14)
          at invokeEventListeners (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:193:27)
          at HTMLUnknownElementImpl._dispatch (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9) undefined
    console.error node_modules/jsdom/lib/jsdom/virtual-console.js:29
      Error: Not implemented: window.scroll
          at module.exports (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/not-implemented.js:9:17)
          at scroll (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/Window.js:594:7)
          at fallbackScrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:44:10)
          at scrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:91:2)
          at SuggestionsList.componentDidUpdate (/benchmarks/nacd/Automattic_wp-calypso/client/components/token-field/suggestions-list.jsx:44:5)
          at commitLifeCycles (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:22117:22)
          at commitLayoutEffects (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:25344:7)
          at HTMLUnknownElement.callCallback (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:336:14)
          at invokeEventListeners (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:193:27)
          at HTMLUnknownElementImpl._dispatch (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9) undefined
    console.error node_modules/jsdom/lib/jsdom/virtual-console.js:29
      Error: Not implemented: window.scroll
          at module.exports (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/not-implemented.js:9:17)
          at scroll (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/Window.js:594:7)
          at fallbackScrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:44:10)
          at scrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:91:2)
          at SuggestionsList.componentDidUpdate (/benchmarks/nacd/Automattic_wp-calypso/client/components/token-field/suggestions-list.jsx:44:5)
          at commitLifeCycles (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:22117:22)
          at commitLayoutEffects (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:25344:7)
          at HTMLUnknownElement.callCallback (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:336:14)
          at invokeEventListeners (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:193:27)
          at HTMLUnknownElementImpl._dispatch (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9) undefined
    console.error node_modules/jsdom/lib/jsdom/virtual-console.js:29
      Error: Not implemented: window.scroll
          at module.exports (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/not-implemented.js:9:17)
          at scroll (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/Window.js:594:7)
          at fallbackScrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:44:10)
          at scrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:91:2)
          at SuggestionsList.componentDidUpdate (/benchmarks/nacd/Automattic_wp-calypso/client/components/token-field/suggestions-list.jsx:44:5)
          at commitLifeCycles (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:22117:22)
          at commitLayoutEffects (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:25344:7)
          at HTMLUnknownElement.callCallback (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:336:14)
          at invokeEventListeners (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:193:27)
          at HTMLUnknownElementImpl._dispatch (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9) undefined
    console.error node_modules/jsdom/lib/jsdom/virtual-console.js:29
      Error: Not implemented: window.scroll
          at module.exports (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/not-implemented.js:9:17)
          at scroll (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/Window.js:594:7)
          at fallbackScrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:44:10)
          at scrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:91:2)
          at SuggestionsList.componentDidUpdate (/benchmarks/nacd/Automattic_wp-calypso/client/components/token-field/suggestions-list.jsx:44:5)
          at commitLifeCycles (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:22117:22)
          at commitLayoutEffects (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:25344:7)
          at HTMLUnknownElement.callCallback (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:336:14)
          at invokeEventListeners (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:193:27)
          at HTMLUnknownElementImpl._dispatch (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9) undefined
    console.error node_modules/jsdom/lib/jsdom/virtual-console.js:29
      Error: Not implemented: window.scroll
          at module.exports (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/not-implemented.js:9:17)
          at scroll (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/Window.js:594:7)
          at fallbackScrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:44:10)
          at scrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:91:2)
          at SuggestionsList.componentDidUpdate (/benchmarks/nacd/Automattic_wp-calypso/client/components/token-field/suggestions-list.jsx:44:5)
          at commitLifeCycles (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:22117:22)
          at commitLayoutEffects (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:25344:7)
          at HTMLUnknownElement.callCallback (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:336:14)
          at invokeEventListeners (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:193:27)
          at HTMLUnknownElementImpl._dispatch (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9) undefined
    console.error node_modules/jsdom/lib/jsdom/virtual-console.js:29
      Error: Not implemented: window.scroll
          at module.exports (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/not-implemented.js:9:17)
          at scroll (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/Window.js:594:7)
          at fallbackScrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:44:10)
          at scrollIntoViewport (/benchmarks/nacd/Automattic_wp-calypso/client/lib/scroll-into-viewport/index.js:91:2)
          at SuggestionsList.componentDidUpdate (/benchmarks/nacd/Automattic_wp-calypso/client/components/token-field/suggestions-list.jsx:44:5)
          at commitLifeCycles (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:22117:22)
          at commitLayoutEffects (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:25344:7)
          at HTMLUnknownElement.callCallback (/benchmarks/nacd/Automattic_wp-calypso/node_modules/react-dom/cjs/react-dom.development.js:336:14)
          at invokeEventListeners (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:193:27)
          at HTMLUnknownElementImpl._dispatch (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9) undefined

PASS client/state/jetpack-connect/test/actions.js
  ● Console

    console.error node_modules/jsdom/lib/jsdom/virtual-console.js:29
      Error: Not implemented: navigation (except hash changes)
          at module.exports (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/browser/not-implemented.js:9:17)
          at navigateFetch (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/window/navigation.js:74:3)
          at exports.navigate (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/window/navigation.js:52:3)
          at LocationImpl._locationObjectNavigate (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:29:5)
          at LocationImpl._locationObjectSetterNavigate (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:23:17)
          at LocationImpl.set href [as href] (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:45:10)
          at Location.set [as href] (/benchmarks/nacd/Automattic_wp-calypso/node_modules/jsdom/lib/jsdom/living/generated/Location.js:143:27)
          at externalRedirect (/benchmarks/nacd/Automattic_wp-calypso/client/lib/route/path.ts:164:2)
          at /benchmarks/nacd/Automattic_wp-calypso/client/state/jetpack-connect/actions.js:187:3
          at Object.<anonymous> (/benchmarks/nacd/Automattic_wp-calypso/client/state/jetpack-connect/test/actions.js:57:3) undefined

PASS client/lib/plans/test/plan-lookups.js
PASS client/my-sites/checkout/checkout/test/composite-checkout.js
PASS client/lib/cart-values/test/cart-items.js
PASS client/lib/gsuite/test/index.js
PASS client/extensions/woocommerce/state/ui/products/variations/test/edits-reducer.js
PASS client/extensions/wp-super-cache/state/settings/test/actions.js
PASS client/lib/user/test/utils.js
PASS client/lib/post-normalizer/test/index.js
PASS client/extensions/woocommerce/state/sites/setup-choices/test/actions.js
PASS client/lib/signup/test/flow-controller.js
PASS client/lib/directly/test/index.js
PASS client/components/domains/contact-details-form-fields/custom-form-fieldsets/test/us-address-fieldset.js
PASS client/signup/test/utils.js
PASS client/state/data-layer/wpcom-http/pipeline/remove-duplicate-gets/test/index.js
PASS client/state/sites/media-storage/test/selectors.js
PASS client/components/plans/plan-icon/test/test.jsx
PASS client/my-sites/checkout/cart/test/cart-item.js
PASS client/blocks/subscription-length-picker/test/index.js
PASS client/components/seo/preview-upgrade-nudge/test/index.jsx
PASS client/components/select-dropdown/test/index.js
PASS client/state/sites/launch/test/actions.js
PASS client/lib/signup/test/step-actions.js
PASS client/state/reader/follows/test/reducer.js
  ● Console

    console.warn client/lib/warn/index.js:14
      State validation failed.
      State: { 'dailypost.wordpress.com':
         { URL: 'http://dailypost.wordpress.com',
           is_following: true,
           blog_ID: 124 } }
      
      data[keys2.0].feed_URL is required
      Found: { URL: 'http://dailypost.wordpress.com',
        is_following: true,
        blog_ID: 124 }
      Violates rule: { type: 'object',
        required: [ 'feed_URL', 'URL', 'is_following', [length]: 3 ],
        properties:
         { URL: { type: 'string' },
           feed_URL: { type: 'string' },
           is_following: { type: 'boolean' },
           ID: { type: [ 'integer', 'null', [length]: 2 ] },
           blog_ID: { type: [ 'integer', 'null', [length]: 2 ] },
           feed_ID: { type: [ 'integer', 'null', [length]: 2 ] },
           date_subscribed: { type: [ 'integer', 'null', [length]: 2 ] },
           delivery_methods: { type: [ 'object', 'null', [length]: 2 ] },
           is_owner: { type: [ 'boolean', 'null', [length]: 2 ] } } }
      

PASS client/signup/steps/plans-atomic-store/test/index.jsx
PASS client/my-sites/site-settings/date-time-format/test/index.js
PASS client/state/notices/test/reducer.js
PASS client/lib/plugins/test/store.js
PASS client/state/nps-survey/test/actions.js
PASS client/state/data-layer/wpcom/activity-log/rewind/restore-status/test/index.js
PASS client/components/gsuite/gsuite-features/test/compact.js
PASS client/state/data-layer/wpcom/sites/plan-transfer/test/index.js
PASS client/state/ui/test/actions.js
PASS client/extensions/woocommerce/state/ui/shipping/zones/methods/test/selectors.js
PASS client/state/selectors/test/has-unseen-notifications.js
PASS client/state/selectors/test/get-theme-filter-to-term-table.js
PASS client/signup/steps/user/test/index.js
PASS client/lib/viewers/test/store.js
PASS client/extensions/woocommerce/components/d3/horizontal-bar/test/index.js
PASS client/state/sharing/publicize/test/actions.js
PASS client/state/happychat/test/middleware-calypso.js
PASS client/state/selectors/test/get-site-default-post-format.js
PASS client/signup/test/flows.js
PASS client/extensions/woocommerce/state/sites/settings/stripe-connect-account/test/reducer.js
PASS client/state/site-settings/test/actions.js
PASS client/lib/checkout/test/validation.js
PASS client/extensions/woocommerce/state/ui/reviews/test/reducer.js
PASS client/state/account-recovery/settings/test/actions.js
PASS client/state/user-devices/test/reducer.js
PASS client/extensions/woocommerce/state/sites/settings/general/test/reducer.js
PASS client/components/data/query-atat-eligibility/test/index.jsx
PASS client/state/stats/lists/test/actions.js
PASS client/state/timezones/test/actions.js
PASS client/extensions/woocommerce/state/sites/orders/activity-log/test/selectors.js
PASS client/lib/analytics/page-view-tracker/test/index.jsx
PASS client/blocks/post-share/test/nudges.jsx
PASS client/state/data-layer/wpcom/me/two-step/application-passwords/new/test/index.js
PASS client/state/purchases/test/selectors.js
PASS client/extensions/woocommerce/state/sites/data/counts/test/selectors.js
PASS client/components/domains/contact-details-form-fields/custom-form-fieldsets/test/region-address-fieldsets.js
PASS client/extensions/woocommerce/state/ui/payments/methods/test/selectors.js
PASS client/state/reader/feed-searches/test/query-key.js
PASS client/state/selectors/test/get-current-route-parameterized.js
PASS client/extensions/woocommerce/state/sites/shipping-methods/test/reducer.js
PASS client/extensions/woocommerce/state/sites/shipping-zone-methods/test/reducer.js
PASS client/state/selectors/test/get-restore-progress.js
PASS client/state/post-types/taxonomies/test/actions.js
PASS client/signup/steps/site-picker/test/site-picker-submit.jsx
PASS client/extensions/woocommerce/woocommerce-services/state/shipping-label/test/actions.js
PASS client/extensions/zoninator/state/data-layer/feeds/test/index.js
PASS client/extensions/woocommerce/woocommerce-services/state/shipping-label/test/selectors.js
PASS client/state/action-log/test/index.js
PASS client/state/data-layer/wpcom/sites/automated-transfer/status/test/index.js
PASS client/extensions/woocommerce/state/ui/shipping/zones/test/selectors.js
PASS client/components/domains/contact-details-form-fields/custom-form-fieldsets/test/uk-address-fieldset.js
PASS client/state/stats/lists/test/utils.js
PASS client/state/plugins/installed/test/actions.js
PASS client/state/help/directly/test/actions.js
PASS client/extensions/woocommerce/state/sites/coupons/test/reducer.js
PASS client/my-sites/plugins/plugin-activate-toggle/test/index.jsx
PASS client/state/selectors/test/is-connected-secondary-network-site.js
PASS client/state/data-layer/wpcom/sites/automated-transfer/initiate/test/index.js
PASS client/state/selectors/test/is-main-site-of.js
PASS client/components/product-icon/test/test.jsx
PASS client/extensions/woocommerce/state/data-layer/ui/products/test/index.js
PASS client/lib/route/test/index.js
PASS client/blocks/product-purchase-features-list/test/video-audio-posts.jsx
PASS client/state/data-layer/wpcom/sites/plugins/new/test/index.js
PASS client/state/data-layer/wpcom/sites/automated-transfer/eligibility/test/index.js
PASS client/extensions/woocommerce/state/sites/settings/mailchimp/test/reducer.js
PASS client/lib/checkout/test/masking.js
PASS client/lib/preferences/test/actions.js
PASS client/state/exporter/test/actions.js
PASS client/state/selectors/test/can-upgrade-to-plan.js
PASS client/components/domains/registrant-extra-info/test/ca-form.js
PASS client/me/purchases/track-purchase-page-view/test/index.js
PASS client/extensions/zoninator/state/zones/test/reducer.js
  ● Console

    console.warn client/lib/warn/index.js:14
      State validation failed.
      State: { '123456': 2 }
      
      data[keys2.0] is the wrong type
      Found: 2
      Violates rule: { type: 'object',
        patternProperties:
         { '^\\d+$':
            { type: 'object',
              properties:
               { id: { type: 'integer' },
                 name: { type: 'string' },
                 slug: { type: 'string' },
                 description: { type: 'string' } } } } }
      

PASS client/state/selectors/test/is-jetpack-remote-install-complete.js
PASS client/extensions/wp-super-cache/state/status/test/actions.js
PASS client/state/data-layer/wpcom/me/account/close/test/index.js
PASS client/components/payment-country-select/test/index.jsx
PASS client/components/domains/contact-details-form-fields/custom-form-fieldsets/test/eu-address-fieldset.js
PASS client/lib/cart-values/test/index.js
PASS client/extensions/woocommerce/state/sites/shipping-zones/test/selectors.js
PASS client/lib/safe-protocol-url/test/index.js
PASS client/extensions/wp-super-cache/state/cache/test/actions.js
PASS client/components/domains/registrant-extra-info/test/uk-form.js
  ● Console

    console.error node_modules/react/cjs/react.development.js:167
      Warning: Each child in a list should have a unique "key" prop.
      
      Check the top-level render call using <FormFieldset>. See https://fb.me/react-warning-keys for more information.
          in FormInputValidation

PASS client/state/data-layer/wpcom/read/following/mine/test/index.js
PASS client/lib/checkout/test/index.js
PASS client/extensions/woocommerce/state/sites/settings/email/test/actions.js
PASS client/state/sites/test/reducer.js
PASS client/jetpack-connect/test/main-wrapper.jsx
  ● Console

    console.error node_modules/react-dom/cjs/react-dom-server.node.development.js:76
      Warning: <DocumentHead /> is using incorrect casing. Use PascalCase for React components, or lowercase for HTML elements.
          in DocumentHead
          in main
          in Main

PASS client/state/plugins/upload/test/reducer.js
PASS client/state/sites/plans/test/selectors.js
PASS client/extensions/woocommerce/woocommerce-services/state/packages/test/reducer.js
PASS client/state/data-layer/test/wpcom-api-middleware.js
PASS client/state/data-layer/wpcom/read/tags/mine/new/test/index.js
PASS client/state/happychat/selectors/test/get-groups.js
PASS client/state/selectors/test/get-selected-or-all-sites-jetpack-can-manage.js
PASS client/state/analytics/test/middleware.js
PASS client/state/stats/lists/test/selectors.js
PASS client/state/data-layer/wpcom/sites/exports/media/test/index.js
PASS client/extensions/woocommerce/state/sites/shipping-zone-methods/test/selectors.js
PASS client/state/plugins/installed/test/selectors.js
PASS client/components/post-schedule/test/index.js
PASS client/state/selectors/test/is-drop-zone-visible.js
PASS client/state/jetpack-connect/test/selectors.js
PASS client/extensions/woocommerce/state/sites/shipping-methods/test/selectors.js
PASS client/components/select-dropdown/test/item.js
PASS client/extensions/woocommerce/woocommerce-services/state/packages/test/actions.js
PASS client/state/data-layer/wpcom/email-forwarding/get/test/index.js
PASS client/components/domains/registrant-extra-info/test/index.js
PASS client/state/timezones/test/reducer.js
PASS client/my-sites/feature-upsell/test/upsell-redirect.jsx
PASS client/state/happiness-engineers/test/actions.js
PASS client/extensions/wp-super-cache/state/plugins/test/actions.js
PASS client/state/data-layer/wpcom/read/site/post-email-subscriptions/update/test/index.js
PASS client/lib/abtest/test/index.js
PASS client/lib/purchases/test/assembler.js
PASS client/extensions/woocommerce/state/sites/product-categories/test/reducer.js
PASS client/state/selectors/test/has-cancelable-site-purchases.js
PASS client/extensions/woocommerce/state/sites/shipping-zones/test/actions.js
PASS client/lib/plans/test/plans-link.js
PASS client/lib/checkout/test/ebanx.js
PASS client/state/signup/steps/design-type/test/selectors.js
PASS client/components/forms/form-phone-input/test/index.jsx
PASS client/state/selectors/test/get-user-purchased-premium-themes.js
PASS client/state/selectors/test/get-site-blocks-current-page.js
PASS client/state/selectors/test/has-cancelable-user-purchases.js
PASS client/state/http/test/index.js
PASS client/my-sites/domains/components/form/test/hidden-input.js
PASS client/lib/purchases/test/index.js
PASS client/extensions/woocommerce/state/selectors/test/promotions.js
PASS client/components/notice/test/index.js
PASS client/extensions/wp-super-cache/state/stats/test/actions.js
PASS client/components/marketing-survey/cancel-purchase-form/step-components/test/business-at-step.jsx
PASS client/state/data-layer/wpcom/concierge/schedules/appointments/book/test/index.js
  ● Console

    console.warn client/lib/warn/index.js:14
      onSuccess handler is not defined: response to the request is being ignored
    console.warn client/lib/warn/index.js:14
      onError handler is not defined: error during the request is being ignored

PASS client/components/domains/registrant-extra-info/test/fr-form.js
PASS client/state/sharing/services/test/selectors.js
PASS client/lib/happychat/test/index.js
PASS client/components/data/query-tld-validation-schemas/test/index.jsx
PASS client/extensions/woocommerce/woocommerce-services/state/packages/test/selectors.js
PASS client/state/happychat/test/utils.js
PASS client/components/readme-viewer/test/index.js
PASS client/state/products-list/test/actions.js
PASS client/state/data-layer/wpcom/concierge/schedules/appointments/reschedule/test/index.js
PASS client/state/test/utils.js
PASS client/lib/postal-code/test/index.jsx
PASS client/state/wordads/approve/test/actions.js
PASS client/state/selectors/test/get-previous-query.js
PASS client/lib/analytics/test/google-analytics.js
PASS client/my-sites/checkout/checkout/test/wechat-payment-qrcode.js
PASS client/state/posts/counts/test/actions.js
PASS client/state/data-layer/wpcom/concierge/initial/test/index.js
PASS client/lib/cart/store/test/cart-synchronizer.js
PASS client/my-sites/domains/components/form/test/select.js
PASS client/state/invites/test/reducer.js
PASS client/state/reader/tags/images/test/actions.js
PASS client/extensions/woocommerce/state/sites/promotions/test/handlers.js
PASS client/state/data-layer/third-party/directly/test/index.js
PASS client/extensions/woocommerce/state/sites/products/test/actions.js
PASS client/state/data-layer/wpcom/sites/blog-stickers/remove/test/index.js
PASS client/state/selectors/test/get-menu-item-types.js
PASS client/lib/plans/test/plan-other.js
PASS client/extensions/woocommerce/state/data-layer/products/test/index.js
PASS client/auth/test/auth-code-button.jsx
PASS client/state/concierge/test/actions.js
PASS client/state/page-templates/test/actions.js
PASS client/extensions/woocommerce/state/selectors/test/plugins.js
PASS client/extensions/woocommerce/state/sites/status/wc-api/test/selectors.js
PASS client/state/happychat/selectors/test/get-skills.js
PASS client/state/data-layer/wpcom/activity-log/activate/test/index.js
PASS client/state/selectors/test/is-business-plan-user.js
PASS client/components/marketing-survey/cancel-purchase-form/test/steps-for-product-and-survey.js
PASS client/state/selectors/test/get-site-stats-view-summary.js
PASS client/state/users/suggestions/test/actions.js
PASS client/state/selectors/test/get-site-slugs-for-upcoming-transactions.js
PASS client/extensions/woocommerce/components/order-status/test/index.js
PASS client/state/help/test/selectors.js
PASS client/extensions/woocommerce/state/ui/products/test/edits-reducer.js
PASS client/state/selectors/test/has-jetpack-sites.js
PASS client/components/locale-suggestions/test/index.jsx
PASS client/state/sites/domains/test/actions.js
PASS client/state/data-layer/wpcom/concierge/schedules/appointments/detail/test/index.js
PASS client/state/selectors/test/are-site-permalinks-editable.js
PASS client/state/selectors/test/get-jetpack-sites.js
PASS client/state/activity-log/restore/test/reducer.js
PASS client/components/badge/test/index.js
PASS client/components/close-on-escape/test/index.jsx
PASS client/state/sites/domains/test/reducer.js
PASS client/state/selectors/test/is-eligible-for-upwork-support.js
PASS client/state/sharing/test/selectors.js
PASS client/extensions/woocommerce/state/ui/reviews/list/test/reducer.js
PASS client/state/selectors/test/get-selected-or-all-sites-with-plugins.js
PASS client/lib/products-values/test/index.js
PASS client/state/selectors/test/is-site-on-free-plan.js
PASS client/state/selectors/test/get-sites.js
PASS client/state/happiness-engineers/test/reducer.js
PASS client/state/atomic-transfer/test/actions.js
PASS client/state/billing-transactions/test/actions.js
PASS client/state/data-layer/wpcom/activity-log/rewind/to/test/index.js
PASS client/components/translator-invite/test/index.js
PASS client/lib/plans/test/choose-default-customer-type.js
PASS client/extensions/woocommerce/state/sites/settings/products/test/reducer.js
PASS client/state/reader/follows/test/actions.js
PASS client/state/selectors/test/are-all-sites-single-user.js
PASS client/state/data-layer/wpcom/activity-log/deactivate/test/index.js
PASS client/extensions/woocommerce/state/sites/review-replies/test/reducer.js
PASS client/state/selectors/test/get-current-plan-purchase-id.js
PASS client/state/selectors/test/get-newest-site.js
PASS client/state/billing-transactions/test/reducer.js
PASS client/state/themes/test/reducer.js
PASS client/components/bulk-select/test/index.js
PASS client/state/data-layer/wpcom/read/tags/mine/delete/test/index.js
PASS client/state/shortcodes/test/actions.js
PASS client/extensions/woocommerce/state/sites/shipping-classes/test/actions.js
PASS client/components/section-nav/test/index.jsx
  ● Console

    console.error node_modules/react-dom/cjs/react-dom.development.js:530
      Warning: React does not recognize the `hasSiblingControls` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `hassiblingcontrols` instead. If you accidentally passed it from a parent component, remove it from the DOM element.
          in p
          in div (created by SectionNav)
          in div (created by SectionNav)
          in SectionNav
    console.error node_modules/react-dom/cjs/react-dom.development.js:530
      Warning: React does not recognize the `closeSectionNavMobilePanel` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `closesectionnavmobilepanel` instead. If you accidentally passed it from a parent component, remove it from the DOM element.
          in p
          in div (created by SectionNav)
          in div (created by SectionNav)
          in SectionNav

PASS client/blocks/get-apps/test/apps-badge.js
PASS client/state/selectors/test/user-has-any-paid-plans.js
PASS client/state/selectors/test/get-new-site-public-setting.js
PASS client/state/data-layer/wpcom/read/site/post-email-subscriptions/delete/test/index.js
PASS client/state/selectors/test/get-network-sites.js
PASS client/components/localized-moment/test/index.js
  ● Console

    console.error node_modules/react-dom/cjs/react-dom.development.js:530
      Warning: An update to ConnectFunction inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://fb.me/react-wrap-tests-with-act
          in ConnectFunction (created by WrapperComponent)
          in WrapperComponent
    console.error node_modules/react-dom/cjs/react-dom.development.js:530
      Warning: An update to ConnectFunction inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://fb.me/react-wrap-tests-with-act
          in ConnectFunction (created by WrapperComponent)
          in WrapperComponent
    console.error node_modules/react-dom/cjs/react-dom.development.js:530
      Warning: An update to ConnectFunction inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://fb.me/react-wrap-tests-with-act
          in ConnectFunction (created by WrapperComponent)
          in WrapperComponent
    console.error node_modules/react-dom/cjs/react-dom.development.js:530
      Warning: An update to ConnectFunction inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://fb.me/react-wrap-tests-with-act
          in ConnectFunction (created by WrapperComponent)
          in WrapperComponent
    console.error node_modules/react-dom/cjs/react-dom.development.js:530
      Warning: An update to ConnectFunction inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://fb.me/react-wrap-tests-with-act
          in ConnectFunction (created by WrapperComponent)
          in WrapperComponent
    console.error node_modules/react-dom/cjs/react-dom.development.js:530
      Warning: An update to ConnectFunction inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://fb.me/react-wrap-tests-with-act
          in ConnectFunction (created by WrapperComponent)
          in WrapperComponent
    console.error node_modules/react-dom/cjs/react-dom.development.js:530
      Warning: An update to ConnectFunction inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://fb.me/react-wrap-tests-with-act
          in ConnectFunction (created by WrapperComponent)
          in WrapperComponent
    console.error node_modules/react-dom/cjs/react-dom.development.js:530
      Warning: An update to ConnectFunction inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://fb.me/react-wrap-tests-with-act
          in ConnectFunction (created by WrapperComponent)
          in WrapperComponent
    console.error node_modules/react-dom/cjs/react-dom.development.js:530
      Warning: An update to ConnectFunction inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://fb.me/react-wrap-tests-with-act
          in ConnectFunction (created by WrapperComponent)
          in WrapperComponent
    console.error node_modules/react-dom/cjs/react-dom.development.js:530
      Warning: An update to ConnectFunction inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://fb.me/react-wrap-tests-with-act
          in ConnectFunction (created by WrapperComponent)
          in WrapperComponent
    console.error node_modules/react-dom/cjs/react-dom.development.js:530
      Warning: An update to ConnectFunction inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://fb.me/react-wrap-tests-with-act
          in ConnectFunction (created by WrapperComponent)
          in WrapperComponent
    console.error node_modules/react-dom/cjs/react-dom.development.js:530
      Warning: An update to ConnectFunction inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://fb.me/react-wrap-tests-with-act
          in ConnectFunction (created by WrapperComponent)
          in WrapperComponent
    console.error node_modules/react-dom/cjs/react-dom.development.js:530
      Warning: An update to ConnectFunction inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://fb.me/react-wrap-tests-with-act
          in ConnectFunction (created by WrapperComponent)
          in WrapperComponent
    console.error node_modules/react-dom/cjs/react-dom.development.js:530
      Warning: An update to ConnectFunction inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://fb.me/react-wrap-tests-with-act
          in ConnectFunction (created by WrapperComponent)
          in WrapperComponent

PASS client/extensions/woocommerce/state/sites/settings/stripe-connect-account/test/actions.js
PASS client/devdocs/test/doc.jsx
PASS client/lib/plans/test/get-popular-plan-spec.js
PASS client/state/jetpack-sync/test/actions.js
PASS client/components/sub-masterbar-nav/test/item.jsx
PASS client/state/data-layer/wpcom/email-forwarding/add/test/index.js
PASS client/extensions/woocommerce/state/sites/setup-choices/test/selectors.js
PASS client/state/data-layer/wpcom/concierge/schedules/appointments/cancel/test/index.js
PASS client/state/plans/test/selectors.js
PASS client/components/data/query-verticals/test/index.js
PASS client/state/ui/test/reducer.js
PASS client/extensions/woocommerce/state/sites/settings/products/test/actions.js
PASS client/components/d3-base/test/index.js
PASS client/extensions/woocommerce/components/d3/base/test/index.js
PASS client/state/push-notifications/test/actions.js
PASS client/state/selectors/test/is-gutenberg-opt-in-dialog-showing.js
PASS client/components/forms/form-toggle/test/index.jsx
PASS client/state/data-layer/wpcom/read/site/comment-email-subscriptions/new/test/index.js
PASS client/state/purchases/test/actions.js
PASS client/state/selectors/test/get-active-discount.js
PASS client/state/selectors/test/is-site-google-my-business-eligible.js

  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Failed to fetch the user from /me endpoint: NetConnectNotAllowedError {
      name: 'NetConnectNotAllowedError',
      code: 'ENETUNREACH',
      message:
       'Nock: Disallowed net connect for "public-api.wordpress.com:443/rest/v1.1/me?meta=flags&abtests=cartNudgeUpdateToPremium_20180917%2CspringSale30PercentOff_20180413%2CATPromptOnCancel_20170515%2CskipThemesSelectionModal_20170904%2CbuilderReferralStatsNudge_20181218%2CbuilderReferralThemesBanner_20181218%2CpageBuilderMVP_20190419%2CconciergeUpsellDial_20190429%2CskippableDomainStep_20290717%2CpasswordlessSignup_20291029%2CdomainStepCopyUpdates_20191121%2CdomainStepMoveParagraph_20191216%2CnonEnglishDomainStepCopyUpdates_20191219%2CshowBusinessPlanPopular_20200109%2CreaderFreeToPaidPlanNudge_20200102%2CshowPlanBumpVsGsuite_20200107"',
      response: undefined }".

      198 | 	return getLanguage( this.data.localeSlug );
      199 | };
    > 200 | 
          | ^
      201 | /**
      202 |  * Get the URL for a user's avatar (from Gravatar). Uses
      203 |  * the short-form query string parameters as options,

      at BufferedConsole.error (node_modules/@jest/console/build/BufferedConsole.js:163:10)
      at User.Object.<anonymous>.User.handleFetchFailure (client/lib/user/user.js:200:13)
      at client/lib/user/user.js:179:11

PASS client/state/data-layer/wpcom/me/settings/test/index.js
PASS client/state/ui/preview/test/selectors.js
PASS client/state/selectors/test/get-account-closure-sites.js
PASS client/lib/automated-transfer/test/index.js
PASS client/my-sites/plugins/plugin-action/test/index.jsx
PASS client/state/selectors/test/get-menus-url.js
PASS client/state/domains/suggestions/test/actions.js
PASS client/jetpack-connect/test/jetpack-connect-notices.js
PASS client/state/pages/test/selectors.js
PASS client/state/selectors/test/get-upgrade-plan-slug-from-path.js
PASS client/state/data-layer/wpcom/sites/stats/google-my-business/test/index.js
PASS client/extensions/woocommerce/components/d3/sparkline/test/index.jsx
PASS client/state/selectors/test/should-new-site-be-private-by-default.js
PASS client/me/billing-history/test/tax.js
PASS client/extensions/woocommerce/state/sites/reviews/test/handlers.js
PASS client/state/signup/steps/site-type/test/actions.js
PASS client/state/selectors/test/get-public-sites.js
PASS client/state/sites/plans/test/actions.js
PASS client/components/head/test/index.jsx
PASS client/state/selectors/test/is-publicize-enabled.js
PASS client/lib/plans/test/plan-levels-match.js
PASS client/state/ui/editor/sidebar/test/actions.js
PASS client/state/data-layer/wpcom/read/following/mine/new/test/index.js
PASS client/extensions/woocommerce/state/sites/data/counts/test/reducer.js
PASS client/components/gsuite/gsuite-price/test/index.js
PASS client/state/jetpack/modules/test/actions.js
PASS client/state/jetpack/settings/test/actions.js
PASS client/components/jetpack-header/test/index.js
PASS client/components/sub-masterbar-nav/test/navbar.jsx
PASS client/state/sites/guided-transfer/test/actions.js
PASS client/state/ui/editor/test/reducer.js
PASS client/state/selectors/test/is-site-supporting-image-editor.js
PASS client/components/sub-masterbar-nav/test/dropdown.jsx
  ● Console

    console.error node_modules/prop-types/checkPropTypes.js:20
      Warning: Failed prop type: The prop `selected.uri` is marked as required in `Dropdown`, but its value is `undefined`.
          in Dropdown

PASS client/components/sorted-grid/test/index.jsx
PASS client/state/sites/vouchers/test/actions.js
PASS client/extensions/woocommerce/state/sites/payment-methods/test/selectors.js
PASS client/state/sites/monitor/test/actions.js
PASS client/extensions/woocommerce/state/sites/reviews/test/reducer.js
PASS client/extensions/woocommerce/state/data-layer/orders/test/index.js
PASS client/state/login/test/reducer.js
PASS client/state/reader/lists/test/actions.js
PASS client/components/forms/form-text-input/test/index.jsx
PASS client/state/stored-cards/test/reducer.js
PASS client/extensions/woocommerce/state/sites/settings/mailchimp/test/actions.js
PASS client/state/sharing/keyring/test/actions.js
PASS client/lib/query-manager/post/test/index.js
PASS client/blocks/follow-button/test/button.js
PASS client/components/count/test/index.jsx
PASS client/state/post-types/taxonomies/test/reducer.js
PASS client/state/data-layer/wpcom/sites/posts/likes/mine/delete/test/index.js
PASS client/state/data-layer/wpcom/read/site/post-email-subscriptions/new/test/index.js
PASS client/state/selectors/test/get-filtered-billing-transactions.js
PASS client/blocks/subscription-length-picker/test/option.js
  ● Console

    console.error node_modules/prop-types/checkPropTypes.js:20
      Warning: Failed prop type: The prop `term` is marked as required in `SubscriptionLengthOption`, but its value is `undefined`.
          in SubscriptionLengthOption
    console.error node_modules/prop-types/checkPropTypes.js:20
      Warning: Failed prop type: Invalid prop `price` of type `number` supplied to `SubscriptionLengthOption`, expected `string`.
          in SubscriptionLengthOption
    console.error node_modules/prop-types/checkPropTypes.js:20
      Warning: Failed prop type: Invalid prop `pricePerMonth` of type `number` supplied to `SubscriptionLengthOption`, expected `string`.
          in SubscriptionLengthOption
    console.error node_modules/prop-types/checkPropTypes.js:20
      Warning: Failed prop type: The prop `value` is marked as required in `SubscriptionLengthOption`, but its value is `undefined`.
          in SubscriptionLengthOption

PASS client/state/data-layer/wpcom/read/sites/posts/mute/test/index.js
PASS client/state/products-list/test/selectors.js
PASS client/components/logged-out-form/test/link-item.js
PASS client/state/plugins/wporg/test/reducer.js
PASS client/extensions/woocommerce/state/sites/payment-methods/test/actions.js
PASS client/extensions/woocommerce/state/ui/reviews/test/selectors.js
PASS client/state/media/test/reducer.js
PASS client/extensions/woocommerce/state/sites/orders/test/selectors.js
PASS client/components/rating/test/index.js
PASS client/extensions/woocommerce/state/sites/settings/general/test/handlers.js
PASS client/state/jetpack/connection/test/actions.js
PASS client/extensions/woocommerce/state/sites/data/locations/test/reducer.js
PASS client/state/analytics/test/actions.js
PASS client/components/emojify/test/emojify.jsx
PASS client/state/selectors/test/get-request.js
PASS client/lib/analytics/test/index.js
PASS client/lib/formatting/decode-entities/test/browser.js
PASS client/components/data/query-segments/test/index.js
PASS client/state/data-layer/wpcom/me/notification/settings/test/index.js
PASS client/lib/oauth-store/test/index.js
PASS client/state/sharing/keyring/test/reducer.js
PASS client/extensions/woocommerce/state/data-layer/request/test/index.js
PASS client/components/auto-direction/test/auto-direction.jsx
PASS client/state/reader/tags/items/test/reducer.js
PASS client/state/sites/connection/test/actions.js
PASS client/state/data-layer/wpcom/gravatar-upload/test/index.js
PASS client/extensions/woocommerce/state/sites/data/currencies/test/reducer.js
PASS client/state/sharing/services/test/actions.js
PASS client/extensions/woocommerce/state/data-layer/shipping-classes/test/index.js
PASS client/state/selectors/test/get-visible-sites.js
PASS client/state/notification-settings/test/actions.js
PASS client/state/stats/posts/test/actions.js
PASS client/state/plugins/wporg/test/actions.js
PASS client/extensions/woocommerce/state/ui/product-categories/test/selectors.js
PASS client/state/reader/teams/test/reducer.js
PASS client/state/selectors/test/is-jetpack-settings-save-failure.js
PASS client/signup/wpcom-login-form/test/index.jsx
PASS client/state/data-layer/wpcom/read/following/mine/delete/test/index.js
PASS client/components/feature-example/test/index.js
PASS client/state/plugins/premium/test/selectors.js
PASS client/components/async-loader/test/index.js
PASS client/extensions/woocommerce/state/sites/payment-methods/test/reducer.js
PASS client/state/posts/likes/test/reducer.js
PASS client/state/domains/test/reducer.js
PASS client/lib/followers/test/store.js
PASS client/state/jetpack/modules/test/reducer.js
PASS client/extensions/woocommerce/state/sites/data/locations/test/selectors.js
PASS client/extensions/woocommerce/lib/analytics/test/tracks-utils.js
PASS client/state/sites/media-storage/test/reducer.js
PASS client/state/data-layer/wpcom/me/devices/test/index.js
PASS client/components/forms/form-country-select/test/index.jsx
PASS client/state/data-layer/wpcom-http/test/index.js
PASS client/state/sharing/publicize/test/reducer.js
PASS client/state/reader/thumbnails/test/actions.js
PASS client/state/selectors/test/is-requesting-jetpack-settings.js
PASS client/extensions/woocommerce/state/action-list/test/reducer.js
PASS client/components/data/media-list-data/test/index.jsx
PASS client/state/stored-cards/test/actions.js
PASS client/state/selectors/test/is-site-using-full-site-editing.js
PASS client/state/data-layer/wpcom/concierge/schedules/appointments/detail/test/from-api.js
PASS client/state/sites/media-storage/test/actions.js
PASS client/state/data-layer/wpcom/me/two-step/application-passwords/delete/test/index.js
PASS client/extensions/woocommerce/state/sites/shipping-zones/test/reducer.js
PASS client/state/country-states/test/actions.js
PASS client/state/data-layer/wpcom/email-forwarding/remove/test/index.js
PASS client/lib/shortcode/test/index.js
PASS client/signup/validation-fieldset/test/index.jsx
PASS client/components/product-expiration/test/index.js
PASS client/my-sites/media-library/test/list-item-video.jsx
PASS client/state/data-layer/wpcom/jetpack/settings/test/index.js
PASS client/state/site-roles/test/reducer.js
PASS client/state/posts/counts/test/selectors.js
PASS client/lib/network-connection/test/index.js
PASS client/state/preferences/test/actions.js
PASS client/lib/user-settings/test/index.js
  ● Console

    console.error client/lib/user/user.js:161
      Failed to fetch the user from /me endpoint: Error: the /me response misses a required field 'ID'
          at filterUserObject (/benchmarks/nacd/Automattic_wp-calypso/client/lib/user/shared-utils.js:47:10)
          at /benchmarks/nacd/Automattic_wp-calypso/client/lib/user/user.js:134:21
    console.error client/lib/user/user.js:161
      Failed to fetch the user from /me endpoint: Error: the /me response misses a required field 'ID'
          at filterUserObject (/benchmarks/nacd/Automattic_wp-calypso/client/lib/user/shared-utils.js:47:10)
          at /benchmarks/nacd/Automattic_wp-calypso/client/lib/user/user.js:134:21

PASS client/lib/paths/login/test/index.js
PASS client/state/nps-survey/test/selectors.js
PASS client/components/global-notices/test/index.js
PASS client/state/data-layer/wpcom/me/block/sites/new/test/index.js
PASS client/state/selectors/test/is-site-on-paid-plan.js
PASS client/lib/query-manager/test/index.js
PASS client/state/sites/sharing-buttons/test/reducer.js
PASS client/state/sites/blog-stickers/test/actions.js
PASS client/extensions/woocommerce/state/sites/settings/products/test/selectors.js
PASS client/extensions/woocommerce/state/data-layer/data/counts/test/index.js
PASS client/extensions/woocommerce/state/sites/shipping-classes/test/reducers.js
PASS client/state/notification-settings/test/toggle-state.js
PASS client/state/reader/tags/items/test/actions.js
PASS client/lib/format-number-compact/test/index.js
PASS client/lib/plugins/wporg-data/test/list-store.js
PASS client/state/themes/upload-theme/test/reducer.js
PASS client/components/forms/counted-textarea/test/index.jsx
PASS client/state/reader/site-blocks/test/actions.js
PASS client/components/sub-masterbar-nav/test/index.jsx
PASS client/extensions/woocommerce/state/sites/setup-choices/test/reducer.js
PASS client/state/ui/comments/test/reducer.js
PASS client/state/jetpack-connect/reducer/test/jetpack-connect-site.js
PASS client/lib/url/test/format.js
PASS client/state/current-user/email-verification/test/reducer.js
PASS client/state/sites/sharing-buttons/test/actions.js
PASS client/state/billing-transactions/individual-transactions/test/actions.js
PASS client/jetpack-connect/test/utils.js
PASS client/extensions/woocommerce/state/sites/review-replies/test/handlers.js
PASS client/state/data-layer/wpcom/me/dismiss/sites/new/test/index.js
PASS client/lib/query-manager/paginated/test/index.js
PASS client/state/signup/steps/site-vertical/test/actions.js
PASS client/lib/make-json-schema-parser/test/index.js
PASS client/state/happychat/selectors/test/get-happychat-timeline.js
PASS client/lib/after-layout-flush/test/index.js
PASS client/lib/i18n-utils/test/utils.js
PASS client/state/data-layer/wpcom/read/sites/notification-subscriptions/delete/test/index.js
PASS client/state/current-user/gravatar-status/test/actions.js
PASS client/state/selectors/test/get-reader-stream-offset-item.js
PASS client/state/sites/test/actions.js
PASS client/state/data-layer/wpcom/sites/jitm/test/index.js
PASS client/state/country-states/test/reducer.js
PASS client/extensions/woocommerce/state/sites/test/reducer.js
PASS client/state/reader/sites/test/reducer.js
PASS client/extensions/woocommerce/state/sites/settings/general/test/actions.js
PASS client/state/sites/monitor/test/reducer.js
PASS client/state/post-types/test/reducer.js
PASS client/state/concierge/next-appointment/test/reducer.js
PASS client/state/reader/watermarks/test/reducer.js
PASS client/reader/discover/test/helper.js
PASS client/extensions/wp-super-cache/state/stats/test/reducer.js
PASS client/state/signup/dependency-store/test/reducer.js
PASS client/state/data-layer/wpcom/read/sites/notification-subscriptions/new/test/index.js
PASS client/state/account-recovery/settings/test/reducer.js
PASS client/extensions/woocommerce/state/sites/test/request.js
PASS client/components/phone-input/test/test-phone-number.js
PASS client/state/data-layer/test/utils.js
PASS client/lib/domains/registration/test/availability-messages.js
PASS client/lib/viewport/test/index.js
PASS client/extensions/woocommerce/state/sites/shipping-zone-locations/test/selectors.js
PASS client/state/current-user/email-verification/test/actions.js
PASS client/state/terms/test/reducer.js
PASS client/state/data-layer/wpcom/sites/comments/likes/mine/delete/test/index.js
PASS client/state/reader/related-posts/test/reducer.js
PASS client/extensions/woocommerce/state/ui/review-replies/test/selectors.js
PASS client/lib/phone-validation/test/index.jsx
PASS client/extensions/woocommerce/state/ui/orders/test/selectors.js
PASS client/extensions/woocommerce/state/sites/product-variations/test/selectors.js
PASS client/state/reader/related-posts/test/actions.js
PASS client/state/sites/plans/test/reducer.js
PASS client/extensions/woocommerce/state/data-layer/data/currencies/test/index.js
PASS client/state/selectors/test/get-image-editor-is-greater-than-minimum-dimensions.js
PASS client/lib/formatting/test/index.js
PASS client/state/current-user/gravatar-status/test/reducer.js
PASS client/state/reader/feed-searches/test/reducer.js
PASS client/lib/domains/email-forwarding/test/index.js
PASS client/state/nps-survey/test/reducer.js
PASS client/state/selectors/test/get-jetpack-settings-save-request-status.js
PASS client/state/site-roles/test/actions.js
PASS client/state/selectors/test/is-updating-jetpack-settings.js
PASS client/extensions/woocommerce/app/store-stats/test/utils.js
PASS client/state/data-layer/wpcom/read/tags/test/index.js
PASS client/extensions/woocommerce/state/data-layer/data/locations/test/index.js
PASS client/extensions/woocommerce/state/sites/product-categories/test/selectors.js
PASS client/state/data-layer/wpcom/read/feed/test/index.js
PASS client/state/products-list/test/reducer.js
PASS client/state/jetpack-remote-install/test/reducer.js
PASS client/lib/plugins/wporg-data/test/actions.js
PASS client/state/data-layer/wpcom/meta/sms-country-codes/test/index.js
PASS client/lib/site/test/utils.js
PASS client/lib/plugins/test/sanitize-section-content.js
PASS client/state/data-layer/wpcom/me/settings/profile-links/test/index.js
PASS client/state/post-formats/test/actions.js
PASS client/state/account/test/actions.js
PASS client/state/data-layer/wpcom/read/site/comment-email-subscriptions/delete/test/index.js
PASS client/extensions/woocommerce/state/sites/orders/test/reducer.js
PASS client/lib/local-storage-bypass/test/index.js
PASS client/state/email-forwarding/test/reducer.js
PASS client/state/data-layer/wpcom-http/test/utils.js
PASS client/state/selected-editor/test/reducer.js
PASS client/state/data-layer/wpcom/sites/posts/likes/test/index.js
PASS client/extensions/woocommerce/state/sites/settings/email/test/reducer.js
PASS client/lib/viewport/test/react.js
PASS client/state/current-user/test/reducer.js
PASS client/state/signup/steps/site-vertical/test/selectors.js
PASS client/state/login/test/selectors.js
PASS client/lib/interval/test/interval.tsx
PASS client/lib/domains/test/index.js
PASS client/extensions/woocommerce/state/sites/orders/test/actions.js
PASS client/state/data-layer/wpcom/me/block/sites/delete/test/index.js
PASS client/lib/query-manager/media/test/index.js
PASS client/state/help/ticket/test/actions.js
PASS client/state/data-layer/wpcom/sites/blog-stickers/add/test/index.js
PASS client/state/selectors/test/is-user-registration-days-within-range.js
PASS client/state/hosting/test/reducer.js
PASS client/state/data-layer/wpcom/me/settings/profile-links/new/test/index.js
PASS client/lib/url/test/url-type-native.js
PASS client/extensions/woocommerce/state/data-layer/product-categories/test/index.js
PASS client/state/signup/progress/test/reducer.js
PASS client/blocks/reader-full-post/test/featured-image.jsx
PASS client/state/preferences/test/reducer.js
PASS client/state/signup/steps/site-type/test/reducer.js
PASS client/state/data-layer/wpcom/read/sites/posts/follow/test/index.js
PASS client/lib/plugins/test/log-store.js
PASS client/state/selectors/test/has-broken-site-user-connection.js
PASS client/lib/importer/test/api-interaction.js
PASS client/state/domains/management/validation-schemas/test/actions.js
PASS client/state/posts/likes/test/actions.js
PASS client/state/signup/steps/site-goals/test/reducer.js
PASS client/state/data-layer/wpcom/me/transactions/supported-countries/test/index.js
PASS client/blocks/reader-author-link/test/index.js
PASS client/extensions/woocommerce/state/data-layer/orders/send-invoice/test/index.js
PASS client/extensions/woocommerce/state/ui/review-replies/edits/test/reducer.js
PASS client/extensions/woocommerce/state/data-layer/orders/refunds/test/index.js
PASS client/state/inline-help/test/reducer.js
PASS client/extensions/woocommerce/state/ui/orders/test/actions.js
PASS client/state/data-layer/wpcom/sites/blog-stickers/test/index.js
PASS client/extensions/woocommerce/state/ui/products/variations/test/selectors.js
PASS client/state/i18n/language-names/test/actions.js
PASS client/state/posts/counts/test/reducer.js
PASS client/state/invites/test/selectors.js
PASS client/components/translatable/test/proptype.js
PASS client/state/reader/site-dismissals/test/actions.js
PASS client/extensions/woocommerce/state/ui/promotions/test/edits-reducer.js
PASS client/state/data-layer/wpcom/jetpack-install/test/index.js
PASS client/state/ui/editor/image-editor/test/reducer.js
PASS client/state/active-promotions/test/reducer.js
PASS client/state/data-layer/wpcom/me/two-step/application-passwords/test/index.js
PASS client/state/jetpack-product-install/test/reducer.js
PASS client/lib/plugins/test/utils.js
PASS client/extensions/wp-super-cache/state/settings/test/reducer.js
PASS client/state/purchases/test/reducer.js
PASS client/state/data-layer/wpcom/sites/comments-tree/test/index.js
PASS client/state/media/test/actions.js
PASS client/lib/signup/test/site-type.js
PASS client/state/data-layer/wpcom/domains/transfer/test/index.js
PASS client/state/application-passwords/test/actions.js
PASS client/state/login/magic-login/test/reducer.js
PASS client/state/sites/connection/test/reducer.js
PASS client/extensions/woocommerce/state/ui/products/test/selectors.js
PASS client/state/selectors/test/is-site-checklist-loading.js
PASS client/lib/url/test/url-parts.js
PASS client/extensions/woocommerce/state/sites/orders/refunds/test/actions.js
PASS client/state/stats/lists/test/reducer.js
PASS client/extensions/woocommerce/state/sites/promotions/test/reducer.js
PASS client/lib/search-url/test/index.js
PASS client/state/themes/themes-ui/test/selectors.js
PASS client/state/order-transactions/test/actions.js
PASS client/extensions/woocommerce/state/sites/settings/general/test/selectors.js
PASS client/state/data-layer/wpcom/sites/posts/likes/new/test/index.js
PASS client/state/data-layer/wpcom/me/connected-applications/delete/test/index.js
PASS client/state/data-layer/wpcom/email-forwarding/resend-email-verification/test/index.js
PASS client/components/seo/meta-title-editor/test/index.js
PASS client/state/inline-help/test/selectors.js
PASS client/state/happychat/test/middleware.js
PASS client/lib/local-list/test/index.js
PASS client/components/community-translator/test/utils.js
PASS client/state/post-formats/test/reducer.js
PASS client/state/data-layer/wpcom/gsuite-users/test/index.js
PASS client/components/domains/registrant-extra-info/test/fr-validate-contact-details.js
PASS client/state/data-layer/wpcom/signup/verticals/test/index.js
PASS client/components/infinite-list/test/scroll-helper.js
PASS client/lib/redux-bridge/test/index.js
PASS client/state/rewind/backups/test/reducer.js
PASS client/state/data-layer/wpcom/domains/countries-list/test/index.js
PASS client/extensions/woocommerce/state/ui/shipping/zones/locations/test/reducer.js
PASS client/lib/create-config/test/index.js
PASS client/extensions/woocommerce/state/data-layer/customers/test/index.js
PASS client/components/forms/range/test/index.jsx
PASS client/extensions/woocommerce/state/sites/shipping-classes/test/selectors.js
PASS client/extensions/zoninator/state/data-layer/locks/test/index.js
PASS client/lib/users/test/store.js
PASS client/state/data-layer/wpcom/sites/comments/likes/new/test/index.js
PASS client/state/plugins/premium/test/reducer.js
PASS client/lib/inflight/test/index.js
PASS client/state/stats/posts/test/reducer.js
PASS client/extensions/woocommerce/state/sites/customers/test/reducer.js
PASS client/components/forms/multi-checkbox/test/index.jsx
PASS client/state/help/test/reducer.js
PASS client/extensions/woocommerce/state/sites/settings/email/test/selectors.js
PASS client/state/reader/site-blocks/test/reducer.js
PASS client/lib/store/test/index.js
PASS client/state/happychat/user/test/reducer.js
PASS client/state/document-head/test/selectors.js
PASS client/state/help/ticket/test/reducer.js
PASS client/state/signup/verticals/test/reducer.js
PASS client/state/atomic-transfer/test/reducer.js
PASS client/extensions/woocommerce/state/sites/settings/mailchimp/test/selectors.js
PASS client/extensions/wp-super-cache/state/status/test/reducer.js
PASS client/state/reader/posts/test/reducer.js
PASS client/extensions/woocommerce/state/sites/shipping-zone-locations/test/reducer.js
PASS client/components/track-input-changes/test/index.jsx
PASS client/extensions/woocommerce/state/data-layer/action-list/test/index.js
PASS client/extensions/woocommerce/state/sites/review-replies/test/selectors.js
PASS client/lib/plugins/test/actions.js
PASS client/state/signup/verticals/test/actions.js
PASS client/state/i18n/locale-suggestions/test/actions.js
PASS client/state/signup/steps/site-vertical/test/reducer.js
PASS client/state/jetpack/settings/test/reducer.js
PASS client/lib/query-manager/test/key.js
PASS client/state/reader/recommended-sites/test/reducer.js
PASS client/components/gsuite/gsuite-learn-more/test/index.js
PASS client/state/immediate-login/test/utils.js
PASS client/state/concierge/available-times/test/reducer.js
PASS client/state/sharing/services/test/reducer.js
PASS client/state/data-layer/wpcom/me/settings/profile-links/delete/test/index.js
PASS client/state/ui/billing-transactions/test/reducer.js
PASS client/extensions/woocommerce/state/sites/status/wc-api/test/error-reducer.js
PASS client/state/application/test/actions.js
PASS client/extensions/wp-super-cache/state/cache/test/reducer.js
PASS client/extensions/woocommerce/state/ui/payments/currency/test/reducer.js
PASS client/extensions/woocommerce/state/ui/shipping/zones/test/reducer.js
PASS client/lib/url/test/omit-url-params.js
PASS client/state/page-templates/test/reducer.js
PASS client/state/shortcodes/test/reducer.js
PASS client/state/application/test/reducer.js
PASS client/state/users/suggestions/test/reducer.js
PASS client/state/domains/suggestions/test/reducer.js
PASS client/state/terms/test/selectors.js
PASS client/blocks/daily-post-button/test/helper.js
PASS client/lib/scroll-to/test/index.js
PASS client/state/domains/transfer/test/reducer.js
PASS client/components/sticky-panel/test/index.js
PASS client/extensions/woocommerce/state/sites/settings/stripe-connect-account/test/selectors.js
PASS client/state/selectors/test/is-regenerating-jetpack-post-by-email.js
PASS client/extensions/woocommerce/state/sites/orders/send-invoice/test/reducer.js
PASS client/post-editor/media-modal/test/preload-image.js
PASS client/extensions/woocommerce/state/sites/orders/test/utils.js
PASS client/state/data-layer/wpcom/me/blocks/sites/test/index.js
PASS client/extensions/woocommerce/state/sites/products/test/selectors.js
PASS client/state/happychat/chat/test/reducer.js
PASS client/state/receipts/test/reducer.js
PASS client/components/gsuite/gsuite-features/test/index.js
PASS client/state/concierge/appointment-details/test/reducer.js
PASS client/state/ui/test/selectors.js
PASS client/state/reader/tags/images/test/reducer.js
PASS client/reader/test/get-helpers.js
PASS client/state/ui/checkout/test/reducer.js
PASS client/state/reader/conversations/test/actions.js
PASS client/state/themes/themes-ui/test/reducer.js
PASS client/state/data-layer/wpcom/read/recommendations/sites/test/index.js
PASS client/components/search/test/index.jsx
PASS client/extensions/woocommerce/lib/generate-variations/test/index.js
PASS client/extensions/zoninator/state/data-layer/locks/test/utils.js
PASS client/lib/url/test/is-external.js
PASS client/lib/track-element-size/test/index.js
PASS client/extensions/woocommerce/lib/order-values/test/index.js
PASS client/extensions/woocommerce/state/sites/settings/email/test/helpers.js
PASS client/state/support/test/reducer.js
PASS client/state/sites/vouchers/test/reducer.js
PASS client/lib/text-utils/test/index.js
PASS client/state/wordads/status/test/reducer.js
PASS client/extensions/woocommerce/state/action-list/test/selectors.js
PASS client/state/reader/conversations/test/reducer.js
  ● Console

    console.warn client/lib/warn/index.js:14
      State validation failed.
      State: { '123-456': 'X' }
      
      data[keys2.0] must be an enum value
      Found: 'X'
      Violates rule: { enum: [ 'F', null, 'M', [length]: 3 ] }
      

PASS client/state/site-settings/test/reducer.js
PASS client/lib/route/test/legacy-routes.js
PASS client/state/selectors/test/has-pending-comment-requests.js
PASS client/state/data-layer/wpcom/concierge/initial/test/from-api.js
PASS client/state/posts/revisions/authors/test/reducer.js
PASS client/state/data-layer/wpcom/me/transactions/order/test/index.js
PASS client/state/push-notifications/test/reducer.js
PASS client/state/site-settings/test/selectors.js
PASS client/state/themes/test/utils.js
PASS client/state/selectors/test/is-comments-tree-initialized.js
PASS client/state/concierge/appointment-timespan/test/reducer.js
PASS client/state/data-layer/wpcom/me/send-verification-email/test/index.js
PASS client/my-sites/email/gsuite-purchase-cta/test/sku-info.js
PASS client/state/data-layer/wpcom/posts/revisions/test/index.js
PASS client/state/followers/test/reducer.js
PASS client/lib/people/test/log-store.js
PASS client/extensions/woocommerce/lib/order-status/test/index.js
PASS client/state/immediate-login/test/reducer.js
PASS client/state/selectors/test/is-directly-ready.js
PASS client/state/signup/steps/survey/test/reducer.js
PASS client/state/data-layer/wpcom/sites/users/test/index.js
PASS client/state/selectors/test/is-transient-media.js
PASS client/extensions/wp-super-cache/state/status/test/selectors.js
PASS client/state/ui/editor/contact-form/test/reducer.js
PASS client/state/ui/editor/video-editor/test/reducer.js
PASS client/state/happychat/connection/test/reducer.js
PASS client/state/concierge/has-available-concierge-sessions/test/reducer.js
PASS client/state/user-devices/test/actions.js
PASS client/state/data-layer/wpcom/concierge/schedules/appointments/book/test/from-api.js
PASS client/lib/plans/test/get-interval-type-for-term.js
PASS client/state/selectors/test/get-media-export-url.js
PASS client/state/selectors/test/get-past-billing-transactions.js
PASS client/state/selectors/test/get-google-my-business-stats.js
PASS client/state/automated-transfer/test/reducer.js
PASS client/state/selectors/test/get-theme-showcase-title.js
PASS client/state/wordads/approve/test/reducer.js
PASS client/extensions/woocommerce/state/sites/promotions/test/helpers.js
PASS client/state/selectors/test/is-mapped-domain-site.js
PASS client/state/google-my-business/test/index.js
PASS client/state/sites/blog-stickers/test/reducer.js
PASS client/lib/query-manager/activity/test/index.js
PASS client/extensions/woocommerce/state/ui/orders/test/reducer.js
PASS client/state/data-layer/wpcom/sites/media/test/index.js
PASS client/extensions/zoninator/state/locks/test/reducer.js
PASS client/state/reader/feeds/test/actions.js
PASS client/state/signup/steps/site-title/test/reducer.js
PASS client/state/ui/media-modal/test/reducer.js
PASS client/state/selectors/test/get-last-good-rewind-backup.js
PASS client/state/selectors/test/is-eligible-for-free-to-paid-upsell.js
PASS client/state/jetpack-connect/reducer/test/jetpack-connect-authorize.js
PASS client/state/ui/editor/video-editor/test/actions.js
PASS client/state/data-layer/wpcom/read/teams/test/index.js
PASS client/state/ui/post-type-list/test/selectors.js
PASS client/reader/test/utils.js
PASS client/state/data-layer/wpcom-http/pipeline/retry-on-failure/test/index.js
PASS client/state/signup/flow/test/reducer.js
PASS client/state/jetpack-sync/test/selectors.js
PASS client/state/order-transactions/test/reducer.js
PASS client/lib/query-manager/term/test/key.js
PASS client/extensions/woocommerce/state/ui/product-categories/test/edits-reducer.js
PASS client/lib/highlight/test/index.js
PASS client/extensions/woocommerce/state/ui/review-replies/test/reducer.js
PASS client/extensions/woocommerce/state/ui/payments/methods/test/reducer.js
PASS client/extensions/woocommerce/state/sites/product-variations/test/reducer.js
PASS client/lib/post-metadata/test/index.js
PASS client/state/active-promotions/test/actions.js
PASS client/state/ui/editor/contact-form/test/actions.js
PASS client/state/reader/thumbnails/test/reducer.js
PASS client/state/signup/steps/user-experience/test/reducer.js
PASS client/extensions/woocommerce/state/sites/orders/notes/test/reducer.js
PASS client/extensions/woocommerce/lib/currency/test/index.js
PASS client/state/stats/chart-tabs/test/selectors.js
PASS client/reader/stream/test/utils.js
PASS client/state/stats/recent-post-views/test/reducer.js
PASS client/state/ui/reader/card-expansions/test/reducer.js
PASS client/extensions/woocommerce/state/sites/orders/notes/test/selectors.js
PASS client/state/help/test/actions.js
PASS client/components/marketing-survey/cancel-purchase-form/test/enriched-survey-data.js
PASS client/state/audio/test/middleware.js
PASS client/state/plans/test/reducer.js
PASS client/state/ui/editor/image-editor/test/actions.js
PASS client/extensions/woocommerce/state/ui/payments/currency/test/selectors.js
PASS client/extensions/woocommerce/state/sites/data/currencies/test/selectors.js
PASS client/state/selectors/test/get-concierge-available-times.js
PASS client/lib/query-manager/test/schema.js
PASS client/state/selectors/test/get-new-application-password.js
PASS client/extensions/woocommerce/state/ui/promotions/test/list-reducer.js
PASS client/state/data-layer/wpcom/plans/test/index.js
PASS client/state/users/test/reducer.js
PASS client/state/selected-editor/test/actions.js
PASS client/state/jetpack-connect/reducer/test/index.js
PASS client/lib/analytics/test/utils.js
PASS client/extensions/woocommerce/state/sites/orders/send-invoice/test/actions.js
PASS client/state/selectors/test/get-billing-transaction-app-filter-values.js
PASS client/state/data-layer/wpcom/me/connected-applications/test/index.js
PASS client/lib/query-manager/term/test/index.js
PASS client/state/jetpack-connect/reducer/test/jetpack-auth-attempts.js
PASS client/state/selectors/test/has-user-asked-a-directly-question.js
PASS client/signup/config/test/index.js
PASS client/state/selectors/test/is-directly-uninitialized.js
PASS client/state/jetpack-sync/test/reducer.js
PASS client/state/concierge/signup-form/test/reducer.js
PASS client/state/selectors/test/is-directly-failed.js
PASS client/me/billing-history/test/utils.js
PASS client/extensions/woocommerce/state/sites/coupons/test/handlers.js
PASS client/state/signup/segments/test/actions.js
PASS client/state/happiness-engineers/test/selectors.js
PASS client/state/connected-applications/test/reducer.js
PASS client/state/reader/sites/test/actions.js
PASS client/state/post-formats/test/selectors.js
PASS client/extensions/woocommerce/state/ui/orders/list/test/reducer.js
PASS client/state/user-settings/test/actions.js
PASS client/state/shortcodes/test/selectors.js
PASS client/state/stats/chart-tabs/test/reducer.js
PASS client/state/selectors/test/is-account-closed.js
PASS client/state/selectors/test/get-reader-stream-should-request-recommendations.js
PASS client/extensions/woocommerce/state/sites/products/test/reducer.js
PASS client/components/translator-invite/test/utils.js
PASS client/components/multiple-choice-question/test/index.js
PASS client/state/selectors/test/is-fetching-magic-login-auth.js
PASS client/state/billing-transactions/individual-transactions/test/reducer.js
PASS client/lib/url/test/decode-utils.js
PASS client/state/data-layer/wpcom/sites/stats/visits/test/index.js
PASS client/lib/follow-list/test/index.js
PASS client/state/data-layer/wpcom-http/test/actions.js
PASS client/state/http/test/actions.js
PASS client/state/marketing/test/actions.js
PASS client/state/selectors/test/is-requesting-site-connection-status.js
PASS client/extensions/woocommerce/state/wc-api/test/utils.js
PASS client/lib/memoize-last/test/index.js
PASS client/state/profile-links/test/reducer.js
PASS client/lib/mixins/data-observe/test/index.js
PASS client/state/sites/domains/test/selectors.js
PASS client/state/jetpack/connection/test/reducer.js
PASS client/extensions/woocommerce/state/ui/shipping/zones/methods/test/helpers.js
PASS client/state/immediate-login/test/selectors.js
PASS client/state/selectors/test/is-fetching-order-transaction.js
PASS client/state/selectors/test/get-payment-country-code.js
PASS client/lib/i18n-utils/test/switch-locale.js
PASS client/state/sharing/publicize/test/selectors.js
PASS client/extensions/wp-super-cache/state/plugins/test/selectors.js
PASS client/state/selectors/test/get-raw-offsets.js
PASS client/state/signup/steps/design-type/test/reducer.js
PASS client/extensions/wp-super-cache/state/stats/test/selectors.js
PASS client/state/concierge/schedule-id/test/reducer.js
PASS client/lib/paths/test/index.js
PASS client/state/plans/test/actions.js
PASS client/state/selectors/test/get-reader-aliased-follow-feed-url.js
PASS client/extensions/woocommerce/state/data-layer/orders/notes/test/index.js
PASS client/components/data/media-list-data/test/utils.js
PASS client/extensions/wp-super-cache/state/plugins/test/reducer.js
PASS client/state/data-layer/wpcom/sites/stats/views/posts/test/index.js
PASS client/extensions/woocommerce/state/sites/product-categories/test/actions.js
PASS client/state/selectors/test/is-jetpack-module-active.js
PASS client/state/selectors/test/get-site-timezone-name.js
PASS client/state/data-layer/wpcom/active-promotions/test/index.js
PASS client/extensions/woocommerce/state/sites/reviews/test/selectors.js
PASS client/extensions/woocommerce/state/sites/customers/test/actions.js
PASS client/state/selectors/test/get-jetpack-remote-install-error-message.js
PASS client/state/selectors/test/is-requesting-media-item.js
PASS client/state/domains/management/test/reducer.js
PASS client/state/document-head/test/reducer.js
PASS client/state/selectors/test/is-following-reader-conversation.js
PASS client/extensions/woocommerce/state/data-layer/product-variations/test/index.js
PASS client/state/selectors/test/get-site-stats-query-date.js
PASS client/state/help/ticket/test/selectors.js
PASS client/state/signup/segments/test/reducer.js
PASS client/state/selectors/test/is-site-in-profile-links.js
PASS client/me/help/help-contact-form/test/utils.js
PASS client/extensions/woocommerce/components/product-search/test/utils.js
PASS client/state/account-recovery/settings/test/selectors.js
PASS client/state/account/test/reducer.js
PASS client/state/selectors/test/is-eligible-for-domain-to-paid-plan-upsell.js
PASS client/state/i18n/language-names/test/reducer.js
PASS client/state/gsuite-users/test/reducer.js
PASS client/state/plugins/installed/test/reducer.js
PASS client/state/account-recovery/test/reducer.js
PASS client/state/ui/language/test/actions.js
PASS client/state/stats/recent-post-views/test/actions.js
PASS client/state/signup/steps/site-style/test/actions.js
PASS client/state/application-passwords/test/reducer.js
PASS client/login/test/ssr.js
PASS client/state/domains/suggestions/test/selectors.js
PASS client/state/exporter/test/reducer.js
PASS client/state/selectors/test/get-poster-upload-progress.js
PASS client/extensions/woocommerce/state/wc-api/status/test/reducer.js
PASS client/state/selectors/test/get-last-non-editor-route.js
PASS client/state/selectors/test/get-localized-language-names.js
PASS client/state/selectors/test/is-fetching-site-blocks.js
PASS client/state/happychat/selectors/test/is-presales-chat-available.js
PASS client/state/plugins/recommended/test/reducer.js
PASS client/state/reader/sites/test/selectors.js
PASS client/state/simple-payments/product-list/test/reducer.js
PASS client/blocks/image-editor/test/utils.js
PASS client/state/signup/steps/site-type/test/selectors.js
PASS client/lib/query-manager/theme/test/key.js
PASS client/state/sharing/publicize/publicize-actions/test/reducer.js
PASS client/state/ui/drop-zone/test/reducer.js
PASS client/extensions/woocommerce/lib/formatted-variation-name/test/index.js
PASS client/state/notices/test/actions.js
PASS client/state/ui/nps-survey-notice/test/reducer.js
PASS client/lib/react-pass-to-children/test/index.js
PASS client/state/data-layer/wpcom/read/sites/test/index.js
PASS client/state/ui/layout-focus/test/actions.js
PASS client/state/selectors/test/get-jetpack-user-connection.js
PASS client/extensions/woocommerce/woocommerce-services/lib/utils/test/sanitize-html.js
PASS client/extensions/zoninator/state/feeds/test/reducer.js
PASS client/state/ui/preview/test/reducer.js
PASS client/lib/human-date/test/index.js
PASS client/state/stats/posts/test/selectors.js
PASS client/components/domains/register-domain-step/test/utility.js
PASS client/state/data-layer/wpcom/timezones/test/index.js
PASS client/state/selectors/test/is-saving-sharing-buttons.js
PASS client/state/selectors/test/is-requesting-jetpack-connection-status.js
PASS client/components/gsuite/gsuite-features/test/single-feature.js
PASS client/extensions/woocommerce/state/sites/orders/refunds/test/selectors.js
PASS client/lib/wp/localization/test/index.js
PASS client/extensions/woocommerce/state/sites/test/http-request.js
PASS client/state/selectors/test/is-jetpack-site-in-staging-mode.js
PASS client/state/selectors/test/get-comments-page.js
PASS client/state/sites/guided-transfer/test/reducer.js
PASS client/state/happychat/selectors/test/get-lostfocus-timestamp.js
PASS client/extensions/hello-dolly/state/test/reducer.js
PASS client/lib/ads/test/stores.js
PASS client/state/ui/route/query/test/reducer.js
PASS client/extensions/woocommerce/state/ui/shipping/zones/locations/test/helpers.js
PASS client/state/posts/revisions/test/reducer.js
PASS client/components/tinymce/plugins/wpcom-sourcecode/test/plugin.js
PASS client/lib/create-selector/test/index.js
PASS client/lib/popup-monitor/test/index.js
PASS client/state/selectors/test/get-media.js
PASS client/state/selectors/test/is-eligible-for-dotcom-checklist.js
PASS client/state/selectors/test/get-media-storage-limit.js
PASS client/lib/email-followers/test/store.js
PASS client/lib/form-state/test/index.js
PASS client/state/data-layer/wpcom/me/transactions/order/test/from-api.js
PASS client/state/ui/payment/test/reducer.js
PASS client/state/data-layer/wpcom-http/pipeline/test/test.js
PASS client/state/site-roles/test/selectors.js
PASS client/state/ui/action-log/test/reducer.js
PASS client/lib/path-to-section/test/index.js
PASS client/state/ui/post-type-list/test/reducer.js
PASS client/state/selectors/test/get-site-options.js
PASS client/lib/url/test/http-utils.js
PASS client/state/selectors/test/get-primary-site-id.js
PASS client/state/happychat/selectors/test/has-unread-messages.js
PASS client/state/jetpack/settings/test/utils.js
PASS client/state/selectors/test/can-current-user-manage-plugins.js
PASS client/state/selectors/test/is-fetching-magic-login-email.js
PASS client/components/tinymce/plugins/contact-form/test/shortcode.js
PASS client/state/happychat/ui/test/index.js
PASS client/state/selectors/test/get-site-timezone-value.js
PASS client/extensions/woocommerce/state/sites/orders/refunds/test/reducer.js
PASS client/state/site-address-change/test/reducer.js
PASS client/state/selectors/test/get-simple-payments.js
PASS client/state/selectors/test/is-private-site.js
PASS client/extensions/zoninator/state/locks/test/actions.js
PASS client/lib/wp/handlers/test/guest-sandbox-ticket.js
PASS client/state/selectors/test/get-site-gmt-offset.js
PASS client/state/selectors/test/get-site-icon-id.js
PASS client/state/jetpack-connect/reducer/test/jetpack-sso.js
PASS client/state/profile-links/test/actions.js
PASS client/state/selectors/test/is-requesting-media.js
PASS client/state/user-settings/test/reducer.js
PASS client/components/tinymce/plugins/contact-form/test/validations.js
PASS client/state/selectors/test/is-vip-site.js
PASS client/state/selectors/test/get-jetpack-setting.js
PASS client/state/activity-log/activation/test/reducer.js
PASS client/state/connected-applications/test/actions.js
PASS client/state/reader/feeds/test/selectors.js
PASS client/state/reader/lists/test/selectors.js
PASS client/state/sites/guided-transfer/test/selectors.js
PASS client/state/selectors/test/get-magic-login-current-view.js
PASS client/state/happychat/selectors/test/is-happychat-server-reachable.js
PASS client/state/data-layer/wpcom/concierge/schedules/appointments/reschedule/test/from-api.js
PASS client/state/selectors/test/is-requesting-sharing-buttons.js
PASS client/state/test/serialization-result.js
PASS client/components/language-picker/test/utils.js
PASS client/state/data-layer/wpcom/marketing/test/index.js
PASS client/state/signup/preview/test/actions.js
PASS client/state/selectors/test/get-post-revisions-comparisons.js
PASS client/state/happychat/selectors/test/get-happychat-connection-status.js
PASS client/state/reader/lists/test/reducer.js
PASS client/state/selectors/test/is-jetpack-site-in-development-mode.js
PASS client/state/selectors/test/get-reader-follows.js
PASS client/lib/compare-props/test/index.js
PASS client/state/exporter/test/selectors.js
PASS client/extensions/woocommerce/state/ui/orders/edits/test/reducer.js
PASS client/my-sites/sidebar/test/index.js
PASS client/state/selectors/test/get-concierge-appointment-timespan.js
PASS client/state/selectors/test/get-jetpack-modules-requiring-connection.js
PASS client/state/selectors/test/get-jetpack-connection-status.js
PASS client/state/selectors/test/get-podcasting-category-id.js
PASS client/state/selectors/test/get-post-likes.js
PASS client/state/selectors/test/is-automated-transfer-active.js
PASS client/state/selectors/test/is-following.js
PASS client/state/post-types/test/selectors.js
PASS client/lib/cart/store/test/cart-analytics.js
PASS client/extensions/wp-super-cache/state/cache/test/selectors.js
PASS client/state/selectors/test/get-wordpress-version.js
PASS client/state/selectors/test/get-selected-or-primary-site-id.js
PASS client/state/ui/editor/image-editor/test/selectors.js
PASS client/extensions/zoninator/state/feeds/test/selectors.js
PASS client/state/selectors/test/is-updating-site-monitor-settings.js
PASS client/state/selectors/test/is-past-billing-transaction-error.js
PASS client/state/ui/gutenberg-opt-in-dialog/test/reducer.js
PASS client/state/reader/posts/test/selectors.js
PASS client/state/ui/billing-transactions/test/actions.js
PASS client/state/selectors/test/get-original-user-setting.js
PASS client/state/selectors/test/can-current-user.js
PASS client/extensions/woocommerce/state/ui/products/test/list-reducer.js
PASS client/extensions/woocommerce/lib/order-values/test/totals.js
PASS client/lib/query-manager/paginated/test/key.js
PASS client/state/data-layer/wpcom/read/following/mine/test/utils.js
PASS client/reader/route/test/index.js
PASS client/state/selectors/test/get-past-billing-transaction.js
PASS client/blocks/product-selector/test/utils.js
PASS client/state/ui/oauth2-clients/test/selectors.js
PASS client/components/happychat/test/connection.js
PASS client/state/ui/oauth2-clients/test/reducer.js
PASS client/state/stats/recent-post-views/test/selectors.js
PASS client/extensions/hello-dolly/state/test/selectors.js
PASS client/my-sites/customize/test/panels.js
PASS client/state/ui/language/test/reducer.js
PASS client/state/selectors/test/get-plugin-upload-error.js
PASS client/state/happychat/selectors/test/get-happychat-userinfo.js
PASS client/lib/geocoding/test/index.js
PASS client/state/selectors/test/get-post-revision.js
PASS client/state/selectors/test/get-restore-error.js
PASS client/lib/keyboard-shortcuts/test/index.js
PASS client/layout/guided-tours/test/tour-branching.js
PASS client/state/selectors/test/is-email-blacklisted.js
PASS client/state/selectors/test/get-media-storage-used.js
PASS client/state/selectors/test/has-initialized-sites.js
PASS client/state/selectors/test/get-blocked-sites.js
PASS client/state/selectors/test/get-sites-items.js
PASS client/state/selectors/test/get-user-devices.js
PASS client/lib/scroll-into-viewport/test/index.js
PASS client/state/data-layer/wpcom/concierge/schedules/appointments/cancel/test/from-api.js
PASS client/state/reader/site-dismissals/test/reducer.js
PASS client/lib/embed-frame-markup/test/index.jsx
PASS client/state/oauth2-clients/test/selectors.js
PASS client/state/selectors/test/get-atomic-hosting-sftp-users.js
PASS client/extensions/woocommerce/woocommerce-services/lib/utils/test/coerce-values.js
PASS client/state/terms/test/utils.js
PASS client/state/signup/flow/test/actions.js
PASS client/state/ui/nps-survey-notice/test/selectors.js
PASS client/state/selectors/test/is-site-eligible-for-full-site-editing.js
PASS client/lib/mobile-app/test/index.js
PASS client/state/selectors/test/get-magic-login-request-auth-error.js
PASS client/state/stored-cards/test/selectors.js
PASS client/state/jetpack-connect/test/utils.js
PASS client/state/followers/test/selectors.js
PASS client/lib/importer/test/utils.js
PASS client/state/selectors/test/is-site-blocked.js
PASS client/state/signup/steps/site-style/test/reducer.js
PASS client/state/selectors/test/is-jetpack-user-master.js
PASS client/state/selectors/test/get-theme-filter-terms.js
PASS client/state/selectors/test/get-billing-transaction-date-filter-values.js
PASS client/state/help/courses/test/actions.js
PASS client/state/help/directly/test/reducer.js
PASS client/state/selectors/test/get-sharing-buttons.js
PASS client/state/selectors/test/is-site-upgradeable.js
PASS client/state/selectors/test/get-locale-suggestions.js
PASS client/state/current-user/gravatar-status/test/selectors.js
PASS client/state/selectors/test/get-concierge-has-available-sessions.js
PASS client/extensions/zoninator/state/zones/test/selectors.js
PASS client/extensions/woocommerce/state/ui/review-replies/test/actions.js
PASS client/state/ui/editor/last-draft/test/reducer.js
PASS client/extensions/zoninator/state/locks/test/selectors.js
PASS client/extensions/zoninator/state/data-layer/zones/test/index.js
PASS client/state/data-layer/test/handler-registry.js
PASS client/state/site-settings/test/utils.js
PASS client/state/domains/dns/test/utils.js
PASS client/me/purchases/cancel-purchase/test/cancellation-effect.jsx
PASS client/state/selectors/test/get-timezones-labels-by-continent.js
PASS client/state/selectors/test/get-poster-url.js
PASS client/state/selectors/test/get-billing-transaction-filters.js
PASS client/lib/domains/whois/test/utils.js
PASS client/state/selectors/test/get-jetpack-modules.js
PASS client/state/selectors/test/is-google-my-business-location-connected.js
PASS client/state/selectors/test/is-fetching-automated-transfer-status.js
PASS client/state/users/suggestions/test/selectors.js
PASS client/state/happychat/selectors/test/has-active-happychat-session.js
PASS client/state/selectors/test/get-site-blocks-last-page.js
PASS client/state/selectors/test/get-reader-conversation-follow-status.js
PASS client/extensions/wp-super-cache/state/settings/test/selectors.js
PASS client/state/selectors/test/get-site-setting.js
PASS client/state/selectors/test/get-theme-filter-term.js
PASS client/state/reader/related-posts/test/selectors.js
PASS client/state/selectors/test/prepend-theme-filter-keys.js
PASS client/components/marketing-survey/cancel-purchase-form/test/is-survey-filled-in.js
PASS client/lib/url/test/resembles-url.js
PASS client/state/happychat/selectors/test/is-happychat-connection-uninitialized.js
PASS client/state/ui/media-modal/test/selectors.js
PASS client/state/selectors/test/is-sharing-buttons-save-successful.js
PASS client/state/current-user/test/actions.js
PASS client/state/selectors/test/get-selected-editor.js
PASS client/state/sharing/keyring/test/selectors.js
PASS client/lib/domains/nameservers/test/store.js
PASS client/state/selectors/test/get-site-monitor-settings.js
PASS client/state/ui/route/path/test/reducer.js
PASS client/state/ui/editor/last-draft/test/actions.js
PASS client/lib/string/test/index.js
PASS client/state/selectors/test/has-loaded-sites.js
PASS client/state/selectors/test/get-site-url.js
PASS client/state/document-head/test/actions.js
PASS client/state/selectors/test/get-user-setting.js
PASS client/state/selectors/test/is-notifications-open.js
PASS client/components/marketing-survey/cancel-purchase-form/test/next-step.js
PASS client/state/selectors/test/get-previous-route.js
PASS client/state/selectors/test/is-requesting-billing-transactions.js
PASS client/state/selectors/test/is-automated-transfer-failed.js
PASS client/state/ui/layout-focus/test/reducer.js
PASS client/state/selectors/test/is-plugin-active.js
PASS client/state/help/courses/test/reducer.js
PASS client/lib/css-safe-url/test/index.js
PASS client/state/reader/feeds/test/schema.js
PASS client/state/selectors/test/get-billing-transactions-by-type.js
PASS client/state/ui/action-log/test/selectors.js
PASS client/state/selectors/test/is-requesting-reader-teams.js
PASS client/state/data-layer/wpcom/read/tags/test/utils.js
PASS client/state/selectors/test/get-raw-site.js
PASS client/state/active-promotions/test/selectors.js
PASS client/state/happychat/selectors/test/can-user-send-messages.js
PASS client/state/selectors/test/get-blog-stickers.js
PASS client/lib/local-storage-polyfill/test/index.js
PASS client/state/selectors/test/get-media-item.js
PASS client/state/selectors/test/is-requesting-jetpack-user-connection.js
PASS client/state/domains/suggestions/test/utils.js
PASS client/state/action-watchers/test/utils.js
PASS client/state/selectors/test/has-navigated.js
PASS client/state/wordads/status/test/selectors.js
PASS client/state/post-types/taxonomies/test/selectors.js
PASS client/state/selectors/test/get-timezones-by-continent.js
PASS client/state/signup/flow/test/selectors.js
PASS client/state/page-templates/test/selectors.js
PASS client/my-sites/pages/test/helpers.js
PASS client/state/selectors/test/get-previous-path.js
PASS client/state/current-user/test/selectors.js
PASS client/state/selectors/test/has-site-pending-automated-transfer.js
PASS client/lib/url/test/scheme-utils.js
PASS client/state/selectors/test/get-connected-applications.js
PASS client/state/selectors/test/find-theme-filter-term.js
PASS client/state/signup/progress/test/selectors.js
PASS client/state/happychat/selectors/test/was-happychat-recently-active.js
PASS client/state/selectors/test/get-jetpack-product-install-status.js
PASS client/state/selectors/test/get-current-plan-term.js
PASS client/state/selectors/test/get-theme-filter-term-from-string.js
PASS client/state/signup/steps/user-experience/test/selectors.js
PASS client/state/selectors/test/get-jetpack-settings.js
PASS client/state/selectors/test/is-jetpack-site-connected.js
PASS client/state/selectors/test/get-theme-filter-terms-table.js
PASS client/state/selectors/test/get-site-comment-counts.js
PASS client/extensions/woocommerce/state/sites/review-replies/test/actions.js
PASS client/state/selectors/test/is-requesting-billing-transaction.js
PASS client/state/selectors/test/is-deactivating-jetpack-module.js
PASS client/lib/flags/test/index.js
PASS client/state/selectors/test/is-sending-billing-receipt-email.js
PASS client/state/selectors/test/is-rewind-activating.js
PASS client/state/signup/segments/test/selectors.js
PASS client/state/plugins/wporg/test/selectors.js
PASS client/state/account-recovery/test/selectors.js
PASS client/state/selectors/test/get-magic-login-requested-auth-successfully.js
PASS client/state/help/courses/test/selectors.js
PASS client/lib/url-search/test/index.js
PASS client/state/selectors/test/get-magic-login-request-email-error.js
PASS client/state/selectors/test/get-application-passwords.js
PASS client/reader/lib/site-description-blocklist/test/index.js
PASS client/lib/preferences/test/store.js
PASS client/state/selectors/test/should-show-video-editor-error.js
PASS client/lib/build-url/test/index.js
PASS client/state/ui/guided-tours/test/reducer.js
PASS client/state/signup/preview/test/reducer.js
PASS client/state/selectors/test/get-timezones-labels.js
PASS client/state/selectors/test/user-has-any-atomic-sites.js
PASS client/state/signup/steps/site-goals/test/selectors.js
PASS client/extensions/woocommerce/lib/get-address-view-format/test/index.js
PASS client/extensions/woocommerce/state/sites/reviews/test/actions.js
PASS client/state/selectors/test/is-jetpack-module-unavailable-in-development-mode.js
PASS client/state/selectors/test/count-post-likes.js
PASS client/components/marketing-survey/cancel-purchase-form/test/previous-step.js
PASS client/state/selectors/test/get-post-revisions.js
PASS client/state/happychat/selectors/test/is-happychat-client-connected.js
PASS client/extensions/woocommerce/app/store-stats/referrers/test/helpers.js
PASS client/state/selectors/test/is-plugin-upload-in-progress.js
PASS client/state/happychat/selectors/test/has-happychat-localized-support.js
PASS client/state/push-notifications/test/selectors.js
PASS client/extensions/zoninator/state/zones/test/actions.js
PASS client/state/preferences/test/selectors.js
PASS client/lib/query-manager/post/test/key.js
PASS client/state/ui/payment/test/actions.js
PASS client/state/ui/comments/test/actions.js
PASS client/state/country-states/test/selectors.js
PASS client/state/domains/dns/test/reducer.js
PASS client/state/signup/steps/site-style/test/selectors.js
PASS client/state/selectors/test/is-fetching-jetpack-modules.js
PASS client/extensions/woocommerce/state/ui/reviews/test/actions.js
PASS client/state/happychat/selectors/test/is-happychat-available.js
PASS client/state/selectors/test/get-profile-links-error-type.js
PASS client/state/signup/optional-dependencies/test/selectors.js
PASS client/state/reader/thumbnails/test/selectors.js
PASS client/lib/query-manager/theme/test/index.js
PASS client/state/selectors/test/get-current-locale-variant.js
PASS client/lib/invites/reducers/test/invites-create-validation.js
PASS client/state/selectors/test/get-site-connection-status.js
PASS client/state/ui/media-modal/test/actions.js
PASS client/state/selectors/test/get-concierge-appointment-details.js
PASS client/state/selectors/test/is-ambiguous-theme-filter-term.js
PASS client/state/happychat/selectors/test/get-geolocation.js
PASS client/state/sites/vouchers/test/selectors.js
PASS client/state/selectors/test/get-partner-id-from-query.js
PASS client/state/selectors/test/get-order-transaction.js
PASS client/state/selectors/test/get-atomic-transfer.js
PASS client/state/selectors/test/get-jetpack-product-install-progress.js
PASS client/state/selectors/test/get-plugin-upload-progress.js
PASS client/state/signup/dependency-store/test/selectors.js
PASS client/state/i18n/locale-suggestions/test/reducer.js
PASS client/state/signup/preview/test/selectors.js
PASS client/reader/test/id-helpers.js
PASS client/state/notices/test/selectors.js
PASS client/state/selectors/test/get-rewind-backups.js
PASS client/state/followers/test/utils.js
PASS client/state/selectors/test/get-concierge-schedule-id.js
PASS client/state/selectors/test/is-activating-jetpack-module.js
PASS client/state/selectors/test/get-timezones-label.js
PASS client/state/signup/steps/site-title/test/selectors.js
PASS client/state/selectors/test/get-profile-links.js
PASS client/state/ui/layout-focus/test/selectors.js
PASS client/state/signup/verticals/test/selectors.js
PASS client/state/selectors/test/is-deleting-site.js
PASS client/lib/analytics/test/statsd.js
PASS client/state/selectors/test/get-partner-slug-from-query.js
PASS client/extensions/woocommerce/lib/get-payment-method-details/test/index.js
PASS client/state/selectors/test/get-image-editor-original-aspect-ratio.js
PASS client/state/selectors/test/is-requesting-site-monitor-settings.js
PASS client/state/selectors/test/is-valid-theme-filter-term.js
PASS client/state/selectors/test/is-domain-only-site.js
PASS client/state/selectors/test/get-theme-filters.js
PASS client/extensions/woocommerce/state/sites/orders/notes/test/actions.js
PASS client/state/selectors/test/is-requesting-reset-password.js
PASS client/state/selectors/test/get-magic-login-requested-email-successfully.js
PASS client/state/selectors/test/get-post-revisions-authors-id.js
PASS client/state/selectors/test/get-theme-filter-string-from-term.js
PASS client/state/wordads/approve/test/selectors.js
PASS client/state/ui/gutenberg-opt-in-dialog/test/actions.js
PASS client/extensions/woocommerce/state/ui/product-categories/test/actions.js
PASS client/state/themes/themes-ui/test/actions.js
PASS client/state/selectors/test/is-site-wpcom-atomic.js
PASS client/state/selectors/test/get-uploaded-plugin-id.js
PASS client/state/selectors/test/get-google-my-business-stats-error.js
PASS client/state/happychat/selectors/test/is-precancellation-chat-available.js
PASS client/state/selectors/test/get-jetpack-module.js
PASS client/state/selectors/test/is-plugin-upload-complete.js
PASS client/state/selectors/test/should-sync-reader-follows.js
PASS client/state/reader/tags/images/test/selectors.js
PASS client/state/selectors/test/is-hidden-site.js
PASS client/extensions/zoninator/state/feeds/test/actions.js
PASS client/state/selectors/test/get-dismissed-sites.js
PASS client/components/marketing-survey/cancel-purchase-form/test/initial-survey-state.js
PASS client/state/users/test/selectors.js
PASS client/lib/formatting/decode-entities/test/node.js
PASS client/state/signup/steps/survey/test/selectors.js
PASS client/reader/lib/teams/test/index.js
PASS client/state/selectors/test/is-iframe-for-html-element.js
PASS client/state/selectors/test/get-checkout-upgrade-intent.js
PASS client/state/selectors/test/get-post-revisions-diff-view.js
PASS client/state/selectors/test/get-theme-showcase-description.js
PASS client/state/selectors/test/get-upcoming-billing-transactions.js
PASS client/state/oauth2-clients/test/reducer.js
PASS client/state/selectors/test/get-timezones.js
PASS client/state/happychat/connection/test/actions.js
PASS client/state/selectors/test/get-concierge-next-appointment.js
PASS client/state/selectors/test/is-fetching-atomic-transfer.js
PASS client/components/tinymce/plugins/wpcom/test/utils.js
PASS client/state/selectors/test/get-jetpack-remote-install-error-code.js
PASS client/state/selectors/test/get-order-transaction-error.js
FAIL client/state/posts/test/selectors.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/posts/test/utils.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/lib/media/test/utils.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/test/utils.js:14:1)

FAIL client/state/data-layer/wpcom/comments/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/lib/post-normalizer/test/utils.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/comments/test/reducer.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/notices/test/middleware.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/components/remove-button/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/state/posts/test/actions.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/comments/test/selectors.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/terms/test/actions.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/reader/streams/test/reducer.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/reader/feeds/test/reducer.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/reader/posts/test/normalization-rules.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/reader/posts/test/actions.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/ui/editor/last-draft/test/selectors.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/components/plans/plans-skip-button/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/state/ui/guided-tours/test/contexts.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/state/ui/guided-tours/contexts.js:14:1)
      at Object.<anonymous> (client/state/ui/guided-tours/test/contexts.js:14:1)

FAIL client/state/ui/guided-tours/test/selectors.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/state/ui/guided-tours/contexts.js:14:1)
      at Object.<anonymous> (client/state/ui/guided-tours/test/fixtures/config.js:9:1)
      at Object.user:/benchmarks/nacd/Automattic_wp-calypso/client/layout/guided-tours/config.js: (client/state/ui/guided-tours/test/selectors.js:17:9)
      at Object.<anonymous> (client/state/ui/guided-tours/selectors/index.js:29:1)
      at Object.<anonymous> (client/state/ui/guided-tours/test/selectors.js:14:1)

FAIL client/state/data-layer/wpcom/read/streams/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/ui/editor/save-blockers/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/components/credit-card-form-fields/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/info-popover/index.jsx:13:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/country-specific-payment-fields.jsx:16:1)
      at Object.<anonymous> (client/components/credit-card-form-fields/index.jsx:18:1)
      at Object.<anonymous> (client/components/credit-card-form-fields/test/index.js:15:1)

FAIL client/state/themes/test/actions.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/jetpack-connect/test/main.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/jetpack-connect/main.jsx:15:1)
      at Object.<anonymous> (client/jetpack-connect/test/main.js:15:1)

FAIL client/blocks/login/test/login-form.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/forms/form-button/index.jsx:13:1)
      at Object.<anonymous> (client/blocks/login/test/login-form.jsx:16:1)

FAIL client/jetpack-connect/test/authorize.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/jetpack-connect/auth-form-header.jsx:13:1)
      at Object.<anonymous> (client/jetpack-connect/authorize.js:15:1)
      at Object.<anonymous> (client/jetpack-connect/test/authorize.js:16:1)

FAIL client/auth/test/login.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/forms/form-button/index.jsx:13:1)
      at Object.<anonymous> (client/auth/login.jsx:15:1)
      at Object.<anonymous> (client/auth/test/login.jsx:17:1)

FAIL client/state/ui/editor/test/selectors.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/devdocs/design/test/component-playground.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/devdocs/design/component-playground.jsx:13:1)
      at Object.<anonymous> (client/devdocs/design/test/component-playground.js:15:1)

FAIL client/blocks/plan-storage/test/bar.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/devdocs/docs-example/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/jetpack-connect/test/auth-form-header.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/jetpack-connect/auth-form-header.jsx:13:1)
      at Object.<anonymous> (client/jetpack-connect/test/auth-form-header.js:15:1)

FAIL client/jetpack-connect/test/plans.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/foldable-card/index.jsx:14:1)
      at Object.<anonymous> (client/my-sites/plan-features/index.jsx:17:1)
      at Object.<anonymous> (client/my-sites/plans-features-main/index.jsx:17:1)
      at Object.<anonymous> (client/jetpack-connect/plans-grid.jsx:14:1)
      at Object.<anonymous> (client/jetpack-connect/test/plans.js:13:1)

FAIL client/state/data-layer/wpcom/sites/comments/replies/new/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/blocks/plan-storage/test/plan-storage.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

FAIL client/jetpack-connect/test/signup.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/jetpack-connect/auth-form-header.jsx:13:1)
      at Object.<anonymous> (client/jetpack-connect/signup.js:22:1)
      at Object.<anonymous> (client/jetpack-connect/test/signup.js:17:1)

FAIL client/my-sites/email/gsuite-purchase-cta/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/email/email-management/gsuite-user-item/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/state/data-layer/wpcom/sites/comments/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/components/marketing-survey/cancel-purchase-form/step-components/test/upgrade-at-step.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/state/data-layer/wpcom/sites/posts/replies/new/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/blocks/product-purchase-features-list/test/product-purchase-features-list.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/email/email-forwarding/test/email-forwarding-item.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/data-layer/wpcom/sites/test/utils.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/data-layer/wpcom/sites/simple-payments/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/my-sites/themes/test/logged-out.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/components/site-verticals-suggestion-search/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/state/selectors/test/get-site-icon-url.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/state/selectors/get-media-url.js:5:1)

FAIL client/state/ui/editor/test/actions.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/components/tinymce/plugins/embed/test/dialog.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/plans-features-main/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/blocks/image-selector/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/image-selector/preview.jsx:15:1)
      at Object.<anonymous> (client/blocks/image-selector/index.jsx:14:1)
      at Object.<anonymous> (client/blocks/image-selector/test/index.jsx:18:1)

FAIL client/components/themes-list/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/empty-content/index.jsx:12:1)
      at Object.<anonymous> (client/components/themes-list/test/index.jsx:16:1)

FAIL client/components/theme/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/theme/index.jsx:17:1)
      at Object.<anonymous> (client/components/theme/test/index.jsx:20:1)

FAIL client/my-sites/site-settings/seo-settings/test/form.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/site-settings/seo-settings/form.jsx:12:1)
      at Object.<anonymous> (client/my-sites/site-settings/seo-settings/test/form.jsx:35:1)

FAIL client/blocks/upwork-banner/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/components/button-group/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/components/support-info/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/info-popover/index.jsx:13:1)
      at Object.<anonymous> (client/components/support-info/index.jsx:11:1)
      at Object.<anonymous> (client/components/support-info/test/index.js:15:1)

FAIL client/components/drop-zone/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/drop-zone/index.jsx:16:1)
      at Object.<anonymous> (client/components/drop-zone/test/index.jsx:17:1)

FAIL client/my-sites/media-library/test/data-source.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/media-library/data-source.jsx:16:1)
      at Object.<anonymous> (client/my-sites/media-library/test/data-source.jsx:17:1)

FAIL client/my-sites/site-settings/test/form-general.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/blocks/credit-card-form/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/credit-card-form/index.jsx:15:1)
      at Object.<anonymous> (client/blocks/credit-card-form/test/index.js:15:1)

FAIL client/my-sites/site-settings/test/form-analytics.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/site-settings/form-analytics.jsx:12:1)
      at Object.<anonymous> (client/my-sites/site-settings/test/form-analytics.jsx:36:1)

FAIL client/my-sites/media-library/test/list-item.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/my-sites/media-library/list-item-image.jsx:11:1)
      at Object.<anonymous> (client/my-sites/media-library/list-item.tsx:13:1)
      at Object.<anonymous> (client/my-sites/media-library/test/list-item.jsx:16:1)

FAIL client/components/domains/contact-details-form-fields/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/forms/form-button/index.jsx:13:1)
      at Object.<anonymous> (client/components/domains/contact-details-form-fields/index.jsx:30:1)
      at Object.<anonymous> (client/components/domains/contact-details-form-fields/test/index.js:16:1)

FAIL client/my-sites/media-library/test/list-item-image.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/my-sites/media-library/test/list-item-image.jsx:16:1)

FAIL client/components/domains/domain-suggestion/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/domains/domain-suggestion/index.jsx:14:1)
      at Object.<anonymous> (client/components/domains/domain-suggestion/test/index.js:16:1)

FAIL client/components/gravatar/test/index.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/components/gravatar/index.jsx:13:1)

FAIL client/lib/media-serialization/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/lib/media-serialization/test/index.js:13:1)

FAIL client/my-sites/media-library/test/index.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/my-sites/media-library/index.jsx:18:1)
      at Object.<anonymous> (client/my-sites/media-library/test/index.jsx:15:1)

FAIL client/components/community-translator/test/translatable.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/community-translator/translatable.jsx:13:1)
      at Object.<anonymous> (client/components/community-translator/test/translatable.js:13:1)

FAIL client/state/selectors/test/edited-post-has-content.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/my-sites/media-library/test/list.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)
      at Object.<anonymous> (client/lib/post-normalizer/rule-pick-canonical-image.js:10:1)
      at Object.<anonymous> (client/state/posts/utils.js:37:1)
      at Object.<anonymous> (client/state/posts/selectors.js:10:1)
      at Object.<anonymous> (client/state/ui/editor/selectors.js:12:1)
      at Object.<anonymous> (client/lib/media/actions.js:15:1)
      at Object.<anonymous> (client/my-sites/media-library/list.jsx:14:1)
      at Object.<anonymous> (client/my-sites/media-library/test/list.jsx:17:1)

FAIL client/my-sites/checkout/checkout/test/pending-payment-blocker.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/checkout/pending-payment-blocker.jsx:11:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/pending-payment-blocker.js:14:1)

FAIL client/components/happiness-support/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/blocks/post-time/test/index.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/components/happychat/test/composer.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/components/date-range/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/date-range/index.js:18:1)
      at Object.<anonymous> (client/components/date-range/test/index.js:17:1)

FAIL client/my-sites/checkout/checkout/test/redirect-payment-box.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/cart/cart-coupon.jsx:13:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/redirect-payment-box.jsx:13:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/redirect-payment-box.js:15:1)

FAIL client/my-sites/media-library/test/content.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)
      at Object.<anonymous> (client/lib/post-normalizer/rule-pick-canonical-image.js:10:1)
      at Object.<anonymous> (client/state/posts/utils.js:37:1)
      at Object.<anonymous> (client/state/posts/selectors.js:10:1)
      at Object.<anonymous> (client/state/ui/editor/selectors.js:12:1)
      at Object.<anonymous> (client/lib/media/actions.js:15:1)
      at Object.<anonymous> (client/components/data/media-list-data/index.jsx:12:1)
      at Object.<anonymous> (client/my-sites/media-library/content.jsx:19:1)
      at Object.<anonymous> (client/my-sites/media-library/test/content.jsx:15:1)

FAIL client/components/happychat/test/button.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/checkout/checkout/test/country-specific-payment-fields.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/info-popover/index.jsx:13:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/country-specific-payment-fields.jsx:16:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/country-specific-payment-fields.js:15:1)

FAIL client/components/purchase-detail/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/lib/accept/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/lib/accept/dialog.jsx:12:1)
      at Object.<anonymous> (client/lib/accept/index.js:11:1)
      at Object.<anonymous> (client/lib/accept/test/index.js:8:1)

FAIL client/components/language-picker/test/modal.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/language-picker/modal.jsx:27:1)
      at Object.<anonymous> (client/components/language-picker/test/modal.js:15:1)

FAIL client/my-sites/checkout/checkout/test/checkout.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/checkout/pending-payment-blocker.jsx:11:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/index.jsx:43:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/checkout.js:15:1)

FAIL client/my-sites/checkout/checkout/test/wechat-payment-box.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/cart/cart-coupon.jsx:13:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/wechat-payment-box.jsx:15:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/wechat-payment-box.js:14:1)

FAIL client/components/language-picker/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/language-picker/modal.jsx:27:1)
      at Object.<anonymous> (client/components/language-picker/index.jsx:15:1)
      at Object.<anonymous> (client/components/language-picker/test/index.jsx:15:1)

FAIL client/my-sites/checkout/checkout/test/credit-card-payment-box.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/checkout/pay-button.jsx:12:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/credit-card-payment-box.jsx:12:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/credit-card-payment-box.js:15:1)

FAIL client/blocks/nps-survey/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/nps-survey/index.jsx:16:1)
      at Object.<anonymous> (client/blocks/nps-survey/test/index.jsx:15:1)

FAIL client/state/posts/test/reducer.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/my-sites/checkout/checkout/test/domain-details-form.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/checkout/payment-box.jsx:14:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/domain-details-form.jsx:17:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/domain-details-form.js:16:1)

FAIL client/components/banner/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/components/external-link/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/checkout/checkout/test/payment-box.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/checkout/payment-box.jsx:14:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/payment-box.js:15:1)

FAIL client/components/suggestion-search/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/checkout/checkout/test/web-payment-box.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/cart/cart-coupon.jsx:13:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/web-payment-box.jsx:16:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/web-payment-box.js:16:1)

FAIL client/components/popover/test/menu-item.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/checkout/checkout/test/pay-button.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/checkout/pay-button.jsx:12:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/pay-button.js:15:1)

FAIL client/my-sites/checkout/checkout/test/paypal-payment-box.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/cart/cart-coupon.jsx:13:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/paypal-payment-box.jsx:22:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/paypal-payment-box.js:15:1)

FAIL client/blocks/image-editor/test/image-editor-canvas.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/blocks/image-editor/image-editor-canvas.jsx:15:1)
      at Object.<anonymous> (client/blocks/image-editor/test/image-editor-canvas.jsx:15:1)

FAIL client/signup/navigation-link/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/components/sites-dropdown/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/state/selectors/get-media-url.js:5:1)
      at Object.<anonymous> (client/state/selectors/get-site-icon-url.js:11:1)
      at Object.<anonymous> (client/blocks/site-icon/index.jsx:20:1)
      at Object.<anonymous> (client/blocks/site/index.jsx:16:1)
      at Object.<anonymous> (client/components/sites-dropdown/index.jsx:15:1)
      at Object.<anonymous> (client/components/sites-dropdown/test/index.js:17:1)

FAIL client/blocks/image-editor/test/image-editor-toolbar.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/popover/menu.jsx:10:1)
      at Object.<anonymous> (client/blocks/image-editor/image-editor-toolbar.jsx:16:1)
      at Object.<anonymous> (client/blocks/image-editor/test/image-editor-toolbar.jsx:16:1)

FAIL client/my-sites/checkout/checkout/test/credits-payment-box.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/checkout/pay-button.jsx:12:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/credits-payment-box.jsx:13:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/credits-payment-box.js:15:1)

FAIL client/signup/submit-step-button/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/state/selectors/test/get-parent-comment.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/my-sites/checkout/cart/test/cart-coupon.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/cart/cart-coupon.jsx:13:1)
      at Object.<anonymous> (client/my-sites/checkout/cart/test/cart-coupon.js:15:1)

FAIL client/my-sites/checkout/cart/test/cart-buttons.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/cart/cart-buttons.jsx:15:1)
      at Object.<anonymous> (client/my-sites/checkout/cart/test/cart-buttons.js:14:1)

FAIL client/signup/steps/site-style/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/signup/steps/site-style/index.jsx:15:1)
      at Object.<anonymous> (client/signup/steps/site-style/test/index.js:15:1)

FAIL client/my-sites/checkout/checkout-thank-you/test/header.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/signup/steps/plans/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/checkout/checkout-thank-you/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/selectors/test/get-active-reply-comment-id.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/my-sites/plan-features/test/header.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/info-popover/index.jsx:13:1)
      at Object.<anonymous> (client/my-sites/plan-features/header.jsx:15:1)
      at Object.<anonymous> (client/my-sites/plan-features/test/header.jsx:36:1)

FAIL client/post-editor/editor-publish-button/test/index.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)
      at Object.<anonymous> (client/lib/post-normalizer/rule-pick-canonical-image.js:10:1)
      at Object.<anonymous> (client/state/posts/utils.js:37:1)
      at Object.<anonymous> (client/state/posts/stats.js:11:1)
      at Object.<anonymous> (client/post-editor/editor-publish-button/index.jsx:13:1)
      at Object.<anonymous> (client/post-editor/editor-publish-button/test/index.jsx:18:1)

FAIL client/state/ui/editor/test/edit-save-flow.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/my-sites/plan-features/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/layout/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/plugins/plugin-autoupdate-toggle/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/external-link/index.jsx:14:1)
      at Object.<anonymous> (client/my-sites/plugins/plugin-autoupdate-toggle/index.jsx:15:1)
      at Object.<anonymous> (client/my-sites/plugins/plugin-autoupdate-toggle/test/index.jsx:18:1)

FAIL client/my-sites/plugins/plugins-list/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/lib/accept/dialog.jsx:12:1)
      at Object.<anonymous> (client/lib/accept/index.js:11:1)
      at Object.<anonymous> (client/my-sites/plugins/plugins-list/index.jsx:17:1)
      at Object.<anonymous> (client/my-sites/plugins/plugins-list/test/index.jsx:15:1)

FAIL client/post-editor/media-modal/test/index.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)
      at Object.<anonymous> (client/lib/post-normalizer/rule-pick-canonical-image.js:10:1)
      at Object.<anonymous> (client/state/posts/utils.js:37:1)
      at Object.<anonymous> (client/state/posts/stats.js:11:1)
      at Object.<anonymous> (client/post-editor/media-modal/index.jsx:30:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/index.jsx:16:1)

FAIL client/post-editor/editor-notice/test/index.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/post-editor/editor-ground-control/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/post-editor/editor-ground-control/index.jsx:15:1)
      at Object.<anonymous> (client/post-editor/editor-ground-control/test/index.jsx:15:1)

FAIL client/post-editor/media-modal/detail/test/index.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/detail/detail-preview-image.jsx:15:1)
      at Object.<anonymous> (client/post-editor/media-modal/detail/detail-item.jsx:20:1)
      at Object.<anonymous> (client/post-editor/media-modal/detail/test/index.jsx:15:1)

FAIL client/my-sites/plugins/plugins-browser/test/index.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/state/selectors/get-media-url.js:5:1)
      at Object.<anonymous> (client/state/selectors/get-site-icon-url.js:11:1)
      at Object.<anonymous> (client/blocks/site-icon/index.jsx:20:1)
      at Object.<anonymous> (client/my-sites/sidebar-navigation/index.jsx:13:1)
      at Object.<anonymous> (client/my-sites/plugins/plugins-browser/index.jsx:14:1)
      at Object.<anonymous> (client/my-sites/plugins/plugins-browser/test/index.jsx:41:1)

FAIL client/blocks/upgrade-nudge/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/state/test/persistence.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/my-sites/plugins/plugin-meta/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/post-editor/editor-discussion/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/external-link/index.jsx:14:1)
      at Object.<anonymous> (client/post-editor/editor-discussion/index.jsx:17:1)
      at Object.<anonymous> (client/post-editor/editor-discussion/test/index.jsx:17:1)

FAIL client/post-editor/editor-word-count/test/index.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)
      at Object.<anonymous> (client/lib/post-normalizer/rule-pick-canonical-image.js:10:1)
      at Object.<anonymous> (client/state/posts/utils.js:37:1)
      at Object.<anonymous> (client/state/posts/selectors.js:10:1)
      at Object.<anonymous> (client/state/ui/editor/selectors.js:12:1)
      at Object.<anonymous> (client/post-editor/editor-word-count/index.jsx:15:1)
      at Object.<anonymous> (client/post-editor/editor-word-count/test/index.jsx:16:1)

FAIL client/post-editor/editor-categories-tags/test/accordion.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/post-editor/editor-categories-tags/accordion.jsx:15:1)
      at Object.<anonymous> (client/post-editor/editor-categories-tags/test/accordion.jsx:16:1)

FAIL client/post-editor/editor-sharing/test/publicize-connection.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)
      at Object.<anonymous> (client/lib/post-normalizer/rule-pick-canonical-image.js:10:1)
      at Object.<anonymous> (client/state/posts/utils.js:37:1)
      at Object.<anonymous> (client/state/posts/stats.js:11:1)
      at Object.<anonymous> (client/post-editor/editor-sharing/publicize-connection.jsx:18:1)
      at Object.<anonymous> (client/post-editor/editor-sharing/test/publicize-connection.jsx:15:1)

FAIL client/state/test/initial-state.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)
      at Object.<anonymous> (client/state/comments/utils.js:4:1)
      at Object.<anonymous> (client/state/comments/reducer.js:50:1)
      at Object.<anonymous> (client/state/reducer.js:27:1)
      at Object.<anonymous> (client/state/index.js:10:1)
      at Object.<anonymous> (client/state/test/initial-state.js:19:1)

FAIL client/my-sites/sidebar/test/sidebar.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/state/selectors/get-media-url.js:5:1)

FAIL client/post-editor/edit-post-status/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/post-editor/edit-post-status/index.jsx:13:1)
      at Object.<anonymous> (client/post-editor/edit-post-status/test/index.jsx:16:1)

FAIL client/my-sites/domains/map-domain/test/map-domain.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/header-cake/index.jsx:12:1)
      at Object.<anonymous> (client/my-sites/domains/map-domain/index.jsx:14:1)
      at Object.<anonymous> (client/my-sites/domains/map-domain/test/map-domain.js:15:1)

FAIL client/me/pending-payments/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/reader/sidebar/test/promo.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/app-promo/index.jsx:18:1)
      at Object.<anonymous> (client/reader/sidebar/promo.jsx:15:1)
      at Object.<anonymous> (client/reader/sidebar/test/promo.jsx:14:1)

FAIL client/me/pending-payments/test/pending-list-item.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/state/selectors/test/get-media-url.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/state/selectors/get-media-url.js:5:1)

FAIL client/blocks/eligibility-warnings/test/index.tsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/eligibility-warnings/index.tsx:21:1)
      at Object.<anonymous> (client/blocks/eligibility-warnings/test/index.tsx:23:1)

FAIL client/blocks/daily-post-button/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/sites-popover/index.jsx:12:1)
      at Object.<anonymous> (client/blocks/daily-post-button/index.jsx:18:1)
      at Object.<anonymous> (client/blocks/daily-post-button/test/index.jsx:18:1)

FAIL client/my-sites/domains/components/domain-warnings/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/domains/components/domain-warnings/pending-gsuite-tos-notice-action.js:7:1)
      at Object.<anonymous> (client/my-sites/domains/components/domain-warnings/pending-gsuite-tos-notice.jsx:16:1)
      at Object.<anonymous> (client/my-sites/domains/components/domain-warnings/index.jsx:18:1)
      at Object.<anonymous> (client/my-sites/domains/components/domain-warnings/test/index.js:17:1)

FAIL client/me/help/help-courses/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/domains/domain-management/edit/card/header/test/primary-domain-button.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/me/help/test/main.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/domains/domain-management/edit/test/mapped-domain.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/domains/domain-management/edit/mapped-domain.jsx:11:1)
      at Object.<anonymous> (client/my-sites/domains/domain-management/edit/test/mapped-domain.js:13:1)

FAIL client/my-sites/domains/domain-management/transfer/transfer-to-other-site/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/domains/domain-management/list/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/domains/components/domain-warnings/pending-gsuite-tos-notice-action.js:7:1)
      at Object.<anonymous> (client/my-sites/domains/components/domain-warnings/pending-gsuite-tos-notice.jsx:16:1)
      at Object.<anonymous> (client/my-sites/domains/components/domain-warnings/index.jsx:18:1)
      at Object.<anonymous> (client/my-sites/domains/domain-management/list/index.jsx:18:1)
      at Object.<anonymous> (client/my-sites/domains/domain-management/list/test/index.js:16:1)

FAIL client/me/help/help-search/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/me/help/help-search/index.jsx:12:1)
      at Object.<anonymous> (client/me/help/help-search/test/index.js:16:1)

FAIL client/state/selectors/test/can-current-user-edit-post.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/me/concierge/test/main.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/blocks/app-banner/test/app-banner.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/app-banner/index.jsx:15:1)
      at Object.<anonymous> (client/blocks/app-banner/test/app-banner.jsx:8:1)

FAIL client/my-sites/hosting/sftp-card/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/my-sites/hosting/sftp-card/index.js:12:1)
      at Object.<anonymous> (client/my-sites/hosting/sftp-card/test/index.js:14:1)

FAIL client/state/comments/test/actions.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/selectors/test/get-editor-close-config.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/my-sites/theme/test/main.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

Summary of all failing tests
FAIL client/post-editor/media-modal/test/markup.js
  ● markup › #get() › should return an empty string if not passed any arguments

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › #get() › should return an empty string if not passed any arguments

    TypeError: Cannot read property 'get' of undefined

      30 | 	describe( '#get()', () => {
      31 | 		test( 'should return an empty string if not passed any arguments', () => {
    > 32 | 			const value = markup.get( site );
         | 			                     ^
      33 | 
      34 | 			expect( value ).to.equal( '' );
      35 | 		} );

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:32:25)

  ● markup › #get() › should defer to a specific mime type handler if one exists

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › #get() › should defer to a specific mime type handler if one exists

    TypeError: Cannot read property 'mimeTypes' of undefined

      36 | 
      37 | 		test( 'should defer to a specific mime type handler if one exists', () => {
    > 38 | 			sandbox.stub( markup.mimeTypes, 'image' );
         | 			                     ^
      39 | 			markup.get( site, { mime_type: 'image/png' } );
      40 | 
      41 | 			expect( markup.mimeTypes.image ).to.have.been.called;

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:38:25)

  ● markup › #get() › should return a link for a mime type prefix without a specific handler

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › #get() › should return a link for a mime type prefix without a specific handler

    Trying to stub property 'link' of undefined

      43 | 
      44 | 		test( 'should return a link for a mime type prefix without a specific handler', () => {
    > 45 | 			sandbox.stub( markup, 'link' );
         | 			        ^
      46 | 			markup.get( site, { mime_type: 'application/pdf' } );
      47 | 
      48 | 			expect( markup.link ).to.have.been.called;

      at throwOnFalsyObject (node_modules/sinon/lib/sinon/throw-on-falsy-object.js:7:15)
      at stub (node_modules/sinon/lib/sinon/stub.js:32:24)
      at Sandbox.stub (node_modules/sinon/lib/sinon/sandbox.js:318:33)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:45:12)

  ● markup › #link() › should return a link for a mime type prefix without a specific handler

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › #link() › should return a link for a mime type prefix without a specific handler

    TypeError: Cannot read property 'link' of undefined

      52 | 	describe( '#link()', () => {
      53 | 		test( 'should return a link for a mime type prefix without a specific handler', () => {
    > 54 | 			const value = markup.link( {
         | 			                     ^
      55 | 				URL: 'http://example.com/wp-content/uploads/document.pdf',
      56 | 				title: 'document',
      57 | 			} );

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:54:25)

  ● markup › #caption() › should accept a media object, returning a caption element

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › #caption() › should accept a media object, returning a caption element

    TypeError: Cannot read property 'caption' of undefined

      65 | 	describe( '#caption()', () => {
      66 | 		test( 'should accept a media object, returning a caption element', () => {
    > 67 | 			const value = markup.caption( site, {
         | 			                     ^
      68 | 				ID: 1,
      69 | 				URL: 'https://s1.wp.com/wp-content/themes/a8c/automattic-2011/images/automattic-logo.png',
      70 | 				alt: 'Automattic',

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:67:25)

  ● markup › #caption() › should accept a non-captioned image, returning null

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › #caption() › should accept a non-captioned image, returning null

    TypeError: Cannot read property 'caption' of undefined

      81 | 
      82 | 		test( 'should accept a non-captioned image, returning null', () => {
    > 83 | 			const value = markup.caption( site, {
         | 			                     ^
      84 | 				ID: 1,
      85 | 				URL: 'https://s1.wp.com/wp-content/themes/a8c/automattic-2011/images/automattic-logo.png',
      86 | 				alt: 'Automattic',

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:83:25)

  ● markup › #caption() › should accept a captioned string, returning a React element

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › #caption() › should accept a captioned string, returning a React element

    TypeError: Cannot read property 'caption' of undefined

      93 | 
      94 | 		test( 'should accept a captioned string, returning a React element', () => {
    > 95 | 			const value = markup.caption(
         | 			                     ^
      96 | 				site,
      97 | 				'[caption id="attachment_1627" align="aligncenter" width="660"]<img class="size-full wp-image-1627" src="https://andrewmduthietest.files.wordpress.com/2015/01/img_0372.jpg" alt="Example" width="660" height="660" /> Ceramic[/caption]'
      98 | 			);

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:95:25)

  ● markup › .mimeTypes › #image() › should not set width auto if media width cannot be determined

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should not set width auto if media width cannot be determined

    TypeError: Cannot read property 'mimeTypes' of undefined

      108 | 		describe( '#image()', () => {
      109 | 			test( 'should not set width auto if media width cannot be determined', () => {
    > 110 | 				const value = markup.mimeTypes.image( site, {
          | 				                     ^
      111 | 					ID: 'media-4',
      112 | 					URL: 'http%3A//example.com/ddd1d6b0-f31b-4937-ae9e-97f1d660cf71',
      113 | 					thumbnails: {},

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:110:26)

  ● markup › .mimeTypes › #image() › should return an img element for an image

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should return an img element for an image

    TypeError: Cannot read property 'mimeTypes' of undefined

      120 | 
      121 | 			test( 'should return an img element for an image', () => {
    > 122 | 				const value = markup.mimeTypes.image( site, {
          | 				                     ^
      123 | 					ID: 1,
      124 | 					URL: 'https://s1.wp.com/wp-content/themes/a8c/automattic-2011/images/automattic-logo.png',
      125 | 					alt: 'Automattic',

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:122:26)

  ● markup › .mimeTypes › #image() › should respect the max width for a site size

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should respect the max width for a site size

    TypeError: Cannot read property 'mimeTypes' of undefined

      141 | 				};
      142 | 
    > 143 | 				const value = markup.mimeTypes.image(
          | 				                     ^
      144 | 					siteWithLargeSize,
      145 | 					{
      146 | 						ID: 1,

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:143:26)

  ● markup › .mimeTypes › #image() › should respect the max height for a site size

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should respect the max height for a site size

    TypeError: Cannot read property 'mimeTypes' of undefined

      166 | 				};
      167 | 
    > 168 | 				const value = markup.mimeTypes.image(
          | 				                     ^
      169 | 					siteWithLargeSize,
      170 | 					{
      171 | 						ID: 1,

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:168:26)

  ● markup › .mimeTypes › #image() › should include a resize parameter if forceResize option passed

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should include a resize parameter if forceResize option passed

    TypeError: Cannot read property 'mimeTypes' of undefined

      184 | 
      185 | 			test( 'should include a resize parameter if forceResize option passed', () => {
    > 186 | 				const value = markup.mimeTypes.image(
          | 				                     ^
      187 | 					site,
      188 | 					{
      189 | 						ID: 1,

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:186:26)

  ● markup › .mimeTypes › #image() › should avoid XSS because React

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should avoid XSS because React

    TypeError: Cannot read property 'mimeTypes' of undefined

      203 | 
      204 | 			test( 'should avoid XSS because React', () => {
    > 205 | 				const value = markup.mimeTypes.image( site, {
          | 				                     ^
      206 | 					ID: 1,
      207 | 					URL: '""><SCRIPT>alert("XSS")</SCRIPT>"',
      208 | 					thumbnails: {},

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:205:26)

  ● markup › .mimeTypes › #image() › should attempt to find the site's thumbnail width if a size is specified

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should attempt to find the site's thumbnail width if a size is specified

    TypeError: Cannot read property 'mimeTypes' of undefined

      223 | 				};
      224 | 
    > 225 | 				value = markup.mimeTypes.image(
          | 				               ^
      226 | 					siteWithWidth,
      227 | 					{
      228 | 						ID: 1,

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:225:20)

  ● markup › .mimeTypes › #image() › should attempt to find the media's own thumbnail width if a size is specified

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should attempt to find the media's own thumbnail width if a size is specified

    TypeError: Cannot read property 'mimeTypes' of undefined

      245 | 				const jetpackSite = { jetpack: true };
      246 | 
    > 247 | 				value = markup.mimeTypes.image(
          | 				               ^
      248 | 					jetpackSite,
      249 | 					{
      250 | 						ID: 1,

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:247:20)

  ● markup › .mimeTypes › #image() › should wrap a captioned image in a caption shortcode

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should wrap a captioned image in a caption shortcode

    TypeError: Cannot read property 'mimeTypes' of undefined

      265 | 
      266 | 			test( 'should wrap a captioned image in a caption shortcode', () => {
    > 267 | 				const value = markup.mimeTypes.image( site, {
          | 				                     ^
      268 | 					ID: 1,
      269 | 					URL: 'https://s1.wp.com/wp-content/themes/a8c/automattic-2011/images/automattic-logo.png',
      270 | 					alt: 'Automattic',

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:267:26)

  ● markup › .mimeTypes › #image() › should calculate the height when specifying a size

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should calculate the height when specifying a size

    TypeError: Cannot read property 'mimeTypes' of undefined

      280 | 
      281 | 			test( 'should calculate the height when specifying a size', () => {
    > 282 | 				const value = markup.mimeTypes.image(
          | 				                     ^
      283 | 					site,
      284 | 					{
      285 | 						ID: 1,

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:282:26)

  ● markup › .mimeTypes › #image() › should include a data-istransient="istransient" attribute when media.transient is truthy

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should include a data-istransient="istransient" attribute when media.transient is truthy

    TypeError: Cannot read property 'mimeTypes' of undefined

      300 | 
      301 | 			test( 'should include a data-istransient="istransient" attribute when media.transient is truthy', () => {
    > 302 | 				const value = markup.mimeTypes.image( site, {
          | 				                     ^
      303 | 					ID: 1,
      304 | 					URL: 'https://s1.wp.com/wp-content/themes/a8c/automattic-2011/images/automattic-logo.png',
      305 | 					alt: 'Automattic',

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:302:26)

  ● markup › .mimeTypes › #image() › should not include a data-istransient attribute when media.transient is falsy

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #image() › should not include a data-istransient attribute when media.transient is falsy

    TypeError: Cannot read property 'mimeTypes' of undefined

      316 | 
      317 | 			test( 'should not include a data-istransient attribute when media.transient is falsy', () => {
    > 318 | 				const value = markup.mimeTypes.image( site, {
          | 				                     ^
      319 | 					ID: 1,
      320 | 					URL: 'https://s1.wp.com/wp-content/themes/a8c/automattic-2011/images/automattic-logo.png',
      321 | 					alt: 'Automattic',

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:318:26)

  ● markup › .mimeTypes › #audio() › should return an `audio` shortcode for an audio item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #audio() › should return an `audio` shortcode for an audio item

    TypeError: Cannot read property 'mimeTypes' of undefined

      334 | 		describe( '#audio()', () => {
      335 | 			test( 'should return an `audio` shortcode for an audio item', () => {
    > 336 | 				const value = markup.mimeTypes.audio( site, {
          | 				                     ^
      337 | 					URL: 'http://example.com/wp-content/uploads/2015/06/loop.mp3',
      338 | 				} );
      339 | 

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:336:26)

  ● markup › .mimeTypes › #video() › should return a `wpvideo` shortcode for a VideoPress video

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #video() › should return a `wpvideo` shortcode for a VideoPress video

    TypeError: Cannot read property 'mimeTypes' of undefined

      346 | 		describe( '#video()', () => {
      347 | 			test( 'should return a `wpvideo` shortcode for a VideoPress video', () => {
    > 348 | 				const value = markup.mimeTypes.video( site, {
          | 				                     ^
      349 | 					videopress_guid: '11acMj3O',
      350 | 				} );
      351 | 

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:348:26)

  ● markup › .mimeTypes › #video() › should return a `video` shortcode for a video

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/markup.js:13:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:22:12)

  ● markup › .mimeTypes › #video() › should return a `video` shortcode for a video

    TypeError: Cannot read property 'mimeTypes' of undefined

      354 | 
      355 | 			test( 'should return a `video` shortcode for a video', () => {
    > 356 | 				const value = markup.mimeTypes.video( site, {
          | 				                     ^
      357 | 					URL: 'http://example.com/wp-content/uploads/2015/06/loop.mp4',
      358 | 					height: 454,
      359 | 					width: 1436,

      at Object.<anonymous> (client/post-editor/media-modal/test/markup.js:356:26)

FAIL client/blocks/post-status/test/index.jsx
  ● PostStatus › no post › should be empty

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › no post › should be empty

    TypeError: Cannot read property 'contextTypes' of undefined

      18 | 		test( 'should be empty', () => {
      19 | 			const PostStatusComponent = <PostStatus translate={ identity } />;
    > 20 | 			const wrapper = shallow( PostStatusComponent );
         | 			                ^
      21 | 
      22 | 			expect( wrapper ).to.be.empty;
      23 | 		} );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:20:20)

  ● PostStatus › post › sticky › should render the primary components

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › sticky › should render the primary components

    TypeError: Cannot read property 'contextTypes' of undefined

      28 | 			test( 'should render the primary components', () => {
      29 | 				const PostStatusComponent = <PostStatus post={ { sticky: true } } translate={ identity } />;
    > 30 | 				const wrapper = shallow( PostStatusComponent );
         | 				                ^
      31 | 
      32 | 				expect( wrapper ).to.have.descendants( 'span' );
      33 | 				expect( wrapper ).to.have.className( 'is-sticky' );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:30:21)

  ● PostStatus › post › not sticky › pending › should render the primary components

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › not sticky › pending › should render the primary components

    TypeError: Cannot read property 'contextTypes' of undefined

      46 | 						<PostStatus post={ { sticky: false, status: 'pending' } } translate={ identity } />
      47 | 					);
    > 48 | 					const wrapper = shallow( PostStatusComponent );
         | 					                ^
      49 | 
      50 | 					expect( wrapper ).to.have.descendants( 'span' );
      51 | 					expect( wrapper ).to.have.className( 'is-pending' );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:48:22)

  ● PostStatus › post › not sticky › future › showAll › should render the primary components

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › not sticky › future › showAll › should render the primary components

    TypeError: Cannot read property 'contextTypes' of undefined

      68 | 							/>
      69 | 						);
    > 70 | 						const wrapper = shallow( PostStatusComponent );
         | 						                ^
      71 | 
      72 | 						expect( wrapper ).to.have.descendants( 'span' );
      73 | 						expect( wrapper ).to.have.className( 'is-scheduled' );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:70:23)

  ● PostStatus › post › not sticky › future › not showAll › should be empty

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › not sticky › future › not showAll › should be empty

    TypeError: Cannot read property 'contextTypes' of undefined

      85 | 							<PostStatus post={ { sticky: false, status: 'future' } } translate={ identity } />
      86 | 						);
    > 87 | 						const wrapper = shallow( PostStatusComponent );
         | 						                ^
      88 | 
      89 | 						expect( wrapper ).to.be.empty;
      90 | 					} );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:87:23)

  ● PostStatus › post › not sticky › trash › showAll › should render the primary components

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › not sticky › trash › showAll › should render the primary components

    TypeError: Cannot read property 'contextTypes' of undefined

      102 | 							/>
      103 | 						);
    > 104 | 						const wrapper = shallow( PostStatusComponent );
          | 						                ^
      105 | 
      106 | 						expect( wrapper ).to.have.descendants( 'span' );
      107 | 						expect( wrapper ).to.have.className( 'is-trash' );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:104:23)

  ● PostStatus › post › not sticky › trash › not showAll › should be empty

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › not sticky › trash › not showAll › should be empty

    TypeError: Cannot read property 'contextTypes' of undefined

      119 | 							<PostStatus post={ { sticky: false, status: 'trash' } } translate={ identity } />
      120 | 						);
    > 121 | 						const wrapper = shallow( PostStatusComponent );
          | 						                ^
      122 | 
      123 | 						expect( wrapper ).to.be.empty;
      124 | 					} );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:121:23)

  ● PostStatus › post › not sticky › draft › showAll › should render the primary components

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › not sticky › draft › showAll › should render the primary components

    TypeError: Cannot read property 'contextTypes' of undefined

      136 | 							/>
      137 | 						);
    > 138 | 						const wrapper = shallow( PostStatusComponent );
          | 						                ^
      139 | 
      140 | 						expect( wrapper ).to.have.descendants( 'span' );
      141 | 						expect( wrapper ).to.have.className( 'is-draft' );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:138:23)

  ● PostStatus › post › not sticky › draft › not showAll › should be empty

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › not sticky › draft › not showAll › should be empty

    TypeError: Cannot read property 'contextTypes' of undefined

      153 | 							<PostStatus post={ { sticky: false, status: 'draft' } } translate={ identity } />
      154 | 						);
    > 155 | 						const wrapper = shallow( PostStatusComponent );
          | 						                ^
      156 | 
      157 | 						expect( wrapper ).to.be.empty;
      158 | 					} );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:155:23)

  ● PostStatus › post › not sticky › publish › showAll › should render the primary components

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › not sticky › publish › showAll › should render the primary components

    TypeError: Cannot read property 'contextTypes' of undefined

      170 | 							/>
      171 | 						);
    > 172 | 						const wrapper = shallow( PostStatusComponent );
          | 						                ^
      173 | 
      174 | 						expect( wrapper ).to.have.descendants( 'span' );
      175 | 						expect( wrapper ).to.have.className( 'is-published' );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:172:23)

  ● PostStatus › post › not sticky › publish › not showAll › should be empty

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › not sticky › publish › not showAll › should be empty

    TypeError: Cannot read property 'contextTypes' of undefined

      187 | 							<PostStatus post={ { sticky: false, status: 'publish' } } translate={ identity } />
      188 | 						);
    > 189 | 						const wrapper = shallow( PostStatusComponent );
          | 						                ^
      190 | 
      191 | 						expect( wrapper ).to.be.empty;
      192 | 					} );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:189:23)

  ● PostStatus › post › not sticky › unhandled status › should be empty

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

  ● PostStatus › post › not sticky › unhandled status › should be empty

    TypeError: Cannot read property 'contextTypes' of undefined

      199 | 						<PostStatus post={ { sticky: false, status: 'wow' } } translate={ identity } />
      200 | 					);
    > 201 | 					const wrapper = shallow( PostStatusComponent );
          | 					                ^
      202 | 
      203 | 					expect( wrapper ).to.be.empty;
      204 | 				} );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/post-status/test/index.jsx:201:22)

FAIL client/lib/media/test/list-store.js
  ● MediaListStore › #get() › should return a single value

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #get() › should return a single value

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #get() › should return a single value

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      85 | 					siteId: DUMMY_SITE_ID,
      86 | 					data: DUMMY_MEDIA_RESPONSE,
    > 87 | 					query: MediaListStore.getNextPageQuery(
         | 					                      ^
      88 | 						action && action.siteId ? action.siteId : DUMMY_SITE_ID
      89 | 					),
      90 | 				},

      at dispatchReceiveMediaItems (client/lib/media/test/list-store.js:87:28)
      at Object.<anonymous> (client/lib/media/test/list-store.js:124:4)

  ● MediaListStore › #get() › should return undefined for an item that does not exist

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #get() › should return undefined for an item that does not exist

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #get() › should return undefined for an item that does not exist

    TypeError: Cannot read property 'get' of undefined

      128 | 
      129 | 		test( 'should return undefined for an item that does not exist', () => {
    > 130 | 			expect( MediaListStore.get( DUMMY_SITE_ID, DUMMY_MEDIA_ID + 1 ) ).to.be.undefined;
          | 			                       ^
      131 | 		} );
      132 | 	} );
      133 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:130:27)

  ● MediaListStore › #getAll() › should return all received media

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #getAll() › should return all received media

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #getAll() › should return all received media

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      85 | 					siteId: DUMMY_SITE_ID,
      86 | 					data: DUMMY_MEDIA_RESPONSE,
    > 87 | 					query: MediaListStore.getNextPageQuery(
         | 					                      ^
      88 | 						action && action.siteId ? action.siteId : DUMMY_SITE_ID
      89 | 					),
      90 | 				},

      at dispatchReceiveMediaItems (client/lib/media/test/list-store.js:87:28)
      at Object.<anonymous> (client/lib/media/test/list-store.js:136:4)

  ● MediaListStore › #getAll() › should sort media by date, with newest first

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #getAll() › should sort media by date, with newest first

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #getAll() › should sort media by date, with newest first

    TypeError: Cannot read property 'get' of undefined

      145 | 			];
      146 | 
    > 147 | 			MediaStore.get.restore();
          | 			           ^
      148 | 			sandbox.stub( MediaStore, 'get' ).callsFake( function( siteId, postId ) {
      149 | 				return find( media, { ID: postId } );
      150 | 			} );

      at Object.<anonymous> (client/lib/media/test/list-store.js:147:15)

  ● MediaListStore › #getAll() › should secondary sort media by ID, with larger first

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #getAll() › should secondary sort media by ID, with larger first

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #getAll() › should secondary sort media by ID, with larger first

    TypeError: Cannot read property 'get' of undefined

      161 | 			];
      162 | 
    > 163 | 			MediaStore.get.restore();
          | 			           ^
      164 | 			sandbox.stub( MediaStore, 'get' ).callsFake( function( siteId, postId ) {
      165 | 				return find( media, { ID: postId } );
      166 | 			} );

      at Object.<anonymous> (client/lib/media/test/list-store.js:163:15)

  ● MediaListStore › #getAll() › should not sort media if the source is marked as not having a date

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #getAll() › should not sort media if the source is marked as not having a date

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #getAll() › should not sort media if the source is marked as not having a date

    TypeError: Cannot read property 'get' of undefined

      178 | 			const query = { number: 2, source: 'pexels' };
      179 | 
    > 180 | 			MediaStore.get.restore();
          | 			           ^
      181 | 			dispatchSetQuery( { query } );
      182 | 
      183 | 			sandbox.stub( MediaStore, 'get' ).callsFake( function( siteId, postId ) {

      at Object.<anonymous> (client/lib/media/test/list-store.js:180:15)

  ● MediaListStore › #getAll() › should return undefined for a fetching site

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #getAll() › should return undefined for a fetching site

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #getAll() › should return undefined for a fetching site

    TypeError: handler is not a function

      67 | 
      68 | 	function dispatchFetchMedia( action ) {
    > 69 | 		handler( {
         | 		^
      70 | 			action: assign(
      71 | 				{
      72 | 					type: 'FETCH_MEDIA_ITEMS',

      at dispatchFetchMedia (client/lib/media/test/list-store.js:69:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:193:4)

  ● MediaListStore › #getAll() › should return an empty array for a site with no media

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #getAll() › should return an empty array for a site with no media

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #getAll() › should return an empty array for a site with no media

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      85 | 					siteId: DUMMY_SITE_ID,
      86 | 					data: DUMMY_MEDIA_RESPONSE,
    > 87 | 					query: MediaListStore.getNextPageQuery(
         | 					                      ^
      88 | 						action && action.siteId ? action.siteId : DUMMY_SITE_ID
      89 | 					),
      90 | 				},

      at dispatchReceiveMediaItems (client/lib/media/test/list-store.js:87:28)
      at Object.<anonymous> (client/lib/media/test/list-store.js:199:4)

  ● MediaListStore › #getNextPageQuery() › should include default parameters if no query provided

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #getNextPageQuery() › should include default parameters if no query provided

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #getNextPageQuery() › should include default parameters if no query provided

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      205 | 	describe( '#getNextPageQuery()', () => {
      206 | 		test( 'should include default parameters if no query provided', () => {
    > 207 | 			expect( MediaListStore.getNextPageQuery( DUMMY_SITE_ID ) ).to.eql(
          | 			                       ^
      208 | 				MediaListStore.DEFAULT_QUERY
      209 | 			);
      210 | 		} );

      at Object.<anonymous> (client/lib/media/test/list-store.js:207:27)

  ● MediaListStore › #getNextPageQuery() › should include page_handle if the previous response included next_page meta

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #getNextPageQuery() › should include page_handle if the previous response included next_page meta

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #getNextPageQuery() › should include page_handle if the previous response included next_page meta

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      85 | 					siteId: DUMMY_SITE_ID,
      86 | 					data: DUMMY_MEDIA_RESPONSE,
    > 87 | 					query: MediaListStore.getNextPageQuery(
         | 					                      ^
      88 | 						action && action.siteId ? action.siteId : DUMMY_SITE_ID
      89 | 					),
      90 | 				},

      at dispatchReceiveMediaItems (client/lib/media/test/list-store.js:87:28)
      at Object.<anonymous> (client/lib/media/test/list-store.js:213:4)

  ● MediaListStore › #getNextPageQuery() › should preserve the query from the previous request

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #getNextPageQuery() › should preserve the query from the previous request

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #getNextPageQuery() › should preserve the query from the previous request

    TypeError: handler is not a function

      55 | 
      56 | 	function dispatchSetQuery( action ) {
    > 57 | 		handler( {
         | 		^
      58 | 			action: assign(
      59 | 				{
      60 | 					type: 'SET_MEDIA_QUERY',

      at dispatchSetQuery (client/lib/media/test/list-store.js:57:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:223:4)

  ● MediaListStore › #getNextPageQuery() › should reset the page handle when the query changes

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #getNextPageQuery() › should reset the page handle when the query changes

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #getNextPageQuery() › should reset the page handle when the query changes

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      85 | 					siteId: DUMMY_SITE_ID,
      86 | 					data: DUMMY_MEDIA_RESPONSE,
    > 87 | 					query: MediaListStore.getNextPageQuery(
         | 					                      ^
      88 | 						action && action.siteId ? action.siteId : DUMMY_SITE_ID
      89 | 					),
      90 | 				},

      at dispatchReceiveMediaItems (client/lib/media/test/list-store.js:87:28)
      at Object.<anonymous> (client/lib/media/test/list-store.js:240:4)

  ● MediaListStore › #hasNextPage() › should return true if the previous response included next_page meta

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #hasNextPage() › should return true if the previous response included next_page meta

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #hasNextPage() › should return true if the previous response included next_page meta

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      85 | 					siteId: DUMMY_SITE_ID,
      86 | 					data: DUMMY_MEDIA_RESPONSE,
    > 87 | 					query: MediaListStore.getNextPageQuery(
         | 					                      ^
      88 | 						action && action.siteId ? action.siteId : DUMMY_SITE_ID
      89 | 					),
      90 | 				},

      at dispatchReceiveMediaItems (client/lib/media/test/list-store.js:87:28)
      at Object.<anonymous> (client/lib/media/test/list-store.js:254:4)

  ● MediaListStore › #hasNextPage() › should return true if the site is unknown

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #hasNextPage() › should return true if the site is unknown

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #hasNextPage() › should return true if the site is unknown

    TypeError: Cannot read property 'hasNextPage' of undefined

      258 | 
      259 | 		test( 'should return true if the site is unknown', () => {
    > 260 | 			expect( MediaListStore.hasNextPage( DUMMY_SITE_ID ) ).to.be.ok;
          | 			                       ^
      261 | 		} );
      262 | 
      263 | 		test( 'should return false if the previous response did not include next_page meta', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:260:27)

  ● MediaListStore › #hasNextPage() › should return false if the previous response did not include next_page meta

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #hasNextPage() › should return false if the previous response did not include next_page meta

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #hasNextPage() › should return false if the previous response did not include next_page meta

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      85 | 					siteId: DUMMY_SITE_ID,
      86 | 					data: DUMMY_MEDIA_RESPONSE,
    > 87 | 					query: MediaListStore.getNextPageQuery(
         | 					                      ^
      88 | 						action && action.siteId ? action.siteId : DUMMY_SITE_ID
      89 | 					),
      90 | 				},

      at dispatchReceiveMediaItems (client/lib/media/test/list-store.js:87:28)
      at Object.<anonymous> (client/lib/media/test/list-store.js:264:4)

  ● MediaListStore › #isFetchingNextPage() › should return false no request has been made

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isFetchingNextPage() › should return false no request has been made

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isFetchingNextPage() › should return false no request has been made

    TypeError: Cannot read property 'isFetchingNextPage' of undefined

      270 | 	describe( '#isFetchingNextPage()', () => {
      271 | 		test( 'should return false no request has been made', () => {
    > 272 | 			expect( MediaListStore.isFetchingNextPage( DUMMY_SITE_ID ) ).to.not.be.ok;
          | 			                       ^
      273 | 		} );
      274 | 
      275 | 		test( 'should return true if site media is being fetched', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:272:27)

  ● MediaListStore › #isFetchingNextPage() › should return true if site media is being fetched

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isFetchingNextPage() › should return true if site media is being fetched

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isFetchingNextPage() › should return true if site media is being fetched

    TypeError: handler is not a function

      67 | 
      68 | 	function dispatchFetchMedia( action ) {
    > 69 | 		handler( {
         | 		^
      70 | 			action: assign(
      71 | 				{
      72 | 					type: 'FETCH_MEDIA_ITEMS',

      at dispatchFetchMedia (client/lib/media/test/list-store.js:69:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:276:4)

  ● MediaListStore › #isFetchingNextPage() › should return false if site media was received

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isFetchingNextPage() › should return false if site media was received

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isFetchingNextPage() › should return false if site media was received

    TypeError: handler is not a function

      67 | 
      68 | 	function dispatchFetchMedia( action ) {
    > 69 | 		handler( {
         | 		^
      70 | 			action: assign(
      71 | 				{
      72 | 					type: 'FETCH_MEDIA_ITEMS',

      at dispatchFetchMedia (client/lib/media/test/list-store.js:69:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:282:4)

  ● MediaListStore › #isFetchingNextPage() › should return false when the query was changed

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isFetchingNextPage() › should return false when the query was changed

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isFetchingNextPage() › should return false when the query was changed

    TypeError: handler is not a function

      67 | 
      68 | 	function dispatchFetchMedia( action ) {
    > 69 | 		handler( {
         | 		^
      70 | 			action: assign(
      71 | 				{
      72 | 					type: 'FETCH_MEDIA_ITEMS',

      at dispatchFetchMedia (client/lib/media/test/list-store.js:69:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:289:4)

  ● MediaListStore › #isItemMatchingQuery › should return true if no query exists for site

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isItemMatchingQuery › should return true if no query exists for site

    TypeError: Cannot read property 'isItemMatchingQuery' of undefined

      298 | 
      299 | 		beforeAll( function() {
    > 300 | 			isItemMatchingQuery = MediaListStore.isItemMatchingQuery;
          | 			                                     ^
      301 | 		} );
      302 | 
      303 | 		test( 'should return true if no query exists for site', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:300:41)

  ● MediaListStore › #isItemMatchingQuery › should return true if no query exists for site

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isItemMatchingQuery › should return true if no query exists for site

    TypeError: isItemMatchingQuery is not a function

      302 | 
      303 | 		test( 'should return true if no query exists for site', () => {
    > 304 | 			const matches = isItemMatchingQuery( DUMMY_SITE_ID, DUMMY_MEDIA_OBJECT );
          | 			                ^
      305 | 
      306 | 			expect( matches ).to.be.true;
      307 | 		} );

      at Object.<anonymous> (client/lib/media/test/list-store.js:304:20)

  ● MediaListStore › #isItemMatchingQuery › should return false if a search query is specified, but the item doesn't match

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isItemMatchingQuery › should return false if a search query is specified, but the item doesn't match

    TypeError: Cannot read property 'isItemMatchingQuery' of undefined

      298 | 
      299 | 		beforeAll( function() {
    > 300 | 			isItemMatchingQuery = MediaListStore.isItemMatchingQuery;
          | 			                                     ^
      301 | 		} );
      302 | 
      303 | 		test( 'should return true if no query exists for site', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:300:41)

  ● MediaListStore › #isItemMatchingQuery › should return false if a search query is specified, but the item doesn't match

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isItemMatchingQuery › should return false if a search query is specified, but the item doesn't match

    TypeError: handler is not a function

      55 | 
      56 | 	function dispatchSetQuery( action ) {
    > 57 | 		handler( {
         | 		^
      58 | 			action: assign(
      59 | 				{
      60 | 					type: 'SET_MEDIA_QUERY',

      at dispatchSetQuery (client/lib/media/test/list-store.js:57:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:310:4)

  ● MediaListStore › #isItemMatchingQuery › should return true if a search query is specified, and the item matches

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isItemMatchingQuery › should return true if a search query is specified, and the item matches

    TypeError: Cannot read property 'isItemMatchingQuery' of undefined

      298 | 
      299 | 		beforeAll( function() {
    > 300 | 			isItemMatchingQuery = MediaListStore.isItemMatchingQuery;
          | 			                                     ^
      301 | 		} );
      302 | 
      303 | 		test( 'should return true if no query exists for site', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:300:41)

  ● MediaListStore › #isItemMatchingQuery › should return true if a search query is specified, and the item matches

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isItemMatchingQuery › should return true if a search query is specified, and the item matches

    TypeError: handler is not a function

      55 | 
      56 | 	function dispatchSetQuery( action ) {
    > 57 | 		handler( {
         | 		^
      58 | 			action: assign(
      59 | 				{
      60 | 					type: 'SET_MEDIA_QUERY',

      at dispatchSetQuery (client/lib/media/test/list-store.js:57:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:318:4)

  ● MediaListStore › #isItemMatchingQuery › should return true if a search query is specified, and the item matches case insensitive

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isItemMatchingQuery › should return true if a search query is specified, and the item matches case insensitive

    TypeError: Cannot read property 'isItemMatchingQuery' of undefined

      298 | 
      299 | 		beforeAll( function() {
    > 300 | 			isItemMatchingQuery = MediaListStore.isItemMatchingQuery;
          | 			                                     ^
      301 | 		} );
      302 | 
      303 | 		test( 'should return true if no query exists for site', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:300:41)

  ● MediaListStore › #isItemMatchingQuery › should return true if a search query is specified, and the item matches case insensitive

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isItemMatchingQuery › should return true if a search query is specified, and the item matches case insensitive

    TypeError: handler is not a function

      55 | 
      56 | 	function dispatchSetQuery( action ) {
    > 57 | 		handler( {
         | 		^
      58 | 			action: assign(
      59 | 				{
      60 | 					type: 'SET_MEDIA_QUERY',

      at dispatchSetQuery (client/lib/media/test/list-store.js:57:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:326:4)

  ● MediaListStore › #isItemMatchingQuery › should return false if a search query and mime_type are specified, and the item matches on title, but not mime_type

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isItemMatchingQuery › should return false if a search query and mime_type are specified, and the item matches on title, but not mime_type

    TypeError: Cannot read property 'isItemMatchingQuery' of undefined

      298 | 
      299 | 		beforeAll( function() {
    > 300 | 			isItemMatchingQuery = MediaListStore.isItemMatchingQuery;
          | 			                                     ^
      301 | 		} );
      302 | 
      303 | 		test( 'should return true if no query exists for site', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:300:41)

  ● MediaListStore › #isItemMatchingQuery › should return false if a search query and mime_type are specified, and the item matches on title, but not mime_type

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isItemMatchingQuery › should return false if a search query and mime_type are specified, and the item matches on title, but not mime_type

    TypeError: handler is not a function

      55 | 
      56 | 	function dispatchSetQuery( action ) {
    > 57 | 		handler( {
         | 		^
      58 | 			action: assign(
      59 | 				{
      60 | 					type: 'SET_MEDIA_QUERY',

      at dispatchSetQuery (client/lib/media/test/list-store.js:57:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:334:4)

  ● MediaListStore › #isItemMatchingQuery › should return false if a mime_type is specified, but the item doesn't match

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isItemMatchingQuery › should return false if a mime_type is specified, but the item doesn't match

    TypeError: Cannot read property 'isItemMatchingQuery' of undefined

      298 | 
      299 | 		beforeAll( function() {
    > 300 | 			isItemMatchingQuery = MediaListStore.isItemMatchingQuery;
          | 			                                     ^
      301 | 		} );
      302 | 
      303 | 		test( 'should return true if no query exists for site', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:300:41)

  ● MediaListStore › #isItemMatchingQuery › should return false if a mime_type is specified, but the item doesn't match

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isItemMatchingQuery › should return false if a mime_type is specified, but the item doesn't match

    TypeError: handler is not a function

      55 | 
      56 | 	function dispatchSetQuery( action ) {
    > 57 | 		handler( {
         | 		^
      58 | 			action: assign(
      59 | 				{
      60 | 					type: 'SET_MEDIA_QUERY',

      at dispatchSetQuery (client/lib/media/test/list-store.js:57:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:342:4)

  ● MediaListStore › #isItemMatchingQuery › should return true if a mime_type is specified, and the item matches

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isItemMatchingQuery › should return true if a mime_type is specified, and the item matches

    TypeError: Cannot read property 'isItemMatchingQuery' of undefined

      298 | 
      299 | 		beforeAll( function() {
    > 300 | 			isItemMatchingQuery = MediaListStore.isItemMatchingQuery;
          | 			                                     ^
      301 | 		} );
      302 | 
      303 | 		test( 'should return true if no query exists for site', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:300:41)

  ● MediaListStore › #isItemMatchingQuery › should return true if a mime_type is specified, and the item matches

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isItemMatchingQuery › should return true if a mime_type is specified, and the item matches

    TypeError: handler is not a function

      55 | 
      56 | 	function dispatchSetQuery( action ) {
    > 57 | 		handler( {
         | 		^
      58 | 			action: assign(
      59 | 				{
      60 | 					type: 'SET_MEDIA_QUERY',

      at dispatchSetQuery (client/lib/media/test/list-store.js:57:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:350:4)

  ● MediaListStore › #isItemMatchingQuery › should return true if item matches an external source but doesnt match title

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › #isItemMatchingQuery › should return true if item matches an external source but doesnt match title

    TypeError: Cannot read property 'isItemMatchingQuery' of undefined

      298 | 
      299 | 		beforeAll( function() {
    > 300 | 			isItemMatchingQuery = MediaListStore.isItemMatchingQuery;
          | 			                                     ^
      301 | 		} );
      302 | 
      303 | 		test( 'should return true if no query exists for site', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:300:41)

  ● MediaListStore › #isItemMatchingQuery › should return true if item matches an external source but doesnt match title

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › #isItemMatchingQuery › should return true if item matches an external source but doesnt match title

    TypeError: handler is not a function

      55 | 
      56 | 	function dispatchSetQuery( action ) {
    > 57 | 		handler( {
         | 		^
      58 | 			action: assign(
      59 | 				{
      60 | 					type: 'SET_MEDIA_QUERY',

      at dispatchSetQuery (client/lib/media/test/list-store.js:57:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:358:4)

  ● MediaListStore › .dispatchToken › should expose its dispatcher ID

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › .dispatchToken › should expose its dispatcher ID

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › .dispatchToken › should expose its dispatcher ID

    TypeError: Cannot read property 'dispatchToken' of undefined

      366 | 	describe( '.dispatchToken', () => {
      367 | 		test( 'should expose its dispatcher ID', () => {
    > 368 | 			expect( MediaListStore.dispatchToken ).to.be.a( 'string' );
          | 			                       ^
      369 | 		} );
      370 | 
      371 | 		test( 'should destroy existing media when a query changes', () => {

      at Object.<anonymous> (client/lib/media/test/list-store.js:368:27)

  ● MediaListStore › .dispatchToken › should destroy existing media when a query changes

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › .dispatchToken › should destroy existing media when a query changes

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › .dispatchToken › should destroy existing media when a query changes

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      85 | 					siteId: DUMMY_SITE_ID,
      86 | 					data: DUMMY_MEDIA_RESPONSE,
    > 87 | 					query: MediaListStore.getNextPageQuery(
         | 					                      ^
      88 | 						action && action.siteId ? action.siteId : DUMMY_SITE_ID
      89 | 					),
      90 | 				},

      at dispatchReceiveMediaItems (client/lib/media/test/list-store.js:87:28)
      at Object.<anonymous> (client/lib/media/test/list-store.js:372:4)

  ● MediaListStore › .dispatchToken › should not destroy existing media if query change relates to pagination

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › .dispatchToken › should not destroy existing media if query change relates to pagination

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › .dispatchToken › should not destroy existing media if query change relates to pagination

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      85 | 					siteId: DUMMY_SITE_ID,
      86 | 					data: DUMMY_MEDIA_RESPONSE,
    > 87 | 					query: MediaListStore.getNextPageQuery(
         | 					                      ^
      88 | 						action && action.siteId ? action.siteId : DUMMY_SITE_ID
      89 | 					),
      90 | 				},

      at dispatchReceiveMediaItems (client/lib/media/test/list-store.js:87:28)
      at Object.<anonymous> (client/lib/media/test/list-store.js:379:4)

  ● MediaListStore › .dispatchToken › should emit a change event when receiving updates

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › .dispatchToken › should emit a change event when receiving updates

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › .dispatchToken › should emit a change event when receiving updates

    TypeError: Cannot read property 'once' of undefined

      384 | 
      385 | 		test( 'should emit a change event when receiving updates', done => {
    > 386 | 			MediaListStore.once( 'change', done );
          | 			               ^
      387 | 
      388 | 			dispatchReceiveMediaItems();
      389 | 		} );

      at Object.<anonymous> (client/lib/media/test/list-store.js:386:19)

  ● MediaListStore › .dispatchToken › should ignore received items where the query does not match

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › .dispatchToken › should ignore received items where the query does not match

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › .dispatchToken › should ignore received items where the query does not match

    TypeError: handler is not a function

      67 | 
      68 | 	function dispatchFetchMedia( action ) {
    > 69 | 		handler( {
         | 		^
      70 | 			action: assign(
      71 | 				{
      72 | 					type: 'FETCH_MEDIA_ITEMS',

      at dispatchFetchMedia (client/lib/media/test/list-store.js:69:3)
      at Object.<anonymous> (client/lib/media/test/list-store.js:392:4)

  ● MediaListStore › .dispatchToken › should remove an item when REMOVE_MEDIA_ITEM is dispatched

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › .dispatchToken › should remove an item when REMOVE_MEDIA_ITEM is dispatched

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › .dispatchToken › should remove an item when REMOVE_MEDIA_ITEM is dispatched

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      85 | 					siteId: DUMMY_SITE_ID,
      86 | 					data: DUMMY_MEDIA_RESPONSE,
    > 87 | 					query: MediaListStore.getNextPageQuery(
         | 					                      ^
      88 | 						action && action.siteId ? action.siteId : DUMMY_SITE_ID
      89 | 					),
      90 | 				},

      at dispatchReceiveMediaItems (client/lib/media/test/list-store.js:87:28)
      at Object.<anonymous> (client/lib/media/test/list-store.js:400:4)

  ● MediaListStore › .dispatchToken › should re-add an item when REMOVE_MEDIA_ITEM errors and includes data

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › .dispatchToken › should re-add an item when REMOVE_MEDIA_ITEM errors and includes data

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › .dispatchToken › should re-add an item when REMOVE_MEDIA_ITEM errors and includes data

    TypeError: Cannot read property 'ensureActiveQueryForSiteId' of undefined

      405 | 
      406 | 		test( 'should re-add an item when REMOVE_MEDIA_ITEM errors and includes data', () => {
    > 407 | 			MediaListStore.ensureActiveQueryForSiteId( DUMMY_SITE_ID );
          | 			               ^
      408 | 			dispatchRemoveMediaItem( { error: true } );
      409 | 
      410 | 			expect( MediaListStore.getAllIds( DUMMY_SITE_ID ) ).to.not.be.empty;

      at Object.<anonymous> (client/lib/media/test/list-store.js:407:19)

  ● MediaListStore › .dispatchToken › should replace an item when RECEIVE_MEDIA_ITEM includes ID

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/list-store.js:31:16)

  ● MediaListStore › .dispatchToken › should replace an item when RECEIVE_MEDIA_ITEM includes ID

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaListStore._media = {};
         | 		^
      49 | 		MediaListStore._activeQueries = {};
      50 | 	} );
      51 | 

      at Object.<anonymous> (client/lib/media/test/list-store.js:48:3)

  ● MediaListStore › .dispatchToken › should replace an item when RECEIVE_MEDIA_ITEM includes ID

    TypeError: Cannot read property 'get' of undefined

      414 | 			const newItem = assign( {}, DUMMY_MEDIA_OBJECT, { ID: DUMMY_MEDIA_ID + 1 } );
      415 | 
    > 416 | 			MediaStore.get.restore();
          | 			           ^
      417 | 			sandbox.stub( MediaStore, 'get' ).callsFake( function( siteId, postId ) {
      418 | 				if ( siteId !== DUMMY_SITE_ID ) {
      419 | 					return;

      at Object.<anonymous> (client/lib/media/test/list-store.js:416:15)

FAIL client/lib/media/test/actions.js
  ● MediaActions › #setQuery() › should dispatch the SET_MEDIA_QUERY action

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #setQuery() › should dispatch the SET_MEDIA_QUERY action

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #setQuery() › should dispatch the SET_MEDIA_QUERY action

    TypeError: Cannot read property 'setQuery' of undefined

      89 | 	describe( '#setQuery()', () => {
      90 | 		test( 'should dispatch the SET_MEDIA_QUERY action', () => {
    > 91 | 			MediaActions.setQuery( DUMMY_SITE_ID, DUMMY_QUERY );
         | 			             ^
      92 | 
      93 | 			expect( Dispatcher.handleViewAction ).to.have.been.calledWithMatch( {
      94 | 				type: 'SET_MEDIA_QUERY',

      at Object.<anonymous> (client/lib/media/test/actions.js:91:17)

  ● MediaActions › #fetch() › should call to the WordPress.com REST API

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #fetch() › should call to the WordPress.com REST API

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #fetch() › should call to the WordPress.com REST API

    TypeError: Cannot read property 'fetch' of undefined

      109 | 				} );
      110 | 
    > 111 | 				MediaActions.fetch( DUMMY_SITE_ID, DUMMY_ITEM.ID );
          | 				             ^
      112 | 
      113 | 				expect( Dispatcher.handleViewAction ).to.have.been.calledOnce;
      114 | 				expect( stubs.mediaGet ).to.have.been.calledOn( [ DUMMY_SITE_ID, DUMMY_ITEM.ID ].join() );

      at client/lib/media/test/actions.js:111:18
      at Object.<anonymous> (client/lib/media/test/actions.js:103:11)

  ● MediaActions › #fetch() › should not allow simultaneous request for the same item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #fetch() › should not allow simultaneous request for the same item

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #fetch() › should not allow simultaneous request for the same item

    TypeError: Cannot read property 'fetch' of undefined

      127 | 
      128 | 		test( 'should not allow simultaneous request for the same item', () => {
    > 129 | 			MediaActions.fetch( DUMMY_SITE_ID, DUMMY_ITEM.ID );
          | 			             ^
      130 | 			MediaActions.fetch( DUMMY_SITE_ID, DUMMY_ITEM.ID );
      131 | 
      132 | 			expect( stubs.mediaGet ).to.have.been.calledOnce;

      at Object.<anonymous> (client/lib/media/test/actions.js:129:17)

  ● MediaActions › #fetch() › should allow simultaneous request for different items

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #fetch() › should allow simultaneous request for different items

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #fetch() › should allow simultaneous request for different items

    TypeError: Cannot read property 'fetch' of undefined

      134 | 
      135 | 		test( 'should allow simultaneous request for different items', () => {
    > 136 | 			MediaActions.fetch( DUMMY_SITE_ID, DUMMY_ITEM.ID );
          | 			             ^
      137 | 			MediaActions.fetch( DUMMY_SITE_ID, DUMMY_ITEM.ID + 1 );
      138 | 
      139 | 			expect( stubs.mediaGet ).to.have.been.calledTwice;

      at Object.<anonymous> (client/lib/media/test/actions.js:136:17)

  ● MediaActions › #fetchNextPage() › should call to the internal WordPress.com REST API

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #fetchNextPage() › should call to the internal WordPress.com REST API

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #fetchNextPage() › should call to the internal WordPress.com REST API

    TypeError: Cannot read property 'getNextPageQuery' of undefined

      144 | 		test( 'should call to the internal WordPress.com REST API', () => {
      145 | 			return new Promise( done => {
    > 146 | 				const query = MediaListStore.getNextPageQuery( DUMMY_SITE_ID );
          | 				                             ^
      147 | 
      148 | 				MediaActions.fetchNextPage( DUMMY_SITE_ID );
      149 | 

      at client/lib/media/test/actions.js:146:34
      at Object.<anonymous> (client/lib/media/test/actions.js:145:11)

  ● MediaActions › #fetchNextPage() › should call to the external WordPress.com REST API

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #fetchNextPage() › should call to the external WordPress.com REST API

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #fetchNextPage() › should call to the external WordPress.com REST API

    TypeError: Cannot read property '_activeQueries' of undefined

      165 | 		test( 'should call to the external WordPress.com REST API', () => {
      166 | 			return new Promise( done => {
    > 167 | 				MediaListStore._activeQueries[ DUMMY_SITE_ID ] = { query: { source: 'external' } };
          | 				               ^
      168 | 
      169 | 				const query = MediaListStore.getNextPageQuery( DUMMY_SITE_ID );
      170 | 

      at client/lib/media/test/actions.js:167:20
      at Object.<anonymous> (client/lib/media/test/actions.js:166:11)

  ● MediaActions › #add() › should accept a single upload

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #add() › should accept a single upload

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #add() › should accept a single upload

    TypeError: Cannot read property 'add' of undefined

      190 | 	describe( '#add()', () => {
      191 | 		test( 'should accept a single upload', () => {
    > 192 | 			return MediaActions.add( site, DUMMY_UPLOAD ).then( () => {
          | 			                    ^
      193 | 				expect( Dispatcher.handleViewAction ).to.have.been.calledOnce;
      194 | 				expect( Dispatcher.handleViewAction ).to.have.been.calledWithMatch( {
      195 | 					type: 'CREATE_MEDIA_ITEM',

      at Object.<anonymous> (client/lib/media/test/actions.js:192:24)

  ● MediaActions › #add() › should accept an array of uploads

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #add() › should accept an array of uploads

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #add() › should accept an array of uploads

    TypeError: Cannot read property 'add' of undefined

      199 | 
      200 | 		test( 'should accept an array of uploads', () => {
    > 201 | 			return MediaActions.add( site, [ DUMMY_UPLOAD, DUMMY_UPLOAD ] ).then( () => {
          | 			                    ^
      202 | 				expect( Dispatcher.handleViewAction ).to.have.been.calledTwice;
      203 | 				expect( Dispatcher.handleViewAction ).to.have.always.been.calledWithMatch( {
      204 | 					type: 'CREATE_MEDIA_ITEM',

      at Object.<anonymous> (client/lib/media/test/actions.js:201:24)

  ● MediaActions › #add() › should accept a file URL

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #add() › should accept a file URL

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #add() › should accept a file URL

    TypeError: Cannot read property 'add' of undefined

      208 | 
      209 | 		test( 'should accept a file URL', () => {
    > 210 | 			return MediaActions.add( site, DUMMY_URL ).then( () => {
          | 			                    ^
      211 | 				expect( stubs.mediaAddUrls ).to.have.been.calledWithMatch( {}, DUMMY_URL );
      212 | 			} );
      213 | 		} );

      at Object.<anonymous> (client/lib/media/test/actions.js:210:24)

  ● MediaActions › #add() › should accept a FileList of uploads

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #add() › should accept a FileList of uploads

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #add() › should accept a FileList of uploads

    TypeError: window.FileList is not a constructor

      215 | 		test( 'should accept a FileList of uploads', () => {
      216 | 			const uploads = [ DUMMY_UPLOAD, DUMMY_UPLOAD ];
    > 217 | 			uploads.__proto__ = new window.FileList(); // eslint-disable-line no-proto
          | 			                    ^
      218 | 			return MediaActions.add( site, uploads ).then( () => {
      219 | 				expect( Dispatcher.handleViewAction ).to.have.been.calledTwice;
      220 | 				expect( Dispatcher.handleViewAction ).to.have.always.been.calledWithMatch( {

      at Object.<anonymous> (client/lib/media/test/actions.js:217:24)

  ● MediaActions › #add() › should accept a Blob object wrapper and pass it as "file" parameter

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #add() › should accept a Blob object wrapper and pass it as "file" parameter

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #add() › should accept a Blob object wrapper and pass it as "file" parameter

    TypeError: Cannot read property 'add' of undefined

      225 | 
      226 | 		test( 'should accept a Blob object wrapper and pass it as "file" parameter', () => {
    > 227 | 			return MediaActions.add( site, DUMMY_BLOB_UPLOAD ).then( () => {
          | 			                    ^
      228 | 				expect( stubs.mediaAdd ).to.have.been.calledWithMatch( {}, { file: DUMMY_BLOB_UPLOAD } );
      229 | 				expect( Dispatcher.handleServerAction ).to.have.been.calledWithMatch( {
      230 | 					type: 'RECEIVE_MEDIA_ITEM',

      at Object.<anonymous> (client/lib/media/test/actions.js:227:24)

  ● MediaActions › #add() › should call to the WordPress.com REST API

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #add() › should call to the WordPress.com REST API

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #add() › should call to the WordPress.com REST API

    TypeError: Cannot read property 'add' of undefined

      237 | 
      238 | 		test( 'should call to the WordPress.com REST API', () => {
    > 239 | 			return MediaActions.add( site, DUMMY_UPLOAD ).then( () => {
          | 			                    ^
      240 | 				expect( stubs.mediaAdd ).to.have.been.calledWithMatch( {}, DUMMY_UPLOAD );
      241 | 				expect( Dispatcher.handleServerAction ).to.have.been.calledWithMatch( {
      242 | 					type: 'RECEIVE_MEDIA_ITEM',

      at Object.<anonymous> (client/lib/media/test/actions.js:239:24)

  ● MediaActions › #add() › should immediately receive a transient object

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #add() › should immediately receive a transient object

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #add() › should immediately receive a transient object

    TypeError: Cannot read property 'add' of undefined

      249 | 
      250 | 		test( 'should immediately receive a transient object', () => {
    > 251 | 			return MediaActions.add( site, DUMMY_UPLOAD ).then( () => {
          | 			                    ^
      252 | 				expect( Dispatcher.handleViewAction ).to.have.been.calledWithMatch( {
      253 | 					type: 'CREATE_MEDIA_ITEM',
      254 | 					data: {

      at Object.<anonymous> (client/lib/media/test/actions.js:251:24)

  ● MediaActions › #add() › should attach file upload to a post if one is being edited

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #add() › should attach file upload to a post if one is being edited

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #add() › should attach file upload to a post if one is being edited

    TypeError: Cannot read property 'add' of undefined

      264 | 			mockReduxPostId = 200;
      265 | 
    > 266 | 			return MediaActions.add( site, DUMMY_UPLOAD ).then( () => {
          | 			                    ^
      267 | 				expect( stubs.mediaAdd ).to.have.been.calledWithMatch(
      268 | 					{},
      269 | 					{

      at Object.<anonymous> (client/lib/media/test/actions.js:266:24)

  ● MediaActions › #add() › should attach URL upload to a post if one is being edited

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #add() › should attach URL upload to a post if one is being edited

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #add() › should attach URL upload to a post if one is being edited

    TypeError: Cannot read property 'add' of undefined

      278 | 			mockReduxPostId = 200;
      279 | 
    > 280 | 			return MediaActions.add( site, DUMMY_URL ).then( () => {
          | 			                    ^
      281 | 				expect( stubs.mediaAddUrls ).to.have.been.calledWithMatch(
      282 | 					{},
      283 | 					{

      at Object.<anonymous> (client/lib/media/test/actions.js:280:24)

  ● MediaActions › #add() › should upload in series

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #add() › should upload in series

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #add() › should upload in series

    TypeError: Cannot read property 'add' of undefined

      296 | 			sandbox.stub( Dispatcher, 'handleServerAction' ).throws();
      297 | 
    > 298 | 			return MediaActions.add( site, [ DUMMY_UPLOAD, DUMMY_UPLOAD ] )
          | 			                    ^
      299 | 				.then( () => {
      300 | 					expect( Dispatcher.handleServerAction ).to.have.thrown;
      301 | 				} )

      at Object.<anonymous> (client/lib/media/test/actions.js:298:24)

  ● MediaActions › #addExternal() › should accept an upload

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #addExternal() › should accept an upload

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #addExternal() › should accept an upload

    TypeError: Cannot read property 'addExternal' of undefined

      308 | 	describe( '#addExternal()', () => {
      309 | 		test( 'should accept an upload', () => {
    > 310 | 			return MediaActions.addExternal( site, [ DUMMY_UPLOAD ], 'external' ).then( () => {
          | 			                    ^
      311 | 				expect( stubs.mediaAddExternal ).to.have.been.calledWithMatch( 'external', [
      312 | 					DUMMY_UPLOAD.guid,
      313 | 				] );

      at Object.<anonymous> (client/lib/media/test/actions.js:310:24)

  ● MediaActions › #edit() › should immediately edit the existing item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #edit() › should immediately edit the existing item

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #edit() › should immediately edit the existing item

    TypeError: Cannot read property 'edit' of undefined

      326 | 
      327 | 		test( 'should immediately edit the existing item', () => {
    > 328 | 			MediaActions.edit( DUMMY_SITE_ID, item );
          | 			             ^
      329 | 
      330 | 			expect( Dispatcher.handleViewAction ).to.have.been.calledWithMatch( {
      331 | 				type: 'RECEIVE_MEDIA_ITEM',

      at Object.<anonymous> (client/lib/media/test/actions.js:328:17)

  ● MediaActions › #update() › should accept a single item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #update() › should accept a single item

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #update() › should accept a single item

    TypeError: Cannot read property 'update' of undefined

      340 | 
      341 | 		test( 'should accept a single item', () => {
    > 342 | 			MediaActions.update( DUMMY_SITE_ID, item );
          | 			             ^
      343 | 			expect( stubs.mediaUpdate ).to.have.been.calledOnce;
      344 | 		} );
      345 | 

      at Object.<anonymous> (client/lib/media/test/actions.js:342:17)

  ● MediaActions › #update() › should accept an array of items

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #update() › should accept an array of items

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #update() › should accept an array of items

    TypeError: Cannot read property 'update' of undefined

      345 | 
      346 | 		test( 'should accept an array of items', () => {
    > 347 | 			MediaActions.update( DUMMY_SITE_ID, [ item, item ] );
          | 			             ^
      348 | 			expect( stubs.mediaUpdate ).to.have.been.calledTwice;
      349 | 		} );
      350 | 

      at Object.<anonymous> (client/lib/media/test/actions.js:347:17)

  ● MediaActions › #update() › should immediately update the existing item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #update() › should immediately update the existing item

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #update() › should immediately update the existing item

    TypeError: Cannot read property 'update' of undefined

      350 | 
      351 | 		test( 'should immediately update the existing item', () => {
    > 352 | 			MediaActions.update( DUMMY_SITE_ID, item );
          | 			             ^
      353 | 
      354 | 			expect( stubs.mediaUpdate ).to.have.been.calledWithMatch( item );
      355 | 			expect( Dispatcher.handleViewAction ).to.have.been.calledWithMatch( {

      at Object.<anonymous> (client/lib/media/test/actions.js:352:17)

  ● MediaActions › #update() › should call to the WordPress.com REST API

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #update() › should call to the WordPress.com REST API

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #update() › should call to the WordPress.com REST API

    TypeError: Cannot read property 'update' of undefined

      362 | 		test( 'should call to the WordPress.com REST API', () => {
      363 | 			return new Promise( done => {
    > 364 | 				MediaActions.update( DUMMY_SITE_ID, item );
          | 				             ^
      365 | 
      366 | 				expect( stubs.mediaUpdate ).to.have.been.calledWithMatch( item );
      367 | 

      at client/lib/media/test/actions.js:364:18
      at Object.<anonymous> (client/lib/media/test/actions.js:363:11)

  ● MediaActions › #delete() › should accept a single item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #delete() › should accept a single item

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #delete() › should accept a single item

    TypeError: Cannot read property 'delete' of undefined

      384 | 
      385 | 		test( 'should accept a single item', () => {
    > 386 | 			MediaActions.delete( DUMMY_SITE_ID, item );
          | 			             ^
      387 | 			expect( stubs.mediaDelete ).to.have.been.calledOnce;
      388 | 		} );
      389 | 

      at Object.<anonymous> (client/lib/media/test/actions.js:386:17)

  ● MediaActions › #delete() › should accept an array of items

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #delete() › should accept an array of items

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #delete() › should accept an array of items

    TypeError: Cannot read property 'delete' of undefined

      389 | 
      390 | 		test( 'should accept an array of items', () => {
    > 391 | 			MediaActions.delete( DUMMY_SITE_ID, [ item, item ] );
          | 			             ^
      392 | 			expect( stubs.mediaDelete ).to.have.been.calledTwice;
      393 | 		} );
      394 | 

      at Object.<anonymous> (client/lib/media/test/actions.js:391:17)

  ● MediaActions › #delete() › should call to the WordPress.com REST API

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #delete() › should call to the WordPress.com REST API

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #delete() › should call to the WordPress.com REST API

    TypeError: Cannot read property 'delete' of undefined

      395 | 		test( 'should call to the WordPress.com REST API', () => {
      396 | 			return new Promise( done => {
    > 397 | 				MediaActions.delete( DUMMY_SITE_ID, item );
          | 				             ^
      398 | 
      399 | 				expect( stubs.mediaDelete ).to.have.been.calledOn( [ DUMMY_SITE_ID, item.ID ].join() );
      400 | 				process.nextTick( function() {

      at client/lib/media/test/actions.js:397:18
      at Object.<anonymous> (client/lib/media/test/actions.js:396:11)

  ● MediaActions › #delete() › should immediately remove the item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #delete() › should immediately remove the item

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #delete() › should immediately remove the item

    TypeError: Cannot read property 'delete' of undefined

      412 | 
      413 | 		test( 'should immediately remove the item', () => {
    > 414 | 			MediaActions.delete( DUMMY_SITE_ID, item );
          | 			             ^
      415 | 
      416 | 			expect( Dispatcher.handleViewAction ).to.have.been.calledWithMatch( {
      417 | 				type: 'REMOVE_MEDIA_ITEM',

      at Object.<anonymous> (client/lib/media/test/actions.js:414:17)

  ● MediaActions › #clearValidationErrors() › should dispatch the `CLEAR_MEDIA_VALIDATION_ERRORS` action with the specified siteId

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #clearValidationErrors() › should dispatch the `CLEAR_MEDIA_VALIDATION_ERRORS` action with the specified siteId

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #clearValidationErrors() › should dispatch the `CLEAR_MEDIA_VALIDATION_ERRORS` action with the specified siteId

    TypeError: Cannot read property 'clearValidationErrors' of undefined

      424 | 	describe( '#clearValidationErrors()', () => {
      425 | 		test( 'should dispatch the `CLEAR_MEDIA_VALIDATION_ERRORS` action with the specified siteId', () => {
    > 426 | 			MediaActions.clearValidationErrors( DUMMY_SITE_ID );
          | 			             ^
      427 | 
      428 | 			expect( Dispatcher.handleViewAction ).to.have.been.calledWithMatch( {
      429 | 				type: 'CLEAR_MEDIA_VALIDATION_ERRORS',

      at Object.<anonymous> (client/lib/media/test/actions.js:426:17)

  ● MediaActions › #clearValidationErrors() › should dispatch the `CLEAR_MEDIA_VALIDATION_ERRORS` action with the specified siteId and itemId

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #clearValidationErrors() › should dispatch the `CLEAR_MEDIA_VALIDATION_ERRORS` action with the specified siteId and itemId

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #clearValidationErrors() › should dispatch the `CLEAR_MEDIA_VALIDATION_ERRORS` action with the specified siteId and itemId

    TypeError: Cannot read property 'clearValidationErrors' of undefined

      434 | 
      435 | 		test( 'should dispatch the `CLEAR_MEDIA_VALIDATION_ERRORS` action with the specified siteId and itemId', () => {
    > 436 | 			MediaActions.clearValidationErrors( DUMMY_SITE_ID, DUMMY_ITEM.ID );
          | 			             ^
      437 | 
      438 | 			expect( Dispatcher.handleViewAction ).to.have.been.calledWithMatch( {
      439 | 				type: 'CLEAR_MEDIA_VALIDATION_ERRORS',

      at Object.<anonymous> (client/lib/media/test/actions.js:436:17)

  ● MediaActions › #sourceChanged() › should dispatch the `CHANGE_MEDIA_SOURCE` action with the specified siteId

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/list-store.js:12:1)
      at Object.<anonymous> (client/lib/media/test/actions.js:59:20)

  ● MediaActions › #sourceChanged() › should dispatch the `CHANGE_MEDIA_SOURCE` action with the specified siteId

    TypeError: Cannot set property '_fetching' of undefined

      73 | 		sandbox.stub( stubs, 'mediaUpdate' ).callsArgWithAsync( 1, null, DUMMY_API_RESPONSE );
      74 | 		sandbox.stub( stubs, 'mediaDelete' ).callsArgWithAsync( 0, null, DUMMY_API_RESPONSE );
    > 75 | 		MediaActions._fetching = {};
         | 		^
      76 | 		window.FileList = function() {};
      77 | 		window.FileList.prototype[ Symbol.iterator ] = Array.prototype[ Symbol.iterator ];
      78 | 		savedCreateObjectURL = window.URL.createObjectURL;

      at Object.<anonymous> (client/lib/media/test/actions.js:75:3)

  ● MediaActions › #sourceChanged() › should dispatch the `CHANGE_MEDIA_SOURCE` action with the specified siteId

    TypeError: Cannot read property 'sourceChanged' of undefined

      446 | 	describe( '#sourceChanged()', () => {
      447 | 		test( 'should dispatch the `CHANGE_MEDIA_SOURCE` action with the specified siteId', () => {
    > 448 | 			MediaActions.sourceChanged( DUMMY_SITE_ID );
          | 			             ^
      449 | 
      450 | 			expect( Dispatcher.handleViewAction ).to.have.been.calledWithMatch( {
      451 | 				type: 'CHANGE_MEDIA_SOURCE',

      at Object.<anonymous> (client/lib/media/test/actions.js:448:17)

FAIL client/components/accordion/test/index.jsx
  ● Accordion › should render as expected with a title but no content when initially closed

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:16:15)

  ● Accordion › should render as expected with a title but no content when initially closed

    TypeError: Cannot read property 'contextTypes' of undefined

      19 | 
      20 | 	test( 'should render as expected with a title but no content when initially closed', () => {
    > 21 | 		const wrapper = shallow( <Accordion title="Section">Content</Accordion> );
         | 		                ^
      22 | 
      23 | 		expect( wrapper.hasClass( 'accordion' ) ).toBe( true );
      24 | 		expect( wrapper.state( 'isExpanded' ) ).toBe( false );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:21:19)

  ● Accordion › should accept an icon prop to be rendered

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:16:15)

  ● Accordion › should accept an icon prop to be rendered

    TypeError: Cannot read property 'contextTypes' of undefined

      34 | 
      35 | 	test( 'should accept an icon prop to be rendered', () => {
    > 36 | 		const wrapper = shallow(
         | 		                ^
      37 | 			<Accordion title="Section" icon={ <Gridicon icon="time" /> }>
      38 | 				Content
      39 | 			</Accordion>

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:36:19)

  ● Accordion › should accept a subtitle prop to be rendered aside the title

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:16:15)

  ● Accordion › should accept a subtitle prop to be rendered aside the title

    TypeError: Cannot read property 'contextTypes' of undefined

      45 | 
      46 | 	test( 'should accept a subtitle prop to be rendered aside the title', () => {
    > 47 | 		const wrapper = shallow(
         | 		                ^
      48 | 			<Accordion title="Section" subtitle="Subtitle">
      49 | 				Content
      50 | 			</Accordion>

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:47:19)

  ● Accordion › should accept a status prop to be rendered in the toggle

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:16:15)

  ● Accordion › should accept a status prop to be rendered in the toggle

    TypeError: Cannot read property 'contextTypes' of undefined

      63 | 			onClick() {},
      64 | 		};
    > 65 | 		const wrapper = shallow(
         | 		                ^
      66 | 			<Accordion title="Section" status={ status }>
      67 | 				Content
      68 | 			</Accordion>

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:65:19)

  ● Accordion › events › should toggle when clicked

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:16:15)

  ● Accordion › events › should toggle when clicked

    TypeError: Cannot read property 'contextTypes' of undefined

      79 | 
      80 | 		test( 'should toggle when clicked', () => {
    > 81 | 			const wrapper = shallow( <Accordion title="Section">Content</Accordion> );
         | 			                ^
      82 | 
      83 | 			simulateClick( wrapper );
      84 | 

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:81:20)

  ● Accordion › events › should accept an onToggle function handler to be invoked when toggled

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:16:15)

  ● Accordion › events › should accept an onToggle function handler to be invoked when toggled

    TypeError: Cannot read property 'contextTypes' of undefined

      90 | 		test( 'should accept an onToggle function handler to be invoked when toggled', () => {
      91 | 			const toggleSpy = jest.fn();
    > 92 | 			const wrapper = shallow(
         | 			                ^
      93 | 				<Accordion title="Section" onToggle={ toggleSpy }>
      94 | 					Content
      95 | 				</Accordion>

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:92:20)

  ● Accordion › events › should always use the initialExpanded prop, if specified

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:16:15)

  ● Accordion › events › should always use the initialExpanded prop, if specified

    TypeError: Cannot read property 'contextTypes' of undefined

      105 | 		test( 'should always use the initialExpanded prop, if specified', () => {
      106 | 			const toggleSpy = jest.fn();
    > 107 | 			const wrapper = shallow(
          | 			                ^
      108 | 				<Accordion initialExpanded={ true } title="Section" onToggle={ toggleSpy }>
      109 | 					Content
      110 | 				</Accordion>

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:107:20)

  ● Accordion › events › should render content when initially open

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:16:15)

  ● Accordion › events › should render content when initially open

    TypeError: Cannot read property 'contextTypes' of undefined

      119 | 
      120 | 		test( 'should render content when initially open', () => {
    > 121 | 			const wrapper = shallow(
          | 			                ^
      122 | 				<Accordion initialExpanded={ true } title="Section">
      123 | 					Content
      124 | 				</Accordion>

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:121:20)

  ● Accordion › events › should render content when forced

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:16:15)

  ● Accordion › events › should render content when forced

    TypeError: Cannot read property 'contextTypes' of undefined

      130 | 
      131 | 		test( 'should render content when forced', () => {
    > 132 | 			const wrapper = shallow( <Accordion title="Section">Content</Accordion> );
          | 			                ^
      133 | 			expect( wrapper.state( 'isExpanded' ) ).toBe( false );
      134 | 			expect( wrapper.state( 'hasExpanded' ) ).toBe( false );
      135 | 			expect( wrapper.find( '.accordion__content' ) ).toHaveLength( 0 );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/index.jsx:132:20)

FAIL client/lib/media/test/validation-store.js
  ● MediaValidationStore › #validateItem() › should have no effect for a valid file

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #validateItem() › should have no effect for a valid file

    TypeError: Cannot read property 'validateItem' of undefined

       97 | 
       98 | 		beforeAll( function() {
    >  99 | 			validateItem = MediaValidationStore.validateItem;
          | 			                                    ^
      100 | 		} );
      101 | 
      102 | 		test( 'should have no effect for a valid file', () => {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:99:40)

  ● MediaValidationStore › #validateItem() › should have no effect for a valid file

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #validateItem() › should have no effect for a valid file

    TypeError: validateItem is not a function

      101 | 
      102 | 		test( 'should have no effect for a valid file', () => {
    > 103 | 			validateItem( site, Object.assign( {}, DUMMY_MEDIA_OBJECT, { extension: 'gif' } ) );
          | 			^
      104 | 
      105 | 			expect( MediaValidationStore._errors ).to.eql( {} );
      106 | 		} );

      at Object.<anonymous> (client/lib/media/test/validation-store.js:103:4)

  ● MediaValidationStore › #validateItem() › should set an error array for an invalid file

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #validateItem() › should set an error array for an invalid file

    TypeError: Cannot read property 'validateItem' of undefined

       97 | 
       98 | 		beforeAll( function() {
    >  99 | 			validateItem = MediaValidationStore.validateItem;
          | 			                                    ^
      100 | 		} );
      101 | 
      102 | 		test( 'should have no effect for a valid file', () => {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:99:40)

  ● MediaValidationStore › #validateItem() › should set an error array for an invalid file

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #validateItem() › should set an error array for an invalid file

    TypeError: validateItem is not a function

      107 | 
      108 | 		test( 'should set an error array for an invalid file', () => {
    > 109 | 			validateItem( site, DUMMY_MEDIA_OBJECT );
          | 			^
      110 | 
      111 | 			expect( MediaValidationStore._errors ).to.eql( {
      112 | 				[ DUMMY_SITE_ID ]: {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:109:4)

  ● MediaValidationStore › #validateItem() › should set an error array for a file exceeding acceptable size

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #validateItem() › should set an error array for a file exceeding acceptable size

    TypeError: Cannot read property 'validateItem' of undefined

       97 | 
       98 | 		beforeAll( function() {
    >  99 | 			validateItem = MediaValidationStore.validateItem;
          | 			                                    ^
      100 | 		} );
      101 | 
      102 | 		test( 'should have no effect for a valid file', () => {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:99:40)

  ● MediaValidationStore › #validateItem() › should set an error array for a file exceeding acceptable size

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #validateItem() › should set an error array for a file exceeding acceptable size

    TypeError: validateItem is not a function

      117 | 
      118 | 		test( 'should set an error array for a file exceeding acceptable size', () => {
    > 119 | 			validateItem(
          | 			^
      120 | 				site,
      121 | 				Object.assign( {}, DUMMY_MEDIA_OBJECT, { size: 2048, extension: 'gif' } )
      122 | 			);

      at Object.<anonymous> (client/lib/media/test/validation-store.js:119:4)

  ● MediaValidationStore › #validateItem() › should accumulate multiple validation errors

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #validateItem() › should accumulate multiple validation errors

    TypeError: Cannot read property 'validateItem' of undefined

       97 | 
       98 | 		beforeAll( function() {
    >  99 | 			validateItem = MediaValidationStore.validateItem;
          | 			                                    ^
      100 | 		} );
      101 | 
      102 | 		test( 'should have no effect for a valid file', () => {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:99:40)

  ● MediaValidationStore › #validateItem() › should accumulate multiple validation errors

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #validateItem() › should accumulate multiple validation errors

    TypeError: validateItem is not a function

      130 | 
      131 | 		test( 'should accumulate multiple validation errors', () => {
    > 132 | 			validateItem( site, Object.assign( {}, DUMMY_MEDIA_OBJECT, { size: 2048 } ) );
          | 			^
      133 | 
      134 | 			expect( MediaValidationStore._errors ).to.eql( {
      135 | 				[ DUMMY_SITE_ID ]: {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:132:4)

  ● MediaValidationStore › #clearValidationErrors() › should remove validation errors for a single item on a given site

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #clearValidationErrors() › should remove validation errors for a single item on a given site

    TypeError: Cannot read property 'clearValidationErrors' of undefined

      147 | 
      148 | 		beforeAll( function() {
    > 149 | 			clearValidationErrors = MediaValidationStore.clearValidationErrors;
          | 			                                             ^
      150 | 		} );
      151 | 
      152 | 		test( 'should remove validation errors for a single item on a given site', () => {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:149:49)

  ● MediaValidationStore › #clearValidationErrors() › should remove validation errors for a single item on a given site

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #clearValidationErrors() › should remove validation errors for a single item on a given site

    TypeError: handler is not a function

      56 | 
      57 | 	function dispatchCreateMediaItem( action ) {
    > 58 | 		handler( {
         | 		^
      59 | 			action: assign(
      60 | 				{
      61 | 					type: 'CREATE_MEDIA_ITEM',

      at dispatchCreateMediaItem (client/lib/media/test/validation-store.js:58:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:153:4)

  ● MediaValidationStore › #clearValidationErrors() › should remove all validation errors on a site if no item is specified

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #clearValidationErrors() › should remove all validation errors on a site if no item is specified

    TypeError: Cannot read property 'clearValidationErrors' of undefined

      147 | 
      148 | 		beforeAll( function() {
    > 149 | 			clearValidationErrors = MediaValidationStore.clearValidationErrors;
          | 			                                             ^
      150 | 		} );
      151 | 
      152 | 		test( 'should remove validation errors for a single item on a given site', () => {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:149:49)

  ● MediaValidationStore › #clearValidationErrors() › should remove all validation errors on a site if no item is specified

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #clearValidationErrors() › should remove all validation errors on a site if no item is specified

    TypeError: handler is not a function

      56 | 
      57 | 	function dispatchCreateMediaItem( action ) {
    > 58 | 		handler( {
         | 		^
      59 | 			action: assign(
      60 | 				{
      61 | 					type: 'CREATE_MEDIA_ITEM',

      at dispatchCreateMediaItem (client/lib/media/test/validation-store.js:58:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:163:4)

  ● MediaValidationStore › #clearValidationErrorsByType › should remove errors for all items containing that error type on a given site

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #clearValidationErrorsByType › should remove errors for all items containing that error type on a given site

    TypeError: Cannot read property 'clearValidationErrorsByType' of undefined

      173 | 
      174 | 		beforeAll( function() {
    > 175 | 			clearValidationErrorsByType = MediaValidationStore.clearValidationErrorsByType;
          | 			                                                   ^
      176 | 		} );
      177 | 
      178 | 		test( 'should remove errors for all items containing that error type on a given site', () => {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:175:55)

  ● MediaValidationStore › #clearValidationErrorsByType › should remove errors for all items containing that error type on a given site

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #clearValidationErrorsByType › should remove errors for all items containing that error type on a given site

    TypeError: handler is not a function

      56 | 
      57 | 	function dispatchCreateMediaItem( action ) {
    > 58 | 		handler( {
         | 		^
      59 | 			action: assign(
      60 | 				{
      61 | 					type: 'CREATE_MEDIA_ITEM',

      at dispatchCreateMediaItem (client/lib/media/test/validation-store.js:58:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:179:4)

  ● MediaValidationStore › #getAllErrors() › should return an empty object when no errors exist

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #getAllErrors() › should return an empty object when no errors exist

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #getAllErrors() › should return an empty object when no errors exist

    TypeError: Cannot read property 'getAllErrors' of undefined

      196 | 	describe( '#getAllErrors()', () => {
      197 | 		test( 'should return an empty object when no errors exist', () => {
    > 198 | 			const errors = MediaValidationStore.getAllErrors( DUMMY_SITE_ID );
          | 			                                    ^
      199 | 
      200 | 			expect( errors ).to.eql( {} );
      201 | 		} );

      at Object.<anonymous> (client/lib/media/test/validation-store.js:198:40)

  ● MediaValidationStore › #getAllErrors() › should return an object of errors

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #getAllErrors() › should return an object of errors

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #getAllErrors() › should return an object of errors

    TypeError: handler is not a function

      56 | 
      57 | 	function dispatchCreateMediaItem( action ) {
    > 58 | 		handler( {
         | 		^
      59 | 			action: assign(
      60 | 				{
      61 | 					type: 'CREATE_MEDIA_ITEM',

      at dispatchCreateMediaItem (client/lib/media/test/validation-store.js:58:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:204:4)

  ● MediaValidationStore › #getErrors() › should return an empty array when no errors exist

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #getErrors() › should return an empty array when no errors exist

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #getErrors() › should return an empty array when no errors exist

    TypeError: Cannot read property 'getErrors' of undefined

      213 | 	describe( '#getErrors()', () => {
      214 | 		test( 'should return an empty array when no errors exist', () => {
    > 215 | 			const errors = MediaValidationStore.getErrors( DUMMY_SITE_ID, DUMMY_MEDIA_OBJECT.ID );
          | 			                                    ^
      216 | 
      217 | 			expect( errors ).to.be.an.instanceof( Array );
      218 | 			expect( errors ).to.be.empty;

      at Object.<anonymous> (client/lib/media/test/validation-store.js:215:40)

  ● MediaValidationStore › #getErrors() › should return an array of errors

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › #getErrors() › should return an array of errors

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › #getErrors() › should return an array of errors

    TypeError: handler is not a function

      56 | 
      57 | 	function dispatchCreateMediaItem( action ) {
    > 58 | 		handler( {
         | 		^
      59 | 			action: assign(
      60 | 				{
      61 | 					type: 'CREATE_MEDIA_ITEM',

      at dispatchCreateMediaItem (client/lib/media/test/validation-store.js:58:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:222:4)

  ● MediaValidationStore › .dispatchToken › should expose its dispatcher ID

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should expose its dispatcher ID

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should expose its dispatcher ID

    TypeError: Cannot read property 'dispatchToken' of undefined

      229 | 	describe( '.dispatchToken', () => {
      230 | 		test( 'should expose its dispatcher ID', () => {
    > 231 | 			expect( MediaValidationStore.dispatchToken ).to.not.be.undefined;
          | 			                             ^
      232 | 		} );
      233 | 
      234 | 		test( 'should emit a change event when receiving an item with an error', done => {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:231:33)

  ● MediaValidationStore › .dispatchToken › should emit a change event when receiving an item with an error

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should emit a change event when receiving an item with an error

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should emit a change event when receiving an item with an error

    TypeError: Cannot read property 'once' of undefined

      233 | 
      234 | 		test( 'should emit a change event when receiving an item with an error', done => {
    > 235 | 			MediaValidationStore.once( 'change', done );
          | 			                     ^
      236 | 
      237 | 			dispatchCreateMediaItem();
      238 | 		} );

      at Object.<anonymous> (client/lib/media/test/validation-store.js:235:25)

  ● MediaValidationStore › .dispatchToken › should emit a change event when clearing validation errors

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should emit a change event when clearing validation errors

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should emit a change event when clearing validation errors

    TypeError: Cannot read property 'once' of undefined

      239 | 
      240 | 		test( 'should emit a change event when clearing validation errors', done => {
    > 241 | 			MediaValidationStore.once( 'change', done );
          | 			                     ^
      242 | 
      243 | 			dispatchClearMediaValidationErrors();
      244 | 		} );

      at Object.<anonymous> (client/lib/media/test/validation-store.js:241:25)

  ● MediaValidationStore › .dispatchToken › should detect a 404 error from received item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should detect a 404 error from received item

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should detect a 404 error from received item

    TypeError: handler is not a function

      70 | 
      71 | 	function dispatchReceiveMediaItem( action ) {
    > 72 | 		handler( {
         | 		^
      73 | 			action: assign(
      74 | 				{
      75 | 					type: 'RECEIVE_MEDIA_ITEM',

      at dispatchReceiveMediaItem (client/lib/media/test/validation-store.js:72:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:247:4)

  ● MediaValidationStore › .dispatchToken › should detect a not enough space error from received item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should detect a not enough space error from received item

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should detect a not enough space error from received item

    TypeError: handler is not a function

      70 | 
      71 | 	function dispatchReceiveMediaItem( action ) {
    > 72 | 		handler( {
         | 		^
      73 | 			action: assign(
      74 | 				{
      75 | 					type: 'RECEIVE_MEDIA_ITEM',

      at dispatchReceiveMediaItem (client/lib/media/test/validation-store.js:72:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:265:4)

  ● MediaValidationStore › .dispatchToken › should detect an exceeds plan storage limit error from received item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should detect an exceeds plan storage limit error from received item

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should detect an exceeds plan storage limit error from received item

    TypeError: handler is not a function

      70 | 
      71 | 	function dispatchReceiveMediaItem( action ) {
    > 72 | 		handler( {
         | 		^
      73 | 			action: assign(
      74 | 				{
      75 | 					type: 'RECEIVE_MEDIA_ITEM',

      at dispatchReceiveMediaItem (client/lib/media/test/validation-store.js:72:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:283:4)

  ● MediaValidationStore › .dispatchToken › should detect general server error from received item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should detect general server error from received item

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should detect general server error from received item

    TypeError: handler is not a function

      70 | 
      71 | 	function dispatchReceiveMediaItem( action ) {
    > 72 | 		handler( {
         | 		^
      73 | 			action: assign(
      74 | 				{
      75 | 					type: 'RECEIVE_MEDIA_ITEM',

      at dispatchReceiveMediaItem (client/lib/media/test/validation-store.js:72:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:301:4)

  ● MediaValidationStore › .dispatchToken › should set errors into the action object explicitly

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should set errors into the action object explicitly

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should set errors into the action object explicitly

    TypeError: handler is not a function

      315 | 			};
      316 | 
    > 317 | 			handler( { action } );
          | 			^
      318 | 
      319 | 			expect( action.error ).to.eql( {
      320 | 				[ DUMMY_MEDIA_OBJECT.ID ]: [ MediaValidationErrors.FILE_TYPE_UNSUPPORTED ],

      at Object.<anonymous> (client/lib/media/test/validation-store.js:317:4)

  ● MediaValidationStore › .dispatchToken › should preserve existing errors when detecting a new one

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should preserve existing errors when detecting a new one

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should preserve existing errors when detecting a new one

    TypeError: handler is not a function

      331 | 			};
      332 | 
    > 333 | 			handler( {
          | 			^
      334 | 				action: {
      335 | 					type: 'CREATE_MEDIA_ITEM',
      336 | 					siteId: DUMMY_SITE_ID,

      at Object.<anonymous> (client/lib/media/test/validation-store.js:333:4)

  ● MediaValidationStore › .dispatchToken › should detect an external media error and set error on item ERROR_GLOBAL_ITEM_ID

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should detect an external media error and set error on item ERROR_GLOBAL_ITEM_ID

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should detect an external media error and set error on item ERROR_GLOBAL_ITEM_ID

    TypeError: handler is not a function

      43 | 
      44 | 	function dispatchError( error ) {
    > 45 | 		handler( {
         | 		^
      46 | 			action: {
      47 | 				type: 'RECEIVE_MEDIA_ITEM',
      48 | 				siteId: DUMMY_SITE_ID,

      at dispatchError (client/lib/media/test/validation-store.js:45:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:351:4)

  ● MediaValidationStore › .dispatchToken › should detect an expired auth token and set error on item ERROR_GLOBAL_ITEM_ID

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should detect an expired auth token and set error on item ERROR_GLOBAL_ITEM_ID

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should detect an expired auth token and set error on item ERROR_GLOBAL_ITEM_ID

    TypeError: handler is not a function

      43 | 
      44 | 	function dispatchError( error ) {
    > 45 | 		handler( {
         | 		^
      46 | 			action: {
      47 | 				type: 'RECEIVE_MEDIA_ITEM',
      48 | 				siteId: DUMMY_SITE_ID,

      at dispatchError (client/lib/media/test/validation-store.js:45:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:359:4)

  ● MediaValidationStore › .dispatchToken › should require an action ID for all errors other than external media

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should require an action ID for all errors other than external media

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should require an action ID for all errors other than external media

    TypeError: handler is not a function

      43 | 
      44 | 	function dispatchError( error ) {
    > 45 | 		handler( {
         | 		^
      46 | 			action: {
      47 | 				type: 'RECEIVE_MEDIA_ITEM',
      48 | 				siteId: DUMMY_SITE_ID,

      at dispatchError (client/lib/media/test/validation-store.js:45:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:367:4)

  ● MediaValidationStore › .dispatchToken › should remove all validation errors when changing the data source

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● MediaValidationStore › .dispatchToken › should remove all validation errors when changing the data source

    TypeError: Cannot set property '_errors' of undefined

      35 | 
      36 | 	beforeEach( () => {
    > 37 | 		MediaValidationStore._errors = {};
         | 		^
      38 | 	} );
      39 | 
      40 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/validation-store.js:37:3)

  ● MediaValidationStore › .dispatchToken › should remove all validation errors when changing the data source

    TypeError: handler is not a function

      43 | 
      44 | 	function dispatchError( error ) {
    > 45 | 		handler( {
         | 		^
      46 | 			action: {
      47 | 				type: 'RECEIVE_MEDIA_ITEM',
      48 | 				siteId: DUMMY_SITE_ID,

      at dispatchError (client/lib/media/test/validation-store.js:45:3)
      at Object.<anonymous> (client/lib/media/test/validation-store.js:375:4)

FAIL client/blocks/edit-gravatar/test/index.jsx
  ● EditGravatar › component rendering › displays a Gravatar

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/edit-gravatar/index.jsx:17:1)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:40:18)

  ● EditGravatar › component rendering › displays a Gravatar

    TypeError: Cannot read property 'contextTypes' of undefined

      48 | 	describe( 'component rendering', () => {
      49 | 		test( 'displays a Gravatar', () => {
    > 50 | 			const wrapper = shallow( <EditGravatar translate={ noop } user={ user } /> );
         | 			                ^
      51 | 			expect( wrapper.find( Gravatar ).length ).to.equal( 1 );
      52 | 		} );
      53 | 

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:50:20)

  ● EditGravatar › component rendering › contains a file picker that accepts images

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/edit-gravatar/index.jsx:17:1)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:40:18)

  ● EditGravatar › component rendering › contains a file picker that accepts images

    TypeError: Cannot read property 'contextTypes' of undefined

      53 | 
      54 | 		test( 'contains a file picker that accepts images', () => {
    > 55 | 			const wrapper = shallow( <EditGravatar translate={ noop } user={ user } /> );
         | 			                ^
      56 | 			const filePicker = wrapper.find( FilePicker );
      57 | 			expect( filePicker.length ).to.equal( 1 );
      58 | 			expect( filePicker.prop( 'accept' ) ).to.equal( 'image/*' );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:55:20)

  ● EditGravatar › component rendering › does not display the image editor by default

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/edit-gravatar/index.jsx:17:1)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:40:18)

  ● EditGravatar › component rendering › does not display the image editor by default

    TypeError: Cannot read property 'contextTypes' of undefined

      60 | 
      61 | 		test( 'does not display the image editor by default', () => {
    > 62 | 			const wrapper = shallow( <EditGravatar translate={ noop } user={ user } /> );
         | 			                ^
      63 | 			expect( wrapper.find( ImageEditor ).length ).to.equal( 0 );
      64 | 		} );
      65 | 

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:62:20)

  ● EditGravatar › component rendering › drag and drop › does not contain a drop zone for unverified users

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/edit-gravatar/index.jsx:17:1)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:40:18)

  ● EditGravatar › component rendering › drag and drop › does not contain a drop zone for unverified users

    TypeError: Cannot read property 'contextTypes' of undefined

      66 | 		describe( 'drag and drop', () => {
      67 | 			test( 'does not contain a drop zone for unverified users', () => {
    > 68 | 				const wrapper = shallow(
         | 				                ^
      69 | 					<EditGravatar
      70 | 						translate={ noop }
      71 | 						user={ {

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:68:21)

  ● EditGravatar › component rendering › drag and drop › contains a drop zone for verified users

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/edit-gravatar/index.jsx:17:1)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:40:18)

  ● EditGravatar › component rendering › drag and drop › contains a drop zone for verified users

    TypeError: Cannot read property 'contextTypes' of undefined

      78 | 
      79 | 			test( 'contains a drop zone for verified users', () => {
    > 80 | 				const wrapper = shallow(
         | 				                ^
      81 | 					<EditGravatar
      82 | 						translate={ noop }
      83 | 						user={ {

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:80:21)

  ● EditGravatar › getting a file from user › accepted file type › displays the image editor with square allowed aspect ratio

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/edit-gravatar/index.jsx:17:1)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:40:18)

  ● EditGravatar › getting a file from user › accepted file type › displays the image editor with square allowed aspect ratio

    TypeError: Cannot read property 'contextTypes' of undefined

      94 | 		describe( 'accepted file type', () => {
      95 | 			test( 'displays the image editor with square allowed aspect ratio', () => {
    > 96 | 				const wrapper = shallow(
         | 				                ^
      97 | 					<EditGravatar translate={ noop } user={ user } recordReceiveImageEvent={ noop } />
      98 | 				);
      99 | 				const files = [

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:96:21)

  ● EditGravatar › getting a file from user › bad file type › does not display editor, and calls error action creator

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/edit-gravatar/index.jsx:17:1)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:40:18)

  ● EditGravatar › getting a file from user › bad file type › does not display editor, and calls error action creator

    TypeError: Cannot read property 'contextTypes' of undefined

      116 | 			test( 'does not display editor, and calls error action creator', () => {
      117 | 				const receiveGravatarImageFailedSpy = sandbox.spy();
    > 118 | 				const wrapper = shallow(
          | 				                ^
      119 | 					<EditGravatar
      120 | 						receiveGravatarImageFailed={ receiveGravatarImageFailedSpy }
      121 | 						translate={ noop }

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:118:21)

  ● EditGravatar › after editing image › given no error, hides image editor and calls upload gravatar action creator

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/edit-gravatar/index.jsx:17:1)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:40:18)

  ● EditGravatar › after editing image › given no error, hides image editor and calls upload gravatar action creator

    TypeError: Cannot read property 'contextTypes' of undefined

      151 | 			const receiveGravatarImageFailedSpy = sandbox.spy();
      152 | 			const uploadGravatarSpy = sandbox.spy();
    > 153 | 			const wrapper = shallow(
          | 			                ^
      154 | 				<EditGravatar
      155 | 					receiveGravatarImageFailed={ receiveGravatarImageFailedSpy }
      156 | 					resetAllImageEditorState={ noop }

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:153:20)

  ● EditGravatar › after editing image › given an error, hides image editor and calls error notice action creator

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/edit-gravatar/index.jsx:17:1)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:40:18)

  ● EditGravatar › after editing image › given an error, hides image editor and calls error notice action creator

    TypeError: Cannot read property 'contextTypes' of undefined

      174 | 			const receiveGravatarImageFailedSpy = sandbox.spy();
      175 | 			const uploadGravatarSpy = sandbox.spy();
    > 176 | 			const wrapper = shallow(
          | 			                ^
      177 | 				<EditGravatar
      178 | 					receiveGravatarImageFailed={ receiveGravatarImageFailedSpy }
      179 | 					resetAllImageEditorState={ noop }

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:176:20)

  ● EditGravatar › unverified user › shows email verification dialog when clicked

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/edit-gravatar/index.jsx:17:1)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:40:18)

  ● EditGravatar › unverified user › shows email verification dialog when clicked

    TypeError: Cannot read property 'contextTypes' of undefined

      196 | 	describe( 'unverified user', () => {
      197 | 		test( 'shows email verification dialog when clicked', () => {
    > 198 | 			const wrapper = shallow(
          | 			                ^
      199 | 				<EditGravatar translate={ noop } user={ user } recordClickButtonEvent={ noop } />
      200 | 			);
      201 | 			// Enzyme requires simulate() to be called directly on the element with the click handler

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/edit-gravatar/test/index.jsx:198:20)

FAIL client/lib/media/test/store.js
  ● MediaStore › #get() › should return a single value

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › #get() › should return a single value

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › #get() › should return a single value

    TypeError: handler is not a function

      43 | 
      44 | 	function dispatchReceiveMediaItems() {
    > 45 | 		handler( {
         | 		^
      46 | 			action: {
      47 | 				type: 'RECEIVE_MEDIA_ITEMS',
      48 | 				siteId: DUMMY_SITE_ID,

      at dispatchReceiveMediaItems (client/lib/media/test/store.js:45:3)
      at Object.<anonymous> (client/lib/media/test/store.js:78:4)

  ● MediaStore › #get() › should return undefined for an item that does not exist

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › #get() › should return undefined for an item that does not exist

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › #get() › should return undefined for an item that does not exist

    TypeError: Cannot read property 'get' of undefined

      82 | 
      83 | 		test( 'should return undefined for an item that does not exist', () => {
    > 84 | 			expect( MediaStore.get( DUMMY_SITE_ID, DUMMY_MEDIA_ID + 1 ) ).to.be.undefined;
         | 			                   ^
      85 | 		} );
      86 | 
      87 | 		test( 'should resolve a pointer to another image item', () => {

      at Object.<anonymous> (client/lib/media/test/store.js:84:23)

  ● MediaStore › #get() › should resolve a pointer to another image item

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › #get() › should resolve a pointer to another image item

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › #get() › should resolve a pointer to another image item

    TypeError: Cannot set property '_media' of undefined

      86 | 
      87 | 		test( 'should resolve a pointer to another image item', () => {
    > 88 | 			MediaStore._media = {
         | 			^
      89 | 				[ DUMMY_SITE_ID ]: {
      90 | 					[ DUMMY_MEDIA_ID ]: DUMMY_MEDIA_OBJECT,
      91 | 				},

      at Object.<anonymous> (client/lib/media/test/store.js:88:4)

  ● MediaStore › #getAll() › should return all received media

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › #getAll() › should return all received media

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › #getAll() › should return all received media

    TypeError: handler is not a function

      43 | 
      44 | 	function dispatchReceiveMediaItems() {
    > 45 | 		handler( {
         | 		^
      46 | 			action: {
      47 | 				type: 'RECEIVE_MEDIA_ITEMS',
      48 | 				siteId: DUMMY_SITE_ID,

      at dispatchReceiveMediaItems (client/lib/media/test/store.js:45:3)
      at Object.<anonymous> (client/lib/media/test/store.js:105:4)

  ● MediaStore › #getAll() › should return undefined for an unknown site

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › #getAll() › should return undefined for an unknown site

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › #getAll() › should return undefined for an unknown site

    TypeError: Cannot read property 'getAll' of undefined

      109 | 
      110 | 		test( 'should return undefined for an unknown site', () => {
    > 111 | 			expect( MediaStore.getAll( DUMMY_SITE_ID ) ).to.be.undefined;
          | 			                   ^
      112 | 		} );
      113 | 	} );
      114 | 

      at Object.<anonymous> (client/lib/media/test/store.js:111:23)

  ● MediaStore › .dispatchToken › should expose its dispatcher ID

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › .dispatchToken › should expose its dispatcher ID

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › .dispatchToken › should expose its dispatcher ID

    TypeError: Cannot read property 'dispatchToken' of undefined

      115 | 	describe( '.dispatchToken', () => {
      116 | 		test( 'should expose its dispatcher ID', () => {
    > 117 | 			expect( MediaStore.dispatchToken ).to.be.a( 'string' );
          | 			                   ^
      118 | 		} );
      119 | 
      120 | 		test( 'should emit a change event when receiving updates', done => {

      at Object.<anonymous> (client/lib/media/test/store.js:117:23)

  ● MediaStore › .dispatchToken › should emit a change event when receiving updates

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › .dispatchToken › should emit a change event when receiving updates

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › .dispatchToken › should emit a change event when receiving updates

    TypeError: Cannot read property 'once' of undefined

      119 | 
      120 | 		test( 'should emit a change event when receiving updates', done => {
    > 121 | 			MediaStore.once( 'change', done );
          | 			           ^
      122 | 
      123 | 			dispatchReceiveMediaItems();
      124 | 		} );

      at Object.<anonymous> (client/lib/media/test/store.js:121:15)

  ● MediaStore › .dispatchToken › should blank an item when REMOVE_MEDIA_ITEM is dispatched

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › .dispatchToken › should blank an item when REMOVE_MEDIA_ITEM is dispatched

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › .dispatchToken › should blank an item when REMOVE_MEDIA_ITEM is dispatched

    TypeError: handler is not a function

      43 | 
      44 | 	function dispatchReceiveMediaItems() {
    > 45 | 		handler( {
         | 		^
      46 | 			action: {
      47 | 				type: 'RECEIVE_MEDIA_ITEMS',
      48 | 				siteId: DUMMY_SITE_ID,

      at dispatchReceiveMediaItems (client/lib/media/test/store.js:45:3)
      at Object.<anonymous> (client/lib/media/test/store.js:127:4)

  ● MediaStore › .dispatchToken › should re-add an item when REMOVE_MEDIA_ITEM errors and includes data

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › .dispatchToken › should re-add an item when REMOVE_MEDIA_ITEM errors and includes data

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › .dispatchToken › should re-add an item when REMOVE_MEDIA_ITEM errors and includes data

    TypeError: handler is not a function

      64 | 
      65 | 	function dispatchRemoveMediaItem( error ) {
    > 66 | 		handler( {
         | 		^
      67 | 			action: {
      68 | 				error: error,
      69 | 				type: 'REMOVE_MEDIA_ITEM',

      at dispatchRemoveMediaItem (client/lib/media/test/store.js:66:3)
      at Object.<anonymous> (client/lib/media/test/store.js:137:4)

  ● MediaStore › .dispatchToken › should replace an item when RECEIVE_MEDIA_ITEM includes ID

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › .dispatchToken › should replace an item when RECEIVE_MEDIA_ITEM includes ID

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › .dispatchToken › should replace an item when RECEIVE_MEDIA_ITEM includes ID

    TypeError: handler is not a function

      53 | 
      54 | 	function dispatchReceiveMediaItem( id, data ) {
    > 55 | 		handler( {
         | 		^
      56 | 			action: {
      57 | 				type: 'RECEIVE_MEDIA_ITEM',
      58 | 				siteId: DUMMY_SITE_ID,

      at dispatchReceiveMediaItem (client/lib/media/test/store.js:55:3)
      at Object.<anonymous> (client/lib/media/test/store.js:148:4)

  ● MediaStore › .dispatchToken › should create an item stub when FETCH_MEDIA_ITEM called

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › .dispatchToken › should create an item stub when FETCH_MEDIA_ITEM called

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › .dispatchToken › should create an item stub when FETCH_MEDIA_ITEM called

    TypeError: handler is not a function

      154 | 
      155 | 		test( 'should create an item stub when FETCH_MEDIA_ITEM called', () => {
    > 156 | 			handler( {
          | 			^
      157 | 				action: {
      158 | 					type: 'FETCH_MEDIA_ITEM',
      159 | 					siteId: DUMMY_SITE_ID,

      at Object.<anonymous> (client/lib/media/test/store.js:156:4)

  ● MediaStore › .dispatchToken › should clear all pointers when CHANGE_MEDIA_SOURCE called

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/store.js:31:16)

  ● MediaStore › .dispatchToken › should clear all pointers when CHANGE_MEDIA_SOURCE called

    TypeError: Cannot set property '_media' of undefined

      34 | 
      35 | 	beforeEach( () => {
    > 36 | 		MediaStore._media = {};
         | 		^
      37 | 		MediaStore._pointers = {};
      38 | 	} );
      39 | 

      at Object.<anonymous> (client/lib/media/test/store.js:36:3)

  ● MediaStore › .dispatchToken › should clear all pointers when CHANGE_MEDIA_SOURCE called

    TypeError: Cannot set property '_pointers' of undefined

      168 | 
      169 | 		test( 'should clear all pointers when CHANGE_MEDIA_SOURCE called', () => {
    > 170 | 			MediaStore._pointers = {
          | 			^
      171 | 				[ DUMMY_SITE_ID ]: {
      172 | 					[ DUMMY_MEDIA_ID + 1 ]: DUMMY_MEDIA_ID,
      173 | 				},

      at Object.<anonymous> (client/lib/media/test/store.js:170:4)

FAIL client/lib/resize-image-url/test/index.js
  ● resizeImageUrl() › should return non-string URLs unmodified

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › should return non-string URLs unmodified

    TypeError: resizeImageUrl is not a function

      14 | 
      15 | 	test( 'should return non-string URLs unmodified', () => {
    > 16 | 		expect( resizeImageUrl() ).to.be.undefined;
         | 		        ^
      17 | 		expect( resizeImageUrl( null ) ).to.be.null;
      18 | 		expect( resizeImageUrl( 1 ) ).to.equal( 1 );
      19 | 	} );

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:16:11)

  ● resizeImageUrl() › should strip original query params (WP.com)

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › should strip original query params (WP.com)

    TypeError: resizeImageUrl is not a function

      20 | 
      21 | 	test( 'should strip original query params (WP.com)', () => {
    > 22 | 		const resizedUrl = resizeImageUrl( imageUrl );
         | 		                   ^
      23 | 		expect( resizedUrl ).to.equal(
      24 | 			'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg'
      25 | 		);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:22:22)

  ● resizeImageUrl() › should strip original query params (Photon)

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › should strip original query params (Photon)

    TypeError: resizeImageUrl is not a function

      28 | 	test( 'should strip original query params (Photon)', () => {
      29 | 		const original = 'https://i0.wp.com/example.com/foo.png?fit=meh';
    > 30 | 		const resizedUrl = resizeImageUrl( original );
         | 		                   ^
      31 | 		expect( resizedUrl ).to.equal( 'https://i0.wp.com/example.com/foo.png' );
      32 | 	} );
      33 | 

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:30:22)

  ● resizeImageUrl() › should not attempt to resize non-HTTP protocols

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › should not attempt to resize non-HTTP protocols

    TypeError: resizeImageUrl is not a function

      35 | 		const blobImageUrl =
      36 | 			'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';
    > 37 | 		const resizedUrl = resizeImageUrl( blobImageUrl, { resize: '40,40' } );
         | 		                   ^
      38 | 		expect( resizedUrl ).to.equal( blobImageUrl );
      39 | 	} );
      40 | 

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:37:22)

  ● resizeImageUrl() › should allow arguments to be specified as strings

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › should allow arguments to be specified as strings

    TypeError: resizeImageUrl is not a function

      40 | 
      41 | 	test( 'should allow arguments to be specified as strings', () => {
    > 42 | 		const resizedUrl = resizeImageUrl( imageUrl, { w: '40' } );
         | 		                   ^
      43 | 		expect( resizedUrl ).to.equal(
      44 | 			'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?w=40'
      45 | 		);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:42:22)

  ● resizeImageUrl() › should preserve unrelated query arguments

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › should preserve unrelated query arguments

    TypeError: resizeImageUrl is not a function

      49 | 		const gravatarUrl =
      50 | 			'https://gravatar.com/avatar/00000000000000000000000000000000?d=https%3A%2F%2Fexample.com%2Favatar.jpg';
    > 51 | 		const resizedUrl = resizeImageUrl( gravatarUrl, { s: '40' } );
         | 		                   ^
      52 | 		const expectedUrl =
      53 | 			'https://gravatar.com/avatar/00000000000000000000000000000000?d=https%3A%2F%2Fexample.com%2Favatar.jpg&s=40';
      54 | 		expect( resizedUrl ).to.equal( expectedUrl );

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:51:22)

  ● resizeImageUrl() › numeric width › wpcom › should append width as ?w query argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › numeric width › wpcom › should append width as ?w query argument

    TypeError: resizeImageUrl is not a function

      59 | 			test( 'should append width as ?w query argument', () => {
      60 | 				const original = 'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg';
    > 61 | 				const resized = resizeImageUrl( original, 40 );
         | 				                ^
      62 | 				const expected = 'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?w=40';
      63 | 				expect( resized ).to.equal( expected );
      64 | 			} );

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:61:21)

  ● resizeImageUrl() › numeric width › wpcom › should append ?fit query argument if both width and height provided

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › numeric width › wpcom › should append ?fit query argument if both width and height provided

    TypeError: resizeImageUrl is not a function

      66 | 			test( 'should append ?fit query argument if both width and height provided', () => {
      67 | 				const original = 'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg';
    > 68 | 				const resized = resizeImageUrl( original, 40, 20 );
         | 				                ^
      69 | 				const expected =
      70 | 					'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?fit=40%2C20';
      71 | 				expect( resized ).to.equal( expected );

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:68:21)

  ● resizeImageUrl() › numeric width › photon › should append width as ?w query argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › numeric width › photon › should append width as ?w query argument

    TypeError: resizeImageUrl is not a function

      76 | 			test( 'should append width as ?w query argument', () => {
      77 | 				const original = 'https://i0.wp.com/example.com/foo.png';
    > 78 | 				const resized = resizeImageUrl( original, 40 );
         | 				                ^
      79 | 				const expected = 'https://i0.wp.com/example.com/foo.png?w=40';
      80 | 				expect( resized ).to.equal( expected );
      81 | 			} );

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:78:21)

  ● resizeImageUrl() › numeric width › photon › should append ?fit query argument if both width and height provided

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › numeric width › photon › should append ?fit query argument if both width and height provided

    TypeError: resizeImageUrl is not a function

      83 | 			test( 'should append ?fit query argument if both width and height provided', () => {
      84 | 				const original = 'https://i0.wp.com/example.com/foo.png';
    > 85 | 				const resized = resizeImageUrl( original, 40, 20 );
         | 				                ^
      86 | 				const expected = 'https://i0.wp.com/example.com/foo.png?fit=40%2C20';
      87 | 				expect( resized ).to.equal( expected );
      88 | 			} );

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:85:21)

  ● resizeImageUrl() › numeric width › gravatar › should append width as ?s query argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › numeric width › gravatar › should append width as ?s query argument

    TypeError: resizeImageUrl is not a function

      92 | 			test( 'should append width as ?s query argument', () => {
      93 | 				const original = 'https://gravatar.com/avatar/00000000000000000000000000000000';
    > 94 | 				const resized = resizeImageUrl( original, 40 );
         | 				                ^
      95 | 				const expected = 'https://gravatar.com/avatar/00000000000000000000000000000000?s=40';
      96 | 				expect( resized ).to.equal( expected );
      97 | 			} );

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:94:21)

  ● resizeImageUrl() › numeric width › gravatar › should ignore height

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › numeric width › gravatar › should ignore height

    TypeError: resizeImageUrl is not a function

       99 | 			test( 'should ignore height', () => {
      100 | 				const original = 'https://gravatar.com/avatar/00000000000000000000000000000000';
    > 101 | 				const resized = resizeImageUrl( original, 40, 20 );
          | 				                ^
      102 | 				const expected = 'https://gravatar.com/avatar/00000000000000000000000000000000?s=40';
      103 | 				expect( resized ).to.equal( expected );
      104 | 			} );

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:101:21)

  ● resizeImageUrl() › numeric width › external › should return a Photonized (safe) resized image with width

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › numeric width › external › should return a Photonized (safe) resized image with width

    TypeError: resizeImageUrl is not a function

      109 | 				const original = 'https://example.com/foo.png';
      110 | 				const expected = 'https://i0.wp.com/example.com/foo.png?ssl=1&w=40';
    > 111 | 				expect( resizeImageUrl( original, 40 ) ).to.equal( expected );
          | 				        ^
      112 | 				expect( resizeImageUrl( original, { w: 40 } ) ).to.equal( expected );
      113 | 			} );
      114 | 

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:111:13)

  ● resizeImageUrl() › numeric width › external › should return a Photonized (safe) resized image with width and height

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › numeric width › external › should return a Photonized (safe) resized image with width and height

    TypeError: resizeImageUrl is not a function

      115 | 			test( 'should return a Photonized (safe) resized image with width and height', () => {
      116 | 				const original = 'https://example.com/foo.png';
    > 117 | 				const resized = resizeImageUrl( original, 40, 20 );
          | 				                ^
      118 | 				const expected = 'https://i0.wp.com/example.com/foo.png?ssl=1&fit=40%2C20';
      119 | 				expect( resized ).to.equal( expected );
      120 | 			} );

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:117:21)

  ● resizeImageUrl() › numeric width › external › returns null for URLs with query string

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › numeric width › external › returns null for URLs with query string

    TypeError: resizeImageUrl is not a function

      122 | 			test( 'returns null for URLs with query string', () => {
      123 | 				const original = 'https://example.com/foo.png?bar=baz';
    > 124 | 				const resized = resizeImageUrl( original, 40, 20 );
          | 				                ^
      125 | 				expect( resized ).to.be.null;
      126 | 			} );
      127 | 

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:124:21)

  ● resizeImageUrl() › numeric width › external › should treat external wp-content urls as external

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › numeric width › external › should treat external wp-content urls as external

    TypeError: resizeImageUrl is not a function

      128 | 			test( 'should treat external wp-content urls as external', () => {
      129 | 				const original = 'https://blacktacho.com/wp-content/uploads/2018/10/Divo07.jpg';
    > 130 | 				const resized = resizeImageUrl( original, 450 );
          | 				                ^
      131 | 				expect( resized ).to.equal(
      132 | 					'https://i2.wp.com/blacktacho.com/wp-content/uploads/2018/10/Divo07.jpg?ssl=1&w=450'
      133 | 				);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:130:21)

  ● resizeImageUrl() › standard pixel density › should append resize argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › standard pixel density › should append resize argument

    TypeError: resizeImageUrl is not a function

      138 | 	describe( 'standard pixel density', () => {
      139 | 		test( 'should append resize argument', () => {
    > 140 | 			const resizedUrl = resizeImageUrl( imageUrl, { resize: '40,40' } );
          | 			                   ^
      141 | 			expect( resizedUrl ).to.equal(
      142 | 				'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?resize=40%2C40'
      143 | 			);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:140:23)

  ● resizeImageUrl() › standard pixel density › should append fit argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › standard pixel density › should append fit argument

    TypeError: resizeImageUrl is not a function

      145 | 
      146 | 		test( 'should append fit argument', () => {
    > 147 | 			const resizedUrl = resizeImageUrl( imageUrl, { fit: '40,40' } );
          | 			                   ^
      148 | 			expect( resizedUrl ).to.equal(
      149 | 				'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?fit=40%2C40'
      150 | 			);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:147:23)

  ● resizeImageUrl() › standard pixel density › should append w argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › standard pixel density › should append w argument

    TypeError: resizeImageUrl is not a function

      152 | 
      153 | 		test( 'should append w argument', () => {
    > 154 | 			const resizedUrl = resizeImageUrl( imageUrl, { w: 40 } );
          | 			                   ^
      155 | 			expect( resizedUrl ).to.equal(
      156 | 				'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?w=40'
      157 | 			);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:154:23)

  ● resizeImageUrl() › standard pixel density › should append s argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › standard pixel density › should append s argument

    TypeError: resizeImageUrl is not a function

      159 | 
      160 | 		test( 'should append s argument', () => {
    > 161 | 			const resizedUrl = resizeImageUrl( imageUrl, { s: 200 } );
          | 			                   ^
      162 | 			expect( resizedUrl ).to.equal(
      163 | 				'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?s=200'
      164 | 			);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:161:23)

  ● resizeImageUrl() › high pixel density › should append resize argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › high pixel density › should append resize argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › high pixel density › should append resize argument

    TypeError: resizeImageUrl is not a function

      182 | 
      183 | 		test( 'should append resize argument', () => {
    > 184 | 			const resizedUrl = resizeImageUrl( imageUrl, { resize: '40,40' } );
          | 			                   ^
      185 | 			expect( resizedUrl ).to.equal(
      186 | 				'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?resize=80%2C80'
      187 | 			);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:184:23)

  ● resizeImageUrl() › high pixel density › should append fit argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › high pixel density › should append fit argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › high pixel density › should append fit argument

    TypeError: resizeImageUrl is not a function

      189 | 
      190 | 		test( 'should append fit argument', () => {
    > 191 | 			const resizedUrl = resizeImageUrl( imageUrl, { fit: '40,40' } );
          | 			                   ^
      192 | 			expect( resizedUrl ).to.equal(
      193 | 				'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?fit=80%2C80'
      194 | 			);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:191:23)

  ● resizeImageUrl() › high pixel density › should append w argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › high pixel density › should append w argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › high pixel density › should append w argument

    TypeError: resizeImageUrl is not a function

      196 | 
      197 | 		test( 'should append w argument', () => {
    > 198 | 			const resizedUrl = resizeImageUrl( imageUrl, { w: 40 } );
          | 			                   ^
      199 | 			expect( resizedUrl ).to.equal(
      200 | 				'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?w=80'
      201 | 			);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:198:23)

  ● resizeImageUrl() › high pixel density › should append s argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › high pixel density › should append s argument

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

  ● resizeImageUrl() › high pixel density › should append s argument

    TypeError: resizeImageUrl is not a function

      203 | 
      204 | 		test( 'should append s argument', () => {
    > 205 | 			const resizedUrl = resizeImageUrl( imageUrl, { s: 200 } );
          | 			                   ^
      206 | 			expect( resizedUrl ).to.equal(
      207 | 				'https://testonesite2014.files.wordpress.com/2014/11/image5.jpg?s=400'
      208 | 			);

      at Object.<anonymous> (client/lib/resize-image-url/test/index.js:205:23)

FAIL client/components/tinymce/plugins/media/restrict-size/test/index.js
  ● restrictSize › #getMaxWidth() › should return the multiple of the root device ratio if available

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/index.js:5:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:14:24)

  ● restrictSize › #getMaxWidth() › should return the multiple of the root device ratio if available

    TypeError: getMaxWidth is not a function

      33 | 			window.devicePixelRatio = 1.5;
      34 | 
    > 35 | 			expect( getMaxWidth() ).to.equal( 1020 );
         | 			        ^
      36 | 		} );
      37 | 
      38 | 		test( 'should return twice the base if the device resolution matches the retina media query', () => {

      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:35:12)

  ● restrictSize › #getMaxWidth() › should return twice the base if the device resolution matches the retina media query

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/index.js:5:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:14:24)

  ● restrictSize › #getMaxWidth() › should return twice the base if the device resolution matches the retina media query

    TypeError: getMaxWidth is not a function

      40 | 			window.matchMedia = () => ( { matches: true } );
      41 | 
    > 42 | 			expect( getMaxWidth() ).to.equal( 1360 );
         | 			        ^
      43 | 		} );
      44 | 
      45 | 		test( 'should return the base max width if the device is not retina-capable', () => {

      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:42:12)

  ● restrictSize › #getMaxWidth() › should return the base max width if the device is not retina-capable

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/index.js:5:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:14:24)

  ● restrictSize › #getMaxWidth() › should return the base max width if the device is not retina-capable

    TypeError: getMaxWidth is not a function

      45 | 		test( 'should return the base max width if the device is not retina-capable', () => {
      46 | 			window.devicePixelRatio = undefined;
    > 47 | 			expect( getMaxWidth() ).to.equal( 680 );
         | 			        ^
      48 | 		} );
      49 | 	} );
      50 | 

      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:47:12)

  ● restrictSize › #resetImages() › should restore all instances of replaced images

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/index.js:5:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:14:24)

  ● restrictSize › #resetImages() › should restore all instances of replaced images

    TypeError: resetImages is not a function

      51 | 	describe( '#resetImages()', () => {
      52 | 		test( 'should restore all instances of replaced images', () => {
    > 53 | 			const value = resetImages(
         | 			              ^
      54 | 				'<p><img src="https://wordpress.com/2015/11/forest.jpg?w=680" data-wpmedia-src="https://wordpress.com/2015/11/forest.jpg?w=1024" class="alignnone size-large wp-image-5823" alt="forest" width="1024" height="683" data-mce-src="https://wordpress.com/2015/11/forest.jpg?w=680" data-mce-selected="1"></p>'
      55 | 			);
      56 | 			expect( value ).to.equal(

      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:53:18)

  ● restrictSize › #resetImages() › should handle multiple images from content

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/index.js:5:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:14:24)

  ● restrictSize › #resetImages() › should handle multiple images from content

    TypeError: resetImages is not a function

      60 | 
      61 | 		test( 'should handle multiple images from content', () => {
    > 62 | 			const value = resetImages(
         | 			              ^
      63 | 				'<p><img src="https://example.com/bird.jpg?w=680" data-wpmedia-src="https://example.com/bird.jpg"><img src="https://example.com/forest.jpg?w=680" data-wpmedia-src="https://example.com/forest.jpg"></p>'
      64 | 			);
      65 | 			expect( value ).to.equal(

      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:62:18)

  ● restrictSize › #resetImages() › should ignore non-replaced images in handling multiple images

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/index.js:5:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:14:24)

  ● restrictSize › #resetImages() › should ignore non-replaced images in handling multiple images

    TypeError: resetImages is not a function

      69 | 
      70 | 		test( 'should ignore non-replaced images in handling multiple images', () => {
    > 71 | 			const value = resetImages(
         | 			              ^
      72 | 				'<p><img src="https://example.com/bird.jpg?w=300"><img src="https://example.com/forest.jpg?w=680" data-wpmedia-src="https://example.com/forest.jpg"></p>'
      73 | 			);
      74 | 			expect( value ).to.equal(

      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:71:18)

  ● restrictSize › #setImages() › should replace all instances of large images

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/index.js:5:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:14:24)

  ● restrictSize › #setImages() › should replace all instances of large images

    TypeError: setImages is not a function

      80 | 	describe( '#setImages()', () => {
      81 | 		test( 'should replace all instances of large images', () => {
    > 82 | 			const value = setImages(
         | 			              ^
      83 | 				'<p><img src="https://wordpress.com/2015/11/forest.jpg?w=1024" class="alignnone size-large wp-image-5823" alt="forest" width="1024" height="683" data-mce-src="https://wordpress.com/2015/11/forest.jpg?w=680" data-mce-selected="1"></p>'
      84 | 			);
      85 | 			expect( value ).to.equal(

      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:82:18)

  ● restrictSize › #setImages() › should not replace already-replaced instances

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/index.js:5:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:14:24)

  ● restrictSize › #setImages() › should not replace already-replaced instances

    TypeError: setImages is not a function

      89 | 
      90 | 		test( 'should not replace already-replaced instances', () => {
    > 91 | 			const value = setImages(
         | 			              ^
      92 | 				'<p><img class="alignnone size-large wp-image-5823" src="https://wordpress.com/2015/11/forest.jpg?w=680" data-wpmedia-src="https://wordpress.com/2015/11/forest.jpg?w=1024" alt="forest" width="1024" height="683" data-mce-src="https://wordpress.com/2015/11/forest.jpg?w=680" data-mce-selected="1"></p>'
      93 | 			);
      94 | 			expect( value ).to.equal(

      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:91:18)

  ● restrictSize › #setImages() › should replace images with indeterminate widths

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/index.js:5:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:14:24)

  ● restrictSize › #setImages() › should replace images with indeterminate widths

    TypeError: setImages is not a function

       98 | 
       99 | 		test( 'should replace images with indeterminate widths', () => {
    > 100 | 			const value = setImages(
          | 			              ^
      101 | 				'<p><img src="https://wordpress.com/2015/11/forest.jpg" alt="forest" class="alignnone size-thumbnail wp-image-5823" data-mce-selected="1"></p>'
      102 | 			);
      103 | 			expect( value ).to.equal(

      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:100:18)

  ● restrictSize › #setImages() › should not replace external images (those without media ID)

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/index.js:5:1)
      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:14:24)

  ● restrictSize › #setImages() › should not replace external images (those without media ID)

    TypeError: setImages is not a function

      110 | 				'<p><img src="https://wordpress.com/2015/11/forest.jpg" alt="forest" class="alignnone size-thumbnail"></p>';
      111 | 
    > 112 | 			const value = setImages( markup );
          | 			              ^
      113 | 			expect( value ).to.equal( markup );
      114 | 		} );
      115 | 	} );

      at Object.<anonymous> (client/components/tinymce/plugins/media/restrict-size/test/index.js:112:18)

FAIL client/lib/safe-image-url/test/index.js
  ● safeImageUrl() › browser › should ignore a blob url for current origin

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should ignore a blob url for current origin

    TypeError: safeImageUrl is not a function

      117 | 		test( 'should ignore a blob url for current origin', () => {
      118 | 			const originalUrl = 'blob:https://wordpress.com/ddd1d6b0-f31b-4937-ae9e-97f1d660cf71';
    > 119 | 			expect( safeImageUrl( originalUrl ) ).toEqual( originalUrl );
          | 			        ^
      120 | 		} );
      121 | 
      122 | 		test( 'should make a blob url for other origin safe', () => {

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:119:12)

  ● safeImageUrl() › browser › should make a blob url for other origin safe

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should make a blob url for other origin safe

    TypeError: safeImageUrl is not a function

      124 | 			const expectedUrl =
      125 | 				'https://i1.wp.com/http//example.com/ddd1d6b0-f31b-4937-ae9e-97f1d660cf71';
    > 126 | 			expect( safeImageUrl( originalUrl ) ).toEqual( expectedUrl );
          | 			        ^
      127 | 		} );
      128 | 
      129 | 		commonTests();

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:126:12)

  ● safeImageUrl() › browser › should ignore a relative url

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should ignore a relative url

    TypeError: safeImageUrl is not a function

      4 | 	function commonTests() {
      5 | 		test( 'should ignore a relative url', () => {
    > 6 | 			expect( safeImageUrl( '/foo' ) ).toEqual( '/foo' );
        | 			        ^
      7 | 		} );
      8 | 
      9 | 		test( 'should ignore a data url', () => {

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:6:12)

  ● safeImageUrl() › browser › should ignore a data url

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should ignore a data url

    TypeError: safeImageUrl is not a function

      10 | 			const dataImageUrl =
      11 | 				'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';
    > 12 | 			expect( safeImageUrl( dataImageUrl ) ).toEqual( dataImageUrl );
         | 			        ^
      13 | 		} );
      14 | 
      15 | 		test( 'should make a non-whitelisted protocol safe', () => {

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:12:12)

  ● safeImageUrl() › browser › should make a non-whitelisted protocol safe

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should make a non-whitelisted protocol safe

    TypeError: safeImageUrl is not a function

      16 | 			[ 'javascript:alert("foo")', 'data:application/json;base64,', 'about:config' ].forEach(
      17 | 				url => {
    > 18 | 					expect( safeImageUrl( url ) ).toMatch( /^https:\/\/i[0-2]\.wp.com\// );
         | 					        ^
      19 | 				}
      20 | 			);
      21 | 		} );

      at forEach (client/lib/safe-image-url/test/index.js:18:14)
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:16:83)

  ● safeImageUrl() › browser › should make a non-wpcom http url safe

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should make a non-wpcom http url safe

    TypeError: safeImageUrl is not a function

      22 | 
      23 | 		test( 'should make a non-wpcom http url safe', () => {
    > 24 | 			expect( safeImageUrl( 'http://example.com/foo' ) ).toEqual(
         | 			        ^
      25 | 				'https://i1.wp.com/example.com/foo'
      26 | 			);
      27 | 		} );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:24:12)

  ● safeImageUrl() › browser › should make a non-wpcom https url safe

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should make a non-wpcom https url safe

    TypeError: safeImageUrl is not a function

      28 | 
      29 | 		test( 'should make a non-wpcom https url safe', () => {
    > 30 | 			expect( safeImageUrl( 'https://example.com/foo' ) ).toEqual(
         | 			        ^
      31 | 				'https://i1.wp.com/example.com/foo?ssl=1'
      32 | 			);
      33 | 		} );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:30:12)

  ● safeImageUrl() › browser › should make wp-com like subdomain url safe

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should make wp-com like subdomain url safe

    TypeError: safeImageUrl is not a function

      34 | 
      35 | 		test( 'should make wp-com like subdomain url safe', () => {
    > 36 | 			expect( safeImageUrl( 'https://wordpress.com.example.com/foo' ) ).toEqual(
         | 			        ^
      37 | 				'https://i0.wp.com/wordpress.com.example.com/foo?ssl=1'
      38 | 			);
      39 | 		} );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:36:12)

  ● safeImageUrl() › browser › should make safe variations of urls testing extremes of safe patterns

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should make safe variations of urls testing extremes of safe patterns

    TypeError: undefined is not a function
        at Array.map (<anonymous>)

      45 | 					'https://wordpresscom/foo',
      46 | 					'https://wordpress.com.example.com/foo',
    > 47 | 				].map( safeImageUrl )
         | 				  ^
      48 | 			).toEqual( [
      49 | 				'https://i0.wp.com/examplewordpress.com/foo?ssl=1',
      50 | 				'https://i0.wp.com/wordpresscom/foo?ssl=1',

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:47:7)

  ● safeImageUrl() › browser › should make a non-wpcom protocol relative url safe

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should make a non-wpcom protocol relative url safe

    TypeError: safeImageUrl is not a function

      54 | 
      55 | 		test( 'should make a non-wpcom protocol relative url safe', () => {
    > 56 | 			expect( safeImageUrl( '//example.com/foo' ) ).toEqual( 'https://i1.wp.com/example.com/foo' );
         | 			        ^
      57 | 		} );
      58 | 
      59 | 		test( 'should promote an http wpcom url to https', () => {

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:56:12)

  ● safeImageUrl() › browser › should promote an http wpcom url to https

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should promote an http wpcom url to https

    TypeError: safeImageUrl is not a function

      58 | 
      59 | 		test( 'should promote an http wpcom url to https', () => {
    > 60 | 			expect( safeImageUrl( 'http://files.wordpress.com/' ) ).toEqual(
         | 			        ^
      61 | 				'https://files.wordpress.com/'
      62 | 			);
      63 | 			expect( safeImageUrl( 'http://wordpress.com/' ) ).toEqual( 'https://wordpress.com/' );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:60:12)

  ● safeImageUrl() › browser › should leave https wpcom url alone

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should leave https wpcom url alone

    TypeError: safeImageUrl is not a function

      65 | 
      66 | 		test( 'should leave https wpcom url alone', () => {
    > 67 | 			expect( safeImageUrl( 'https://files.wordpress.com/' ) ).toEqual(
         | 			        ^
      68 | 				'https://files.wordpress.com/'
      69 | 			);
      70 | 			expect( safeImageUrl( 'https://wordpress.com/' ) ).toEqual( 'https://wordpress.com/' );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:67:12)

  ● safeImageUrl() › browser › should promote an http gravatar url to https

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should promote an http gravatar url to https

    TypeError: safeImageUrl is not a function

      75 | 
      76 | 		test( 'should promote an http gravatar url to https', () => {
    > 77 | 			expect( safeImageUrl( 'http://files.gravatar.com/' ) ).toEqual(
         | 			        ^
      78 | 				'https://files.gravatar.com/'
      79 | 			);
      80 | 			expect( safeImageUrl( 'http://gravatar.com/' ) ).toEqual( 'https://gravatar.com/' );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:77:12)

  ● safeImageUrl() › browser › should leave https gravatar url alone

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should leave https gravatar url alone

    TypeError: safeImageUrl is not a function

      82 | 
      83 | 		test( 'should leave https gravatar url alone', () => {
    > 84 | 			expect( safeImageUrl( 'https://files.gravatar.com/' ) ).toEqual(
         | 			        ^
      85 | 				'https://files.gravatar.com/'
      86 | 			);
      87 | 			expect( safeImageUrl( 'https://gravatar.com/' ) ).toEqual( 'https://gravatar.com/' );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:84:12)

  ● safeImageUrl() › browser › should return null for urls with querystrings

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should return null for urls with querystrings

    TypeError: safeImageUrl is not a function

      89 | 
      90 | 		test( 'should return null for urls with querystrings', () => {
    > 91 | 			expect( safeImageUrl( 'https://example.com/foo?bar' ) ).toBeNull();
         | 			        ^
      92 | 			expect( safeImageUrl( 'https://example.com/foo.jpg?bar' ) ).toBeNull();
      93 | 			expect( safeImageUrl( 'https://example.com/foo.jpeg?bar' ) ).toBeNull();
      94 | 			expect( safeImageUrl( 'https://example.com/foo.gif?bar' ) ).toBeNull();

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:91:12)

  ● safeImageUrl() › browser › should return null for SVG images

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:109:19)

  ● safeImageUrl() › browser › should return null for SVG images

    TypeError: safeImageUrl is not a function

       98 | 
       99 | 		test( 'should return null for SVG images', () => {
    > 100 | 			expect( safeImageUrl( 'https://example.com/foo.svg' ) ).toBeNull();
          | 			        ^
      101 | 			expect( safeImageUrl( 'https://example.com/foo.svg?ssl=1' ) ).toBeNull();
      102 | 		} );
      103 | 	}

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:100:12)

  ● safeImageUrl() › node › should make a blob url safe

    TypeError: safeImageUrl is not a function

      139 | 			const expectedUrl =
      140 | 				'https://i1.wp.com/http//example.com/ddd1d6b0-f31b-4937-ae9e-97f1d660cf71';
    > 141 | 			expect( safeImageUrl( originalUrl ) ).toEqual( expectedUrl );
          | 			        ^
      142 | 		} );
      143 | 
      144 | 		commonTests();

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:141:12)

  ● safeImageUrl() › node › should ignore a relative url

    TypeError: safeImageUrl is not a function

      4 | 	function commonTests() {
      5 | 		test( 'should ignore a relative url', () => {
    > 6 | 			expect( safeImageUrl( '/foo' ) ).toEqual( '/foo' );
        | 			        ^
      7 | 		} );
      8 | 
      9 | 		test( 'should ignore a data url', () => {

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:6:12)

  ● safeImageUrl() › node › should ignore a data url

    TypeError: safeImageUrl is not a function

      10 | 			const dataImageUrl =
      11 | 				'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';
    > 12 | 			expect( safeImageUrl( dataImageUrl ) ).toEqual( dataImageUrl );
         | 			        ^
      13 | 		} );
      14 | 
      15 | 		test( 'should make a non-whitelisted protocol safe', () => {

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:12:12)

  ● safeImageUrl() › node › should make a non-whitelisted protocol safe

    TypeError: safeImageUrl is not a function

      16 | 			[ 'javascript:alert("foo")', 'data:application/json;base64,', 'about:config' ].forEach(
      17 | 				url => {
    > 18 | 					expect( safeImageUrl( url ) ).toMatch( /^https:\/\/i[0-2]\.wp.com\// );
         | 					        ^
      19 | 				}
      20 | 			);
      21 | 		} );

      at forEach (client/lib/safe-image-url/test/index.js:18:14)
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:16:83)

  ● safeImageUrl() › node › should make a non-wpcom http url safe

    TypeError: safeImageUrl is not a function

      22 | 
      23 | 		test( 'should make a non-wpcom http url safe', () => {
    > 24 | 			expect( safeImageUrl( 'http://example.com/foo' ) ).toEqual(
         | 			        ^
      25 | 				'https://i1.wp.com/example.com/foo'
      26 | 			);
      27 | 		} );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:24:12)

  ● safeImageUrl() › node › should make a non-wpcom https url safe

    TypeError: safeImageUrl is not a function

      28 | 
      29 | 		test( 'should make a non-wpcom https url safe', () => {
    > 30 | 			expect( safeImageUrl( 'https://example.com/foo' ) ).toEqual(
         | 			        ^
      31 | 				'https://i1.wp.com/example.com/foo?ssl=1'
      32 | 			);
      33 | 		} );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:30:12)

  ● safeImageUrl() › node › should make wp-com like subdomain url safe

    TypeError: safeImageUrl is not a function

      34 | 
      35 | 		test( 'should make wp-com like subdomain url safe', () => {
    > 36 | 			expect( safeImageUrl( 'https://wordpress.com.example.com/foo' ) ).toEqual(
         | 			        ^
      37 | 				'https://i0.wp.com/wordpress.com.example.com/foo?ssl=1'
      38 | 			);
      39 | 		} );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:36:12)

  ● safeImageUrl() › node › should make safe variations of urls testing extremes of safe patterns

    TypeError: [object Object] is not a function
        at Array.map (<anonymous>)

      45 | 					'https://wordpresscom/foo',
      46 | 					'https://wordpress.com.example.com/foo',
    > 47 | 				].map( safeImageUrl )
         | 				  ^
      48 | 			).toEqual( [
      49 | 				'https://i0.wp.com/examplewordpress.com/foo?ssl=1',
      50 | 				'https://i0.wp.com/wordpresscom/foo?ssl=1',

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:47:7)

  ● safeImageUrl() › node › should make a non-wpcom protocol relative url safe

    TypeError: safeImageUrl is not a function

      54 | 
      55 | 		test( 'should make a non-wpcom protocol relative url safe', () => {
    > 56 | 			expect( safeImageUrl( '//example.com/foo' ) ).toEqual( 'https://i1.wp.com/example.com/foo' );
         | 			        ^
      57 | 		} );
      58 | 
      59 | 		test( 'should promote an http wpcom url to https', () => {

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:56:12)

  ● safeImageUrl() › node › should promote an http wpcom url to https

    TypeError: safeImageUrl is not a function

      58 | 
      59 | 		test( 'should promote an http wpcom url to https', () => {
    > 60 | 			expect( safeImageUrl( 'http://files.wordpress.com/' ) ).toEqual(
         | 			        ^
      61 | 				'https://files.wordpress.com/'
      62 | 			);
      63 | 			expect( safeImageUrl( 'http://wordpress.com/' ) ).toEqual( 'https://wordpress.com/' );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:60:12)

  ● safeImageUrl() › node › should leave https wpcom url alone

    TypeError: safeImageUrl is not a function

      65 | 
      66 | 		test( 'should leave https wpcom url alone', () => {
    > 67 | 			expect( safeImageUrl( 'https://files.wordpress.com/' ) ).toEqual(
         | 			        ^
      68 | 				'https://files.wordpress.com/'
      69 | 			);
      70 | 			expect( safeImageUrl( 'https://wordpress.com/' ) ).toEqual( 'https://wordpress.com/' );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:67:12)

  ● safeImageUrl() › node › should promote an http gravatar url to https

    TypeError: safeImageUrl is not a function

      75 | 
      76 | 		test( 'should promote an http gravatar url to https', () => {
    > 77 | 			expect( safeImageUrl( 'http://files.gravatar.com/' ) ).toEqual(
         | 			        ^
      78 | 				'https://files.gravatar.com/'
      79 | 			);
      80 | 			expect( safeImageUrl( 'http://gravatar.com/' ) ).toEqual( 'https://gravatar.com/' );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:77:12)

  ● safeImageUrl() › node › should leave https gravatar url alone

    TypeError: safeImageUrl is not a function

      82 | 
      83 | 		test( 'should leave https gravatar url alone', () => {
    > 84 | 			expect( safeImageUrl( 'https://files.gravatar.com/' ) ).toEqual(
         | 			        ^
      85 | 				'https://files.gravatar.com/'
      86 | 			);
      87 | 			expect( safeImageUrl( 'https://gravatar.com/' ) ).toEqual( 'https://gravatar.com/' );

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:84:12)

  ● safeImageUrl() › node › should return null for urls with querystrings

    TypeError: safeImageUrl is not a function

      89 | 
      90 | 		test( 'should return null for urls with querystrings', () => {
    > 91 | 			expect( safeImageUrl( 'https://example.com/foo?bar' ) ).toBeNull();
         | 			        ^
      92 | 			expect( safeImageUrl( 'https://example.com/foo.jpg?bar' ) ).toBeNull();
      93 | 			expect( safeImageUrl( 'https://example.com/foo.jpeg?bar' ) ).toBeNull();
      94 | 			expect( safeImageUrl( 'https://example.com/foo.gif?bar' ) ).toBeNull();

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:91:12)

  ● safeImageUrl() › node › should return null for SVG images

    TypeError: safeImageUrl is not a function

       98 | 
       99 | 		test( 'should return null for SVG images', () => {
    > 100 | 			expect( safeImageUrl( 'https://example.com/foo.svg' ) ).toBeNull();
          | 			        ^
      101 | 			expect( safeImageUrl( 'https://example.com/foo.svg?ssl=1' ) ).toBeNull();
      102 | 		} );
      103 | 	}

      at Object.<anonymous> (client/lib/safe-image-url/test/index.js:100:12)

FAIL client/lib/media/test/library-selected-store.js
  ● MediaLibrarySelectedStore › #get() › should return a single value

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:36:16)

  ● MediaLibrarySelectedStore › #get() › should return a single value

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaLibrarySelectedStore._media = {};
         | 		^
      49 | 	} );
      50 | 
      51 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:48:3)

  ● MediaLibrarySelectedStore › #get() › should return a single value

    TypeError: handler is not a function

      54 | 
      55 | 	function dispatchSetLibrarySelectedItems( action ) {
    > 56 | 		handler( {
         | 		^
      57 | 			action: assign(
      58 | 				{
      59 | 					type: 'SET_MEDIA_LIBRARY_SELECTED_ITEMS',

      at dispatchSetLibrarySelectedItems (client/lib/media/test/library-selected-store.js:56:3)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:92:4)

  ● MediaLibrarySelectedStore › #get() › should return undefined for an item that does not exist

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:36:16)

  ● MediaLibrarySelectedStore › #get() › should return undefined for an item that does not exist

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaLibrarySelectedStore._media = {};
         | 		^
      49 | 	} );
      50 | 
      51 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:48:3)

  ● MediaLibrarySelectedStore › #get() › should return undefined for an item that does not exist

    TypeError: Cannot read property 'get' of undefined

       98 | 
       99 | 		test( 'should return undefined for an item that does not exist', () => {
    > 100 | 			expect( MediaLibrarySelectedStore.get( DUMMY_SITE_ID, DUMMY_TRANSIENT_MEDIA_OBJECT.ID + 1 ) )
          | 			                                  ^
      101 | 				.to.be.undefined;
      102 | 		} );
      103 | 	} );

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:100:38)

  ● MediaLibrarySelectedStore › #getAll() › should return all selected media

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:36:16)

  ● MediaLibrarySelectedStore › #getAll() › should return all selected media

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaLibrarySelectedStore._media = {};
         | 		^
      49 | 	} );
      50 | 
      51 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:48:3)

  ● MediaLibrarySelectedStore › #getAll() › should return all selected media

    TypeError: handler is not a function

      54 | 
      55 | 	function dispatchSetLibrarySelectedItems( action ) {
    > 56 | 		handler( {
         | 		^
      57 | 			action: assign(
      58 | 				{
      59 | 					type: 'SET_MEDIA_LIBRARY_SELECTED_ITEMS',

      at dispatchSetLibrarySelectedItems (client/lib/media/test/library-selected-store.js:56:3)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:107:4)

  ● MediaLibrarySelectedStore › #getAll() › should return an empty array for a site with no selected items

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:36:16)

  ● MediaLibrarySelectedStore › #getAll() › should return an empty array for a site with no selected items

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaLibrarySelectedStore._media = {};
         | 		^
      49 | 	} );
      50 | 
      51 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:48:3)

  ● MediaLibrarySelectedStore › #getAll() › should return an empty array for a site with no selected items

    TypeError: Cannot read property 'getAll' of undefined

      113 | 
      114 | 		test( 'should return an empty array for a site with no selected items', () => {
    > 115 | 			expect( MediaLibrarySelectedStore.getAll( DUMMY_SITE_ID ) ).to.eql( [] );
          | 			                                  ^
      116 | 		} );
      117 | 	} );
      118 | 

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:115:38)

  ● MediaLibrarySelectedStore › .dispatchToken › should expose its dispatcher ID

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:36:16)

  ● MediaLibrarySelectedStore › .dispatchToken › should expose its dispatcher ID

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaLibrarySelectedStore._media = {};
         | 		^
      49 | 	} );
      50 | 
      51 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:48:3)

  ● MediaLibrarySelectedStore › .dispatchToken › should expose its dispatcher ID

    TypeError: Cannot read property 'dispatchToken' of undefined

      119 | 	describe( '.dispatchToken', () => {
      120 | 		test( 'should expose its dispatcher ID', () => {
    > 121 | 			expect( MediaLibrarySelectedStore.dispatchToken ).to.not.be.undefined;
          | 			                                  ^
      122 | 		} );
      123 | 
      124 | 		test( 'should emit a change event when library items have been set', done => {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:121:38)

  ● MediaLibrarySelectedStore › .dispatchToken › should emit a change event when library items have been set

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:36:16)

  ● MediaLibrarySelectedStore › .dispatchToken › should emit a change event when library items have been set

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaLibrarySelectedStore._media = {};
         | 		^
      49 | 	} );
      50 | 
      51 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:48:3)

  ● MediaLibrarySelectedStore › .dispatchToken › should emit a change event when library items have been set

    TypeError: Cannot read property 'once' of undefined

      123 | 
      124 | 		test( 'should emit a change event when library items have been set', done => {
    > 125 | 			MediaLibrarySelectedStore.once( 'change', done );
          | 			                          ^
      126 | 
      127 | 			dispatchSetLibrarySelectedItems();
      128 | 		} );

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:125:30)

  ● MediaLibrarySelectedStore › .dispatchToken › should emit a change event when receiving updates

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:36:16)

  ● MediaLibrarySelectedStore › .dispatchToken › should emit a change event when receiving updates

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaLibrarySelectedStore._media = {};
         | 		^
      49 | 	} );
      50 | 
      51 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:48:3)

  ● MediaLibrarySelectedStore › .dispatchToken › should emit a change event when receiving updates

    TypeError: Cannot read property 'once' of undefined

      129 | 
      130 | 		test( 'should emit a change event when receiving updates', done => {
    > 131 | 			MediaLibrarySelectedStore.once( 'change', done );
          | 			                          ^
      132 | 
      133 | 			dispatchReceiveMediaItem();
      134 | 		} );

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:131:30)

  ● MediaLibrarySelectedStore › .dispatchToken › should replace an item when its ID has changed

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:36:16)

  ● MediaLibrarySelectedStore › .dispatchToken › should replace an item when its ID has changed

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaLibrarySelectedStore._media = {};
         | 		^
      49 | 	} );
      50 | 
      51 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:48:3)

  ● MediaLibrarySelectedStore › .dispatchToken › should replace an item when its ID has changed

    TypeError: handler is not a function

      54 | 
      55 | 	function dispatchSetLibrarySelectedItems( action ) {
    > 56 | 		handler( {
         | 		^
      57 | 			action: assign(
      58 | 				{
      59 | 					type: 'SET_MEDIA_LIBRARY_SELECTED_ITEMS',

      at dispatchSetLibrarySelectedItems (client/lib/media/test/library-selected-store.js:56:3)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:137:4)

  ● MediaLibrarySelectedStore › .dispatchToken › should remove an item when REMOVE_MEDIA_ITEM is dispatched

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:36:16)

  ● MediaLibrarySelectedStore › .dispatchToken › should remove an item when REMOVE_MEDIA_ITEM is dispatched

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaLibrarySelectedStore._media = {};
         | 		^
      49 | 	} );
      50 | 
      51 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:48:3)

  ● MediaLibrarySelectedStore › .dispatchToken › should remove an item when REMOVE_MEDIA_ITEM is dispatched

    TypeError: handler is not a function

      54 | 
      55 | 	function dispatchSetLibrarySelectedItems( action ) {
    > 56 | 		handler( {
         | 		^
      57 | 			action: assign(
      58 | 				{
      59 | 					type: 'SET_MEDIA_LIBRARY_SELECTED_ITEMS',

      at dispatchSetLibrarySelectedItems (client/lib/media/test/library-selected-store.js:56:3)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:144:4)

  ● MediaLibrarySelectedStore › .dispatchToken › should clear selected items when CHANGE_MEDIA_SOURCE is dispatched

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:36:16)

  ● MediaLibrarySelectedStore › .dispatchToken › should clear selected items when CHANGE_MEDIA_SOURCE is dispatched

    TypeError: Cannot set property '_media' of undefined

      46 | 
      47 | 	beforeEach( () => {
    > 48 | 		MediaLibrarySelectedStore._media = {};
         | 		^
      49 | 	} );
      50 | 
      51 | 	afterAll( function() {

      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:48:3)

  ● MediaLibrarySelectedStore › .dispatchToken › should clear selected items when CHANGE_MEDIA_SOURCE is dispatched

    TypeError: handler is not a function

      54 | 
      55 | 	function dispatchSetLibrarySelectedItems( action ) {
    > 56 | 		handler( {
         | 		^
      57 | 			action: assign(
      58 | 				{
      59 | 					type: 'SET_MEDIA_LIBRARY_SELECTED_ITEMS',

      at dispatchSetLibrarySelectedItems (client/lib/media/test/library-selected-store.js:56:3)
      at Object.<anonymous> (client/lib/media/test/library-selected-store.js:151:4)

FAIL client/my-sites/people/people-invite-details/test/index.jsx
  ● PeopleInviteDetails › should trigger deletion upon clicking Revoke Invite (pending invite)

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/state/selectors/get-media-url.js:5:1)
      at Object.<anonymous> (client/state/selectors/get-site-icon-url.js:11:1)
      at Object.<anonymous> (client/blocks/site-icon/index.jsx:20:1)
      at Object.<anonymous> (client/my-sites/sidebar-navigation/index.jsx:13:1)
      at Object.<anonymous> (client/my-sites/people/people-invite-details/index.jsx:15:1)
      at Object.<anonymous> (client/my-sites/people/people-invite-details/test/index.jsx:66:25)

  ● PeopleInviteDetails › should trigger deletion upon clicking Revoke Invite (pending invite)

    TypeError: Cannot read property 'contextTypes' of undefined

      74 | 		const mockDeleteInvite = jest.fn();
      75 | 
    > 76 | 		const inviteDetails = shallow(
         | 		                      ^
      77 | 			<PeopleInviteDetails
      78 | 				site={ siteObject }
      79 | 				requesting={ false }

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/my-sites/people/people-invite-details/test/index.jsx:76:25)

  ● PeopleInviteDetails › should trigger deletion upon clicking Clear Invite (accepted invite)

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/state/selectors/get-media-url.js:5:1)
      at Object.<anonymous> (client/state/selectors/get-site-icon-url.js:11:1)
      at Object.<anonymous> (client/blocks/site-icon/index.jsx:20:1)
      at Object.<anonymous> (client/my-sites/sidebar-navigation/index.jsx:13:1)
      at Object.<anonymous> (client/my-sites/people/people-invite-details/index.jsx:15:1)
      at Object.<anonymous> (client/my-sites/people/people-invite-details/test/index.jsx:66:25)

  ● PeopleInviteDetails › should trigger deletion upon clicking Clear Invite (accepted invite)

    TypeError: Cannot read property 'contextTypes' of undefined

      103 | 		const mockDeleteInvite = jest.fn();
      104 | 
    > 105 | 		const inviteDetails = shallow(
          | 		                      ^
      106 | 			<PeopleInviteDetails
      107 | 				site={ siteObject }
      108 | 				requesting={ false }

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/my-sites/people/people-invite-details/test/index.jsx:105:25)

  ● PeopleInviteDetails › should navigate back (to the invite list) when an invite is deleted

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/state/selectors/get-media-url.js:5:1)
      at Object.<anonymous> (client/state/selectors/get-site-icon-url.js:11:1)
      at Object.<anonymous> (client/blocks/site-icon/index.jsx:20:1)
      at Object.<anonymous> (client/my-sites/sidebar-navigation/index.jsx:13:1)
      at Object.<anonymous> (client/my-sites/people/people-invite-details/index.jsx:15:1)
      at Object.<anonymous> (client/my-sites/people/people-invite-details/test/index.jsx:66:25)

  ● PeopleInviteDetails › should navigate back (to the invite list) when an invite is deleted

    TypeError: Cannot read property 'contextTypes' of undefined

      130 | 
      131 | 	it( 'should navigate back (to the invite list) when an invite is deleted', () => {
    > 132 | 		const inviteDetails = shallow(
          | 		                      ^
      133 | 			<PeopleInviteDetails
      134 | 				site={ siteObject }
      135 | 				requesting={ false }

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/my-sites/people/people-invite-details/test/index.jsx:132:25)

FAIL client/components/accordion/test/status.jsx
  ● AccordionStatus › should render with explicit props

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/test/status.jsx:18:21)

  ● AccordionStatus › should render with explicit props

    TypeError: Cannot read property 'contextTypes' of undefined

      27 | 			position: 'top left',
      28 | 		};
    > 29 | 		const wrapper = shallow( <AccordionStatus { ...status } /> );
         | 		                ^
      30 | 
      31 | 		expect( wrapper.find( 'a' ) )
      32 | 			.to.have.prop( 'href' )

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/status.jsx:29:19)

  ● AccordionStatus › should render with default props

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/test/status.jsx:18:21)

  ● AccordionStatus › should render with default props

    TypeError: Cannot read property 'contextTypes' of undefined

      45 | 
      46 | 	test( 'should render with default props', () => {
    > 47 | 		const wrapper = shallow( <AccordionStatus /> );
         | 		                ^
      48 | 
      49 | 		expect( wrapper.find( 'a' ) ).to.not.have.prop( 'href' );
      50 | 		expect( wrapper.find( 'a' ) ).to.have.className( 'is-info' );

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/status.jsx:47:19)

  ● AccordionStatus › should show tooltip on hover

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/test/status.jsx:18:21)

  ● AccordionStatus › should show tooltip on hover

    TypeError: Cannot read property 'contextTypes' of undefined

      56 | 
      57 | 	test( 'should show tooltip on hover', () => {
    > 58 | 		const wrapper = shallow( <AccordionStatus text="Warning!" /> );
         | 		                ^
      59 | 
      60 | 		expect( wrapper.find( Tooltip ) ).to.have.prop( 'isVisible' ).be.false;
      61 | 		expect( wrapper.find( Tooltip ) )

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/status.jsx:58:19)

  ● AccordionStatus › should call onClick callback

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/test/status.jsx:18:21)

  ● AccordionStatus › should call onClick callback

    TypeError: Cannot read property 'contextTypes' of undefined

      74 | 	test( 'should call onClick callback', () => {
      75 | 		const spy = sinon.spy();
    > 76 | 		const wrapper = shallow( <AccordionStatus onClick={ spy } /> );
         | 		                ^
      77 | 
      78 | 		wrapper.find( 'a' ).simulate( 'click' );
      79 | 

      at Object.render (node_modules/enzyme-adapter-react-16/src/ReactSixteenAdapter.js:626:54)
      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:397:22)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/components/accordion/test/status.jsx:76:19)

FAIL client/blocks/app-promo/test/index.jsx
  ● AppPromo › readering › should render the primary components

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/app-promo/index.jsx:18:1)
      at Object.<anonymous> (client/blocks/app-promo/test/index.jsx:30:14)

  ● AppPromo › readering › should render the primary components

    TypeError: ShallowWrapper can only wrap valid elements

      35 | 	describe( 'readering', () => {
      36 | 		test( 'should render the primary components', () => {
    > 37 | 			const wrapper = shallow( AppPromoComponent );
         | 			                ^
      38 | 
      39 | 			expect( wrapper ).to.have.descendants( '.app-promo' );
      40 | 			expect( wrapper ).to.have.descendants( '.app-promo__dismiss' );

      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:386:15)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/app-promo/test/index.jsx:37:20)

  ● AppPromo › readering › should render the promo text

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/app-promo/index.jsx:18:1)
      at Object.<anonymous> (client/blocks/app-promo/test/index.jsx:30:14)

  ● AppPromo › readering › should render the promo text

    TypeError: ShallowWrapper can only wrap valid elements

      43 | 
      44 | 		test( 'should render the promo text', () => {
    > 45 | 			const wrapper = shallow( AppPromoComponent );
         | 			                ^
      46 | 
      47 | 			expect( wrapper.text() ).to.contain( appPromoDetails.message );
      48 | 		} );

      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:386:15)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/app-promo/test/index.jsx:45:20)

  ● AppPromo › readering › should render the promo link

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/app-promo/index.jsx:18:1)
      at Object.<anonymous> (client/blocks/app-promo/test/index.jsx:30:14)

  ● AppPromo › readering › should render the promo link

    TypeError: ShallowWrapper can only wrap valid elements

      49 | 
      50 | 		test( 'should render the promo link', () => {
    > 51 | 			const wrapper = shallow( AppPromoComponent );
         | 			                ^
      52 | 
      53 | 			const promoLink = wrapper.find( '.app-promo__link' );
      54 | 			expect( promoLink ).to.have.lengthOf( 1 );

      at new ShallowWrapper (node_modules/enzyme/src/ShallowWrapper.js:386:15)
      at shallow (node_modules/enzyme/src/shallow.js:10:10)
      at Object.<anonymous> (client/blocks/app-promo/test/index.jsx:51:20)

  ● AppPromo › getPromoLink › should render a mobile link when the mobile promo code is passed in

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/app-promo/index.jsx:18:1)
      at Object.<anonymous> (client/blocks/app-promo/test/index.jsx:30:14)

  ● AppPromo › getPromoLink › should render a mobile link when the mobile promo code is passed in

    TypeError: getPromoLink is not a function

      73 | 
      74 | 		test( 'should render a mobile link when the mobile promo code is passed in', () => {
    > 75 | 			expect( getPromoLink( 'reader', mobilePromo ) ).to.include( 'mobile' );
         | 			        ^
      76 | 		} );
      77 | 
      78 | 		test( 'should render a desktop link when the desktop promo code is passed in', () => {

      at Object.<anonymous> (client/blocks/app-promo/test/index.jsx:75:12)

  ● AppPromo › getPromoLink › should render a desktop link when the desktop promo code is passed in

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/app-promo/index.jsx:18:1)
      at Object.<anonymous> (client/blocks/app-promo/test/index.jsx:30:14)

  ● AppPromo › getPromoLink › should render a desktop link when the desktop promo code is passed in

    TypeError: getPromoLink is not a function

      77 | 
      78 | 		test( 'should render a desktop link when the desktop promo code is passed in', () => {
    > 79 | 			expect( getPromoLink( 'reader', desktopPromo ) ).to.include( 'desktop' );
         | 			        ^
      80 | 		} );
      81 | 	} );
      82 | } );

      at Object.<anonymous> (client/blocks/app-promo/test/index.jsx:79:12)

FAIL client/state/posts/test/selectors.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/posts/test/utils.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/lib/media/test/utils.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/test/utils.js:14:1)

FAIL client/state/data-layer/wpcom/comments/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/lib/post-normalizer/test/utils.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/comments/test/reducer.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/notices/test/middleware.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/components/remove-button/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/state/posts/test/actions.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/comments/test/selectors.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/terms/test/actions.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/reader/streams/test/reducer.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/reader/feeds/test/reducer.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/reader/posts/test/normalization-rules.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/reader/posts/test/actions.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/ui/editor/last-draft/test/selectors.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/components/plans/plans-skip-button/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/state/ui/guided-tours/test/contexts.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/state/ui/guided-tours/contexts.js:14:1)
      at Object.<anonymous> (client/state/ui/guided-tours/test/contexts.js:14:1)

FAIL client/state/ui/guided-tours/test/selectors.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media/store.js:10:1)
      at Object.<anonymous> (client/state/ui/guided-tours/contexts.js:14:1)
      at Object.<anonymous> (client/state/ui/guided-tours/test/fixtures/config.js:9:1)
      at Object.user:/benchmarks/nacd/Automattic_wp-calypso/client/layout/guided-tours/config.js: (client/state/ui/guided-tours/test/selectors.js:17:9)
      at Object.<anonymous> (client/state/ui/guided-tours/selectors/index.js:29:1)
      at Object.<anonymous> (client/state/ui/guided-tours/test/selectors.js:14:1)

FAIL client/state/data-layer/wpcom/read/streams/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/ui/editor/save-blockers/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/components/credit-card-form-fields/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/info-popover/index.jsx:13:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/country-specific-payment-fields.jsx:16:1)
      at Object.<anonymous> (client/components/credit-card-form-fields/index.jsx:18:1)
      at Object.<anonymous> (client/components/credit-card-form-fields/test/index.js:15:1)

FAIL client/state/themes/test/actions.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/jetpack-connect/test/main.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/jetpack-connect/main.jsx:15:1)
      at Object.<anonymous> (client/jetpack-connect/test/main.js:15:1)

FAIL client/blocks/login/test/login-form.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/forms/form-button/index.jsx:13:1)
      at Object.<anonymous> (client/blocks/login/test/login-form.jsx:16:1)

FAIL client/jetpack-connect/test/authorize.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/jetpack-connect/auth-form-header.jsx:13:1)
      at Object.<anonymous> (client/jetpack-connect/authorize.js:15:1)
      at Object.<anonymous> (client/jetpack-connect/test/authorize.js:16:1)

FAIL client/auth/test/login.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/forms/form-button/index.jsx:13:1)
      at Object.<anonymous> (client/auth/login.jsx:15:1)
      at Object.<anonymous> (client/auth/test/login.jsx:17:1)

FAIL client/state/ui/editor/test/selectors.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/devdocs/design/test/component-playground.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/devdocs/design/component-playground.jsx:13:1)
      at Object.<anonymous> (client/devdocs/design/test/component-playground.js:15:1)

FAIL client/blocks/plan-storage/test/bar.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/devdocs/docs-example/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/jetpack-connect/test/auth-form-header.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/jetpack-connect/auth-form-header.jsx:13:1)
      at Object.<anonymous> (client/jetpack-connect/test/auth-form-header.js:15:1)

FAIL client/jetpack-connect/test/plans.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/foldable-card/index.jsx:14:1)
      at Object.<anonymous> (client/my-sites/plan-features/index.jsx:17:1)
      at Object.<anonymous> (client/my-sites/plans-features-main/index.jsx:17:1)
      at Object.<anonymous> (client/jetpack-connect/plans-grid.jsx:14:1)
      at Object.<anonymous> (client/jetpack-connect/test/plans.js:13:1)

FAIL client/state/data-layer/wpcom/sites/comments/replies/new/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/blocks/plan-storage/test/plan-storage.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)

FAIL client/jetpack-connect/test/signup.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/jetpack-connect/auth-form-header.jsx:13:1)
      at Object.<anonymous> (client/jetpack-connect/signup.js:22:1)
      at Object.<anonymous> (client/jetpack-connect/test/signup.js:17:1)

FAIL client/my-sites/email/gsuite-purchase-cta/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/email/email-management/gsuite-user-item/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/state/data-layer/wpcom/sites/comments/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/components/marketing-survey/cancel-purchase-form/step-components/test/upgrade-at-step.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/state/data-layer/wpcom/sites/posts/replies/new/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/blocks/product-purchase-features-list/test/product-purchase-features-list.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/email/email-forwarding/test/email-forwarding-item.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/data-layer/wpcom/sites/test/utils.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/data-layer/wpcom/sites/simple-payments/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/my-sites/themes/test/logged-out.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/components/site-verticals-suggestion-search/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/state/selectors/test/get-site-icon-url.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/state/selectors/get-media-url.js:5:1)

FAIL client/state/ui/editor/test/actions.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/components/tinymce/plugins/embed/test/dialog.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/plans-features-main/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/blocks/image-selector/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/image-selector/preview.jsx:15:1)
      at Object.<anonymous> (client/blocks/image-selector/index.jsx:14:1)
      at Object.<anonymous> (client/blocks/image-selector/test/index.jsx:18:1)

FAIL client/components/themes-list/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/empty-content/index.jsx:12:1)
      at Object.<anonymous> (client/components/themes-list/test/index.jsx:16:1)

FAIL client/components/theme/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/theme/index.jsx:17:1)
      at Object.<anonymous> (client/components/theme/test/index.jsx:20:1)

FAIL client/my-sites/site-settings/seo-settings/test/form.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/site-settings/seo-settings/form.jsx:12:1)
      at Object.<anonymous> (client/my-sites/site-settings/seo-settings/test/form.jsx:35:1)

FAIL client/blocks/upwork-banner/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/components/button-group/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/components/support-info/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/info-popover/index.jsx:13:1)
      at Object.<anonymous> (client/components/support-info/index.jsx:11:1)
      at Object.<anonymous> (client/components/support-info/test/index.js:15:1)

FAIL client/components/drop-zone/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/drop-zone/index.jsx:16:1)
      at Object.<anonymous> (client/components/drop-zone/test/index.jsx:17:1)

FAIL client/my-sites/media-library/test/data-source.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/media-library/data-source.jsx:16:1)
      at Object.<anonymous> (client/my-sites/media-library/test/data-source.jsx:17:1)

FAIL client/my-sites/site-settings/test/form-general.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/blocks/credit-card-form/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/credit-card-form/index.jsx:15:1)
      at Object.<anonymous> (client/blocks/credit-card-form/test/index.js:15:1)

FAIL client/my-sites/site-settings/test/form-analytics.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/site-settings/form-analytics.jsx:12:1)
      at Object.<anonymous> (client/my-sites/site-settings/test/form-analytics.jsx:36:1)

FAIL client/my-sites/media-library/test/list-item.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/my-sites/media-library/list-item-image.jsx:11:1)
      at Object.<anonymous> (client/my-sites/media-library/list-item.tsx:13:1)
      at Object.<anonymous> (client/my-sites/media-library/test/list-item.jsx:16:1)

FAIL client/components/domains/contact-details-form-fields/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/forms/form-button/index.jsx:13:1)
      at Object.<anonymous> (client/components/domains/contact-details-form-fields/index.jsx:30:1)
      at Object.<anonymous> (client/components/domains/contact-details-form-fields/test/index.js:16:1)

FAIL client/my-sites/media-library/test/list-item-image.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/my-sites/media-library/test/list-item-image.jsx:16:1)

FAIL client/components/domains/domain-suggestion/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/domains/domain-suggestion/index.jsx:14:1)
      at Object.<anonymous> (client/components/domains/domain-suggestion/test/index.js:16:1)

FAIL client/components/gravatar/test/index.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/components/gravatar/index.jsx:13:1)

FAIL client/lib/media-serialization/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/lib/media-serialization/detect-format.js:11:1)
      at Object.<anonymous> (client/lib/media-serialization/index.js:4:1)
      at Object.<anonymous> (client/lib/media-serialization/test/index.js:13:1)

FAIL client/my-sites/media-library/test/index.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/my-sites/media-library/index.jsx:18:1)
      at Object.<anonymous> (client/my-sites/media-library/test/index.jsx:15:1)

FAIL client/components/community-translator/test/translatable.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/community-translator/translatable.jsx:13:1)
      at Object.<anonymous> (client/components/community-translator/test/translatable.js:13:1)

FAIL client/state/selectors/test/edited-post-has-content.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/my-sites/media-library/test/list.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)
      at Object.<anonymous> (client/lib/post-normalizer/rule-pick-canonical-image.js:10:1)
      at Object.<anonymous> (client/state/posts/utils.js:37:1)
      at Object.<anonymous> (client/state/posts/selectors.js:10:1)
      at Object.<anonymous> (client/state/ui/editor/selectors.js:12:1)
      at Object.<anonymous> (client/lib/media/actions.js:15:1)
      at Object.<anonymous> (client/my-sites/media-library/list.jsx:14:1)
      at Object.<anonymous> (client/my-sites/media-library/test/list.jsx:17:1)

FAIL client/my-sites/checkout/checkout/test/pending-payment-blocker.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/checkout/pending-payment-blocker.jsx:11:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/pending-payment-blocker.js:14:1)

FAIL client/components/happiness-support/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/blocks/post-time/test/index.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/components/happychat/test/composer.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/components/date-range/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/date-range/index.js:18:1)
      at Object.<anonymous> (client/components/date-range/test/index.js:17:1)

FAIL client/my-sites/checkout/checkout/test/redirect-payment-box.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/cart/cart-coupon.jsx:13:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/redirect-payment-box.jsx:13:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/redirect-payment-box.js:15:1)

FAIL client/my-sites/media-library/test/content.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)
      at Object.<anonymous> (client/lib/post-normalizer/rule-pick-canonical-image.js:10:1)
      at Object.<anonymous> (client/state/posts/utils.js:37:1)
      at Object.<anonymous> (client/state/posts/selectors.js:10:1)
      at Object.<anonymous> (client/state/ui/editor/selectors.js:12:1)
      at Object.<anonymous> (client/lib/media/actions.js:15:1)
      at Object.<anonymous> (client/components/data/media-list-data/index.jsx:12:1)
      at Object.<anonymous> (client/my-sites/media-library/content.jsx:19:1)
      at Object.<anonymous> (client/my-sites/media-library/test/content.jsx:15:1)

FAIL client/components/happychat/test/button.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/checkout/checkout/test/country-specific-payment-fields.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/info-popover/index.jsx:13:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/country-specific-payment-fields.jsx:16:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/country-specific-payment-fields.js:15:1)

FAIL client/components/purchase-detail/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/lib/accept/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/lib/accept/dialog.jsx:12:1)
      at Object.<anonymous> (client/lib/accept/index.js:11:1)
      at Object.<anonymous> (client/lib/accept/test/index.js:8:1)

FAIL client/components/language-picker/test/modal.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/language-picker/modal.jsx:27:1)
      at Object.<anonymous> (client/components/language-picker/test/modal.js:15:1)

FAIL client/my-sites/checkout/checkout/test/checkout.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/checkout/pending-payment-blocker.jsx:11:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/index.jsx:43:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/checkout.js:15:1)

FAIL client/my-sites/checkout/checkout/test/wechat-payment-box.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/cart/cart-coupon.jsx:13:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/wechat-payment-box.jsx:15:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/wechat-payment-box.js:14:1)

FAIL client/components/language-picker/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/language-picker/modal.jsx:27:1)
      at Object.<anonymous> (client/components/language-picker/index.jsx:15:1)
      at Object.<anonymous> (client/components/language-picker/test/index.jsx:15:1)

FAIL client/my-sites/checkout/checkout/test/credit-card-payment-box.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/checkout/pay-button.jsx:12:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/credit-card-payment-box.jsx:12:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/credit-card-payment-box.js:15:1)

FAIL client/blocks/nps-survey/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/nps-survey/index.jsx:16:1)
      at Object.<anonymous> (client/blocks/nps-survey/test/index.jsx:15:1)

FAIL client/state/posts/test/reducer.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/my-sites/checkout/checkout/test/domain-details-form.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/checkout/payment-box.jsx:14:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/domain-details-form.jsx:17:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/domain-details-form.js:16:1)

FAIL client/components/banner/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/components/external-link/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/checkout/checkout/test/payment-box.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/checkout/payment-box.jsx:14:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/payment-box.js:15:1)

FAIL client/components/suggestion-search/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/checkout/checkout/test/web-payment-box.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/cart/cart-coupon.jsx:13:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/web-payment-box.jsx:16:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/web-payment-box.js:16:1)

FAIL client/components/popover/test/menu-item.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/checkout/checkout/test/pay-button.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/checkout/pay-button.jsx:12:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/pay-button.js:15:1)

FAIL client/my-sites/checkout/checkout/test/paypal-payment-box.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/cart/cart-coupon.jsx:13:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/paypal-payment-box.jsx:22:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/paypal-payment-box.js:15:1)

FAIL client/blocks/image-editor/test/image-editor-canvas.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/blocks/image-editor/image-editor-canvas.jsx:15:1)
      at Object.<anonymous> (client/blocks/image-editor/test/image-editor-canvas.jsx:15:1)

FAIL client/signup/navigation-link/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/components/sites-dropdown/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/state/selectors/get-media-url.js:5:1)
      at Object.<anonymous> (client/state/selectors/get-site-icon-url.js:11:1)
      at Object.<anonymous> (client/blocks/site-icon/index.jsx:20:1)
      at Object.<anonymous> (client/blocks/site/index.jsx:16:1)
      at Object.<anonymous> (client/components/sites-dropdown/index.jsx:15:1)
      at Object.<anonymous> (client/components/sites-dropdown/test/index.js:17:1)

FAIL client/blocks/image-editor/test/image-editor-toolbar.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/popover/menu.jsx:10:1)
      at Object.<anonymous> (client/blocks/image-editor/image-editor-toolbar.jsx:16:1)
      at Object.<anonymous> (client/blocks/image-editor/test/image-editor-toolbar.jsx:16:1)

FAIL client/my-sites/checkout/checkout/test/credits-payment-box.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/checkout/pay-button.jsx:12:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/credits-payment-box.jsx:13:1)
      at Object.<anonymous> (client/my-sites/checkout/checkout/test/credits-payment-box.js:15:1)

FAIL client/signup/submit-step-button/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/state/selectors/test/get-parent-comment.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/my-sites/checkout/cart/test/cart-coupon.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/cart/cart-coupon.jsx:13:1)
      at Object.<anonymous> (client/my-sites/checkout/cart/test/cart-coupon.js:15:1)

FAIL client/my-sites/checkout/cart/test/cart-buttons.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/checkout/cart/cart-buttons.jsx:15:1)
      at Object.<anonymous> (client/my-sites/checkout/cart/test/cart-buttons.js:14:1)

FAIL client/signup/steps/site-style/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/signup/steps/site-style/index.jsx:15:1)
      at Object.<anonymous> (client/signup/steps/site-style/test/index.js:15:1)

FAIL client/my-sites/checkout/checkout-thank-you/test/header.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/signup/steps/plans/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/checkout/checkout-thank-you/test/index.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/selectors/test/get-active-reply-comment-id.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/my-sites/plan-features/test/header.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/info-popover/index.jsx:13:1)
      at Object.<anonymous> (client/my-sites/plan-features/header.jsx:15:1)
      at Object.<anonymous> (client/my-sites/plan-features/test/header.jsx:36:1)

FAIL client/post-editor/editor-publish-button/test/index.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)
      at Object.<anonymous> (client/lib/post-normalizer/rule-pick-canonical-image.js:10:1)
      at Object.<anonymous> (client/state/posts/utils.js:37:1)
      at Object.<anonymous> (client/state/posts/stats.js:11:1)
      at Object.<anonymous> (client/post-editor/editor-publish-button/index.jsx:13:1)
      at Object.<anonymous> (client/post-editor/editor-publish-button/test/index.jsx:18:1)

FAIL client/state/ui/editor/test/edit-save-flow.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/my-sites/plan-features/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/layout/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/plugins/plugin-autoupdate-toggle/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/external-link/index.jsx:14:1)
      at Object.<anonymous> (client/my-sites/plugins/plugin-autoupdate-toggle/index.jsx:15:1)
      at Object.<anonymous> (client/my-sites/plugins/plugin-autoupdate-toggle/test/index.jsx:18:1)

FAIL client/my-sites/plugins/plugins-list/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/lib/accept/dialog.jsx:12:1)
      at Object.<anonymous> (client/lib/accept/index.js:11:1)
      at Object.<anonymous> (client/my-sites/plugins/plugins-list/index.jsx:17:1)
      at Object.<anonymous> (client/my-sites/plugins/plugins-list/test/index.jsx:15:1)

FAIL client/post-editor/media-modal/test/index.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)
      at Object.<anonymous> (client/lib/post-normalizer/rule-pick-canonical-image.js:10:1)
      at Object.<anonymous> (client/state/posts/utils.js:37:1)
      at Object.<anonymous> (client/state/posts/stats.js:11:1)
      at Object.<anonymous> (client/post-editor/media-modal/index.jsx:30:1)
      at Object.<anonymous> (client/post-editor/media-modal/test/index.jsx:16:1)

FAIL client/post-editor/editor-notice/test/index.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/post-editor/editor-ground-control/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/post-editor/editor-ground-control/index.jsx:15:1)
      at Object.<anonymous> (client/post-editor/editor-ground-control/test/index.jsx:15:1)

FAIL client/post-editor/media-modal/detail/test/index.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/resize-image-url/index.js:10:1)
      at Object.<anonymous> (client/lib/media/utils.js:12:1)
      at Object.<anonymous> (client/post-editor/media-modal/detail/detail-preview-image.jsx:15:1)
      at Object.<anonymous> (client/post-editor/media-modal/detail/detail-item.jsx:20:1)
      at Object.<anonymous> (client/post-editor/media-modal/detail/test/index.jsx:15:1)

FAIL client/my-sites/plugins/plugins-browser/test/index.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/state/selectors/get-media-url.js:5:1)
      at Object.<anonymous> (client/state/selectors/get-site-icon-url.js:11:1)
      at Object.<anonymous> (client/blocks/site-icon/index.jsx:20:1)
      at Object.<anonymous> (client/my-sites/sidebar-navigation/index.jsx:13:1)
      at Object.<anonymous> (client/my-sites/plugins/plugins-browser/index.jsx:14:1)
      at Object.<anonymous> (client/my-sites/plugins/plugins-browser/test/index.jsx:41:1)

FAIL client/blocks/upgrade-nudge/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/state/test/persistence.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/my-sites/plugins/plugin-meta/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/post-editor/editor-discussion/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/external-link/index.jsx:14:1)
      at Object.<anonymous> (client/post-editor/editor-discussion/index.jsx:17:1)
      at Object.<anonymous> (client/post-editor/editor-discussion/test/index.jsx:17:1)

FAIL client/post-editor/editor-word-count/test/index.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)
      at Object.<anonymous> (client/lib/post-normalizer/rule-pick-canonical-image.js:10:1)
      at Object.<anonymous> (client/state/posts/utils.js:37:1)
      at Object.<anonymous> (client/state/posts/selectors.js:10:1)
      at Object.<anonymous> (client/state/ui/editor/selectors.js:12:1)
      at Object.<anonymous> (client/post-editor/editor-word-count/index.jsx:15:1)
      at Object.<anonymous> (client/post-editor/editor-word-count/test/index.jsx:16:1)

FAIL client/post-editor/editor-categories-tags/test/accordion.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/post-editor/editor-categories-tags/accordion.jsx:15:1)
      at Object.<anonymous> (client/post-editor/editor-categories-tags/test/accordion.jsx:16:1)

FAIL client/post-editor/editor-sharing/test/publicize-connection.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)
      at Object.<anonymous> (client/lib/post-normalizer/rule-pick-canonical-image.js:10:1)
      at Object.<anonymous> (client/state/posts/utils.js:37:1)
      at Object.<anonymous> (client/state/posts/stats.js:11:1)
      at Object.<anonymous> (client/post-editor/editor-sharing/publicize-connection.jsx:18:1)
      at Object.<anonymous> (client/post-editor/editor-sharing/test/publicize-connection.jsx:15:1)

FAIL client/state/test/initial-state.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)
      at Object.<anonymous> (client/state/comments/utils.js:4:1)
      at Object.<anonymous> (client/state/comments/reducer.js:50:1)
      at Object.<anonymous> (client/state/reducer.js:27:1)
      at Object.<anonymous> (client/state/index.js:10:1)
      at Object.<anonymous> (client/state/test/initial-state.js:19:1)

FAIL client/my-sites/sidebar/test/sidebar.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/state/selectors/get-media-url.js:5:1)

FAIL client/post-editor/edit-post-status/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/post-editor/edit-post-status/index.jsx:13:1)
      at Object.<anonymous> (client/post-editor/edit-post-status/test/index.jsx:16:1)

FAIL client/my-sites/domains/map-domain/test/map-domain.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/header-cake/index.jsx:12:1)
      at Object.<anonymous> (client/my-sites/domains/map-domain/index.jsx:14:1)
      at Object.<anonymous> (client/my-sites/domains/map-domain/test/map-domain.js:15:1)

FAIL client/me/pending-payments/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/reader/sidebar/test/promo.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/app-promo/index.jsx:18:1)
      at Object.<anonymous> (client/reader/sidebar/promo.jsx:15:1)
      at Object.<anonymous> (client/reader/sidebar/test/promo.jsx:14:1)

FAIL client/me/pending-payments/test/pending-list-item.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/state/selectors/test/get-media-url.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/state/selectors/get-media-url.js:5:1)

FAIL client/blocks/eligibility-warnings/test/index.tsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/eligibility-warnings/index.tsx:21:1)
      at Object.<anonymous> (client/blocks/eligibility-warnings/test/index.tsx:23:1)

FAIL client/blocks/daily-post-button/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/sites-popover/index.jsx:12:1)
      at Object.<anonymous> (client/blocks/daily-post-button/index.jsx:18:1)
      at Object.<anonymous> (client/blocks/daily-post-button/test/index.jsx:18:1)

FAIL client/my-sites/domains/components/domain-warnings/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/domains/components/domain-warnings/pending-gsuite-tos-notice-action.js:7:1)
      at Object.<anonymous> (client/my-sites/domains/components/domain-warnings/pending-gsuite-tos-notice.jsx:16:1)
      at Object.<anonymous> (client/my-sites/domains/components/domain-warnings/index.jsx:18:1)
      at Object.<anonymous> (client/my-sites/domains/components/domain-warnings/test/index.js:17:1)

FAIL client/me/help/help-courses/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/domains/domain-management/edit/card/header/test/primary-domain-button.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/me/help/test/main.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/domains/domain-management/edit/test/mapped-domain.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/domains/domain-management/edit/mapped-domain.jsx:11:1)
      at Object.<anonymous> (client/my-sites/domains/domain-management/edit/test/mapped-domain.js:13:1)

FAIL client/my-sites/domains/domain-management/transfer/transfer-to-other-site/test/index.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/my-sites/domains/domain-management/list/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/my-sites/domains/components/domain-warnings/pending-gsuite-tos-notice-action.js:7:1)
      at Object.<anonymous> (client/my-sites/domains/components/domain-warnings/pending-gsuite-tos-notice.jsx:16:1)
      at Object.<anonymous> (client/my-sites/domains/components/domain-warnings/index.jsx:18:1)
      at Object.<anonymous> (client/my-sites/domains/domain-management/list/index.jsx:18:1)
      at Object.<anonymous> (client/my-sites/domains/domain-management/list/test/index.js:16:1)

FAIL client/me/help/help-search/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/me/help/help-search/index.jsx:12:1)
      at Object.<anonymous> (client/me/help/help-search/test/index.js:16:1)

FAIL client/state/selectors/test/can-current-user-edit-post.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/me/concierge/test/main.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)

FAIL client/blocks/app-banner/test/app-banner.jsx
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/blocks/app-banner/index.jsx:15:1)
      at Object.<anonymous> (client/blocks/app-banner/test/app-banner.jsx:8:1)

FAIL client/my-sites/hosting/sftp-card/test/index.js
  ● Test suite failed to run

    TypeError: (0 , _toConsumableArray2.default)(...).flat is not a function

      65 | };
      66 | exports.iconToProductSlugMap = iconToProductSlugMap;
    > 67 | var supportedSlugs = (0, _toConsumableArray2.default)(Object.values(iconToProductSlugMap)).flat();
         |                                                                                            ^
      68 | exports.supportedSlugs = supportedSlugs;

      at Object.<anonymous> (packages/components/dist/cjs/product-icon/config.js:67:92)
      at Object.<anonymous> (packages/components/dist/cjs/product-icon/index.js:18:15)
      at Object.<anonymous> (packages/components/dist/cjs/index.js:77:43)
      at Object.<anonymous> (client/components/popover/index.jsx:15:1)
      at Object.<anonymous> (client/components/tooltip/index.jsx:12:1)
      at Object.<anonymous> (client/components/accordion/status.jsx:13:1)
      at Object.<anonymous> (client/components/accordion/index.jsx:14:1)
      at Object.<anonymous> (client/my-sites/hosting/sftp-card/index.js:12:1)
      at Object.<anonymous> (client/my-sites/hosting/sftp-card/test/index.js:14:1)

FAIL client/state/comments/test/actions.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/state/selectors/test/get-editor-close-config.js
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)

FAIL client/my-sites/theme/test/main.jsx
  ● Test suite failed to run

    ReferenceError: globalThis is not defined

      15 |  */
      16 | let REGEX_EXEMPT_URL;
    > 17 | if ( typeof globalThis.location === 'object' ) {
         | ^
      18 | 	REGEX_EXEMPT_URL = new RegExp(
      19 | 		`^(/(?!/)|data:image/[^;]+;|blob:${ globalThis.location.origin }/)`
      20 | 	);

      at Object.<anonymous> (client/lib/safe-image-url/index.js:17:1)
      at Object.<anonymous> (client/lib/post-normalizer/utils.js:10:1)


Test Suites: 174 failed, 1251 passed, 1425 total
Tests:       240 failed, 4 skipped, 10761 passed, 11005 total
Snapshots:   34 passed, 34 total
Time:        71.751s
Ran all test suites.
npm ERR! Test failed.  See above for more details.
